<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i class="fas fa-share-alt"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i class="far fa-file-alt"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i class="fas fa-history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i class="fas fa-print"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i class="fas fa-file-download"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x20e96a=_0x583a;(function(_0x14c8a8,_0x480649){const _0x1c8acf=_0x583a,_0x3b9634=_0x14c8a8();while(!![]){try{const _0x674819=-parseInt(_0x1c8acf(0x23f))/0x1*(parseInt(_0x1c8acf(0x28b))/0x2)+-parseInt(_0x1c8acf(0x1dc))/0x3*(parseInt(_0x1c8acf(0x24b))/0x4)+parseInt(_0x1c8acf(0x251))/0x5*(parseInt(_0x1c8acf(0x275))/0x6)+-parseInt(_0x1c8acf(0x1ee))/0x7+-parseInt(_0x1c8acf(0x21b))/0x8*(parseInt(_0x1c8acf(0x229))/0x9)+parseInt(_0x1c8acf(0x274))/0xa*(parseInt(_0x1c8acf(0x249))/0xb)+parseInt(_0x1c8acf(0x239))/0xc*(parseInt(_0x1c8acf(0x1e8))/0xd);if(_0x674819===_0x480649)break;else _0x3b9634['push'](_0x3b9634['shift']());}catch(_0xd1f802){_0x3b9634['push'](_0x3b9634['shift']());}}}(_0x2c84,0x23fa9));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':'AIzaSyBwLgE4rF7RimBCr2cx8krF2c9FpXetQLc','authDomain':_0x20e96a(0x1df),'databaseURL':'https://dlswifi-default-rtdb.firebaseio.com','projectId':_0x20e96a(0x1f4),'storageBucket':'dlswifi.firebasestorage.app','messagingSenderId':_0x20e96a(0x27f),'appId':_0x20e96a(0x25d),'measurementId':'G-YDLNR7S0C6'},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x20e96a(0x1d3));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window[_0x20e96a(0x255)]=window[_0x20e96a(0x256)][_0x20e96a(0x255)];async function fetchVendors(){const _0x81aa98=_0x20e96a;try{const _0x5d923b=ref(db,_0x81aa98(0x1fa)),_0x19593f=await get(_0x5d923b);_0x19593f[_0x81aa98(0x228)]()?(vendors=_0x19593f[_0x81aa98(0x236)](),availableUsernames=Object[_0x81aa98(0x1d9)](vendors)):console['log'](_0x81aa98(0x1dd));}catch(_0x12310c){console[_0x81aa98(0x25e)](_0x81aa98(0x1d5),_0x12310c);}}const usernameInput=document[_0x20e96a(0x246)](_0x20e96a(0x23c)),passwordInput=document[_0x20e96a(0x246)](_0x20e96a(0x20b)),suggestionsList=document[_0x20e96a(0x246)](_0x20e96a(0x29f));usernameInput[_0x20e96a(0x289)](_0x20e96a(0x1f1),()=>{const _0x668854=_0x20e96a,_0x4ab8f3=usernameInput[_0x668854(0x1cf)][_0x668854(0x290)](),_0x50cc37=availableUsernames[_0x668854(0x226)](_0x4f2822=>_0x4f2822[_0x668854(0x290)]()[_0x668854(0x2a6)](_0x4ab8f3));suggestionsList[_0x668854(0x1f5)]='';if(_0x4ab8f3[_0x668854(0x262)]===0x0||_0x50cc37['length']===0x0){suggestionsList[_0x668854(0x29b)][_0x668854(0x1d0)]=_0x668854(0x258);return;}_0x50cc37[_0x668854(0x254)](_0x4b6ad5=>{const _0x573f44=_0x668854,_0x442d06=document[_0x573f44(0x211)]('li');_0x442d06[_0x573f44(0x252)]=_0x4b6ad5,_0x442d06['addEventListener'](_0x573f44(0x23b),()=>{const _0x33a2c4=_0x573f44;usernameInput[_0x33a2c4(0x1cf)]=_0x4b6ad5,suggestionsList['innerHTML']='',suggestionsList[_0x33a2c4(0x29b)][_0x33a2c4(0x1d0)]=_0x33a2c4(0x258);}),suggestionsList['appendChild'](_0x442d06);}),suggestionsList[_0x668854(0x29b)]['display']=_0x668854(0x28c);}),document['addEventListener'](_0x20e96a(0x23b),_0x15e1e7=>{const _0x28f09e=_0x20e96a;!usernameInput[_0x28f09e(0x1e4)](_0x15e1e7['target'])&&!suggestionsList[_0x28f09e(0x1e4)](_0x15e1e7[_0x28f09e(0x219)])&&(suggestionsList['style'][_0x28f09e(0x1d0)]=_0x28f09e(0x258));});const rememberMeCheckbox=document['getElementById'](_0x20e96a(0x281)),storedUsername=localStorage[_0x20e96a(0x205)](_0x20e96a(0x23c)),storedPassword=localStorage[_0x20e96a(0x205)](_0x20e96a(0x20b)),storedTimestamp=localStorage[_0x20e96a(0x205)]('usernameTimestamp'),now=Date['now'](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0x20e96a(0x1cf)]=storedUsername,passwordInput['value']=storedPassword,rememberMeCheckbox[_0x20e96a(0x2a2)]=!![]);const loginForm=document[_0x20e96a(0x246)]('loginForm'),loginError=document[_0x20e96a(0x246)](_0x20e96a(0x23d)),ratesSection=document[_0x20e96a(0x25f)](_0x20e96a(0x22a)),historySection=document[_0x20e96a(0x246)](_0x20e96a(0x1f6)),loginSection=document['getElementById'](_0x20e96a(0x218)),messagesSection=document[_0x20e96a(0x246)](_0x20e96a(0x242));loginForm[_0x20e96a(0x289)]('submit',async _0x356c41=>{const _0x2d0d69=_0x20e96a;_0x356c41[_0x2d0d69(0x28a)](),showLoader();const _0x14c414=usernameInput[_0x2d0d69(0x1cf)],_0x53b959=passwordInput['value'];vendors[_0x14c414]&&vendors[_0x14c414][_0x2d0d69(0x20b)]===_0x53b959?(loginError[_0x2d0d69(0x29b)][_0x2d0d69(0x1d0)]='none',ratesSection[_0x2d0d69(0x29b)]['display']=_0x2d0d69(0x28c),historySection['style']['display']='none',loginSection[_0x2d0d69(0x29b)][_0x2d0d69(0x1d0)]='none',messagesSection['style']['display']=_0x2d0d69(0x28c),currentVendorId=_0x14c414,rememberMeCheckbox[_0x2d0d69(0x2a2)]?(localStorage[_0x2d0d69(0x299)](_0x2d0d69(0x23c),_0x14c414),localStorage['setItem'](_0x2d0d69(0x20b),_0x53b959),localStorage[_0x2d0d69(0x299)]('usernameTimestamp',Date['now']())):(localStorage[_0x2d0d69(0x233)](_0x2d0d69(0x23c)),localStorage[_0x2d0d69(0x233)](_0x2d0d69(0x20b)),localStorage[_0x2d0d69(0x233)](_0x2d0d69(0x285))),await syncTickets(),loadHistory(),listenForNewMessages(),hideLoader()):(loginError[_0x2d0d69(0x29b)][_0x2d0d69(0x1d0)]=_0x2d0d69(0x28c),loginError[_0x2d0d69(0x252)]='Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.',hideLoader());});async function syncTickets(){const _0xaafa92=_0x20e96a;try{const _0x28e51c=document[_0xaafa92(0x25f)]('.loading-message'),_0x3f0b5c=document[_0xaafa92(0x25f)]('.rates-section\x20table');_0x28e51c[_0xaafa92(0x29b)]['display']=_0xaafa92(0x28c),_0x3f0b5c['style'][_0xaafa92(0x1d0)]=_0xaafa92(0x258);const _0x7187f0=ref(db,_0xaafa92(0x27a)),_0x486875=await get(_0x7187f0);_0x486875[_0xaafa92(0x228)]()?(localTickets=_0x486875[_0xaafa92(0x236)](),createTicketTable(),_0x28e51c[_0xaafa92(0x29b)][_0xaafa92(0x1d0)]=_0xaafa92(0x258),_0x3f0b5c[_0xaafa92(0x29b)][_0xaafa92(0x1d0)]=_0xaafa92(0x28f)):_0x28e51c[_0xaafa92(0x252)]=_0xaafa92(0x279);}catch(_0x3f2477){console['error'](_0xaafa92(0x1ec),_0x3f2477),loadingMessage[_0xaafa92(0x252)]=_0xaafa92(0x21a);}}async function createTicketTable(){const _0x314bbf=_0x20e96a,_0x52ae06=document['querySelector']('.rates-section\x20table');_0x52ae06[_0x314bbf(0x1f5)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';for(const [_0xc08f5e,_0x153166]of Object['entries'](localTickets)){const _0x64e0c7=_0x153166[_0x314bbf(0x27d)]?_0x153166[_0x314bbf(0x27d)][_0x314bbf(0x262)]:0x0;if(_0x64e0c7>0x0){const _0x4e9b92=_0x153166[_0x314bbf(0x266)][0x0],_0x1e3388=_0x52ae06[_0x314bbf(0x20c)]();_0x1e3388[_0x314bbf(0x1f5)]=_0x314bbf(0x260)+_0xc08f5e+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x4e9b92+_0x314bbf(0x26c)+_0x64e0c7+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27'+_0xc08f5e+_0x314bbf(0x20f);}}document['querySelector']('.loading-message')[_0x314bbf(0x29b)][_0x314bbf(0x1d0)]=_0x314bbf(0x258),_0x52ae06[_0x314bbf(0x29b)][_0x314bbf(0x1d0)]='table';}window[_0x20e96a(0x209)]=async function(_0x574c4b){const _0x474dbb=_0x20e96a;showLoader();try{const _0x357f37=ref(db,_0x474dbb(0x2a5)+_0x574c4b),_0x16996a=await get(_0x357f37);if(_0x16996a[_0x474dbb(0x228)]()){const _0x17b47a=_0x16996a[_0x474dbb(0x236)]();if(!_0x17b47a[_0x474dbb(0x27d)]||_0x17b47a[_0x474dbb(0x27d)]['length']===0x0)throw new Error(_0x474dbb(0x250));ticketToSell={'category':_0x574c4b,'user':_0x17b47a[_0x474dbb(0x27d)][0x0],'password':_0x17b47a[_0x474dbb(0x217)][0x0],'price':_0x17b47a[_0x474dbb(0x266)][0x0],'updatedData':{..._0x17b47a,'utilisateur':_0x17b47a['utilisateur']['slice'](0x1),'motDePasse':_0x17b47a['motDePasse'][_0x474dbb(0x214)](0x1),'prix':_0x17b47a[_0x474dbb(0x266)][_0x474dbb(0x214)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x4d46b1){console[_0x474dbb(0x25e)](_0x474dbb(0x280),_0x4d46b1),showNotification(_0x474dbb(0x269),_0x474dbb(0x286)),hideLoader();}};function showConfirmation(_0x3c49c9){const _0x1f37ab=_0x20e96a,_0x230980=document[_0x1f37ab(0x246)](_0x1f37ab(0x29a)),_0x2b90a8=document[_0x1f37ab(0x246)]('notification-message'),_0x2762b9=document['getElementById'](_0x1f37ab(0x2a4)),_0x5aebd1=document[_0x1f37ab(0x246)](_0x1f37ab(0x1e3));document['getElementById'](_0x1f37ab(0x26e))['textContent']=_0x1f37ab(0x283),_0x2b90a8[_0x1f37ab(0x1f5)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20'+_0x3c49c9[_0x1f37ab(0x22b)]+_0x1f37ab(0x288)+_0x3c49c9[_0x1f37ab(0x25c)]+_0x1f37ab(0x1e1),_0x5aebd1[_0x1f37ab(0x29b)][_0x1f37ab(0x1d0)]=_0x1f37ab(0x296),_0x2762b9[_0x1f37ab(0x29b)][_0x1f37ab(0x1d0)]=_0x1f37ab(0x258),_0x230980[_0x1f37ab(0x29b)]['display']=_0x1f37ab(0x28c);}window[_0x20e96a(0x216)]=async function(){const _0x4d2cb8=_0x20e96a;showLoader();if(!ticketToSell){showNotification(_0x4d2cb8(0x269),_0x4d2cb8(0x222)),hideLoader();return;}try{const _0x53848f=ref(db,_0x4d2cb8(0x2a5)+ticketToSell['category']);await set(_0x53848f,ticketToSell['updatedData']);const _0x3ccb8f=ref(db,_0x4d2cb8(0x22e));await push(_0x3ccb8f,{'category':ticketToSell[_0x4d2cb8(0x22b)],'user':ticketToSell[_0x4d2cb8(0x29c)],'password':ticketToSell[_0x4d2cb8(0x20b)],'price':ticketToSell[_0x4d2cb8(0x25c)],'soldAt':Date['now'](),'vendorId':currentVendorId});const _0x445d26=ref(db,_0x4d2cb8(0x292)+currentVendorId);await push(_0x445d26,{'category':ticketToSell[_0x4d2cb8(0x22b)],'user':ticketToSell[_0x4d2cb8(0x29c)],'password':ticketToSell['password'],'price':ticketToSell[_0x4d2cb8(0x25c)],'soldAt':Date['now']()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x133876){console[_0x4d2cb8(0x25e)](_0x4d2cb8(0x1de),_0x133876),showNotification(_0x4d2cb8(0x269),_0x4d2cb8(0x243)),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x4ec473){const _0x241378=_0x20e96a,_0x4305e7=document[_0x241378(0x246)](_0x241378(0x29a)),_0x10bc57=document['getElementById']('notification-message'),_0x5c2c00=document[_0x241378(0x246)]('ticket-actions'),_0x36b200=document[_0x241378(0x246)]('confirmation-buttons');document[_0x241378(0x246)](_0x241378(0x26e))['textContent']=_0x241378(0x20e),_0x10bc57[_0x241378(0x1f5)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20'+_0x4ec473[_0x241378(0x22b)]+_0x241378(0x1da)+_0x4ec473['user']+_0x241378(0x232)+_0x4ec473[_0x241378(0x20b)]+_0x241378(0x288)+_0x4ec473[_0x241378(0x25c)]+_0x241378(0x1e1),_0x36b200[_0x241378(0x29b)][_0x241378(0x1d0)]=_0x241378(0x258),_0x5c2c00['style'][_0x241378(0x1d0)]=_0x241378(0x296),_0x4305e7['style'][_0x241378(0x1d0)]=_0x241378(0x28c);}function showSaleConfirmation(_0x5ee268){const _0x2342ef=_0x20e96a,_0x390e31=document[_0x2342ef(0x246)]('notification'),_0x4d113b=document['getElementById'](_0x2342ef(0x24c)),_0x57f759=document[_0x2342ef(0x246)](_0x2342ef(0x21c));_0x4d113b[_0x2342ef(0x1f5)]=_0x2342ef(0x298)+_0x5ee268[_0x2342ef(0x22b)]+_0x2342ef(0x1da)+_0x5ee268[_0x2342ef(0x29c)]+_0x2342ef(0x232)+_0x5ee268['password']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x5ee268[_0x2342ef(0x25c)]+_0x2342ef(0x1e1),_0x57f759[_0x2342ef(0x1f5)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x390e31['style'][_0x2342ef(0x1d0)]=_0x2342ef(0x28c);}function _0x2c84(){const _0x5c775d=['1677ZWmxWV','Aucun\x20vendeur\x20trouvé.','Erreur\x20lors\x20de\x20la\x20vente:','dlswifi.firebaseapp.com','filterHistoryByDateRange','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Page\x20','confirmation-buttons','contains','catch','historique_ventes.xlsx','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','854607LTTpeT','hideNotification','Aucun\x20ticket\x20en\x20cours\x20de\x20vente','Impossible\x20de\x20copier\x20le\x20ticket','Erreur\x20de\x20synchronisation:','setHours','1139306seQwOP','getTime','max','input','autoTable','copyTicket','dlswifi','innerHTML','historySection','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','right','getDate','Vendors','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','appendChild','scrollHeight','grid','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','height','entries','Abonnement\x20expiré','hideSubscriptionRequiredModal','totalTickets','getItem','scrollTop','margin','exportToPDFHistory','initTicketSale','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','password','insertRow','reduce','Ticket\x20vendu\x20avec\x20succès','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','pageLoaderWrapper','createElement','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','Pas\x20d\x27abonnement\x20actif','slice','Succès','proceedWithSale','motDePasse','loginSection','target','Erreur\x20de\x20synchronisation\x20des\x20tickets.','38072aSEYiK','notification-buttons','text','loaderWrapper','xlsx','href','div','Aucun\x20ticket\x20à\x20vendre','width','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','printHistory','filter','Détails\x20du\x20Ticket','exists','297jnRKFx','.rates-section','category','log','messagesContainer','TicketsVendus','all','Abonnement\x20actif','Vendors/','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','removeItem','ceil','periodFilter','val','message','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','108GxhERE','/messages','click','username','loginError','addImage','293922UPvyqO','share','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','messagesSection','Impossible\x20de\x20finaliser\x20la\x20vente','charCodeAt','totalRevenue','getElementById','Partage\x20réussi','then','1133NeKmah','Impossible\x20de\x20charger\x20l\x27historique','668oECQhW','notification-message','Historique\x20des\x20ventes','confirmSale','topCategory','Plus\x20de\x20tickets\x20disponibles','25fddhVF','textContent','internal','forEach','jsPDF','jspdf','endDate','none','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','closeHistory','getHeight','price','1:914445912574:web:4448ebbc615241b63ad8af','error','querySelector','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','startDate','length','min','Ticket\x20vendu\x20avec\x20succès!','PNG','prix','redirectToSubscription','toFixed','Erreur','location','Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente','notification-title','Erreur\x20de\x20confirmation:','sort','exportToPDF','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','\x20FCFA','4110UUsucx','264558cDAVoX','map','save','active','Aucun\x20ticket\x20disponible.','TicketsTotal','print','content','utilisateur','getNumberOfPages','914445912574','Erreur:','rememberMe','settings','Confirmation\x20de\x20vente','left','usernameTimestamp','Impossible\x20de\x20récupérer\x20le\x20ticket','binary','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','addEventListener','preventDefault','2fIvgou','block','DOMContentLoaded','shareTicket','table','toLowerCase','update','VendorsHistory/','toLocaleString','expired','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','flex','Erreur\x20lors\x20du\x20partage:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','setItem','notification','style','user','Erreur\x20lors\x20de\x20l\x27initialisation\x20:','pageSize','autocompleteSuggestions','timestamp','Ventes','checked','historyTableBody','ticket-actions','TicketsTotal/','startsWith','soldAt','bold','value','display','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','exportToExcelHistory','admin/subscription','#historyTableBody','Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:','Erreur\x20lors\x20de\x20la\x20copie:','clipboard','now','keys','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','write'];_0x2c84=function(){return _0x5c775d;};return _0x2c84();}window[_0x20e96a(0x24e)]=async function(){const _0x1bb5b8=_0x20e96a;showLoader();if(!currentReservedTicket){showNotification(_0x1bb5b8(0x269),_0x1bb5b8(0x1ea)),hideLoader();return;}try{const _0x2718bd=ref(db,_0x1bb5b8(0x22e));await push(_0x2718bd,{...currentReservedTicket,'soldAt':Date['now'](),'vendorId':currentVendorId});const _0x3eec04=ref(db,_0x1bb5b8(0x292)+currentVendorId);await push(_0x3eec04,{...currentReservedTicket,'soldAt':Date[_0x1bb5b8(0x1d8)]()}),showNotification(_0x1bb5b8(0x215),_0x1bb5b8(0x264)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x2c663f){console['error'](_0x1bb5b8(0x26f),_0x2c663f),showNotification(_0x1bb5b8(0x269),_0x1bb5b8(0x26d)),hideLoader();}},window['cancelSale']=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0x370c13,_0x1535ed){const _0x230e71=_0x20e96a,_0x24fcf1=document[_0x230e71(0x246)]('notification'),_0xc7331a=document[_0x230e71(0x246)](_0x230e71(0x26e)),_0xa03125=document[_0x230e71(0x246)](_0x230e71(0x24c)),_0x4eaa53=document[_0x230e71(0x246)](_0x230e71(0x21c)),_0x361777=document[_0x230e71(0x246)](_0x230e71(0x2a4));_0xc7331a[_0x230e71(0x252)]=_0x370c13,_0xa03125['innerHTML']=_0x1535ed,_0x370c13===_0x230e71(0x215)||_0x370c13===_0x230e71(0x269)?(_0x4eaa53[_0x230e71(0x29b)][_0x230e71(0x1d0)]=_0x230e71(0x258),_0x361777['style'][_0x230e71(0x1d0)]=_0x230e71(0x258)):(_0x4eaa53[_0x230e71(0x29b)][_0x230e71(0x1d0)]='flex',_0x361777[_0x230e71(0x29b)][_0x230e71(0x1d0)]=_0x230e71(0x258)),_0x24fcf1[_0x230e71(0x29b)]['display']=_0x230e71(0x28c);}window[_0x20e96a(0x1e9)]=function(){const _0x2c9b10=_0x20e96a;document[_0x2c9b10(0x246)](_0x2c9b10(0x29a))[_0x2c9b10(0x29b)][_0x2c9b10(0x1d0)]=_0x2c9b10(0x258);};async function loadHistory(){const _0x34bcd9=_0x20e96a;showLoader();try{const _0x449c28=ref(db,'VendorsHistory/'+currentVendorId),_0x2cf2d5=await get(_0x449c28);let _0x270196=[];_0x2cf2d5[_0x34bcd9(0x228)]()&&(_0x270196=Object[_0x34bcd9(0x201)](_0x2cf2d5[_0x34bcd9(0x236)]())[_0x34bcd9(0x276)](([_0x521a92,_0xa24f05])=>({'id':_0x521a92,..._0xa24f05}))),filterHistory(_0x270196),hideLoader();}catch(_0x2cf2c4){console['error'](_0x34bcd9(0x1e7),_0x2cf2c4),showNotification(_0x34bcd9(0x269),_0x34bcd9(0x24a)),hideLoader();}}function filterHistory(_0x2e0b5a){const _0x575b63=_0x20e96a,_0x25219d=document[_0x575b63(0x246)](_0x575b63(0x235))['value'],_0x5cc2d3=new Date(),_0x37bbd2={'today':new Date(_0x5cc2d3['setHours'](0x0,0x0,0x0,0x0)),'week':new Date(_0x5cc2d3['setDate'](_0x5cc2d3[_0x575b63(0x1f9)]()-_0x5cc2d3['getDay']())),'month':new Date(_0x5cc2d3['setDate'](0x1)),'all':new Date(0x0)};let _0x21134f=_0x2e0b5a;_0x25219d!==_0x575b63(0x22f)&&(_0x21134f=_0x2e0b5a[_0x575b63(0x226)](_0x2ce007=>new Date(_0x2ce007[_0x575b63(0x2a7)])>=_0x37bbd2[_0x25219d])),updateStats(_0x21134f),updateHistoryTable(_0x21134f);}window[_0x20e96a(0x1e0)]=function(){const _0x2144bc=_0x20e96a,_0xebd05c=new Date(document[_0x2144bc(0x246)](_0x2144bc(0x261))[_0x2144bc(0x1cf)]),_0x44ea83=new Date(document[_0x2144bc(0x246)](_0x2144bc(0x257))[_0x2144bc(0x1cf)]);_0x44ea83[_0x2144bc(0x1ed)](0x17,0x3b,0x3b);if(isNaN(_0xebd05c['getTime']())||isNaN(_0x44ea83[_0x2144bc(0x1ef)]())){showNotification('Erreur','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.');return;}const _0xb2b2e0=ref(db,'VendorsHistory/'+currentVendorId);get(_0xb2b2e0)['then'](_0x447599=>{const _0x4a236d=_0x2144bc;let _0x1b6a02=[];_0x447599['exists']()&&(_0x1b6a02=Object[_0x4a236d(0x201)](_0x447599[_0x4a236d(0x236)]())[_0x4a236d(0x276)](([_0x2e7bec,_0x2c8011])=>({'id':_0x2e7bec,..._0x2c8011})));const _0x1208cf=_0x1b6a02[_0x4a236d(0x226)](_0x41e8eb=>{const _0x9b07c1=new Date(_0x41e8eb['soldAt']);return _0x9b07c1>=_0xebd05c&&_0x9b07c1<=_0x44ea83;});updateStats(_0x1208cf),updateHistoryTable(_0x1208cf);});};function updateStats(_0x27fc67){const _0x1446c2=_0x20e96a,_0x4514d6=_0x27fc67[_0x1446c2(0x262)],_0x301e6f=_0x27fc67[_0x1446c2(0x20d)]((_0x58a471,_0x488258)=>_0x58a471+parseFloat(_0x488258['price']),0x0),_0x2bf26f=_0x27fc67[_0x1446c2(0x20d)]((_0x273b11,_0x4fc15b)=>{const _0x2dc792=_0x1446c2;return _0x273b11[_0x4fc15b[_0x2dc792(0x22b)]]=(_0x273b11[_0x4fc15b[_0x2dc792(0x22b)]]||0x0)+0x1,_0x273b11;},{}),_0x3ddeaf=Object[_0x1446c2(0x201)](_0x2bf26f)[_0x1446c2(0x270)]((_0x45ff20,_0x1a8a22)=>_0x1a8a22[0x1]-_0x45ff20[0x1])[0x0]?.[0x0]||'-',_0xb36f74=_0x27fc67[_0x1446c2(0x262)]>0x0?Math[_0x1446c2(0x1f0)](0x1,Math[_0x1446c2(0x234)]((Date[_0x1446c2(0x1d8)]()-Math[_0x1446c2(0x263)](..._0x27fc67[_0x1446c2(0x276)](_0x5d59ff=>_0x5d59ff[_0x1446c2(0x2a7)])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x2a4721=(_0x4514d6/_0xb36f74)[_0x1446c2(0x268)](0x1);document['getElementById'](_0x1446c2(0x204))['textContent']=_0x4514d6,document[_0x1446c2(0x246)](_0x1446c2(0x245))['textContent']=_0x301e6f['toLocaleString']()+_0x1446c2(0x273),document[_0x1446c2(0x246)](_0x1446c2(0x24f))[_0x1446c2(0x252)]=_0x3ddeaf,document[_0x1446c2(0x246)]('avgDaily')[_0x1446c2(0x252)]=_0x2a4721;}function updateHistoryTable(_0x20979f){const _0x4427f9=_0x20e96a,_0x1edc4c=document[_0x4427f9(0x246)](_0x4427f9(0x2a3));_0x1edc4c[_0x4427f9(0x1f5)]=_0x20979f['sort']((_0x3f053e,_0x40c802)=>_0x40c802['soldAt']-_0x3f053e['soldAt'])[_0x4427f9(0x276)](_0x1c07b5=>_0x4427f9(0x1fb)+_0x1c07b5['id']+_0x4427f9(0x238)+new Date(_0x1c07b5[_0x4427f9(0x2a7)])[_0x4427f9(0x293)]()+_0x4427f9(0x26c)+_0x1c07b5[_0x4427f9(0x22b)]+_0x4427f9(0x26c)+_0x1c07b5[_0x4427f9(0x29c)]+_0x4427f9(0x26c)+_0x1c07b5[_0x4427f9(0x25c)]+_0x4427f9(0x295))['join']('');}window['showTicketDetailsFromHistory']=async function(_0x45490a){const _0x2dbf5e=_0x20e96a;showLoader();try{const _0x532987=ref(db,'VendorsHistory/'+currentVendorId+'/'+_0x45490a),_0x2765b9=await get(_0x532987);if(_0x2765b9[_0x2dbf5e(0x228)]()){const _0x2a38b7=_0x2765b9[_0x2dbf5e(0x236)]();window[_0x2dbf5e(0x25a)](),showTicketDetails(_0x2a38b7),hideLoader();}else showNotification('Erreur','Ticket\x20introuvable\x20dans\x20l\x27historique'),hideLoader();}catch(_0x2cef09){console[_0x2dbf5e(0x25e)](_0x2dbf5e(0x241),_0x2cef09),showNotification('Erreur',_0x2dbf5e(0x224)),hideLoader();}},window['toggleHistory']=function(){const _0x4c5ab8=_0x20e96a,_0x37ed2c=document[_0x4c5ab8(0x246)]('historySection'),_0x544fe0=_0x37ed2c[_0x4c5ab8(0x29b)]['display']===_0x4c5ab8(0x28c);_0x37ed2c[_0x4c5ab8(0x29b)][_0x4c5ab8(0x1d0)]=_0x544fe0?_0x4c5ab8(0x258):_0x4c5ab8(0x28c),!_0x544fe0&&loadHistory();},window['closeHistory']=function(){const _0x4e80d6=_0x20e96a;document[_0x4e80d6(0x246)](_0x4e80d6(0x1f6))[_0x4e80d6(0x29b)]['display']='none';},window['filterHistory']=function(){loadHistory();};function listenForNewMessages(){const _0xf5b4e9=_0x20e96a,_0x69814a=ref(db,_0xf5b4e9(0x231)+currentVendorId+_0xf5b4e9(0x23a));onChildAdded(_0x69814a,_0xd052b2=>{const _0x56c9fa=_0xf5b4e9,_0x5125a0=_0xd052b2[_0x56c9fa(0x236)]();displayNewMessage(_0x5125a0);});}function displayNewMessage(_0x3b9fbd){const _0xb43e0d=_0x20e96a,_0x102fec=document[_0xb43e0d(0x246)](_0xb43e0d(0x22d)),_0x3ace9b=document[_0xb43e0d(0x211)](_0xb43e0d(0x221));_0x3ace9b['classList']['add'](_0xb43e0d(0x237)),_0x3ace9b[_0xb43e0d(0x1f5)]=_0xb43e0d(0x272)+_0x3b9fbd[_0xb43e0d(0x27c)]+_0xb43e0d(0x1d1)+new Date(_0x3b9fbd[_0xb43e0d(0x2a0)])[_0xb43e0d(0x293)]()+_0xb43e0d(0x259),_0x102fec[_0xb43e0d(0x1fc)](_0x3ace9b),_0x102fec[_0xb43e0d(0x206)]=_0x102fec[_0xb43e0d(0x1fd)];}window[_0x20e96a(0x28e)]=function(){const _0x5ca2aa=_0x20e96a,_0x2a5442=document[_0x5ca2aa(0x246)]('notification-message')['innerText'];navigator[_0x5ca2aa(0x240)]?navigator['share']({'title':_0x5ca2aa(0x227),'text':_0x2a5442})['then'](()=>console[_0x5ca2aa(0x22c)](_0x5ca2aa(0x247)))['catch'](_0x1e6916=>console[_0x5ca2aa(0x25e)](_0x5ca2aa(0x297),_0x1e6916)):alert(_0x5ca2aa(0x26b));},window[_0x20e96a(0x1f3)]=function(){const _0x1a3db9=_0x20e96a,_0x2ef834=document[_0x1a3db9(0x246)]('notification-message')['innerText'];navigator[_0x1a3db9(0x1d7)]['writeText'](_0x2ef834)[_0x1a3db9(0x248)](()=>{const _0x3752eb=_0x1a3db9;showNotification(_0x3752eb(0x215),_0x3752eb(0x212));})[_0x1a3db9(0x1e5)](_0x355254=>{const _0x2f2649=_0x1a3db9;console['error'](_0x2f2649(0x1d6),_0x355254),showNotification('Erreur',_0x2f2649(0x1eb));});},window[_0x20e96a(0x271)]=async function(){const _0x4b9815=_0x20e96a;showLoader();const _0x3b6149=document[_0x4b9815(0x246)]('notification-message'),_0x472066=new jsPDF(),_0xad01ee=await html2canvas(_0x3b6149),_0x5e9f7f=_0xad01ee['toDataURL']('image/png');_0x472066[_0x4b9815(0x23e)](_0x5e9f7f,_0x4b9815(0x265),0xa,0xa,0xbe,0x0),_0x472066[_0x4b9815(0x277)]('ticket.pdf'),hideLoader();},window[_0x20e96a(0x225)]=function(){const _0x114525=_0x20e96a;window[_0x114525(0x27b)]();},window[_0x20e96a(0x208)]=function(){const _0x56580d=_0x20e96a,{jsPDF:_0x241886}=window[_0x56580d(0x256)],_0x488453=new _0x241886(),_0x4fcbfe=document[_0x56580d(0x246)](_0x56580d(0x2a3)),_0x1e81d6={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x56580d(0x1ce),'halign':'center'},_0xe0ea68={'halign':_0x56580d(0x284)},_0x4636d={'theme':_0x56580d(0x1fe),'headStyles':_0x1e81d6,'bodyStyles':_0xe0ea68,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x3b841d){const _0x2d1550=_0x56580d;_0x488453[_0x2d1550(0x21d)](_0x2d1550(0x24d),0xe,0xf);const _0x267fd=_0x2d1550(0x1e2)+_0x488453[_0x2d1550(0x253)][_0x2d1550(0x27e)]();_0x488453['setFontSize'](0xa);const _0x1929e7=_0x488453[_0x2d1550(0x253)][_0x2d1550(0x29e)],_0x38c389=_0x1929e7[_0x2d1550(0x200)]?_0x1929e7['height']:_0x1929e7[_0x2d1550(0x25b)]();_0x488453[_0x2d1550(0x21d)](_0x267fd,_0x3b841d[_0x2d1550(0x282)]['margin'][_0x2d1550(0x284)],_0x38c389-0xa),_0x488453[_0x2d1550(0x21d)](new Date()['toLocaleString'](),_0x1929e7[_0x2d1550(0x223)]-_0x3b841d[_0x2d1550(0x282)][_0x2d1550(0x207)][_0x2d1550(0x1f8)]-0x28,_0x38c389-0xa);}};_0x488453[_0x56580d(0x1f2)]({'html':_0x56580d(0x1d4),..._0x4636d}),_0x488453[_0x56580d(0x277)]('historique_ventes.pdf');},window[_0x20e96a(0x1d2)]=function(){const _0x5f3eb4=_0x20e96a,_0x550184=XLSX['utils']['table_to_book'](document[_0x5f3eb4(0x246)](_0x5f3eb4(0x2a3)),{'sheet':_0x5f3eb4(0x2a1)}),_0x4672f1=XLSX[_0x5f3eb4(0x1db)](_0x550184,{'bookType':_0x5f3eb4(0x21f),'type':_0x5f3eb4(0x287)});function _0x5dc338(_0x1251d4){const _0x2c4867=_0x5f3eb4,_0x499b3d=new ArrayBuffer(_0x1251d4[_0x2c4867(0x262)]),_0xdd036d=new Uint8Array(_0x499b3d);for(let _0x2e18e4=0x0;_0x2e18e4<_0x1251d4[_0x2c4867(0x262)];_0x2e18e4++)_0xdd036d[_0x2e18e4]=_0x1251d4[_0x2c4867(0x244)](_0x2e18e4)&0xff;return _0x499b3d;}saveAs(new Blob([_0x5dc338(_0x4672f1)],{'type':'application/octet-stream'}),_0x5f3eb4(0x1e6));};function showLoader(){const _0x290f37=_0x20e96a;document[_0x290f37(0x246)]('loaderWrapper')[_0x290f37(0x29b)][_0x290f37(0x1d0)]='block';}function hideLoader(){const _0x19149e=_0x20e96a;document[_0x19149e(0x246)](_0x19149e(0x21e))[_0x19149e(0x29b)][_0x19149e(0x1d0)]=_0x19149e(0x258);}function showPageLoader(){const _0x4963b7=_0x20e96a;document[_0x4963b7(0x246)](_0x4963b7(0x210))[_0x4963b7(0x29b)]['display']=_0x4963b7(0x296);}function hidePageLoader(){const _0x264afc=_0x20e96a;document['getElementById']('pageLoaderWrapper')[_0x264afc(0x29b)][_0x264afc(0x1d0)]=_0x264afc(0x258);}function showSubscriptionRequiredModal(){const _0x5ed450=_0x20e96a;subscriptionRequiredModal['style'][_0x5ed450(0x1d0)]=_0x5ed450(0x296);}function _0x583a(_0x159f5c,_0x26884d){const _0x2c845d=_0x2c84();return _0x583a=function(_0x583a96,_0x1fddd7){_0x583a96=_0x583a96-0x1ce;let _0x187418=_0x2c845d[_0x583a96];return _0x187418;},_0x583a(_0x159f5c,_0x26884d);}function hideSubscriptionRequiredModal(){const _0x7ece3c=_0x20e96a;subscriptionRequiredModal[_0x7ece3c(0x29b)][_0x7ece3c(0x1d0)]=_0x7ece3c(0x258);}function redirectToSubscription(){const _0x17e819=_0x20e96a;window[_0x17e819(0x26a)][_0x17e819(0x220)]='index.html';}async function checkSubscriptionStatus(){const _0x50f1fa=_0x20e96a,_0x358e30=document[_0x50f1fa(0x246)]('pageLoaderMessage');_0x358e30[_0x50f1fa(0x252)]='Vérification\x20de\x20l\x27abonnement...';try{const _0x6e9baa=await get(adminRef),_0x673771=_0x6e9baa[_0x50f1fa(0x236)](),_0x51d591=new Date();if(_0x673771&&_0x673771['status']===_0x50f1fa(0x278)){const _0x276be3=new Date(_0x673771[_0x50f1fa(0x257)]);_0x276be3<_0x51d591?(_0x358e30[_0x50f1fa(0x252)]=_0x50f1fa(0x202),showSubscriptionRequiredModal(),await adminRef[_0x50f1fa(0x291)]({'status':_0x50f1fa(0x294)})):_0x358e30['textContent']=_0x50f1fa(0x230);}else _0x358e30[_0x50f1fa(0x252)]=_0x50f1fa(0x213),showSubscriptionRequiredModal();}catch(_0x56eded){console[_0x50f1fa(0x25e)](_0x50f1fa(0x1ff),_0x56eded),_0x358e30[_0x50f1fa(0x252)]='Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement',showNotification(_0x50f1fa(0x269),_0x50f1fa(0x20a));}}document[_0x20e96a(0x289)](_0x20e96a(0x28d),()=>{const _0x50bd8e=_0x20e96a;checkSubscriptionStatus()[_0x50bd8e(0x248)](()=>{fetchVendors(),hidePageLoader();})[_0x50bd8e(0x1e5)](_0x129d9c=>{const _0x26a7e6=_0x50bd8e;console[_0x26a7e6(0x25e)](_0x26a7e6(0x29d),_0x129d9c),showNotification(_0x26a7e6(0x269),_0x26a7e6(0x1f7)),hidePageLoader();});}),window[_0x20e96a(0x267)]=redirectToSubscription,window[_0x20e96a(0x203)]=redirectToSubscription;   </script>
</body>
</html>
