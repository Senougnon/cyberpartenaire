<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN WIFI ZONE</title>
    <link rel="stylesheet" href="styleA.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications majeures, juste des ajustements pour le formulaire) ... */
       /* Style pour le modal de paiement */
       .payment-modal {
           display: none;
           position: fixed;
           top: 50%;
           left: 50%;
           transform: translate(-50%, -50%);
           background-color: white;
           padding: 30px;
           border-radius: 10px;
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
           z-index: 1000;
           max-width: 400px;
           width: 90%;
           text-align: center;
       }

       .payment-modal h2 {
           color: #333;
           margin-bottom: 20px;
       }

       .payment-modal p {
           color: #666;
           margin-bottom: 30px;
       }

       .payment-modal button {
           background-color: #fdbb2d;
           color: #1a2a6c;
           border: none;
           padding: 12px 20px;
           border-radius: 25px;
           cursor: pointer;
           transition: all 0.3s;
           font-weight: 600;
           font-size: 0.9rem;
           margin: 0 10px;
       }

       .payment-modal button:hover {
           background-color: #e6a727;
       }

       .close-modal {
           position: absolute;
           top: 10px;
           right: 10px;
           cursor: pointer;
           font-size: 1.2rem;
           color: #333;
       }

       /* Style pour l'overlay */
       .overlay {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0, 0, 0, 0.5);
           z-index: 999;
       }
       #subscriptionSection {
           text-align: center;
           margin-bottom: 30px;
       }

       #subscriptionSection h2 {
           font-size: 24px;
           color: #fdbb2d;
           margin-bottom: 20px;
       }

       #subscriptionStatus {
           font-size: 18px;
           color: #fff;
           margin-bottom: 20px;
       }

       .subscription-buttons {
           display: flex;
           justify-content: center;
           gap: 20px;
       }

       .subscription-buttons button {
           background-color: #fdbb2d;
           color: #1a2a6c;
           border: none;
           padding: 12px 20px;
           border-radius: 25px;
           cursor: pointer;
           transition: all 0.3s;
           font-weight: 600;
           font-size: 0.9rem;
       }

       .subscription-buttons button:hover {
           background-color: #e6a727;
       }

       /* Style pour le message d'abonnement requis */
       .subscription-required {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0, 0, 0, 0.5);
           z-index: 1000;
           justify-content: center;
           align-items: center;
           color: white;
           text-align: center;
           padding: 20px;
       }

       .subscription-required-content {
           background-color: white;
           padding: 30px;
           border-radius: 10px;
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
           max-width: 400px;
           width: 90%;
       }

       .subscription-required-content h2 {
           color: #333;
           margin-bottom: 20px;
       }

       .subscription-required-content p {
           color: #666;
           margin-bottom: 30px;
       }

       .subscription-required-content button {
           background-color: #fdbb2d;
           color: #1a2a6c;
           border: none;
           padding: 12px 20px;
           border-radius: 25px;
           cursor: pointer;
           transition: all 0.3s;
           font-weight: 600;
           font-size: 0.9rem;
           margin: 0 10px;
       }

       .subscription-required-content button:hover {
           background-color: #e6a727;
       }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }

        .header {
            display: flex; /* Added to align items */
            justify-content: center; /* MODIFICATION: Center content horizontally */
            align-items: center; /* Added to vertically align items */
            flex-direction: column; /* MODIFICATION: Stack items vertically */
            text-align: center; /* MODIFICATION: Center text within header */
        }

        .header h1 {
            margin: 0; /* Reset margin for h1 inside header */
        }

        .logout-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .logout-button:hover {
            background-color: #c0392b;
        }
       /* Styles pour le formulaire de portail captif */
      #portalForm {
          display: none; /*Caché par défaut*/
          flex-direction: column;
          gap: 10px;
          max-width: 600px; /* Limite la largeur du formulaire */
          margin: 20px auto;
          padding: 20px;
          background-color: rgba(255, 255, 255, 0.1); /* Léger fond pour le formulaire */
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Ombre légère */
      }
      #portalForm label {
          color: #fdbb2d; /* Couleur pour les labels */
      }
      #portalForm input[type="text"],
      #portalForm input[type="number"],
      #portalForm textarea,
      #portalForm select {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 4px;
          background-color: rgba(255,255,255,0.2); /* Fond transparent */
          color: white; /* Couleur du texte */
      }

      #portalForm button {
          padding: 10px 15px;
          background-color: #fdbb2d;
          color: #1a2a6c;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
      }

      #portalForm button:hover {
          background-color: #e6a727;
      }
      #portalForm .list-input-container {
          display: flex;
          flex-direction: column;
      }

      #portalForm .list-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

      #portalForm .list-item input {
          flex: 1; /* Permet à l'input de prendre l'espace disponible */
          margin-right: 5px; /* Marge entre l'input et le bouton */
      }
        #portalForm .list-item button {
           padding: 5px 10px;
           background-color: #e74c3c; /* Couleur différente pour le bouton de suppression */
           color: white;
           border: none;
           border-radius: 4px;
           cursor: pointer;
           font-size: 14px;
        }

        #portalForm .list-item button:hover {
           background-color: #c0392b;
        }

        #configSection {
          margin-bottom:           20px;
          text-align: center; /* Center-align the buttons */
      }
        #configSection .config-buttons {
          display: inline-block;
          margin: 0 10px;
        }

    </style>
</head>
<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <div class="container" id="contentContainer" style="display:none;">
        <header class="header">
            <h1 id="networkNameDisplay">ADMIN WIFI ZONE</h1>
            <div class="wave"></div>
        </header>


        <main>
            <div id="subscriptionSection">
                <h2>Statut de l'Abonnement</h2>
                <div id="subscriptionStatus"></div>
                <div class="subscription-button">
                    <button id="subscribeMonthly">S'abonner (Mensuel - 1000 FCFA)</button>
                    <button id="subscribeYearly">S'abonner (Annuel - 10 000 FCFA)</button>
                </div>
            </div>

            <div id="configSection">
              <button onclick="togglePortalForm()" id="togglePortalFormBtn">Configurer le portail captif</button>
              <button onclick="downloadLoginFile()" id="downloadLoginBtn" style="display: none;">Télécharger le portail captif</button>
             </div>


            <form id="portalForm" style="display: none;">
                <label for="networkName">Nom du réseau:</label>
                <input type="text" id="networkName" name="networkName" required>

                <label for="contactNumber">Numéro à contacter:</label>
                <input type="text" id="contactNumber" name="contactNumber" required>

                <label for="fedapayApiKey">Clé API FedaPay:</label>
                <input type="text" id="fedapayApiKey" name="fedapayApiKey" required>

                <label for="loginMode">Mode de connexion par défaut :</label>
                <select id="loginMode" name="loginMode">
                    <option value="separate">Nom d'utilisateur et Mot de passe</option>
                    <option value="same">Identifiant unique</option>
                    <option value="pay">Page de paiement</option> <!-- Nouvelle option -->
                </select>

                <div class="list-input-container">
                    <label>Tarifs:</label>
                    <div id="tariffsList">
                        <div class="list-item">
                            <input type="text" placeholder="Nom du tarif" data-type="tariffName">
                            <input type="number" placeholder="Prix" data-type="tariffPrice">
                            <button type="button" onclick="addListItem('tariffsList')">Ajouter</button>
                         </div>
                      </div>
                 </div>

                 <div class="list-input-container">
                      <label>Adresses de connexion:</label>
                      <div id="connectionsList">
                         <div class="list-item">
                            <input type="text" placeholder="Adresse" data-type="connection">
                            <button type="button" onclick="addListItem('connectionsList')">Ajouter</button>
                           </div>
                      </div>
                  </div>

                  <div class="list-input-container">
                      <label>Services et produits:</label>
                      <div id="productsList">
                         <div class="list-item">
                             <input type="text" placeholder="Service/Produit" data-type="product">
                             <button type="button" onclick="addListItem('productsList')">Ajouter</button>
                         </div>
                     </div>
                 </div>

                 <button type="submit">Enregistrer la configuration</button>
             </form>

            <div class="menu">
                <a href="PageVenteTicket.html" class="menu-item" id="vente">
                    <i class="fas fa-ticket-alt"></i> <!-- Font Awesome Ticket Icon -->
                    <h2>Vente de Tickets</h2>
                    <p>Procédez à la vente de nouveaux tickets Wifi.</p>
                </a>
                <a href="AdminVentePartenaires.html" class="menu-item" id="inventaire">
                    <i class="fas fa-clipboard-list"></i> <!-- Font Awesome Clipboard List Icon -->
                    <h2>Inventaire des Tickets</h2>
                    <p>Consultez l'état des ventes de vos partenaires.</p>
                </a>
                <a href="Stock.html" class="menu-item" id="stock">
                    <i class="fas fa-boxes"></i> <!-- Font Awesome Boxes Icon -->
                    <h2>Gestion des Stocks Partenaire</h2>
                    <p>Suivez les stocks de tickets de vos partenaires.</p>
                </a>
                <a href="a3.html" class="menu-item" id="administration">
                    <i class="fas fa-cog"></i> <!-- Font Awesome Settings Cog Icon -->
                    <h2>Administration des Tickets</h2>
                    <p>Gérez les tickets, activez ou désactivez-les.</p>
                </a>
                <button onclick="logout()" class="logout-button">Déconnexion</button>
            </div>

        </main>

    </div>


    <div id="paymentModal" class="payment-modal" style="display: none;">
        <span class="close-modal" onclick="closePaymentModal()">×</span>
        <h2>Paiement de l'Abonnement</h2>
        <p>Choisissez votre plan d'abonnement et procédez au paiement via FedaPay.</p>
        <!-- Les boutons de paiement seront ajoutés ici par le script -->
    </div>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <div class="overlay" id="overlay" style="display: none;" onclick="closePaymentModal()"></div>

    <script type="module">
const _0x4ad636=_0x4a23;function _0x405e(){const _0x5b41ff=['Vous\x20devez\x20être\x20connecté\x20pour\x20configurer\x20le\x20portail.','login.html','click','Abonnement\x20mensuel','true','networkName','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22><button\x20onclick=\x22initPayment(\x27','category','/portalConfig','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>','Traitement\x20des\x20tickets\x20uniques...','submit','flex','monthly','getItem','contentContainer','hideSubscriptionRequiredModal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20value=\x22','body','3943315oQWgqG','red','green','remove','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20:','toISOString','Mode\x20de\x20connexion\x20invalide.','Vendeur\x20automatique','\x22\x20placeholder=\x22','6751794BzztvN','setFullYear','active','5254242EVFCVo','getFullYear','style','revokeObjectURL','Erreur\x20lors\x20de\x20la\x20mise\x20à\x20jour\x20de\x20l\x27abonnement:','indexOf','productsList','onload','pay','separate','product','/admin/subscription','Vous\x20devez\x20être\x20connecté\x20pour\x20annuler\x20un\x20abonnement.','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>','Erreur\x20lors\x20de\x20l\x27enregistrement\x20de\x20la\x20configuration.','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22','1597288zpMxqn','connectionsList','/TicketConnecté','connection','<!--\x20FEDAPAY_API_KEY\x20-->','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>','inline-block','push','text/html','download','2291954WwzTHH','networkNameDisplay','loginMode','Ticket\x20','User\x20ID\x20not\x20found.\x20Cannot\x20initiate\x20payment.','+229\x20XXXXXXXX','PageVenteTicket.html','replace','display','text','Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20','1lIWtCO','parentNode','User\x20ID\x20not\x20found.\x20Cannot\x20cancel\x20subscription.','paymentModal','loginAccueil.html','/TicketsTotal/','ADMIN\x20WIFI\x20ZONE','color','subscriptionRequiredModal','User\x20ID\x20not\x20found.\x20Cannot\x20save\x20portal\x20configuration.','</ul>','innerHTML','Abonnement\x20annulé.','TicketsTransit','Erreur\x20lors\x20de\x20l\x27annulation\x20de\x20l\x27abonnement:','</li>','status','href','<!--\x20CONTACT_NUMBER\x20-->','[data-type=\x22tariffPrice\x22]','loaderWrapper','pk_live_TfSz212W0xSMKK7oPEogkFmp','expired','User\x20ID\x20not\x20found.\x20Cannot\x20download\x20login\x20file.','div','#productsList\x20.list-item\x20input','admin@example.com','password','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20placeholder=\x22Nom\x20du\x20tarif\x22\x20data-type=\x22tariffName\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20placeholder=\x22Prix\x22\x20data-type=\x22tariffPrice\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>','isLoggedIn','block','list-item','val','</tbody></table>','Erreur\x20lors\x20du\x20téléchargement\x20du\x20portail\x20captif:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table\x20style=\x22width:\x20100%;\x20border-collapse:\x20collapse;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20connectés\x20:','togglePortalFormBtn','yearly','removeListItem','Erreur\x20lors\x20du\x20chargement\x20de\x20la\x20configuration:','contactNumber','<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>','createElement','portalForm','Statut\x20de\x20l\x27abonnement:\x20Expiré','Service/Produit','textContent','logout','Erreur\x20lors\x20du\x20chargement\x20de\x20la\x20configuration.','Configurer\x20le\x20portail\x20captif','clear','/TicketsTotal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','then','User\x20ID\x20not\x20found.\x20Cannot\x20check\x20subscription\x20status.','Adresse','querySelectorAll','Erreur\x20lors\x20de\x20la\x20vérification\x20du\x20statut\x20d\x27abonnement:','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>','forEach','location','#tariffsList\x20.list-item','createObjectURL','<!--\x20ADMIN_USER_ID\x20-->','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>','username','Current\x20user\x20ID\x20is\x20not\x20found\x20in\x20sessionStorage.','<!--\x20CONNECTION_LOCATIONS\x20-->','tariffsList','administration','trim','utilisateur','products','getElementById','Vous\x20devez\x20être\x20connecté\x20pour\x20vous\x20abonner.','motDePasse','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','pay.html','redirectToSubscription','name','Vente\x20du\x20ticket\x20','Masquer\x20le\x20formulaire','tariffs','mensuel','user','prix','Statut\x20de\x20l\x27abonnement:\x20Actif\x20jusqu\x27au\x20','log','users-data/','Statut\x20de\x20l\x27abonnement:\x20Inactif','reason','same','35867925kQSbnV','value','Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20:','togglePortalForm','a3.html','<input\x20type=\x22text\x22\x20value=\x22','querySelector','Erreur','connections','[data-type=\x22tariffName\x22]','Erreur\x20lors\x20de\x20l\x27enregistrement\x20de\x20la\x20configuration:','DIALOG_DISMISSED','init','...','firebase-config-manager.js','Vous\x20devez\x20être\x20connecté\x20pour\x20télécharger\x20le\x20portail.','CYBER\x20CAMPUS\x20WIFI\x20ZONE','log.html','3892DiPLTj','pageLoaderWrapper','catch','updatedData','none','AdminVentePartenaires.html','Vérification\x20du\x20ticket\x20pour\x20','currentUserId','3138GSSyXH','filter','\x22\x20data-type=\x22','Erreur\x20lors\x20de\x20la\x20mise\x20à\x20jour\x20de\x20l\x27abonnement.','error','slice','/VendorsHistory','endDate','Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket.','addEventListener',')\x22>Payer</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','vente','preventDefault','User\x20ID\x20not\x20found.\x20Cannot\x20load\x20portal\x20configuration.','Current\x20user\x20ID\x20is\x20not\x20provided\x20to\x20sellTicketAutomatically.','CHECKOUT_COMPLETED','price','downloadLoginBtn','appendChild','Erreur\x20lors\x20de\x20l\x27annulation\x20de\x20l\x27abonnement.','annuel','exists','TicketsTotal','className','Database\x20initialized\x20in\x20index.html','overlay','fedapayApiKey','Une\x20erreur\x20est\x20survenue\x20lors\x20du\x20traitement\x20des\x20tickets.','stock','removeChild','<!--\x20TARIFFS_TABLE_SIMPLE\x20-->'];_0x405e=function(){return _0x5b41ff;};return _0x405e();}(function(_0x1fa384,_0x1a9070){const _0x14f00a=_0x4a23,_0xd8d59d=_0x1fa384();while(!![]){try{const _0x10ab3b=parseInt(_0x14f00a(0x1f2))/0x1*(parseInt(_0x14f00a(0x1e7))/0x2)+parseInt(_0x14f00a(0x269))/0x3*(parseInt(_0x14f00a(0x261))/0x4)+parseInt(_0x14f00a(0x1c0))/0x5+parseInt(_0x14f00a(0x1cc))/0x6+parseInt(_0x14f00a(0x1c9))/0x7+-parseInt(_0x14f00a(0x1dd))/0x8+-parseInt(_0x14f00a(0x24f))/0x9;if(_0x10ab3b===_0x1a9070)break;else _0xd8d59d['push'](_0xd8d59d['shift']());}catch(_0x15e744){_0xd8d59d['push'](_0xd8d59d['shift']());}}}(_0x405e,0x945ad));import{getActiveDatabase}from'./firebase-config-manager.js';import{ref,get,set,push,remove,update}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';let db,adminRef;async function initializeDatabase(){const _0x2dfb5c=_0x4a23;db=await getActiveDatabase(),console[_0x2dfb5c(0x24a)](_0x2dfb5c(0x281));}async function checkLoginStatus(){const _0x16cf57=_0x4a23;if(sessionStorage[_0x16cf57(0x1bb)](_0x16cf57(0x20f))!==_0x16cf57(0x1b1))redirectToLogin();else{const _0x6a893=sessionStorage[_0x16cf57(0x1bb)]('currentUserId');if(!_0x6a893){console[_0x16cf57(0x26d)](_0x16cf57(0x235)),redirectToLogin();return;}document[_0x16cf57(0x23c)](_0x16cf57(0x1bc))[_0x16cf57(0x1ce)][_0x16cf57(0x1ef)]=_0x16cf57(0x210),adminRef=ref(db,_0x16cf57(0x24b)+_0x6a893+_0x16cf57(0x1d7));}}function redirectToLogin(){const _0x42beaf=_0x4a23;window['location'][_0x42beaf(0x203)]=_0x42beaf(0x1f6);}window[_0x4ad636(0x222)]=function(){sessionStorage['clear'](),redirectToLogin();};const venteMenuItem=document['getElementById'](_0x4ad636(0x274)),inventaireMenuItem=document[_0x4ad636(0x23c)]('inventaire'),stockMenuItem=document[_0x4ad636(0x23c)](_0x4ad636(0x285)),administrationMenuItem=document[_0x4ad636(0x23c)](_0x4ad636(0x238)),subscriptionStatus=document[_0x4ad636(0x23c)]('subscriptionStatus'),subscribeMonthlyButton=document[_0x4ad636(0x23c)]('subscribeMonthly'),subscribeYearlyButton=document[_0x4ad636(0x23c)]('subscribeYearly'),paymentModal=document[_0x4ad636(0x23c)](_0x4ad636(0x1f5)),overlay=document[_0x4ad636(0x23c)](_0x4ad636(0x282)),subscriptionRequiredModal=document['getElementById'](_0x4ad636(0x1fa));function showLoader(){const _0x414b5d=_0x4ad636;document[_0x414b5d(0x23c)](_0x414b5d(0x206))[_0x414b5d(0x1ce)][_0x414b5d(0x1ef)]=_0x414b5d(0x210);}function hideLoader(){const _0x3be5c8=_0x4ad636;document[_0x3be5c8(0x23c)](_0x3be5c8(0x206))[_0x3be5c8(0x1ce)][_0x3be5c8(0x1ef)]='none';}function showPageLoader(){const _0x399e8c=_0x4ad636;document['getElementById'](_0x399e8c(0x262))['style'][_0x399e8c(0x1ef)]='flex';}function _0x4a23(_0x2f618d,_0x4d0504){const _0x405ea7=_0x405e();return _0x4a23=function(_0x4a2306,_0x8c1335){_0x4a2306=_0x4a2306-0x1ae;let _0xe1be82=_0x405ea7[_0x4a2306];return _0xe1be82;},_0x4a23(_0x2f618d,_0x4d0504);}function hidePageLoader(){const _0x5d1ec2=_0x4ad636;document[_0x5d1ec2(0x23c)](_0x5d1ec2(0x262))[_0x5d1ec2(0x1ce)][_0x5d1ec2(0x1ef)]=_0x5d1ec2(0x265);}function showSubscriptionRequiredModal(){const _0x441ad0=_0x4ad636;subscriptionRequiredModal[_0x441ad0(0x1ce)][_0x441ad0(0x1ef)]='flex';}function hideSubscriptionRequiredModal(){const _0x62449d=_0x4ad636;subscriptionRequiredModal[_0x62449d(0x1ce)]['display']=_0x62449d(0x265);}function redirectToSubscription(){hideSubscriptionRequiredModal();}function checkSubscriptionStatus(){const _0x4322e3=_0x4ad636,_0x2d4366=sessionStorage['getItem'](_0x4322e3(0x268));if(!_0x2d4366){console[_0x4322e3(0x26d)](_0x4322e3(0x229));return;}const _0x3f475b=ref(db,_0x4322e3(0x24b)+_0x2d4366+_0x4322e3(0x1d7));get(_0x3f475b)[_0x4322e3(0x228)](_0x37a090=>{const _0x691758=_0x4322e3,_0x251264=_0x37a090[_0x691758(0x212)](),_0x223b16=new Date();if(_0x251264&&_0x251264['status']===_0x691758(0x1cb)){const _0x1392a4=new Date(_0x251264[_0x691758(0x270)]);_0x1392a4<_0x223b16?(subscriptionStatus[_0x691758(0x221)]=_0x691758(0x21f),subscriptionStatus[_0x691758(0x1ce)][_0x691758(0x1f9)]='red',subscribeMonthlyButton[_0x691758(0x1ce)]['display']=_0x691758(0x1e3),subscribeYearlyButton[_0x691758(0x1ce)][_0x691758(0x1ef)]=_0x691758(0x1e3),set(_0x3f475b,{..._0x251264,'status':_0x691758(0x208)})):(subscriptionStatus[_0x691758(0x221)]=_0x691758(0x249)+_0x1392a4['toLocaleDateString'](),subscriptionStatus['style'][_0x691758(0x1f9)]=_0x691758(0x1c2),subscribeMonthlyButton[_0x691758(0x1ce)]['display']=_0x691758(0x265),subscribeYearlyButton['style']['display']=_0x691758(0x265));}else subscriptionStatus[_0x691758(0x221)]=_0x691758(0x24c),subscriptionStatus[_0x691758(0x1ce)]['color']=_0x691758(0x1c1),subscribeMonthlyButton[_0x691758(0x1ce)][_0x691758(0x1ef)]=_0x691758(0x1e3),subscribeYearlyButton[_0x691758(0x1ce)][_0x691758(0x1ef)]='inline-block';})[_0x4322e3(0x263)](_0x411cc6=>{const _0x10a8db=_0x4322e3;console[_0x10a8db(0x26d)](_0x10a8db(0x22c),_0x411cc6);});}function checkUserAccess(){const _0x556cb9=_0x4ad636;get(adminRef)[_0x556cb9(0x228)](_0x460ef7=>{const _0x380efb=_0x556cb9,_0x2f0015=_0x460ef7['val']();(!_0x2f0015||_0x2f0015[_0x380efb(0x202)]!==_0x380efb(0x1cb))&&showSubscriptionRequiredModal();});}venteMenuItem[_0x4ad636(0x272)](_0x4ad636(0x1af),_0x3bf2fc=>{const _0x2995eb=_0x4ad636;_0x3bf2fc[_0x2995eb(0x275)](),checkUserAccess(),window[_0x2995eb(0x22f)][_0x2995eb(0x203)]=_0x2995eb(0x1ed);}),inventaireMenuItem[_0x4ad636(0x272)](_0x4ad636(0x1af),_0x1e6a0b=>{const _0x225812=_0x4ad636;_0x1e6a0b['preventDefault'](),checkUserAccess(),window['location'][_0x225812(0x203)]=_0x225812(0x266);}),stockMenuItem[_0x4ad636(0x272)](_0x4ad636(0x1af),_0x3be63b=>{const _0x4aeff2=_0x4ad636;_0x3be63b[_0x4aeff2(0x275)](),checkUserAccess(),window[_0x4aeff2(0x22f)]['href']='Stock.html';}),administrationMenuItem[_0x4ad636(0x272)]('click',_0x15e55b=>{const _0x10f981=_0x4ad636;_0x15e55b[_0x10f981(0x275)](),checkUserAccess(),window['location']['href']=_0x10f981(0x253);}),subscribeMonthlyButton[_0x4ad636(0x272)]('click',()=>{const _0x3b9a67=_0x4ad636;initiatePayment(_0x3b9a67(0x1ba));}),subscribeYearlyButton['addEventListener']('click',()=>{const _0x10ce40=_0x4ad636;initiatePayment(_0x10ce40(0x218));});function initiatePayment(_0x132caf){const _0x5bafb9=_0x4ad636,_0x54c843=_0x132caf===_0x5bafb9(0x1ba)?0x3e8:0x2710,_0x96b24f=_0x132caf==='monthly'?_0x5bafb9(0x1b0):'Abonnement\x20annuel',_0x4ae7a6=sessionStorage[_0x5bafb9(0x1bb)](_0x5bafb9(0x268));if(!_0x4ae7a6){console[_0x5bafb9(0x26d)](_0x5bafb9(0x1eb)),alert(_0x5bafb9(0x23d));return;}FedaPay[_0x5bafb9(0x25b)]({'public_key':_0x5bafb9(0x207),'transaction':{'amount':_0x54c843,'description':_0x96b24f},'customer':{'email':_0x5bafb9(0x20c)},'onComplete':async function(_0x2c84a9){const _0x601d3b=_0x5bafb9;if(_0x2c84a9['reason']===FedaPay[_0x601d3b(0x25a)])alert('Paiement\x20échoué.');else _0x2c84a9[_0x601d3b(0x24d)]===FedaPay[_0x601d3b(0x278)]&&handleSuccessfulPayment(_0x132caf,_0x2c84a9,_0x4ae7a6);}})['open']();}async function handleSuccessfulPayment(_0x43e9f0,_0x23a54f,_0x286d30){const _0x39133a=_0x4ad636,_0x154aef=new Date(),_0x1f61b6=new Date(_0x154aef);_0x43e9f0===_0x39133a(0x1ba)?_0x1f61b6['setMonth'](_0x1f61b6['getMonth']()+0x1):_0x1f61b6[_0x39133a(0x1ca)](_0x1f61b6[_0x39133a(0x1cd)]()+0x1);const _0x594783={'status':'active','startDate':_0x154aef['toISOString'](),'endDate':_0x1f61b6[_0x39133a(0x1c5)](),'transactionId':_0x23a54f['transaction']['id'],'plan':_0x43e9f0};try{const _0x59e8d8=ref(db,_0x39133a(0x24b)+_0x286d30+'/admin/subscription');await set(_0x59e8d8,_0x594783),checkSubscriptionStatus(),alert('Abonnement\x20'+(_0x43e9f0===_0x39133a(0x1ba)?_0x39133a(0x246):_0x39133a(0x27d))+'\x20réussi!');}catch(_0x5a1c95){console[_0x39133a(0x26d)](_0x39133a(0x1d0),_0x5a1c95),alert(_0x39133a(0x26c));}}async function cancelSubscription(){const _0x5ec349=_0x4ad636,_0x8049c3=sessionStorage[_0x5ec349(0x1bb)](_0x5ec349(0x268));if(!_0x8049c3){console['error'](_0x5ec349(0x1f4)),alert(_0x5ec349(0x1d8));return;}try{const _0x59ebc1=ref(db,_0x5ec349(0x24b)+_0x8049c3+_0x5ec349(0x1d7));await set(_0x59ebc1,{...(await get(_0x59ebc1))[_0x5ec349(0x212)](),'status':'cancelled'}),checkSubscriptionStatus(),alert(_0x5ec349(0x1fe));}catch(_0x260fab){console[_0x5ec349(0x26d)](_0x5ec349(0x200),_0x260fab),alert(_0x5ec349(0x27c));}}async function processConnectedTickets(){const _0x295462=_0x4ad636,_0x7f5bdd=document[_0x295462(0x23c)]('pageLoaderMessage'),_0x357d36=sessionStorage[_0x295462(0x1bb)](_0x295462(0x268));if(!_0x357d36){console[_0x295462(0x26d)](_0x295462(0x235));return;}const _0xbc207e=ref(db,_0x295462(0x24b)+_0x357d36+_0x295462(0x1df));try{_0x7f5bdd[_0x295462(0x221)]='Vérification\x20des\x20tickets\x20connectés...';const _0x1902da=await get(_0xbc207e);let _0x1566ae=_0x1902da[_0x295462(0x212)]()||{};const _0x1d87aa={};for(const _0x4ba91a in _0x1566ae){const _0x1a06d0=_0x1566ae[_0x4ba91a][_0x295462(0x234)];!_0x1d87aa[_0x1a06d0]&&(_0x1d87aa[_0x1a06d0]=_0x1566ae[_0x4ba91a]);}_0x7f5bdd[_0x295462(0x221)]=_0x295462(0x1b7);for(const _0x99768c in _0x1d87aa){await processTicket(_0x1d87aa[_0x99768c],_0x357d36);}_0x7f5bdd[_0x295462(0x221)]='Nettoyage\x20des\x20tickets\x20traités...',await remove(_0xbc207e);}catch(_0x22aaf7){console['error'](_0x295462(0x216),_0x22aaf7),showNotification(_0x295462(0x256),_0x295462(0x284));}}async function processTicket(_0x39b9c2,_0xc696d7){const _0x4d55f6=_0x4ad636,_0x212cd2=document[_0x4d55f6(0x23c)]('pageLoaderMessage');if(!_0xc696d7){console[_0x4d55f6(0x26d)]('Current\x20user\x20ID\x20is\x20not\x20provided\x20to\x20processTicket.');return;}try{_0x212cd2['textContent']=_0x4d55f6(0x267)+_0x39b9c2['username']+_0x4d55f6(0x25c);const _0x13b7af=ref(db,_0x4d55f6(0x24b)+_0xc696d7+_0x4d55f6(0x26f)),_0x147a73=await get(_0x13b7af),_0x418dec=_0x147a73['val']()||{};let _0x2b7f12=![];for(const _0x4e0dbc in _0x418dec){const _0x595ac5=_0x418dec[_0x4e0dbc];for(const _0x2b85ed in _0x595ac5){if(_0x595ac5[_0x2b85ed][_0x4d55f6(0x247)]===_0x39b9c2[_0x4d55f6(0x234)]){_0x2b7f12=!![];break;}}if(_0x2b7f12)break;}if(!_0x2b7f12){_0x212cd2[_0x4d55f6(0x221)]='Traitement\x20du\x20ticket\x20'+_0x39b9c2[_0x4d55f6(0x234)]+_0x4d55f6(0x25c);const _0x3f6466=ref(db,_0x4d55f6(0x24b)+_0xc696d7+_0x4d55f6(0x226)),_0x19703b=ref(db,_0x4d55f6(0x24b)+_0xc696d7+'/TicketsTransit'),_0x35ff18=await get(_0x3f6466),_0x868c7d=await get(_0x19703b),_0x151ce6=_0x35ff18[_0x4d55f6(0x212)]()||{},_0x2782d9=_0x868c7d[_0x4d55f6(0x212)]()||{};let _0x5d5016=null,_0x3280f8=null,_0x587a04=null;for(const _0x3e5c4d in _0x151ce6){const _0x1fb17c=(_0x151ce6[_0x3e5c4d][_0x4d55f6(0x23a)]||[])[_0x4d55f6(0x1d1)](_0x39b9c2[_0x4d55f6(0x234)]);if(_0x1fb17c>-0x1){_0x5d5016={'category':_0x3e5c4d,'user':_0x151ce6[_0x3e5c4d][_0x4d55f6(0x23a)][_0x1fb17c],'password':_0x151ce6[_0x3e5c4d][_0x4d55f6(0x23e)][_0x1fb17c],'price':_0x151ce6[_0x3e5c4d][_0x4d55f6(0x248)][_0x1fb17c],'updatedData':{..._0x151ce6[_0x3e5c4d],'utilisateur':_0x151ce6[_0x3e5c4d]['utilisateur'][_0x4d55f6(0x26a)]((_0x3b3e9f,_0x4249fd)=>_0x4249fd!==_0x1fb17c),'motDePasse':_0x151ce6[_0x3e5c4d]['motDePasse'][_0x4d55f6(0x26a)]((_0x480fdc,_0x1d8156)=>_0x1d8156!==_0x1fb17c),'prix':_0x151ce6[_0x3e5c4d][_0x4d55f6(0x248)][_0x4d55f6(0x26a)]((_0xbef1e,_0x3d42f4)=>_0x3d42f4!==_0x1fb17c)}},_0x3280f8=ref(db,_0x4d55f6(0x24b)+_0xc696d7+_0x4d55f6(0x1f7)+_0x3e5c4d),_0x587a04='TicketsTotal';break;}}if(!_0x5d5016)for(const _0xd51d4e in _0x2782d9){if(_0x2782d9[_0xd51d4e]['user']===_0x39b9c2[_0x4d55f6(0x234)]){_0x5d5016={'category':_0x2782d9[_0xd51d4e][_0x4d55f6(0x1b4)],'user':_0x2782d9[_0xd51d4e][_0x4d55f6(0x247)],'password':_0x2782d9[_0xd51d4e][_0x4d55f6(0x20d)],'price':_0x2782d9[_0xd51d4e][_0x4d55f6(0x279)]},_0x3280f8=ref(db,_0x4d55f6(0x24b)+_0xc696d7+'/TicketsTransit/'+_0xd51d4e),_0x587a04=_0x4d55f6(0x1ff);break;}}_0x5d5016&&(_0x212cd2['textContent']=_0x4d55f6(0x243)+_0x39b9c2[_0x4d55f6(0x234)]+_0x4d55f6(0x25c),await sellTicketAutomatically(_0x5d5016,_0x3280f8,_0x587a04,_0xc696d7));}}catch(_0x1c80b8){console[_0x4d55f6(0x26d)](_0x4d55f6(0x251),_0x1c80b8),showNotification('Erreur',_0x4d55f6(0x1f1)+_0x39b9c2[_0x4d55f6(0x234)]+'.');}}async function sellTicketAutomatically(_0x6045ce,_0x13cd2f,_0x314233,_0x16bd39){const _0xbc4634=_0x4ad636;if(!_0x16bd39){console['error'](_0xbc4634(0x277));return;}try{const _0x49d2d6=_0xbc4634(0x1c7),_0x351a2c=ref(db,_0xbc4634(0x24b)+_0x16bd39+'/VendorsHistory/'+_0x49d2d6);await push(_0x351a2c,{'category':_0x6045ce[_0xbc4634(0x1b4)],'user':_0x6045ce[_0xbc4634(0x247)],'password':_0x6045ce[_0xbc4634(0x20d)],'price':_0x6045ce[_0xbc4634(0x279)],'soldAt':Date['now'](),'vendorId':_0x49d2d6}),_0x314233===_0xbc4634(0x27f)?await set(_0x13cd2f,_0x6045ce[_0xbc4634(0x264)]):await remove(_0x13cd2f),console[_0xbc4634(0x24a)](_0xbc4634(0x1ea)+_0x6045ce[_0xbc4634(0x247)]+'\x20vendu\x20automatiquement\x20et\x20enregistré\x20dans\x20VendorsHistory.');}catch(_0x21a33d){console['error']('Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket\x20:',_0x21a33d),showNotification(_0xbc4634(0x256),_0xbc4634(0x271));}}window[_0x4ad636(0x222)]=function(){const _0x39fe80=_0x4ad636;sessionStorage[_0x39fe80(0x225)](),window[_0x39fe80(0x22f)][_0x39fe80(0x1ee)](_0x39fe80(0x1f6));},window[_0x4ad636(0x252)]=function(){const _0x48c1d4=_0x4ad636,_0x13c110=document[_0x48c1d4(0x23c)](_0x48c1d4(0x21e)),_0x2daa0c=document[_0x48c1d4(0x23c)](_0x48c1d4(0x217)),_0xf37d8f=document[_0x48c1d4(0x23c)](_0x48c1d4(0x27a));_0x13c110[_0x48c1d4(0x1ce)][_0x48c1d4(0x1ef)]===_0x48c1d4(0x265)||_0x13c110[_0x48c1d4(0x1ce)]['display']===''?(_0x13c110[_0x48c1d4(0x1ce)][_0x48c1d4(0x1ef)]=_0x48c1d4(0x1b9),_0xf37d8f[_0x48c1d4(0x1ce)]['display']=_0x48c1d4(0x1e3),_0x2daa0c['textContent']=_0x48c1d4(0x244)):(_0x13c110[_0x48c1d4(0x1ce)][_0x48c1d4(0x1ef)]=_0x48c1d4(0x265),_0xf37d8f['style'][_0x48c1d4(0x1ef)]='none',_0x2daa0c['textContent']='Configurer\x20le\x20portail\x20captif');},window['addListItem']=function(_0x9f44e5){const _0x901d78=_0x4ad636,_0x1be21c=document[_0x901d78(0x23c)](_0x9f44e5),_0x424da6=document[_0x901d78(0x21d)](_0x901d78(0x20a));_0x424da6['className']=_0x901d78(0x211);let _0x469731=_0x901d78(0x1f0);if(_0x9f44e5===_0x901d78(0x237))_0x424da6[_0x901d78(0x1fd)]=_0x901d78(0x20e);else{let _0xeee137='';if(_0x9f44e5===_0x901d78(0x1de))_0xeee137=_0x901d78(0x22a);else _0x9f44e5===_0x901d78(0x1d2)&&(_0xeee137=_0x901d78(0x220));_0x424da6[_0x901d78(0x1fd)]=_0x901d78(0x1dc)+_0x469731+_0x901d78(0x1c8)+_0xeee137+'\x22\x20data-type=\x22'+_0x9f44e5[_0x901d78(0x26e)](0x0,-0x4)+_0x901d78(0x22d);}_0x1be21c[_0x901d78(0x27b)](_0x424da6);},window[_0x4ad636(0x219)]=function(_0x19a944){const _0x4faad1=_0x4ad636;_0x19a944[_0x4faad1(0x1f3)][_0x4faad1(0x1c3)]();},document[_0x4ad636(0x23c)](_0x4ad636(0x21e))[_0x4ad636(0x272)](_0x4ad636(0x1b8),async _0x575dd5=>{const _0x48ff38=_0x4ad636;_0x575dd5['preventDefault'](),showLoader();const _0x1b0bb0=sessionStorage[_0x48ff38(0x1bb)](_0x48ff38(0x268));if(!_0x1b0bb0){console[_0x48ff38(0x26d)](_0x48ff38(0x1fb)),alert(_0x48ff38(0x288)),hideLoader();return;}const _0x1bf787={'networkName':document[_0x48ff38(0x23c)](_0x48ff38(0x1b2))[_0x48ff38(0x250)],'contactNumber':document[_0x48ff38(0x23c)](_0x48ff38(0x21b))[_0x48ff38(0x250)],'fedapayApiKey':document[_0x48ff38(0x23c)](_0x48ff38(0x283))[_0x48ff38(0x250)],'loginMode':document['getElementById'](_0x48ff38(0x1e9))[_0x48ff38(0x250)],'tariffs':[],'connections':[],'products':[]};document[_0x48ff38(0x22b)](_0x48ff38(0x230))[_0x48ff38(0x22e)](_0x59158a=>{const _0x5d382b=_0x48ff38,_0x38e035=_0x59158a[_0x5d382b(0x255)](_0x5d382b(0x258)),_0x3f818c=_0x59158a['querySelector'](_0x5d382b(0x205));if(_0x38e035&&_0x3f818c){const _0x4756c2=_0x38e035[_0x5d382b(0x250)][_0x5d382b(0x239)](),_0x5ee668=parseFloat(_0x3f818c[_0x5d382b(0x250)]);_0x4756c2&&!isNaN(_0x5ee668)&&_0x1bf787[_0x5d382b(0x245)][_0x5d382b(0x1e4)]({'name':_0x4756c2,'price':_0x5ee668});}}),document[_0x48ff38(0x22b)]('#connectionsList\x20.list-item\x20input')[_0x48ff38(0x22e)](_0x1c66a2=>{const _0x4cd647=_0x48ff38,_0x2a7e18=_0x1c66a2[_0x4cd647(0x250)][_0x4cd647(0x239)]();_0x2a7e18&&_0x1bf787[_0x4cd647(0x257)][_0x4cd647(0x1e4)](_0x2a7e18);}),document['querySelectorAll'](_0x48ff38(0x20b))['forEach'](_0x5a0fd1=>{const _0x3f88ea=_0x48ff38,_0x55efb0=_0x5a0fd1[_0x3f88ea(0x250)][_0x3f88ea(0x239)]();_0x55efb0&&_0x1bf787[_0x3f88ea(0x23b)][_0x3f88ea(0x1e4)](_0x55efb0);});try{const _0x2b61dc=ref(db,'users-data/'+_0x1b0bb0+'/portalConfig');await set(_0x2b61dc,_0x1bf787),alert('Configuration\x20du\x20portail\x20captif\x20enregistrée\x20avec\x20succès!'),hideLoader(),document[_0x48ff38(0x23c)]('portalForm')['reset'](),document[_0x48ff38(0x23c)](_0x48ff38(0x21e))['style'][_0x48ff38(0x1ef)]=_0x48ff38(0x265),document[_0x48ff38(0x23c)](_0x48ff38(0x217))[_0x48ff38(0x221)]=_0x48ff38(0x224),document[_0x48ff38(0x23c)](_0x48ff38(0x27a))[_0x48ff38(0x1ce)][_0x48ff38(0x1ef)]='none',document['getElementById'](_0x48ff38(0x1e8))['textContent']=_0x1bf787[_0x48ff38(0x1b2)];}catch(_0xa48a42){console[_0x48ff38(0x26d)](_0x48ff38(0x259),_0xa48a42),alert(_0x48ff38(0x1da)),hideLoader();}});async function downloadLoginFile(){const _0x119abe=_0x4ad636;showLoader();const _0x392803=sessionStorage[_0x119abe(0x1bb)](_0x119abe(0x268));if(!_0x392803){console['error'](_0x119abe(0x209)),hideLoader(),alert(_0x119abe(0x25e));return;}try{const _0x503d2f=ref(db,_0x119abe(0x24b)+_0x392803+'/portalConfig'),_0x19bf8a=await get(_0x503d2f);if(!_0x19bf8a['exists']()){alert('Aucune\x20configuration\x20de\x20portail\x20captif\x20trouvée.'),hideLoader();return;}const _0x4a99dc=_0x19bf8a[_0x119abe(0x212)]();let _0x2a35ae='',_0x52c7be='';if(_0x4a99dc[_0x119abe(0x1e9)]===_0x119abe(0x1d5)){const _0x2c2e15=await fetch(_0x119abe(0x1ae));_0x2a35ae=await _0x2c2e15[_0x119abe(0x1f0)](),_0x52c7be='login.html';}else{if(_0x4a99dc[_0x119abe(0x1e9)]===_0x119abe(0x24e)){const _0x25a05b=await fetch(_0x119abe(0x260));_0x2a35ae=await _0x25a05b[_0x119abe(0x1f0)](),_0x52c7be='log.html';}else{if(_0x4a99dc['loginMode']===_0x119abe(0x1d4)){const _0x167e42=await fetch('pay.html');_0x2a35ae=await _0x167e42[_0x119abe(0x1f0)](),_0x52c7be=_0x119abe(0x240);}else{alert(_0x119abe(0x1c6)),hideLoader();return;}}}_0x2a35ae=_0x2a35ae[_0x119abe(0x1ee)](_0x119abe(0x232),_0x392803);function _0x5a7b5d(_0x452799){const _0x315fc2=_0x119abe;let _0x386de9=_0x315fc2(0x215);return _0x452799['forEach'](_0x4860bf=>{const _0x1ed741=_0x315fc2;_0x386de9+=_0x1ed741(0x233)+_0x4860bf[_0x1ed741(0x242)]+_0x1ed741(0x1e2)+_0x4860bf[_0x1ed741(0x279)]+_0x1ed741(0x1b3)+_0x4860bf[_0x1ed741(0x242)]+'\x27,\x20'+_0x4860bf['price']+_0x1ed741(0x273);}),_0x386de9+=_0x315fc2(0x227),_0x386de9;}function _0x1c602d(_0x54da3a){const _0x5ceacd=_0x119abe;let _0x10fd0c='<table\x20style=\x22width:\x20100%;\x20border-collapse:\x20collapse;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>';return _0x54da3a[_0x5ceacd(0x22e)](_0x4a6f54=>{const _0x4e2918=_0x5ceacd;_0x10fd0c+=_0x4e2918(0x21c)+_0x4a6f54[_0x4e2918(0x242)]+_0x4e2918(0x1db)+_0x4a6f54[_0x4e2918(0x279)]+_0x4e2918(0x1d9);}),_0x10fd0c+=_0x5ceacd(0x213),_0x10fd0c;}function _0xb66f4c(_0x42e3bd){const _0x56cc9f=_0x119abe;let _0x5ee8ec='<ul>';return _0x42e3bd[_0x56cc9f(0x22e)](_0x17ab1a=>{const _0x5ed06d=_0x56cc9f;_0x5ee8ec+='<li>'+_0x17ab1a+_0x5ed06d(0x201);}),_0x5ee8ec+=_0x56cc9f(0x1fc),_0x5ee8ec;}_0x2a35ae=_0x2a35ae[_0x119abe(0x1ee)]('<!--\x20TARIFFS_TABLE\x20-->',_0x5a7b5d(_0x4a99dc['tariffs']||[])),_0x2a35ae=_0x2a35ae['replace'](_0x119abe(0x287),_0x1c602d(_0x4a99dc[_0x119abe(0x245)]||[])),_0x2a35ae=_0x2a35ae[_0x119abe(0x1ee)](_0x119abe(0x236),_0xb66f4c(_0x4a99dc[_0x119abe(0x257)]||[])),_0x2a35ae=_0x2a35ae[_0x119abe(0x1ee)]('<!--\x20PRODUCTS_LIST\x20-->',_0xb66f4c(_0x4a99dc[_0x119abe(0x23b)]||[])),_0x2a35ae=_0x2a35ae['replace'](_0x119abe(0x204),_0x4a99dc[_0x119abe(0x21b)]||_0x119abe(0x1ec)),_0x2a35ae=_0x2a35ae[_0x119abe(0x1ee)]('<!--\x20NETWORK_NAME\x20-->',_0x4a99dc[_0x119abe(0x1b2)]||_0x119abe(0x25f)),_0x2a35ae=_0x2a35ae[_0x119abe(0x1ee)](_0x119abe(0x1e1),_0x4a99dc[_0x119abe(0x283)]||'');const _0xe617ab=new Blob([_0x2a35ae],{'type':_0x119abe(0x1e5)}),_0x8eab9e=URL[_0x119abe(0x231)](_0xe617ab),_0x57a2b9=document[_0x119abe(0x21d)]('a');_0x57a2b9[_0x119abe(0x203)]=_0x8eab9e,_0x57a2b9[_0x119abe(0x1e6)]=_0x52c7be,document[_0x119abe(0x1bf)][_0x119abe(0x27b)](_0x57a2b9),_0x57a2b9[_0x119abe(0x1af)](),document[_0x119abe(0x1bf)][_0x119abe(0x286)](_0x57a2b9),URL[_0x119abe(0x1cf)](_0x8eab9e);const _0x1d3ba1=document[_0x119abe(0x21d)]('a');_0x1d3ba1[_0x119abe(0x203)]=_0x119abe(0x25d),_0x1d3ba1[_0x119abe(0x1e6)]=_0x119abe(0x25d),document[_0x119abe(0x1bf)][_0x119abe(0x27b)](_0x1d3ba1),_0x1d3ba1['click'](),document[_0x119abe(0x1bf)][_0x119abe(0x286)](_0x1d3ba1),hideLoader();}catch(_0xa60964){console[_0x119abe(0x26d)](_0x119abe(0x214),_0xa60964),alert('Erreur\x20lors\x20du\x20téléchargement\x20du\x20portail\x20captif.'),hideLoader();}}window['downloadLoginFile']=downloadLoginFile;async function loadPortalConfig(){const _0x552271=_0x4ad636;showLoader();const _0x26267f=sessionStorage[_0x552271(0x1bb)](_0x552271(0x268));if(!_0x26267f){console[_0x552271(0x26d)](_0x552271(0x276)),hideLoader();return;}try{const _0x355eae=ref(db,'users-data/'+_0x26267f+_0x552271(0x1b5)),_0x3233cf=await get(_0x355eae);if(_0x3233cf[_0x552271(0x27e)]()){const _0x20f483=_0x3233cf['val']();document[_0x552271(0x23c)]('networkName')[_0x552271(0x250)]=_0x20f483[_0x552271(0x1b2)]||'',document[_0x552271(0x23c)](_0x552271(0x21b))[_0x552271(0x250)]=_0x20f483[_0x552271(0x21b)]||'',document[_0x552271(0x23c)](_0x552271(0x283))[_0x552271(0x250)]=_0x20f483[_0x552271(0x283)]||'',document['getElementById']('loginMode')[_0x552271(0x250)]=_0x20f483[_0x552271(0x1e9)]||_0x552271(0x1d5),document['getElementById'](_0x552271(0x1e8))['textContent']=_0x20f483[_0x552271(0x1b2)]||_0x552271(0x1f8);function _0x16fa9e(_0x4ff313,_0x2f1d37,_0x264b46){const _0x2385b0=_0x552271,_0x3fd859=document[_0x2385b0(0x23c)](_0x4ff313);_0x3fd859[_0x2385b0(0x1fd)]='',_0x2f1d37[_0x2385b0(0x22e)](_0x444a83=>{const _0x28f576=_0x2385b0,_0x4a921b=document[_0x28f576(0x21d)](_0x28f576(0x20a));_0x4a921b[_0x28f576(0x280)]=_0x28f576(0x211),_0x4ff313===_0x28f576(0x237)?_0x4a921b[_0x28f576(0x1fd)]=_0x28f576(0x1be)+_0x444a83[_0x28f576(0x242)]+'\x22\x20data-type=\x22tariffName\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20value=\x22'+_0x444a83['price']+'\x22\x20data-type=\x22tariffPrice\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>':_0x4a921b['innerHTML']=_0x28f576(0x254)+_0x444a83+_0x28f576(0x26b)+_0x264b46+_0x28f576(0x1b6),_0x3fd859[_0x28f576(0x27b)](_0x4a921b);}),addListItem(_0x4ff313);}_0x16fa9e('tariffsList',_0x20f483[_0x552271(0x245)]||[],null),_0x16fa9e(_0x552271(0x1de),_0x20f483[_0x552271(0x257)]||[],_0x552271(0x1e0)),_0x16fa9e(_0x552271(0x1d2),_0x20f483[_0x552271(0x23b)]||[],_0x552271(0x1d6));}else console['log']('Aucune\x20configuration\x20trouvée.'),addListItem(_0x552271(0x237)),addListItem(_0x552271(0x1de)),addListItem(_0x552271(0x1d2));}catch(_0x46ebc3){console[_0x552271(0x26d)](_0x552271(0x21a),_0x46ebc3),alert(_0x552271(0x223));}finally{hideLoader();}}document['addEventListener']('DOMContentLoaded',async()=>{const _0x203719=_0x4ad636;showPageLoader(),await initializeDatabase(),await checkLoginStatus(),loadPortalConfig(),processConnectedTickets()['then'](()=>checkSubscriptionStatus())[_0x203719(0x228)](()=>{hidePageLoader();})[_0x203719(0x263)](_0x45771a=>{const _0x4f4677=_0x203719;console[_0x4f4677(0x26d)](_0x4f4677(0x1c4),_0x45771a),hidePageLoader(),showNotification(_0x4f4677(0x256),_0x4f4677(0x23f));});}),window[_0x4ad636(0x241)]=redirectToSubscription,window[_0x4ad636(0x1bd)]=redirectToSubscription;function closePaymentModal(){const _0x3329ec=_0x4ad636;paymentModal[_0x3329ec(0x1ce)][_0x3329ec(0x1ef)]='none',overlay[_0x3329ec(0x1ce)][_0x3329ec(0x1ef)]=_0x3329ec(0x265);}window[_0x4ad636(0x1d3)]=()=>{};
    </script>

</body>
</html>
