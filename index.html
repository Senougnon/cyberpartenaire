<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN WIFI ZONE</title>
    <link rel="stylesheet" href="styleA.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications majeures, juste des ajustements pour le formulaire) ... */
       /* Style pour le modal de paiement */
       .payment-modal {
           display: none;
           position: fixed;
           top: 50%;
           left: 50%;
           transform: translate(-50%, -50%);
           background-color: white;
           padding: 30px;
           border-radius: 10px;
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
           z-index: 1000;
           max-width: 400px;
           width: 90%;
           text-align: center;
       }

       .payment-modal h2 {
           color: #333;
           margin-bottom: 20px;
       }

       .payment-modal p {
           color: #666;
           margin-bottom: 30px;
       }

       .payment-modal button {
           background-color: #fdbb2d;
           color: #1a2a6c;
           border: none;
           padding: 12px 20px;
           border-radius: 25px;
           cursor: pointer;
           transition: all 0.3s;
           font-weight: 600;
           font-size: 0.9rem;
           margin: 0 10px;
       }

       .payment-modal button:hover {
           background-color: #e6a727;
       }

       .close-modal {
           position: absolute;
           top: 10px;
           right: 10px;
           cursor: pointer;
           font-size: 1.2rem;
           color: #333;
       }

       /* Style pour l'overlay */
       .overlay {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0, 0, 0, 0.5);
           z-index: 999;
       }
       #subscriptionSection {
           text-align: center;
           margin-bottom: 30px;
       }

       #subscriptionSection h2 {
           font-size: 24px;
           color: #fdbb2d;
           margin-bottom: 20px;
       }

       #subscriptionStatus {
           font-size: 18px;
           color: #fff;
           margin-bottom: 20px;
       }

       .subscription-buttons {
           display: flex;
           justify-content: center;
           gap: 20px;
       }

       .subscription-buttons button {
           background-color: #fdbb2d;
           color: #1a2a6c;
           border: none;
           padding: 12px 20px;
           border-radius: 25px;
           cursor: pointer;
           transition: all 0.3s;
           font-weight: 600;
           font-size: 0.9rem;
       }

       .subscription-buttons button:hover {
           background-color: #e6a727;
       }

       /* Style pour le message d'abonnement requis */
       .subscription-required {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0, 0, 0, 0.5);
           z-index: 1000;
           justify-content: center;
           align-items: center;
           color: white;
           text-align: center;
           padding: 20px;
       }

       .subscription-required-content {
           background-color: white;
           padding: 30px;
           border-radius: 10px;
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
           max-width: 400px;
           width: 90%;
       }

       .subscription-required-content h2 {
           color: #333;
           margin-bottom: 20px;
       }

       .subscription-required-content p {
           color: #666;
           margin-bottom: 30px;
       }

       .subscription-required-content button {
           background-color: #fdbb2d;
           color: #1a2a6c;
           border: none;
           padding: 12px 20px;
           border-radius: 25px;
           cursor: pointer;
           transition: all 0.3s;
           font-weight: 600;
           font-size: 0.9rem;
           margin: 0 10px;
       }

       .subscription-required-content button:hover {
           background-color: #e6a727;
       }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }

        .header {
            display: flex; /* Added to align items */
            justify-content: center; /* MODIFICATION: Center content horizontally */
            align-items: center; /* Added to vertically align items */
            flex-direction: column; /* MODIFICATION: Stack items vertically */
            text-align: center; /* MODIFICATION: Center text within header */
        }

        .header h1 {
            margin: 0; /* Reset margin for h1 inside header */
        }

        .logout-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .logout-button:hover {
            background-color: #c0392b;
        }
       /* Styles pour le formulaire de portail captif */
      #portalForm {
          display: none; /*Caché par défaut*/
          flex-direction: column;
          gap: 10px;
          max-width: 600px; /* Limite la largeur du formulaire */
          margin: 20px auto;
          padding: 20px;
          background-color: rgba(255, 255, 255, 0.1); /* Léger fond pour le formulaire */
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Ombre légère */
      }
      #portalForm label {
          color: #fdbb2d; /* Couleur pour les labels */
      }
      #portalForm input[type="text"],
      #portalForm input[type="number"],
      #portalForm textarea,
      #portalForm select {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 4px;
          background-color: rgba(255,255,255,0.2); /* Fond transparent */
          color: white; /* Couleur du texte */
      }

      #portalForm button {
          padding: 10px 15px;
          background-color: #fdbb2d;
          color: #1a2a6c;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
      }

      #portalForm button:hover {
          background-color: #e6a727;
      }
      #portalForm .list-input-container {
          display: flex;
          flex-direction: column;
      }

      #portalForm .list-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

      #portalForm .list-item input {
          flex: 1; /* Permet à l'input de prendre l'espace disponible */
          margin-right: 5px; /* Marge entre l'input et le bouton */
      }
        #portalForm .list-item button {
           padding: 5px 10px;
           background-color: #e74c3c; /* Couleur différente pour le bouton de suppression */
           color: white;
           border: none;
           border-radius: 4px;
           cursor: pointer;
           font-size: 14px;
        }

        #portalForm .list-item button:hover {
           background-color: #c0392b;
        }

        #configSection {
          margin-bottom:           20px;
          text-align: center; /* Center-align the buttons */
      }
        #configSection .config-buttons {
          display: inline-block;
          margin: 0 10px;
        }

    </style>
</head>
<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <div class="container" id="contentContainer" style="display:none;">
        <header class="header">
            <h1 id="networkNameDisplay">ADMIN WIFI ZONE</h1>
            <div class="wave"></div>
        </header>


        <main>
            <div id="subscriptionSection">
                <h2>Statut de l'Abonnement</h2>
                <div id="subscriptionStatus"></div>
                <div class="subscription-button">
                    <button id="subscribeMonthly">S'abonner (Mensuel - 1000 FCFA)</button>
                    <button id="subscribeYearly">S'abonner (Annuel - 10 000 FCFA)</button>
                </div>
            </div>

            <div id="configSection">
              <button onclick="togglePortalForm()" id="togglePortalFormBtn">Configurer le portail captif</button>
              <button onclick="downloadLoginFile()" id="downloadLoginBtn" style="display: none;">Télécharger le portail captif</button>
             </div>


            <form id="portalForm" style="display: none;">
                <label for="networkName">Nom du réseau:</label>
                <input type="text" id="networkName" name="networkName" required>

                <label for="contactNumber">Numéro à contacter:</label>
                <input type="text" id="contactNumber" name="contactNumber" required>

                <label for="fedapayApiKey">Clé API FedaPay:</label>
                <input type="text" id="fedapayApiKey" name="fedapayApiKey" required>

                <label for="loginMode">Mode de connexion par défaut :</label>
                <select id="loginMode" name="loginMode">
                    <option value="separate">Nom d'utilisateur et Mot de passe</option>
                    <option value="same">Identifiant unique</option>
                    <option value="pay">Page de paiement</option> <!-- Nouvelle option -->
                </select>

                <div class="list-input-container">
                    <label>Tarifs:</label>
                    <div id="tariffsList">
                        <div class="list-item">
                            <input type="text" placeholder="Nom du tarif" data-type="tariffName">
                            <input type="number" placeholder="Prix" data-type="tariffPrice">
                            <button type="button" onclick="addListItem('tariffsList')">Ajouter</button>
                         </div>
                      </div>
                 </div>

                 <div class="list-input-container">
                      <label>Adresses de connexion:</label>
                      <div id="connectionsList">
                         <div class="list-item">
                            <input type="text" placeholder="Adresse" data-type="connection">
                            <button type="button" onclick="addListItem('connectionsList')">Ajouter</button>
                           </div>
                      </div>
                  </div>

                  <div class="list-input-container">
                      <label>Services et produits:</label>
                      <div id="productsList">
                         <div class="list-item">
                             <input type="text" placeholder="Service/Produit" data-type="product">
                             <button type="button" onclick="addListItem('productsList')">Ajouter</button>
                         </div>
                     </div>
                 </div>

                 <button type="submit">Enregistrer la configuration</button>
             </form>

            <div class="menu">
                <a href="PageVenteTicket.html" class="menu-item" id="vente">
                    <i class="fas fa-ticket-alt"></i> <!-- Font Awesome Ticket Icon -->
                    <h2>Vente de Tickets</h2>
                    <p>Procédez à la vente de nouveaux tickets Wifi.</p>
                </a>
                <a href="AdminVentePartenaires.html" class="menu-item" id="inventaire">
                    <i class="fas fa-clipboard-list"></i> <!-- Font Awesome Clipboard List Icon -->
                    <h2>Inventaire des Tickets</h2>
                    <p>Consultez l'état des ventes de vos partenaires.</p>
                </a>
                <a href="Stock.html" class="menu-item" id="stock">
                    <i class="fas fa-boxes"></i> <!-- Font Awesome Boxes Icon -->
                    <h2>Gestion des Stocks Partenaire</h2>
                    <p>Suivez les stocks de tickets de vos partenaires.</p>
                </a>
                <a href="a3.html" class="menu-item" id="administration">
                    <i class="fas fa-cog"></i> <!-- Font Awesome Settings Cog Icon -->
                    <h2>Administration des Tickets</h2>
                    <p>Gérez les tickets, activez ou désactivez-les.</p>
                </a>
                <button onclick="logout()" class="logout-button">Déconnexion</button>
            </div>

        </main>

    </div>


    <div id="paymentModal" class="payment-modal" style="display: none;">
        <span class="close-modal" onclick="closePaymentModal()">×</span>
        <h2>Paiement de l'Abonnement</h2>
        <p>Choisissez votre plan d'abonnement et procédez au paiement via FedaPay.</p>
        <!-- Les boutons de paiement seront ajoutés ici par le script -->
    </div>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <div class="overlay" id="overlay" style="display: none;" onclick="closePaymentModal()"></div>

    <script type="module">
 const _0x3255aa=_0x1ac5;(function(_0x2448af,_0x496f07){const _0x459044=_0x1ac5,_0x22380f=_0x2448af();while(!![]){try{const _0x322599=parseInt(_0x459044(0x1ae))/0x1+parseInt(_0x459044(0x168))/0x2+-parseInt(_0x459044(0x180))/0x3+parseInt(_0x459044(0x1bf))/0x4*(parseInt(_0x459044(0x191))/0x5)+-parseInt(_0x459044(0x18b))/0x6+-parseInt(_0x459044(0x190))/0x7+-parseInt(_0x459044(0x1b4))/0x8;if(_0x322599===_0x496f07)break;else _0x22380f['push'](_0x22380f['shift']());}catch(_0x2f385a){_0x22380f['push'](_0x22380f['shift']());}}}(_0x48dc,0xf2564));import{getActiveDatabase}from'./firebase-config-manager.js';import{ref,get,set,push,remove,update}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';function _0x48dc(){const _0x3f0f76=['fedapayApiKey','2930007mHiwII','ADMIN\x20WIFI\x20ZONE','slice','/VendorsHistory','red','Adresse','createObjectURL','networkNameDisplay','parentNode','subscriptionRequiredModal','removeChild','1541592MJotsR','connections','monthly','flex','querySelector','6570634AXVbhv','135790onZzFC','innerHTML','reason','addListItem','\x20réussi!','connectionsList','<input\x20type=\x22text\x22\x20value=\x22','appendChild','endDate','download','text','transaction','toISOString','TicketsTransit','active','reset','removeListItem','Erreur\x20lors\x20de\x20la\x20vérification\x20du\x20statut\x20d\x27abonnement:','filter','status','trim','Erreur\x20lors\x20de\x20l\x27annulation\x20de\x20l\x27abonnement.','addEventListener','Current\x20user\x20ID\x20is\x20not\x20found\x20in\x20sessionStorage.','TicketConnecté','Erreur\x20lors\x20de\x20la\x20mise\x20à\x20jour\x20de\x20l\x27abonnement.','username','error','#productsList\x20.list-item\x20input','877906bhyDMb','loginMode','init','submit','Abonnement\x20','Erreur\x20lors\x20du\x20téléchargement\x20du\x20portail\x20captif.','4947888CZPMKE','...','same','+229\x20XXXXXXXX','Paiement\x20échoué.','/portalConfig','prix','PageVenteTicket.html','setMonth','price','Erreur\x20lors\x20de\x20l\x27enregistrement\x20de\x20la\x20configuration.','236XhQlZq','href','val','/TicketsVendus','User\x20ID\x20not\x20found.\x20Cannot\x20cancel\x20subscription.','User\x20ID\x20not\x20found.\x20Cannot\x20save\x20portal\x20configuration.','Vente\x20du\x20ticket\x20','log.html','Nettoyage\x20des\x20tickets\x20traités...','tariffs','<!--\x20NETWORK_NAME\x20-->','textContent','Ticket\x20','overlay','contactNumber','clear','forEach','exists','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20placeholder=\x22Nom\x20du\x20tarif\x22\x20data-type=\x22tariffName\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20placeholder=\x22Prix\x22\x20data-type=\x22tariffPrice\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>','</tbody></table>','name','body','TicketsTotal','Traitement\x20des\x20tickets\x20uniques...','tariffsList','Vendeur\x20automatique','subscribeMonthly','<!--\x20FEDAPAY_API_KEY\x20-->','Abonnement\x20annuel','portalForm','revokeObjectURL','createElement','Erreur\x20lors\x20de\x20la\x20mise\x20à\x20jour\x20de\x20l\x27abonnement:','Vous\x20devez\x20être\x20connecté\x20pour\x20configurer\x20le\x20portail.','Vous\x20devez\x20être\x20connecté\x20pour\x20annuler\x20un\x20abonnement.','Aucune\x20configuration\x20de\x20portail\x20captif\x20trouvée.','push','Mode\x20de\x20connexion\x20invalide.','className','getFullYear','Abonnement\x20annulé.','Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket\x20:','Service/Produit','Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>','</li>','\x20vendu\x20automatiquement.','yearly','isLoggedIn','Erreur','networkName','Erreur\x20lors\x20de\x20l\x27enregistrement\x20de\x20la\x20configuration:','list-item','preventDefault','utilisateur','User\x20ID\x20not\x20found.\x20Cannot\x20check\x20subscription\x20status.','pageLoaderMessage','Current\x20user\x20ID\x20is\x20not\x20provided\x20to\x20processTicket.','<!--\x20TARIFFS_TABLE\x20-->','<ul>','hideSubscriptionRequiredModal','users-data/','user','click','loaderWrapper','/TicketsTransit/','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20:','<table\x20style=\x22width:\x20100%;\x20border-collapse:\x20collapse;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>','Current\x20user\x20ID\x20is\x20not\x20provided\x20to\x20sellTicketAutomatically.','logout','productsList','querySelectorAll','paymentModal','Vous\x20devez\x20être\x20connecté\x20pour\x20télécharger\x20le\x20portail.','togglePortalForm','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table\x20style=\x22width:\x20100%;\x20border-collapse:\x20collapse;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x20text-align:\x20left;\x22>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</ul>','getElementById','now','<!--\x20CONTACT_NUMBER\x20-->','CYBER\x20CAMPUS\x20WIFI\x20ZONE','then','annuel','Vous\x20devez\x20être\x20connecté\x20pour\x20vous\x20abonner.','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','DOMContentLoaded','/admin/subscription','Aucune\x20configuration\x20trouvée.','setFullYear','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>','downloadLoginBtn','stock',')\x22>Payer</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','togglePortalFormBtn','Database\x20initialized\x20in\x20index.html','login.html','onload','category','loginAccueil.html','Erreur\x20lors\x20du\x20chargement\x20de\x20la\x20configuration:','<!--\x20TARIFFS_TABLE_SIMPLE\x20-->','currentUserId','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','connection','#connectionsList\x20.list-item\x20input','/TicketsTotal/','value','expired','green','\x22\x20data-type=\x22','product','motDePasse','inline-block','none','Une\x20erreur\x20est\x20survenue\x20lors\x20du\x20traitement\x20des\x20tickets.','location','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22','Statut\x20de\x20l\x27abonnement:\x20Expiré','Erreur\x20lors\x20du\x20chargement\x20de\x20la\x20configuration.','color','block','/TicketsTotal','vente','remove','contentContainer','catch','getItem','2606266rdiqcu','pageLoaderWrapper','a3.html','display','inventaire','User\x20ID\x20not\x20found.\x20Cannot\x20download\x20login\x20file.','Statut\x20de\x20l\x27abonnement:\x20Inactif','getMonth','Configuration\x20du\x20portail\x20captif\x20enregistrée\x20avec\x20succès!','style','indexOf','log','products','replace','password','<!--\x20CONNECTION_LOCATIONS\x20-->','separate','pay.html','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>','Erreur\x20lors\x20du\x20traitement\x20des\x20tickets\x20connectés\x20:','\x22\x20data-type=\x22tariffName\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20value=\x22','div','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>'];_0x48dc=function(){return _0x3f0f76;};return _0x48dc();}let db,adminRef,connectedTicketsRef;async function initializeDatabase(){const _0x121671=_0x1ac5;db=await getActiveDatabase(),connectedTicketsRef=ref(db,_0x121671(0x1a9)),console[_0x121671(0x173)](_0x121671(0x21d));}async function checkLoginStatus(){const _0x493615=_0x1ac5;if(sessionStorage['getItem'](_0x493615(0x1ef))!=='true')redirectToLogin();else{const _0x3dbdf6=sessionStorage[_0x493615(0x167)](_0x493615(0x224));if(!_0x3dbdf6){console[_0x493615(0x1ac)](_0x493615(0x1a8)),redirectToLogin();return;}document[_0x493615(0x20c)](_0x493615(0x165))['style'][_0x493615(0x16b)]='block',adminRef=ref(db,_0x493615(0x1fc)+_0x3dbdf6+_0x493615(0x215));}}function redirectToLogin(){const _0x1d4a99=_0x1ac5;window[_0x1d4a99(0x233)][_0x1d4a99(0x1c0)]=_0x1d4a99(0x221);}window[_0x3255aa(0x204)]=function(){sessionStorage['clear'](),redirectToLogin();};const venteMenuItem=document['getElementById'](_0x3255aa(0x163)),inventaireMenuItem=document[_0x3255aa(0x20c)](_0x3255aa(0x16c)),stockMenuItem=document['getElementById'](_0x3255aa(0x21a)),administrationMenuItem=document[_0x3255aa(0x20c)]('administration'),subscriptionStatus=document[_0x3255aa(0x20c)]('subscriptionStatus'),subscribeMonthlyButton=document[_0x3255aa(0x20c)](_0x3255aa(0x1d9)),subscribeYearlyButton=document[_0x3255aa(0x20c)]('subscribeYearly'),paymentModal=document['getElementById'](_0x3255aa(0x207)),overlay=document[_0x3255aa(0x20c)](_0x3255aa(0x1cc)),subscriptionRequiredModal=document[_0x3255aa(0x20c)](_0x3255aa(0x189));function _0x1ac5(_0x1c47c0,_0x14cad9){const _0x48dc40=_0x48dc();return _0x1ac5=function(_0x1ac50b,_0x3b2a8d){_0x1ac50b=_0x1ac50b-0x160;let _0x4e1178=_0x48dc40[_0x1ac50b];return _0x4e1178;},_0x1ac5(_0x1c47c0,_0x14cad9);}function showLoader(){const _0x276f4a=_0x3255aa;document[_0x276f4a(0x20c)](_0x276f4a(0x1ff))[_0x276f4a(0x171)][_0x276f4a(0x16b)]=_0x276f4a(0x161);}function hideLoader(){const _0x36c2f1=_0x3255aa;document[_0x36c2f1(0x20c)]('loaderWrapper')['style'][_0x36c2f1(0x16b)]='none';}function showPageLoader(){const _0x81fe4d=_0x3255aa;document[_0x81fe4d(0x20c)](_0x81fe4d(0x169))['style'][_0x81fe4d(0x16b)]='flex';}function hidePageLoader(){const _0x1a4d2a=_0x3255aa;document[_0x1a4d2a(0x20c)](_0x1a4d2a(0x169))[_0x1a4d2a(0x171)][_0x1a4d2a(0x16b)]='none';}function showSubscriptionRequiredModal(){const _0x6fd204=_0x3255aa;subscriptionRequiredModal['style'][_0x6fd204(0x16b)]=_0x6fd204(0x18e);}function hideSubscriptionRequiredModal(){const _0x17ff1e=_0x3255aa;subscriptionRequiredModal['style']['display']=_0x17ff1e(0x231);}function redirectToSubscription(){hideSubscriptionRequiredModal();}function checkSubscriptionStatus(){const _0x2ae9b8=_0x3255aa,_0x425821=sessionStorage[_0x2ae9b8(0x167)]('currentUserId');if(!_0x425821){console['error'](_0x2ae9b8(0x1f6));return;}const _0x2530d7=ref(db,_0x2ae9b8(0x1fc)+_0x425821+_0x2ae9b8(0x215));get(_0x2530d7)[_0x2ae9b8(0x210)](_0x4c79a1=>{const _0x55f89d=_0x2ae9b8,_0x5d91ba=_0x4c79a1[_0x55f89d(0x1c1)](),_0x1fe371=new Date();if(_0x5d91ba&&_0x5d91ba['status']==='active'){const _0x57fdb0=new Date(_0x5d91ba[_0x55f89d(0x199)]);_0x57fdb0<_0x1fe371?(subscriptionStatus[_0x55f89d(0x1ca)]=_0x55f89d(0x235),subscriptionStatus[_0x55f89d(0x171)][_0x55f89d(0x160)]='red',subscribeMonthlyButton[_0x55f89d(0x171)][_0x55f89d(0x16b)]=_0x55f89d(0x230),subscribeYearlyButton[_0x55f89d(0x171)]['display']=_0x55f89d(0x230),set(_0x2530d7,{..._0x5d91ba,'status':_0x55f89d(0x22b)})):(subscriptionStatus[_0x55f89d(0x1ca)]='Statut\x20de\x20l\x27abonnement:\x20Actif\x20jusqu\x27au\x20'+_0x57fdb0['toLocaleDateString'](),subscriptionStatus[_0x55f89d(0x171)]['color']=_0x55f89d(0x22c),subscribeMonthlyButton[_0x55f89d(0x171)]['display']=_0x55f89d(0x231),subscribeYearlyButton[_0x55f89d(0x171)][_0x55f89d(0x16b)]='none');}else subscriptionStatus[_0x55f89d(0x1ca)]=_0x55f89d(0x16e),subscriptionStatus['style']['color']=_0x55f89d(0x184),subscribeMonthlyButton['style'][_0x55f89d(0x16b)]=_0x55f89d(0x230),subscribeYearlyButton['style'][_0x55f89d(0x16b)]=_0x55f89d(0x230);})[_0x2ae9b8(0x166)](_0x21febf=>{const _0x5179c4=_0x2ae9b8;console[_0x5179c4(0x1ac)](_0x5179c4(0x1a2),_0x21febf);});}function checkUserAccess(){const _0x400307=_0x3255aa;get(adminRef)[_0x400307(0x210)](_0x5af7ef=>{const _0x461f62=_0x400307,_0x40627c=_0x5af7ef['val']();(!_0x40627c||_0x40627c[_0x461f62(0x1a4)]!==_0x461f62(0x19f))&&showSubscriptionRequiredModal();});}venteMenuItem[_0x3255aa(0x1a7)](_0x3255aa(0x1fe),_0x4caea3=>{const _0x1e460e=_0x3255aa;_0x4caea3[_0x1e460e(0x1f4)](),checkUserAccess(),window[_0x1e460e(0x233)][_0x1e460e(0x1c0)]=_0x1e460e(0x1bb);}),inventaireMenuItem['addEventListener']('click',_0x4f4bdf=>{const _0xf658eb=_0x3255aa;_0x4f4bdf[_0xf658eb(0x1f4)](),checkUserAccess(),window[_0xf658eb(0x233)][_0xf658eb(0x1c0)]='AdminVentePartenaires.html';}),stockMenuItem[_0x3255aa(0x1a7)](_0x3255aa(0x1fe),_0x16f100=>{const _0x174d6d=_0x3255aa;_0x16f100[_0x174d6d(0x1f4)](),checkUserAccess(),window[_0x174d6d(0x233)][_0x174d6d(0x1c0)]='Stock.html';}),administrationMenuItem[_0x3255aa(0x1a7)](_0x3255aa(0x1fe),_0x5bd5c5=>{const _0x8b6231=_0x3255aa;_0x5bd5c5[_0x8b6231(0x1f4)](),checkUserAccess(),window['location'][_0x8b6231(0x1c0)]=_0x8b6231(0x16a);}),subscribeMonthlyButton['addEventListener'](_0x3255aa(0x1fe),()=>{initiatePayment('monthly');}),subscribeYearlyButton[_0x3255aa(0x1a7)](_0x3255aa(0x1fe),()=>{const _0x1ab8ff=_0x3255aa;initiatePayment(_0x1ab8ff(0x1ee));});function initiatePayment(_0x75dd93){const _0x113382=_0x3255aa,_0x48818d=_0x75dd93===_0x113382(0x18d)?0x3e8:0x2710,_0x1c9023=_0x75dd93===_0x113382(0x18d)?'Abonnement\x20mensuel':_0x113382(0x1db),_0x5895d9=sessionStorage[_0x113382(0x167)](_0x113382(0x224));if(!_0x5895d9){console[_0x113382(0x1ac)]('User\x20ID\x20not\x20found.\x20Cannot\x20initiate\x20payment.'),alert(_0x113382(0x212));return;}FedaPay[_0x113382(0x1b0)]({'public_key':'pk_live_TfSz212W0xSMKK7oPEogkFmp','transaction':{'amount':_0x48818d,'description':_0x1c9023},'customer':{'email':'admin@example.com'},'onComplete':async function(_0x16a091){const _0x2b2d66=_0x113382;if(_0x16a091[_0x2b2d66(0x193)]===FedaPay['DIALOG_DISMISSED'])alert(_0x2b2d66(0x1b8));else _0x16a091[_0x2b2d66(0x193)]===FedaPay['CHECKOUT_COMPLETED']&&handleSuccessfulPayment(_0x75dd93,_0x16a091,_0x5895d9);}})['open']();}async function handleSuccessfulPayment(_0x1d11fa,_0x15a602,_0x39f234){const _0x328b74=_0x3255aa,_0x419b8e=new Date(),_0x49b2b5=new Date(_0x419b8e);_0x1d11fa===_0x328b74(0x18d)?_0x49b2b5[_0x328b74(0x1bc)](_0x49b2b5[_0x328b74(0x16f)]()+0x1):_0x49b2b5[_0x328b74(0x217)](_0x49b2b5[_0x328b74(0x1e6)]()+0x1);const _0x3cdf3b={'status':_0x328b74(0x19f),'startDate':_0x419b8e['toISOString'](),'endDate':_0x49b2b5[_0x328b74(0x19d)](),'transactionId':_0x15a602[_0x328b74(0x19c)]['id'],'plan':_0x1d11fa};try{const _0x45620a=ref(db,_0x328b74(0x1fc)+_0x39f234+'/admin/subscription');await set(_0x45620a,_0x3cdf3b),checkSubscriptionStatus(),alert(_0x328b74(0x1b2)+(_0x1d11fa===_0x328b74(0x18d)?'mensuel':_0x328b74(0x211))+_0x328b74(0x195));}catch(_0x3d3a1c){console['error'](_0x328b74(0x1df),_0x3d3a1c),alert(_0x328b74(0x1aa));}}async function cancelSubscription(){const _0x38d31f=_0x3255aa,_0xae0920=sessionStorage[_0x38d31f(0x167)]('currentUserId');if(!_0xae0920){console['error'](_0x38d31f(0x1c3)),alert(_0x38d31f(0x1e1));return;}try{const _0xd64d37=ref(db,_0x38d31f(0x1fc)+_0xae0920+_0x38d31f(0x215));await set(_0xd64d37,{...(await get(_0xd64d37))['val'](),'status':'cancelled'}),checkSubscriptionStatus(),alert(_0x38d31f(0x1e7));}catch(_0x2edf13){console[_0x38d31f(0x1ac)]('Erreur\x20lors\x20de\x20l\x27annulation\x20de\x20l\x27abonnement:',_0x2edf13),alert(_0x38d31f(0x1a6));}}async function processConnectedTickets(){const _0x5d5d38=_0x3255aa,_0x260d33=document[_0x5d5d38(0x20c)]('pageLoaderMessage'),_0x11a4dd=sessionStorage[_0x5d5d38(0x167)](_0x5d5d38(0x224));if(!_0x11a4dd){console[_0x5d5d38(0x1ac)](_0x5d5d38(0x1a8));return;}try{_0x260d33['textContent']='Vérification\x20des\x20tickets\x20connectés...';const _0x3f733e=await get(connectedTicketsRef);let _0x325dcb=_0x3f733e[_0x5d5d38(0x1c1)]()||{};const _0x1d8484={};for(const _0x3ff5b9 in _0x325dcb){const _0x288451=_0x325dcb[_0x3ff5b9][_0x5d5d38(0x1ab)];!_0x1d8484[_0x288451]&&(_0x1d8484[_0x288451]=_0x325dcb[_0x3ff5b9]);}_0x260d33[_0x5d5d38(0x1ca)]=_0x5d5d38(0x1d6);for(const _0x2d0c4a in _0x1d8484){await processTicket(_0x1d8484[_0x2d0c4a],_0x11a4dd);}_0x260d33[_0x5d5d38(0x1ca)]=_0x5d5d38(0x1c7),await remove(connectedTicketsRef);}catch(_0x3482a9){console[_0x5d5d38(0x1ac)](_0x5d5d38(0x17b),_0x3482a9),showNotification('Erreur',_0x5d5d38(0x232));}}async function processTicket(_0x3873fc,_0x217733){const _0x5a5c9b=_0x3255aa,_0x2cda39=document[_0x5a5c9b(0x20c)](_0x5a5c9b(0x1f7));if(!_0x217733){console[_0x5a5c9b(0x1ac)](_0x5a5c9b(0x1f8));return;}try{_0x2cda39[_0x5a5c9b(0x1ca)]='Vérification\x20du\x20ticket\x20pour\x20'+_0x3873fc[_0x5a5c9b(0x1ab)]+_0x5a5c9b(0x1b5);const _0x520a9b=ref(db,_0x5a5c9b(0x1fc)+_0x217733+_0x5a5c9b(0x183)),_0x18376d=await get(_0x520a9b),_0xa6134e=_0x18376d[_0x5a5c9b(0x1c1)]()||{};let _0x58852d=![];for(const _0x545286 in _0xa6134e){const _0x28d16f=_0xa6134e[_0x545286];for(const _0x460cd6 in _0x28d16f){if(_0x28d16f[_0x460cd6][_0x5a5c9b(0x1fd)]===_0x3873fc[_0x5a5c9b(0x1ab)]){_0x58852d=!![];break;}}if(_0x58852d)break;}if(!_0x58852d){_0x2cda39[_0x5a5c9b(0x1ca)]='Traitement\x20du\x20ticket\x20'+_0x3873fc[_0x5a5c9b(0x1ab)]+_0x5a5c9b(0x1b5);const _0x3cad5b=ref(db,'users-data/'+_0x217733+_0x5a5c9b(0x162)),_0x1e6ae3=ref(db,'users-data/'+_0x217733+'/TicketsTransit'),_0x5ce3c6=await get(_0x3cad5b),_0x242961=await get(_0x1e6ae3),_0x59f49e=_0x5ce3c6['val']()||{},_0x559dbc=_0x242961[_0x5a5c9b(0x1c1)]()||{};let _0x2f1575=null,_0x419cbf=null,_0x1df2c8=null;for(const _0x134459 in _0x59f49e){const _0xb73c8d=(_0x59f49e[_0x134459]['utilisateur']||[])[_0x5a5c9b(0x172)](_0x3873fc[_0x5a5c9b(0x1ab)]);if(_0xb73c8d>-0x1){_0x2f1575={'category':_0x134459,'user':_0x59f49e[_0x134459]['utilisateur'][_0xb73c8d],'password':_0x59f49e[_0x134459][_0x5a5c9b(0x22f)][_0xb73c8d],'price':_0x59f49e[_0x134459]['prix'][_0xb73c8d],'updatedData':{..._0x59f49e[_0x134459],'utilisateur':_0x59f49e[_0x134459][_0x5a5c9b(0x1f5)]['filter']((_0x18adf9,_0x132455)=>_0x132455!==_0xb73c8d),'motDePasse':_0x59f49e[_0x134459][_0x5a5c9b(0x22f)][_0x5a5c9b(0x1a3)]((_0x2d6919,_0x22b069)=>_0x22b069!==_0xb73c8d),'prix':_0x59f49e[_0x134459][_0x5a5c9b(0x1ba)][_0x5a5c9b(0x1a3)]((_0x985de2,_0x581cf0)=>_0x581cf0!==_0xb73c8d)}},_0x419cbf=ref(db,_0x5a5c9b(0x1fc)+_0x217733+_0x5a5c9b(0x229)+_0x134459),_0x1df2c8=_0x5a5c9b(0x1d5);break;}}if(!_0x2f1575)for(const _0x1ac557 in _0x559dbc){if(_0x559dbc[_0x1ac557][_0x5a5c9b(0x1fd)]===_0x3873fc[_0x5a5c9b(0x1ab)]){_0x2f1575={'category':_0x559dbc[_0x1ac557]['category'],'user':_0x559dbc[_0x1ac557][_0x5a5c9b(0x1fd)],'password':_0x559dbc[_0x1ac557][_0x5a5c9b(0x176)],'price':_0x559dbc[_0x1ac557]['price']},_0x419cbf=ref(db,_0x5a5c9b(0x1fc)+_0x217733+_0x5a5c9b(0x200)+_0x1ac557),_0x1df2c8=_0x5a5c9b(0x19e);break;}}_0x2f1575&&(_0x2cda39['textContent']=_0x5a5c9b(0x1c5)+_0x3873fc[_0x5a5c9b(0x1ab)]+'...',await sellTicketAutomatically(_0x2f1575,_0x419cbf,_0x1df2c8,_0x217733));}}catch(_0x6159c4){console[_0x5a5c9b(0x1ac)]('Erreur\x20lors\x20du\x20traitement\x20du\x20ticket\x20:',_0x6159c4),showNotification(_0x5a5c9b(0x1f0),_0x5a5c9b(0x1ea)+_0x3873fc[_0x5a5c9b(0x1ab)]+'.');}}async function sellTicketAutomatically(_0x55b9cd,_0x5aa939,_0x3b8147,_0x102f9b){const _0x373958=_0x3255aa;if(!_0x102f9b){console['error'](_0x373958(0x203));return;}try{const _0x3d64c5=_0x373958(0x1d8),_0x4e0de5=ref(db,_0x373958(0x1fc)+_0x102f9b+_0x373958(0x1c2));await push(_0x4e0de5,{'category':_0x55b9cd[_0x373958(0x220)],'user':_0x55b9cd['user'],'password':_0x55b9cd[_0x373958(0x176)],'price':_0x55b9cd[_0x373958(0x1bd)],'soldAt':Date[_0x373958(0x20d)](),'vendorId':_0x3d64c5}),_0x3b8147===_0x373958(0x1d5)?await set(_0x5aa939,_0x55b9cd['updatedData']):await remove(_0x5aa939),console[_0x373958(0x173)](_0x373958(0x1cb)+_0x55b9cd[_0x373958(0x1fd)]+_0x373958(0x1ed));}catch(_0x2a2c4d){console[_0x373958(0x1ac)](_0x373958(0x1e8),_0x2a2c4d),showNotification(_0x373958(0x1f0),'Erreur\x20lors\x20de\x20la\x20vente\x20automatique\x20du\x20ticket.');}}window[_0x3255aa(0x204)]=function(){const _0x3995d2=_0x3255aa;sessionStorage[_0x3995d2(0x1ce)](),window[_0x3995d2(0x233)]['replace'](_0x3995d2(0x221));},window[_0x3255aa(0x209)]=function(){const _0x5457c1=_0x3255aa,_0x4c00cf=document[_0x5457c1(0x20c)](_0x5457c1(0x1dc)),_0x17c818=document[_0x5457c1(0x20c)](_0x5457c1(0x21c)),_0x2b496c=document['getElementById'](_0x5457c1(0x219));_0x4c00cf[_0x5457c1(0x171)]['display']==='none'||_0x4c00cf[_0x5457c1(0x171)][_0x5457c1(0x16b)]===''?(_0x4c00cf['style'][_0x5457c1(0x16b)]=_0x5457c1(0x18e),_0x2b496c[_0x5457c1(0x171)][_0x5457c1(0x16b)]=_0x5457c1(0x230),_0x17c818[_0x5457c1(0x1ca)]='Masquer\x20le\x20formulaire'):(_0x4c00cf[_0x5457c1(0x171)]['display']=_0x5457c1(0x231),_0x2b496c['style'][_0x5457c1(0x16b)]=_0x5457c1(0x231),_0x17c818[_0x5457c1(0x1ca)]='Configurer\x20le\x20portail\x20captif');},window[_0x3255aa(0x194)]=function(_0x157df5){const _0xa0cb13=_0x3255aa,_0x391064=document[_0xa0cb13(0x20c)](_0x157df5),_0x2f0476=document[_0xa0cb13(0x1de)]('div');_0x2f0476[_0xa0cb13(0x1e5)]=_0xa0cb13(0x1f3);let _0xf41c55=_0xa0cb13(0x19b);if(_0x157df5==='tariffsList')_0x2f0476[_0xa0cb13(0x192)]=_0xa0cb13(0x1d1);else{let _0x9ceb74='';if(_0x157df5==='connectionsList')_0x9ceb74=_0xa0cb13(0x185);else _0x157df5===_0xa0cb13(0x205)&&(_0x9ceb74=_0xa0cb13(0x1e9));_0x2f0476[_0xa0cb13(0x192)]=_0xa0cb13(0x234)+_0xf41c55+'\x22\x20placeholder=\x22'+_0x9ceb74+_0xa0cb13(0x22d)+_0x157df5[_0xa0cb13(0x182)](0x0,-0x4)+_0xa0cb13(0x218);}_0x391064[_0xa0cb13(0x198)](_0x2f0476);},window[_0x3255aa(0x1a1)]=function(_0x59868c){const _0x4b8b24=_0x3255aa;_0x59868c[_0x4b8b24(0x188)][_0x4b8b24(0x164)]();},document[_0x3255aa(0x20c)](_0x3255aa(0x1dc))[_0x3255aa(0x1a7)](_0x3255aa(0x1b1),async _0x4b47af=>{const _0x154586=_0x3255aa;_0x4b47af[_0x154586(0x1f4)](),showLoader();const _0x29ba00=sessionStorage[_0x154586(0x167)]('currentUserId');if(!_0x29ba00){console[_0x154586(0x1ac)](_0x154586(0x1c4)),alert(_0x154586(0x1e0)),hideLoader();return;}const _0x364729={'networkName':document[_0x154586(0x20c)]('networkName')[_0x154586(0x22a)],'contactNumber':document[_0x154586(0x20c)]('contactNumber')['value'],'fedapayApiKey':document['getElementById'](_0x154586(0x17f))['value'],'loginMode':document[_0x154586(0x20c)](_0x154586(0x1af))[_0x154586(0x22a)],'tariffs':[],'connections':[],'products':[]};document[_0x154586(0x206)]('#tariffsList\x20.list-item')[_0x154586(0x1cf)](_0x5f2e05=>{const _0xf4334d=_0x154586,_0x29f8d5=_0x5f2e05[_0xf4334d(0x18f)]('[data-type=\x22tariffName\x22]'),_0x4729d0=_0x5f2e05[_0xf4334d(0x18f)]('[data-type=\x22tariffPrice\x22]');if(_0x29f8d5&&_0x4729d0){const _0x3f8d54=_0x29f8d5[_0xf4334d(0x22a)][_0xf4334d(0x1a5)](),_0x424aa0=parseFloat(_0x4729d0[_0xf4334d(0x22a)]);_0x3f8d54&&!isNaN(_0x424aa0)&&_0x364729[_0xf4334d(0x1c8)][_0xf4334d(0x1e3)]({'name':_0x3f8d54,'price':_0x424aa0});}}),document[_0x154586(0x206)](_0x154586(0x228))['forEach'](_0x3db9d0=>{const _0x307d3a=_0x154586,_0x143de5=_0x3db9d0[_0x307d3a(0x22a)][_0x307d3a(0x1a5)]();_0x143de5&&_0x364729['connections'][_0x307d3a(0x1e3)](_0x143de5);}),document[_0x154586(0x206)](_0x154586(0x1ad))[_0x154586(0x1cf)](_0x3b96bc=>{const _0x17bc83=_0x154586,_0x4d397b=_0x3b96bc['value'][_0x17bc83(0x1a5)]();_0x4d397b&&_0x364729['products'][_0x17bc83(0x1e3)](_0x4d397b);});try{const _0x1da571=ref(db,_0x154586(0x1fc)+_0x29ba00+'/portalConfig');await set(_0x1da571,_0x364729),alert(_0x154586(0x170)),hideLoader(),document[_0x154586(0x20c)](_0x154586(0x1dc))[_0x154586(0x1a0)](),document['getElementById']('portalForm')[_0x154586(0x171)]['display']=_0x154586(0x231),document[_0x154586(0x20c)](_0x154586(0x21c))[_0x154586(0x1ca)]='Configurer\x20le\x20portail\x20captif',document['getElementById']('downloadLoginBtn')[_0x154586(0x171)]['display']=_0x154586(0x231),document[_0x154586(0x20c)](_0x154586(0x187))[_0x154586(0x1ca)]=_0x364729[_0x154586(0x1f1)];}catch(_0x29a339){console[_0x154586(0x1ac)](_0x154586(0x1f2),_0x29a339),alert(_0x154586(0x1be)),hideLoader();}});async function downloadLoginFile(){const _0x2994c2=_0x3255aa;showLoader();const _0x510ad0=sessionStorage[_0x2994c2(0x167)](_0x2994c2(0x224));if(!_0x510ad0){console[_0x2994c2(0x1ac)](_0x2994c2(0x16d)),hideLoader(),alert(_0x2994c2(0x208));return;}try{const _0x36fb0f=ref(db,'users-data/'+_0x510ad0+_0x2994c2(0x1b9)),_0x196f0c=await get(_0x36fb0f);if(!_0x196f0c['exists']()){alert(_0x2994c2(0x1e2)),hideLoader();return;}const _0x34bed1=_0x196f0c[_0x2994c2(0x1c1)]();let _0x5e6d9f='',_0x1cc20a='';if(_0x34bed1[_0x2994c2(0x1af)]===_0x2994c2(0x178)){const _0x103a02=await fetch(_0x2994c2(0x21e));_0x5e6d9f=await _0x103a02[_0x2994c2(0x19b)](),_0x1cc20a='login.html';}else{if(_0x34bed1[_0x2994c2(0x1af)]===_0x2994c2(0x1b6)){const _0x4382e9=await fetch('log.html');_0x5e6d9f=await _0x4382e9[_0x2994c2(0x19b)](),_0x1cc20a=_0x2994c2(0x1c6);}else{if(_0x34bed1['loginMode']==='pay'){const _0x267b1f=await fetch(_0x2994c2(0x179));_0x5e6d9f=await _0x267b1f[_0x2994c2(0x19b)](),_0x1cc20a=_0x2994c2(0x179);}else{alert(_0x2994c2(0x1e4)),hideLoader();return;}}}_0x5e6d9f=_0x5e6d9f[_0x2994c2(0x175)]('<!--\x20ADMIN_USER_ID\x20-->',_0x510ad0);function _0x4b4aeb(_0x253f76){const _0x50cd79=_0x2994c2;let _0x5606b9=_0x50cd79(0x20a);return _0x253f76[_0x50cd79(0x1cf)](_0x7f6740=>{const _0x252229=_0x50cd79;_0x5606b9+=_0x252229(0x17e)+_0x7f6740['name']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>'+_0x7f6740['price']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22><button\x20onclick=\x22initPayment(\x27'+_0x7f6740[_0x252229(0x1d3)]+'\x27,\x20'+_0x7f6740[_0x252229(0x1bd)]+_0x252229(0x21b);}),_0x5606b9+=_0x50cd79(0x226),_0x5606b9;}function _0x5c03d3(_0x39c6c5){const _0x452f3b=_0x2994c2;let _0xbd9cce=_0x452f3b(0x202);return _0x39c6c5[_0x452f3b(0x1cf)](_0x46e77c=>{const _0x1aafaa=_0x452f3b;_0xbd9cce+='<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:\x208px;\x20border-bottom:\x201px\x20solid\x20#ddd;\x22>'+_0x46e77c[_0x1aafaa(0x1d3)]+_0x1aafaa(0x225)+_0x46e77c[_0x1aafaa(0x1bd)]+_0x1aafaa(0x1eb);}),_0xbd9cce+=_0x452f3b(0x1d2),_0xbd9cce;}function _0x246773(_0x3e10c7){const _0x1922c4=_0x2994c2;let _0x4ce424=_0x1922c4(0x1fa);return _0x3e10c7[_0x1922c4(0x1cf)](_0x40c18c=>{const _0x43cfac=_0x1922c4;_0x4ce424+='<li>'+_0x40c18c+_0x43cfac(0x1ec);}),_0x4ce424+=_0x1922c4(0x20b),_0x4ce424;}_0x5e6d9f=_0x5e6d9f[_0x2994c2(0x175)](_0x2994c2(0x1f9),_0x4b4aeb(_0x34bed1['tariffs']||[])),_0x5e6d9f=_0x5e6d9f[_0x2994c2(0x175)](_0x2994c2(0x223),_0x5c03d3(_0x34bed1[_0x2994c2(0x1c8)]||[])),_0x5e6d9f=_0x5e6d9f['replace'](_0x2994c2(0x177),_0x246773(_0x34bed1[_0x2994c2(0x18c)]||[])),_0x5e6d9f=_0x5e6d9f[_0x2994c2(0x175)]('<!--\x20PRODUCTS_LIST\x20-->',_0x246773(_0x34bed1[_0x2994c2(0x174)]||[])),_0x5e6d9f=_0x5e6d9f[_0x2994c2(0x175)](_0x2994c2(0x20e),_0x34bed1[_0x2994c2(0x1cd)]||_0x2994c2(0x1b7)),_0x5e6d9f=_0x5e6d9f[_0x2994c2(0x175)](_0x2994c2(0x1c9),_0x34bed1[_0x2994c2(0x1f1)]||_0x2994c2(0x20f)),_0x5e6d9f=_0x5e6d9f[_0x2994c2(0x175)](_0x2994c2(0x1da),_0x34bed1[_0x2994c2(0x17f)]||'');const _0x7aecd9=new Blob([_0x5e6d9f],{'type':'text/html'}),_0x37e135=URL[_0x2994c2(0x186)](_0x7aecd9),_0xecd38=document[_0x2994c2(0x1de)]('a');_0xecd38[_0x2994c2(0x1c0)]=_0x37e135,_0xecd38[_0x2994c2(0x19a)]=_0x1cc20a,document['body'][_0x2994c2(0x198)](_0xecd38),_0xecd38[_0x2994c2(0x1fe)](),document[_0x2994c2(0x1d4)][_0x2994c2(0x18a)](_0xecd38),URL[_0x2994c2(0x1dd)](_0x37e135),hideLoader();}catch(_0x1ba6b2){console[_0x2994c2(0x1ac)]('Erreur\x20lors\x20du\x20téléchargement\x20du\x20portail\x20captif:',_0x1ba6b2),alert(_0x2994c2(0x1b3)),hideLoader();}}window['downloadLoginFile']=downloadLoginFile;async function loadPortalConfig(){const _0x4bbb0b=_0x3255aa;showLoader();const _0x458e0c=sessionStorage[_0x4bbb0b(0x167)](_0x4bbb0b(0x224));if(!_0x458e0c){console[_0x4bbb0b(0x1ac)]('User\x20ID\x20not\x20found.\x20Cannot\x20load\x20portal\x20configuration.'),hideLoader();return;}try{const _0x4db1a5=ref(db,'users-data/'+_0x458e0c+_0x4bbb0b(0x1b9)),_0x304950=await get(_0x4db1a5);if(_0x304950[_0x4bbb0b(0x1d0)]()){const _0x39c469=_0x304950[_0x4bbb0b(0x1c1)]();document['getElementById'](_0x4bbb0b(0x1f1))['value']=_0x39c469[_0x4bbb0b(0x1f1)]||'',document['getElementById'](_0x4bbb0b(0x1cd))[_0x4bbb0b(0x22a)]=_0x39c469[_0x4bbb0b(0x1cd)]||'',document[_0x4bbb0b(0x20c)](_0x4bbb0b(0x17f))[_0x4bbb0b(0x22a)]=_0x39c469['fedapayApiKey']||'',document['getElementById'](_0x4bbb0b(0x1af))[_0x4bbb0b(0x22a)]=_0x39c469[_0x4bbb0b(0x1af)]||_0x4bbb0b(0x178),document['getElementById']('networkNameDisplay')[_0x4bbb0b(0x1ca)]=_0x39c469[_0x4bbb0b(0x1f1)]||_0x4bbb0b(0x181);function _0x5a2b84(_0x2d8053,_0xf530f,_0x1aa2e7){const _0x46e15b=_0x4bbb0b,_0x262174=document[_0x46e15b(0x20c)](_0x2d8053);_0x262174['innerHTML']='',_0xf530f[_0x46e15b(0x1cf)](_0x1754e7=>{const _0x38a78d=_0x46e15b,_0x36bca7=document[_0x38a78d(0x1de)](_0x38a78d(0x17d));_0x36bca7[_0x38a78d(0x1e5)]=_0x38a78d(0x1f3),_0x2d8053==='tariffsList'?_0x36bca7['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20value=\x22'+_0x1754e7[_0x38a78d(0x1d3)]+_0x38a78d(0x17c)+_0x1754e7[_0x38a78d(0x1bd)]+'\x22\x20data-type=\x22tariffPrice\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20onclick=\x22removeListItem(this)\x22>Supprimer</button>':_0x36bca7['innerHTML']=_0x38a78d(0x197)+_0x1754e7+_0x38a78d(0x22d)+_0x1aa2e7+_0x38a78d(0x17a),_0x262174[_0x38a78d(0x198)](_0x36bca7);}),addListItem(_0x2d8053);}_0x5a2b84(_0x4bbb0b(0x1d7),_0x39c469[_0x4bbb0b(0x1c8)]||[],null),_0x5a2b84(_0x4bbb0b(0x196),_0x39c469['connections']||[],_0x4bbb0b(0x227)),_0x5a2b84(_0x4bbb0b(0x205),_0x39c469['products']||[],_0x4bbb0b(0x22e));}else console[_0x4bbb0b(0x173)](_0x4bbb0b(0x216)),addListItem('tariffsList'),addListItem(_0x4bbb0b(0x196)),addListItem(_0x4bbb0b(0x205));}catch(_0x494444){console[_0x4bbb0b(0x1ac)](_0x4bbb0b(0x222),_0x494444),alert(_0x4bbb0b(0x236));}finally{hideLoader();}}document[_0x3255aa(0x1a7)](_0x3255aa(0x214),async()=>{const _0x3051a2=_0x3255aa;showPageLoader(),await initializeDatabase(),await checkLoginStatus(),loadPortalConfig(),processConnectedTickets()[_0x3051a2(0x210)](()=>checkSubscriptionStatus())[_0x3051a2(0x210)](()=>{hidePageLoader();})[_0x3051a2(0x166)](_0x3aa060=>{const _0x12acbf=_0x3051a2;console[_0x12acbf(0x1ac)](_0x12acbf(0x201),_0x3aa060),hidePageLoader(),showNotification(_0x12acbf(0x1f0),_0x12acbf(0x213));});}),window['redirectToSubscription']=redirectToSubscription,window[_0x3255aa(0x1fb)]=redirectToSubscription;function closePaymentModal(){const _0x3c02fa=_0x3255aa;paymentModal['style']['display']=_0x3c02fa(0x231),overlay[_0x3c02fa(0x171)][_0x3c02fa(0x16b)]=_0x3c02fa(0x231);}window[_0x3255aa(0x21f)]=()=>{};
    </script>

</body>
</html>