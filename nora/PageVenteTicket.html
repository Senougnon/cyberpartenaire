<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i data-lucide="share-2"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i data-lucide="file-text"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i data-lucide="history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i data-lucide="printer"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i data-lucide="file-down"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x311da6=_0xb799;(function(_0x215206,_0x43540a){const _0x2eec21=_0xb799,_0x7b17e=_0x215206();while(!![]){try{const _0x5d9a36=-parseInt(_0x2eec21(0x163))/0x1*(-parseInt(_0x2eec21(0x1d2))/0x2)+-parseInt(_0x2eec21(0x1a6))/0x3*(parseInt(_0x2eec21(0x21b))/0x4)+parseInt(_0x2eec21(0x17b))/0x5+parseInt(_0x2eec21(0x219))/0x6*(parseInt(_0x2eec21(0x175))/0x7)+parseInt(_0x2eec21(0x19f))/0x8+parseInt(_0x2eec21(0x1e9))/0x9*(-parseInt(_0x2eec21(0x1f7))/0xa)+parseInt(_0x2eec21(0x19b))/0xb;if(_0x5d9a36===_0x43540a)break;else _0x7b17e['push'](_0x7b17e['shift']());}catch(_0x4f2d03){_0x7b17e['push'](_0x7b17e['shift']());}}}(_0x18a1,0xae280));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':_0x311da6(0x1c4),'authDomain':_0x311da6(0x22b),'databaseURL':_0x311da6(0x1bd),'projectId':'nora-wifi-zone','storageBucket':'nora-wifi-zone.firebasestorage.app','messagingSenderId':_0x311da6(0x226),'appId':_0x311da6(0x15c),'measurementId':_0x311da6(0x1ba)},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x311da6(0x1f0));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window['jsPDF']=window[_0x311da6(0x167)][_0x311da6(0x1ad)];async function fetchVendors(){const _0xa542b2=_0x311da6;try{const _0x3f3a05=ref(db,_0xa542b2(0x205)),_0x37c6ed=await get(_0x3f3a05);_0x37c6ed[_0xa542b2(0x221)]()?(vendors=_0x37c6ed[_0xa542b2(0x16a)](),availableUsernames=Object[_0xa542b2(0x16c)](vendors)):console[_0xa542b2(0x1b4)](_0xa542b2(0x1d0));}catch(_0x391a6b){console['error'](_0xa542b2(0x18c),_0x391a6b);}}const usernameInput=document[_0x311da6(0x1c7)](_0x311da6(0x1bc)),passwordInput=document['getElementById'](_0x311da6(0x1ed)),suggestionsList=document[_0x311da6(0x1c7)](_0x311da6(0x17d));function _0xb799(_0x4a8040,_0x22c04f){const _0x18a1f7=_0x18a1();return _0xb799=function(_0xb7998e,_0x4e61af){_0xb7998e=_0xb7998e-0x15c;let _0x124590=_0x18a1f7[_0xb7998e];return _0x124590;},_0xb799(_0x4a8040,_0x22c04f);}usernameInput['addEventListener']('input',()=>{const _0x54efb5=_0x311da6,_0x3a976d=usernameInput[_0x54efb5(0x19e)][_0x54efb5(0x211)](),_0xed5de1=availableUsernames[_0x54efb5(0x1ec)](_0x4f0a3b=>_0x4f0a3b[_0x54efb5(0x211)]()['startsWith'](_0x3a976d));suggestionsList[_0x54efb5(0x17a)]='';if(_0x3a976d[_0x54efb5(0x191)]===0x0||_0xed5de1['length']===0x0){suggestionsList[_0x54efb5(0x1b1)][_0x54efb5(0x1a1)]=_0x54efb5(0x193);return;}_0xed5de1[_0x54efb5(0x1e2)](_0x264b2b=>{const _0x5d96e6=_0x54efb5,_0x8f41a8=document[_0x5d96e6(0x214)]('li');_0x8f41a8[_0x5d96e6(0x1eb)]=_0x264b2b,_0x8f41a8[_0x5d96e6(0x1d4)](_0x5d96e6(0x22c),()=>{const _0x3fa90e=_0x5d96e6;usernameInput['value']=_0x264b2b,suggestionsList[_0x3fa90e(0x17a)]='',suggestionsList['style'][_0x3fa90e(0x1a1)]=_0x3fa90e(0x193);}),suggestionsList[_0x5d96e6(0x220)](_0x8f41a8);}),suggestionsList[_0x54efb5(0x1b1)][_0x54efb5(0x1a1)]=_0x54efb5(0x1a5);}),document[_0x311da6(0x1d4)]('click',_0x161fff=>{const _0x54eb11=_0x311da6;!usernameInput[_0x54eb11(0x1d1)](_0x161fff['target'])&&!suggestionsList[_0x54eb11(0x1d1)](_0x161fff[_0x54eb11(0x15f)])&&(suggestionsList['style'][_0x54eb11(0x1a1)]=_0x54eb11(0x193));});const rememberMeCheckbox=document['getElementById']('rememberMe'),storedUsername=localStorage['getItem'](_0x311da6(0x1bc)),storedPassword=localStorage[_0x311da6(0x203)](_0x311da6(0x1ed)),storedTimestamp=localStorage[_0x311da6(0x203)](_0x311da6(0x15d)),now=Date[_0x311da6(0x213)](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0x311da6(0x19e)]=storedUsername,passwordInput[_0x311da6(0x19e)]=storedPassword,rememberMeCheckbox[_0x311da6(0x194)]=!![]);const loginForm=document[_0x311da6(0x1c7)](_0x311da6(0x178)),loginError=document['getElementById'](_0x311da6(0x1da)),ratesSection=document['querySelector'](_0x311da6(0x1c6)),historySection=document[_0x311da6(0x1c7)](_0x311da6(0x197)),loginSection=document['getElementById'](_0x311da6(0x181)),messagesSection=document['getElementById']('messagesSection');loginForm['addEventListener'](_0x311da6(0x1c5),async _0xb9bffd=>{const _0x302a46=_0x311da6;_0xb9bffd[_0x302a46(0x1f1)](),showLoader();const _0x56f339=usernameInput['value'],_0x2baaa1=passwordInput[_0x302a46(0x19e)];vendors[_0x56f339]&&vendors[_0x56f339][_0x302a46(0x1ed)]===_0x2baaa1?(loginError[_0x302a46(0x1b1)][_0x302a46(0x1a1)]=_0x302a46(0x193),ratesSection[_0x302a46(0x1b1)][_0x302a46(0x1a1)]='block',historySection[_0x302a46(0x1b1)][_0x302a46(0x1a1)]=_0x302a46(0x193),loginSection[_0x302a46(0x1b1)]['display']=_0x302a46(0x193),messagesSection[_0x302a46(0x1b1)][_0x302a46(0x1a1)]=_0x302a46(0x1a5),currentVendorId=_0x56f339,rememberMeCheckbox[_0x302a46(0x194)]?(localStorage['setItem'](_0x302a46(0x1bc),_0x56f339),localStorage[_0x302a46(0x1b0)](_0x302a46(0x1ed),_0x2baaa1),localStorage[_0x302a46(0x1b0)](_0x302a46(0x15d),Date[_0x302a46(0x213)]())):(localStorage[_0x302a46(0x190)]('username'),localStorage[_0x302a46(0x190)](_0x302a46(0x1ed)),localStorage[_0x302a46(0x190)]('usernameTimestamp')),await syncTickets(),loadHistory(),listenForNewMessages(),lucide[_0x302a46(0x186)](),hideLoader()):(loginError['style']['display']=_0x302a46(0x1a5),loginError[_0x302a46(0x1eb)]='Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.',hideLoader());});async function syncTickets(){const _0x1f7873=_0x311da6;try{const _0x266c89=document[_0x1f7873(0x201)](_0x1f7873(0x207)),_0x25c34a=document[_0x1f7873(0x201)](_0x1f7873(0x218));_0x266c89[_0x1f7873(0x1b1)][_0x1f7873(0x1a1)]=_0x1f7873(0x1a5),_0x25c34a[_0x1f7873(0x1b1)]['display']=_0x1f7873(0x193);const _0x3fc625=ref(db,_0x1f7873(0x1f3)),_0x224872=await get(_0x3fc625);_0x224872[_0x1f7873(0x221)]()?(localTickets=_0x224872[_0x1f7873(0x16a)](),createTicketTable(),_0x266c89[_0x1f7873(0x1b1)][_0x1f7873(0x1a1)]=_0x1f7873(0x193),_0x25c34a[_0x1f7873(0x1b1)]['display']=_0x1f7873(0x1b5)):_0x266c89['textContent']=_0x1f7873(0x21d);}catch(_0x3b3d9c){console['error'](_0x1f7873(0x225),_0x3b3d9c),loadingMessage[_0x1f7873(0x1eb)]='Erreur\x20de\x20synchronisation\x20des\x20tickets.';}}async function createTicketTable(){const _0x58734d=_0x311da6,_0x128073=document[_0x58734d(0x201)](_0x58734d(0x218));_0x128073[_0x58734d(0x17a)]=_0x58734d(0x20c);for(const [_0x3f1203,_0x2b2c2f]of Object[_0x58734d(0x1b6)](localTickets)){const _0x2b56b4=_0x2b2c2f[_0x58734d(0x1f6)]?_0x2b2c2f[_0x58734d(0x1f6)][_0x58734d(0x191)]:0x0;if(_0x2b56b4>0x0){const _0x4c6a97=_0x2b2c2f['prix'][0x0],_0x5cb233=_0x128073['insertRow']();_0x5cb233[_0x58734d(0x17a)]=_0x58734d(0x164)+_0x3f1203+_0x58734d(0x1d9)+_0x4c6a97+_0x58734d(0x1d9)+_0x2b56b4+_0x58734d(0x21c)+_0x3f1203+_0x58734d(0x1b8);}}document[_0x58734d(0x201)](_0x58734d(0x207))[_0x58734d(0x1b1)]['display']='none',_0x128073[_0x58734d(0x1b1)][_0x58734d(0x1a1)]=_0x58734d(0x1b5);}window['initTicketSale']=async function(_0xa3ae8e){const _0x2f9408=_0x311da6;showLoader();try{const _0x469f61=ref(db,_0x2f9408(0x166)+_0xa3ae8e),_0x1d6d15=await get(_0x469f61);if(_0x1d6d15[_0x2f9408(0x221)]()){const _0x465adc=_0x1d6d15['val']();if(!_0x465adc['utilisateur']||_0x465adc['utilisateur'][_0x2f9408(0x191)]===0x0)throw new Error(_0x2f9408(0x182));ticketToSell={'category':_0xa3ae8e,'user':_0x465adc[_0x2f9408(0x1f6)][0x0],'password':_0x465adc[_0x2f9408(0x216)][0x0],'price':_0x465adc[_0x2f9408(0x16d)][0x0],'updatedData':{..._0x465adc,'utilisateur':_0x465adc['utilisateur'][_0x2f9408(0x173)](0x1),'motDePasse':_0x465adc['motDePasse'][_0x2f9408(0x173)](0x1),'prix':_0x465adc[_0x2f9408(0x16d)]['slice'](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x3f448d){console[_0x2f9408(0x1f4)]('Erreur:',_0x3f448d),showNotification('Erreur',_0x2f9408(0x1cf)),hideLoader();}};function showConfirmation(_0x360c60){const _0x96e4db=_0x311da6,_0x4f96b0=document['getElementById'](_0x96e4db(0x1ef)),_0x259d14=document[_0x96e4db(0x1c7)](_0x96e4db(0x189)),_0x31c991=document[_0x96e4db(0x1c7)](_0x96e4db(0x1f8)),_0x5708b3=document[_0x96e4db(0x1c7)]('confirmation-buttons');document[_0x96e4db(0x1c7)]('notification-title')[_0x96e4db(0x1eb)]=_0x96e4db(0x16f),_0x259d14[_0x96e4db(0x17a)]=_0x96e4db(0x174)+_0x360c60[_0x96e4db(0x209)]+_0x96e4db(0x18a)+_0x360c60[_0x96e4db(0x1d3)]+_0x96e4db(0x22d),_0x5708b3[_0x96e4db(0x1b1)][_0x96e4db(0x1a1)]=_0x96e4db(0x222),_0x31c991[_0x96e4db(0x1b1)]['display']=_0x96e4db(0x193),_0x4f96b0[_0x96e4db(0x1b1)][_0x96e4db(0x1a1)]=_0x96e4db(0x1a5);}window['proceedWithSale']=async function(){const _0x123654=_0x311da6;showLoader();if(!ticketToSell){showNotification(_0x123654(0x20f),_0x123654(0x1cd)),hideLoader();return;}try{const _0x38e288=ref(db,_0x123654(0x166)+ticketToSell['category']);await set(_0x38e288,ticketToSell[_0x123654(0x229)]);const _0x1db8e8=ref(db,_0x123654(0x188));await push(_0x1db8e8,{'category':ticketToSell['category'],'user':ticketToSell['user'],'password':ticketToSell[_0x123654(0x1ed)],'price':ticketToSell[_0x123654(0x1d3)],'soldAt':Date[_0x123654(0x213)](),'vendorId':currentVendorId});const _0x1e7c81=ref(db,_0x123654(0x1b7)+currentVendorId);await push(_0x1e7c81,{'category':ticketToSell[_0x123654(0x209)],'user':ticketToSell[_0x123654(0x22f)],'password':ticketToSell['password'],'price':ticketToSell[_0x123654(0x1d3)],'soldAt':Date[_0x123654(0x213)]()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x4ee052){console[_0x123654(0x1f4)](_0x123654(0x17e),_0x4ee052),showNotification('Erreur','Impossible\x20de\x20finaliser\x20la\x20vente'),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x343f2f){const _0x494f5e=_0x311da6,_0x1f8e73=document[_0x494f5e(0x1c7)](_0x494f5e(0x1ef)),_0x9a0dab=document[_0x494f5e(0x1c7)](_0x494f5e(0x189)),_0x442d2e=document[_0x494f5e(0x1c7)](_0x494f5e(0x1f8)),_0x3d5dd6=document['getElementById']('confirmation-buttons');document[_0x494f5e(0x1c7)]('notification-title')[_0x494f5e(0x1eb)]=_0x494f5e(0x1ee),_0x9a0dab[_0x494f5e(0x17a)]=_0x494f5e(0x1d8)+_0x343f2f['category']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x343f2f[_0x494f5e(0x22f)]+_0x494f5e(0x171)+_0x343f2f[_0x494f5e(0x1ed)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x343f2f[_0x494f5e(0x1d3)]+_0x494f5e(0x22d),_0x3d5dd6[_0x494f5e(0x1b1)][_0x494f5e(0x1a1)]=_0x494f5e(0x193),_0x442d2e[_0x494f5e(0x1b1)][_0x494f5e(0x1a1)]=_0x494f5e(0x222),_0x1f8e73[_0x494f5e(0x1b1)][_0x494f5e(0x1a1)]=_0x494f5e(0x1a5),lucide[_0x494f5e(0x186)]();}function showSaleConfirmation(_0x4454db){const _0x4c7f33=_0x311da6,_0x42188b=document[_0x4c7f33(0x1c7)](_0x4c7f33(0x1ef)),_0x3e8f75=document[_0x4c7f33(0x1c7)](_0x4c7f33(0x189)),_0x4337a1=document[_0x4c7f33(0x1c7)](_0x4c7f33(0x1b3));_0x3e8f75['innerHTML']=_0x4c7f33(0x1d8)+_0x4454db[_0x4c7f33(0x209)]+_0x4c7f33(0x1d7)+_0x4454db['user']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20'+_0x4454db['password']+_0x4c7f33(0x18a)+_0x4454db[_0x4c7f33(0x1d3)]+_0x4c7f33(0x22d),_0x4337a1[_0x4c7f33(0x17a)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x42188b['style'][_0x4c7f33(0x1a1)]=_0x4c7f33(0x1a5),lucide[_0x4c7f33(0x186)]();}window[_0x311da6(0x1af)]=async function(){const _0x1880a3=_0x311da6;showLoader();if(!currentReservedTicket){showNotification('Erreur',_0x1880a3(0x215)),hideLoader();return;}try{const _0x152c13=ref(db,'TicketsVendus');await push(_0x152c13,{...currentReservedTicket,'soldAt':Date[_0x1880a3(0x213)](),'vendorId':currentVendorId});const _0x19d80d=ref(db,_0x1880a3(0x1b7)+currentVendorId);await push(_0x19d80d,{...currentReservedTicket,'soldAt':Date[_0x1880a3(0x213)]()}),showNotification(_0x1880a3(0x206),_0x1880a3(0x1e0)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x44b4d1){console[_0x1880a3(0x1f4)]('Erreur\x20de\x20confirmation:',_0x44b4d1),showNotification(_0x1880a3(0x20f),_0x1880a3(0x1a3)),hideLoader();}},window[_0x311da6(0x224)]=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0x10e789,_0x11e866){const _0x42dcd8=_0x311da6,_0x2a9bb8=document['getElementById'](_0x42dcd8(0x1ef)),_0x5ca8e3=document['getElementById']('notification-title'),_0x44bdf9=document[_0x42dcd8(0x1c7)](_0x42dcd8(0x189)),_0x53cbbe=document['getElementById'](_0x42dcd8(0x1b3)),_0x364c2e=document[_0x42dcd8(0x1c7)]('ticket-actions');_0x5ca8e3[_0x42dcd8(0x1eb)]=_0x10e789,_0x44bdf9[_0x42dcd8(0x17a)]=_0x11e866,_0x10e789==='Succès'||_0x10e789===_0x42dcd8(0x20f)?(_0x53cbbe[_0x42dcd8(0x1b1)][_0x42dcd8(0x1a1)]=_0x42dcd8(0x193),_0x364c2e[_0x42dcd8(0x1b1)][_0x42dcd8(0x1a1)]=_0x42dcd8(0x193)):(_0x53cbbe[_0x42dcd8(0x1b1)]['display']=_0x42dcd8(0x222),_0x364c2e['style'][_0x42dcd8(0x1a1)]=_0x42dcd8(0x193)),_0x2a9bb8[_0x42dcd8(0x1b1)][_0x42dcd8(0x1a1)]=_0x42dcd8(0x1a5);}function _0x18a1(){const _0x258ff2=['\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','2188753UBgiOQ','pageLoaderWrapper','Abonnement\x20expiré','loginForm','min','innerHTML','3301155lbrOjg','share','autocompleteSuggestions','Erreur\x20lors\x20de\x20la\x20vente:','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','charCodeAt','loginSection','Plus\x20de\x20tickets\x20disponibles','all','Vérification\x20de\x20l\x27abonnement...','soldAt','createIcons','redirectToSubscription','TicketsVendus','notification-message','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','toLocaleString','Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:','image/png','Abonnement\x20actif','getDate','removeItem','length','right','none','checked','closeHistory','catch','historySection','PNG','exportToExcelHistory','sort','859045rIaybU','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','add','value','11243688aPfnhl','Pas\x20d\x27abonnement\x20actif','display','max','Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente','Détails\x20du\x20Ticket','block','1068knJWZW','toggleHistory','settings','ceil','print','content','div','jsPDF','status','confirmSale','setItem','style','xlsx','notification-buttons','log','table','entries','VendorsHistory/','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','setFontSize','G-ME2G62WHLL','startDate','username','https://nora-wifi-zone-default-rtdb.firebaseio.com','text','toFixed','historique_ventes.xlsx','pageSize','expired','setDate','AIzaSyAtObOTrkcnp2rZG9woqmKdqOK8zYAfxck','submit','.rates-section','getElementById','center','height','filterHistory','left','Partage\x20réussi','Aucun\x20ticket\x20à\x20vendre','innerText','Impossible\x20de\x20récupérer\x20le\x20ticket','Aucun\x20vendeur\x20trouvé.','contains','207032uvPCIr','price','addEventListener','internal','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','loginError','index.html','hideSubscriptionRequiredModal','periodFilter','loaderWrapper','update','Ticket\x20vendu\x20avec\x20succès!','Impossible\x20de\x20charger\x20l\x27historique','forEach','scrollHeight','Erreur\x20lors\x20de\x20la\x20copie:','Ticket\x20introuvable\x20dans\x20l\x27historique','historique_ventes.pdf','getTime','table_to_book','91890LsacYj','Vendors/','textContent','filter','password','Ticket\x20vendu\x20avec\x20succès','notification','admin/subscription','preventDefault','bold','TicketsTotal','error','location','utilisateur','650jCtzVO','ticket-actions','setHours','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','shareTicket','endDate','Erreur\x20lors\x20de\x20l\x27initialisation\x20:','Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','avgDaily','querySelector','map','getItem','ticket.pdf','Vendors','Succès','.loading-message','#historyTableBody','category','getHeight','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','classList','addImage','Erreur','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.','toLowerCase','filterHistoryByDateRange','now','createElement','Aucun\x20ticket\x20en\x20cours\x20de\x20vente','motDePasse','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','.rates-section\x20table','6nZJNmA','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','13292Cyvazk','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27','Aucun\x20ticket\x20disponible.','clipboard','getDay','appendChild','exists','flex','copyTicket','cancelSale','Erreur\x20de\x20synchronisation:','273027756522','Historique\x20des\x20ventes','getNumberOfPages','updatedData','join','nora-wifi-zone.firebaseapp.com','click','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','then','user','reduce','1:273027756522:web:653a46a1b21e382e8c8293','usernameTimestamp','Erreur\x20lors\x20du\x20partage:','target','historyTableBody','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','toDataURL','1gSRBEz','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','exportToPDF','TicketsTotal/','jspdf','printHistory','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','val','margin','keys','prix','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','Confirmation\x20de\x20vente','save','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','href','slice'];_0x18a1=function(){return _0x258ff2;};return _0x18a1();}window['hideNotification']=function(){const _0x1a09c7=_0x311da6;document[_0x1a09c7(0x1c7)](_0x1a09c7(0x1ef))[_0x1a09c7(0x1b1)][_0x1a09c7(0x1a1)]=_0x1a09c7(0x193);};async function loadHistory(){const _0x27de3d=_0x311da6;showLoader();try{const _0x60caab=ref(db,'VendorsHistory/'+currentVendorId),_0x2fe0b8=await get(_0x60caab);let _0xef0a77=[];_0x2fe0b8[_0x27de3d(0x221)]()&&(_0xef0a77=Object['entries'](_0x2fe0b8[_0x27de3d(0x16a)]())[_0x27de3d(0x202)](([_0x2380a6,_0x129b69])=>({'id':_0x2380a6,..._0x129b69}))),filterHistory(_0xef0a77),hideLoader();}catch(_0x291335){console['error'](_0x27de3d(0x16e),_0x291335),showNotification(_0x27de3d(0x20f),_0x27de3d(0x1e1)),hideLoader();}}function filterHistory(_0xa38b31){const _0xc48f76=_0x311da6,_0x73dd36=document[_0xc48f76(0x1c7)](_0xc48f76(0x1dd))[_0xc48f76(0x19e)],_0x40998d=new Date(),_0x406b2b={'today':new Date(_0x40998d[_0xc48f76(0x1f9)](0x0,0x0,0x0,0x0)),'week':new Date(_0x40998d[_0xc48f76(0x1c3)](_0x40998d[_0xc48f76(0x18f)]()-_0x40998d[_0xc48f76(0x21f)]())),'month':new Date(_0x40998d[_0xc48f76(0x1c3)](0x1)),'all':new Date(0x0)};let _0x21cf9c=_0xa38b31;_0x73dd36!==_0xc48f76(0x183)&&(_0x21cf9c=_0xa38b31['filter'](_0x155f86=>new Date(_0x155f86[_0xc48f76(0x185)])>=_0x406b2b[_0x73dd36])),updateStats(_0x21cf9c),updateHistoryTable(_0x21cf9c);}window[_0x311da6(0x212)]=function(){const _0xe5d977=_0x311da6,_0xfe2bb1=new Date(document[_0xe5d977(0x1c7)](_0xe5d977(0x1bb))[_0xe5d977(0x19e)]),_0x324e19=new Date(document[_0xe5d977(0x1c7)](_0xe5d977(0x1fc))[_0xe5d977(0x19e)]);_0x324e19[_0xe5d977(0x1f9)](0x17,0x3b,0x3b);if(isNaN(_0xfe2bb1[_0xe5d977(0x1e7)]())||isNaN(_0x324e19[_0xe5d977(0x1e7)]())){showNotification('Erreur',_0xe5d977(0x210));return;}const _0x1c73b6=ref(db,_0xe5d977(0x1b7)+currentVendorId);get(_0x1c73b6)['then'](_0x3bf5db=>{const _0x16afce=_0xe5d977;let _0xd3cbb9=[];_0x3bf5db[_0x16afce(0x221)]()&&(_0xd3cbb9=Object[_0x16afce(0x1b6)](_0x3bf5db[_0x16afce(0x16a)]())['map'](([_0x39df14,_0x4f579d])=>({'id':_0x39df14,..._0x4f579d})));const _0x210e6c=_0xd3cbb9[_0x16afce(0x1ec)](_0x3b5c6d=>{const _0xe5ed29=new Date(_0x3b5c6d['soldAt']);return _0xe5ed29>=_0xfe2bb1&&_0xe5ed29<=_0x324e19;});updateStats(_0x210e6c),updateHistoryTable(_0x210e6c);});};function updateStats(_0x387f39){const _0x1a34a9=_0x311da6,_0x49ec6d=_0x387f39['length'],_0x86fa1=_0x387f39[_0x1a34a9(0x230)]((_0x1110b9,_0x2340ab)=>_0x1110b9+parseFloat(_0x2340ab[_0x1a34a9(0x1d3)]),0x0),_0x843852=_0x387f39[_0x1a34a9(0x230)]((_0x1067a9,_0x32a8c0)=>{const _0x5ac094=_0x1a34a9;return _0x1067a9[_0x32a8c0[_0x5ac094(0x209)]]=(_0x1067a9[_0x32a8c0[_0x5ac094(0x209)]]||0x0)+0x1,_0x1067a9;},{}),_0x414fe8=Object[_0x1a34a9(0x1b6)](_0x843852)[_0x1a34a9(0x19a)]((_0x2c9b80,_0x2e4368)=>_0x2e4368[0x1]-_0x2c9b80[0x1])[0x0]?.[0x0]||'-',_0xc616e3=_0x387f39[_0x1a34a9(0x191)]>0x0?Math[_0x1a34a9(0x1a2)](0x1,Math[_0x1a34a9(0x1a9)]((Date[_0x1a34a9(0x213)]()-Math[_0x1a34a9(0x179)](..._0x387f39['map'](_0x5b17bc=>_0x5b17bc[_0x1a34a9(0x185)])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x3dcc6c=(_0x49ec6d/_0xc616e3)[_0x1a34a9(0x1bf)](0x1);document[_0x1a34a9(0x1c7)]('totalTickets')[_0x1a34a9(0x1eb)]=_0x49ec6d,document[_0x1a34a9(0x1c7)]('totalRevenue')['textContent']=_0x86fa1[_0x1a34a9(0x18b)]()+'\x20FCFA',document[_0x1a34a9(0x1c7)]('topCategory')[_0x1a34a9(0x1eb)]=_0x414fe8,document['getElementById'](_0x1a34a9(0x200))[_0x1a34a9(0x1eb)]=_0x3dcc6c;}function updateHistoryTable(_0x5f2004){const _0x12ba1d=_0x311da6,_0x187e77=document[_0x12ba1d(0x1c7)](_0x12ba1d(0x160));_0x187e77['innerHTML']=_0x5f2004['sort']((_0x30fdf2,_0x33fd63)=>_0x33fd63[_0x12ba1d(0x185)]-_0x30fdf2[_0x12ba1d(0x185)])[_0x12ba1d(0x202)](_0x35d5e4=>_0x12ba1d(0x161)+_0x35d5e4['id']+_0x12ba1d(0x21a)+new Date(_0x35d5e4[_0x12ba1d(0x185)])[_0x12ba1d(0x18b)]()+_0x12ba1d(0x1d9)+_0x35d5e4[_0x12ba1d(0x209)]+_0x12ba1d(0x1d9)+_0x35d5e4['user']+_0x12ba1d(0x1d9)+_0x35d5e4['price']+_0x12ba1d(0x169))[_0x12ba1d(0x22a)]('');}window['showTicketDetailsFromHistory']=async function(_0x53dc3f){const _0x3a5190=_0x311da6;showLoader();try{const _0x39327c=ref(db,_0x3a5190(0x1b7)+currentVendorId+'/'+_0x53dc3f),_0x1b6c57=await get(_0x39327c);if(_0x1b6c57[_0x3a5190(0x221)]()){const _0x3878bd=_0x1b6c57['val']();window[_0x3a5190(0x195)](),showTicketDetails(_0x3878bd),hideLoader();}else showNotification(_0x3a5190(0x20f),_0x3a5190(0x1e5)),hideLoader();}catch(_0x48e46d){console['error']('Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:',_0x48e46d),showNotification(_0x3a5190(0x20f),_0x3a5190(0x19c)),hideLoader();}},window[_0x311da6(0x1a7)]=function(){const _0x429f95=_0x311da6,_0xedefff=document[_0x429f95(0x1c7)]('historySection'),_0x3d5d7c=_0xedefff[_0x429f95(0x1b1)][_0x429f95(0x1a1)]===_0x429f95(0x1a5);_0xedefff[_0x429f95(0x1b1)][_0x429f95(0x1a1)]=_0x3d5d7c?'none':'block',!_0x3d5d7c&&loadHistory();},window['closeHistory']=function(){const _0xc49eeb=_0x311da6;document['getElementById'](_0xc49eeb(0x197))[_0xc49eeb(0x1b1)][_0xc49eeb(0x1a1)]=_0xc49eeb(0x193);},window[_0x311da6(0x1ca)]=function(){loadHistory();};function listenForNewMessages(){const _0x3ec419=_0x311da6,_0x4a34cb=ref(db,_0x3ec419(0x1ea)+currentVendorId+'/messages');onChildAdded(_0x4a34cb,_0x5b3a04=>{const _0x2f31a9=_0x5b3a04['val']();displayNewMessage(_0x2f31a9);});}function displayNewMessage(_0x5fd1bc){const _0x454340=_0x311da6,_0x439321=document[_0x454340(0x1c7)]('messagesContainer'),_0x54451d=document[_0x454340(0x214)](_0x454340(0x1ac));_0x54451d[_0x454340(0x20d)][_0x454340(0x19d)]('message'),_0x54451d[_0x454340(0x17a)]=_0x454340(0x1ff)+_0x5fd1bc[_0x454340(0x1ab)]+_0x454340(0x1d6)+new Date(_0x5fd1bc['timestamp'])[_0x454340(0x18b)]()+_0x454340(0x20b),_0x439321[_0x454340(0x220)](_0x54451d),_0x439321['scrollTop']=_0x439321[_0x454340(0x1e3)];}window[_0x311da6(0x1fb)]=function(){const _0xe47647=_0x311da6,_0xa39123=document[_0xe47647(0x1c7)](_0xe47647(0x189))[_0xe47647(0x1ce)];navigator['share']?navigator[_0xe47647(0x17c)]({'title':_0xe47647(0x1a4),'text':_0xa39123})[_0xe47647(0x22e)](()=>console[_0xe47647(0x1b4)](_0xe47647(0x1cc)))['catch'](_0x320490=>console['error'](_0xe47647(0x15e),_0x320490)):alert(_0xe47647(0x1fe));},window[_0x311da6(0x223)]=function(){const _0x1d1e46=_0x311da6,_0x17f5c1=document[_0x1d1e46(0x1c7)](_0x1d1e46(0x189))[_0x1d1e46(0x1ce)];navigator[_0x1d1e46(0x21e)]['writeText'](_0x17f5c1)['then'](()=>{const _0x421616=_0x1d1e46;showNotification(_0x421616(0x206),_0x421616(0x217));})[_0x1d1e46(0x196)](_0x447d28=>{const _0x3c442b=_0x1d1e46;console[_0x3c442b(0x1f4)](_0x3c442b(0x1e4),_0x447d28),showNotification(_0x3c442b(0x20f),'Impossible\x20de\x20copier\x20le\x20ticket');});},window[_0x311da6(0x165)]=async function(){const _0x434bb3=_0x311da6;showLoader();const _0x635ced=document[_0x434bb3(0x1c7)](_0x434bb3(0x189)),_0x3f4fc7=new jsPDF(),_0x52a339=await html2canvas(_0x635ced),_0x5be209=_0x52a339[_0x434bb3(0x162)](_0x434bb3(0x18d));_0x3f4fc7[_0x434bb3(0x20e)](_0x5be209,_0x434bb3(0x198),0xa,0xa,0xbe,0x0),_0x3f4fc7[_0x434bb3(0x170)](_0x434bb3(0x204)),hideLoader();},window[_0x311da6(0x168)]=function(){const _0x21bce2=_0x311da6;window[_0x21bce2(0x1aa)]();},window['exportToPDFHistory']=function(){const _0x23a338=_0x311da6,{jsPDF:_0x395a04}=window[_0x23a338(0x167)],_0x2e43ff=new _0x395a04(),_0x49b806=document[_0x23a338(0x1c7)](_0x23a338(0x160)),_0x55f5b8={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x23a338(0x1f2),'halign':_0x23a338(0x1c8)},_0x3bcb6e={'halign':_0x23a338(0x1cb)},_0x4a9194={'theme':'grid','headStyles':_0x55f5b8,'bodyStyles':_0x3bcb6e,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x340e67){const _0x4950bb=_0x23a338;_0x2e43ff[_0x4950bb(0x1be)](_0x4950bb(0x227),0xe,0xf);const _0x28aa38='Page\x20'+_0x2e43ff[_0x4950bb(0x1d5)][_0x4950bb(0x228)]();_0x2e43ff[_0x4950bb(0x1b9)](0xa);const _0x143ad0=_0x2e43ff[_0x4950bb(0x1d5)][_0x4950bb(0x1c1)],_0x649987=_0x143ad0[_0x4950bb(0x1c9)]?_0x143ad0['height']:_0x143ad0[_0x4950bb(0x20a)]();_0x2e43ff[_0x4950bb(0x1be)](_0x28aa38,_0x340e67[_0x4950bb(0x1a8)][_0x4950bb(0x16b)][_0x4950bb(0x1cb)],_0x649987-0xa),_0x2e43ff[_0x4950bb(0x1be)](new Date()[_0x4950bb(0x18b)](),_0x143ad0['width']-_0x340e67['settings'][_0x4950bb(0x16b)][_0x4950bb(0x192)]-0x28,_0x649987-0xa);}};_0x2e43ff['autoTable']({'html':_0x23a338(0x208),..._0x4a9194}),_0x2e43ff[_0x23a338(0x170)](_0x23a338(0x1e6));},window[_0x311da6(0x199)]=function(){const _0x38fb63=_0x311da6,_0x24a870=XLSX['utils'][_0x38fb63(0x1e8)](document[_0x38fb63(0x1c7)]('historyTableBody'),{'sheet':'Ventes'}),_0x344927=XLSX['write'](_0x24a870,{'bookType':_0x38fb63(0x1b2),'type':'binary'});function _0x38da2a(_0xbd5487){const _0x3a4b9d=_0x38fb63,_0x7f4b8d=new ArrayBuffer(_0xbd5487[_0x3a4b9d(0x191)]),_0x33feb1=new Uint8Array(_0x7f4b8d);for(let _0x2ba891=0x0;_0x2ba891<_0xbd5487['length'];_0x2ba891++)_0x33feb1[_0x2ba891]=_0xbd5487[_0x3a4b9d(0x180)](_0x2ba891)&0xff;return _0x7f4b8d;}saveAs(new Blob([_0x38da2a(_0x344927)],{'type':'application/octet-stream'}),_0x38fb63(0x1c0));};function showLoader(){const _0x11dd55=_0x311da6;document[_0x11dd55(0x1c7)](_0x11dd55(0x1de))[_0x11dd55(0x1b1)]['display']=_0x11dd55(0x1a5);}function hideLoader(){const _0x195f0c=_0x311da6;document['getElementById'](_0x195f0c(0x1de))[_0x195f0c(0x1b1)][_0x195f0c(0x1a1)]=_0x195f0c(0x193);}function showPageLoader(){const _0x24a78c=_0x311da6;document[_0x24a78c(0x1c7)](_0x24a78c(0x176))[_0x24a78c(0x1b1)][_0x24a78c(0x1a1)]=_0x24a78c(0x222);}function hidePageLoader(){const _0x493bcc=_0x311da6;document['getElementById'](_0x493bcc(0x176))[_0x493bcc(0x1b1)][_0x493bcc(0x1a1)]='none';}function showSubscriptionRequiredModal(){const _0x29b260=_0x311da6;subscriptionRequiredModal[_0x29b260(0x1b1)]['display']='flex';}function hideSubscriptionRequiredModal(){const _0x312dd6=_0x311da6;subscriptionRequiredModal[_0x312dd6(0x1b1)][_0x312dd6(0x1a1)]=_0x312dd6(0x193);}function redirectToSubscription(){const _0x1833e6=_0x311da6;window[_0x1833e6(0x1f5)][_0x1833e6(0x172)]=_0x1833e6(0x1db);}async function checkSubscriptionStatus(){const _0x1798e9=_0x311da6,_0x17d003=document['getElementById']('pageLoaderMessage');_0x17d003['textContent']=_0x1798e9(0x184);try{const _0x35ce47=await get(adminRef),_0x22141a=_0x35ce47[_0x1798e9(0x16a)](),_0x3c9bcb=new Date();if(_0x22141a&&_0x22141a[_0x1798e9(0x1ae)]==='active'){const _0x23e989=new Date(_0x22141a[_0x1798e9(0x1fc)]);_0x23e989<_0x3c9bcb?(_0x17d003[_0x1798e9(0x1eb)]=_0x1798e9(0x177),showSubscriptionRequiredModal(),await adminRef[_0x1798e9(0x1df)]({'status':_0x1798e9(0x1c2)})):_0x17d003[_0x1798e9(0x1eb)]=_0x1798e9(0x18e);}else _0x17d003[_0x1798e9(0x1eb)]=_0x1798e9(0x1a0),showSubscriptionRequiredModal();}catch(_0x1eb4ac){console[_0x1798e9(0x1f4)]('Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:',_0x1eb4ac),_0x17d003[_0x1798e9(0x1eb)]=_0x1798e9(0x17f),showNotification('Erreur','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.');}}document[_0x311da6(0x1d4)]('DOMContentLoaded',()=>{const _0x26f431=_0x311da6;checkSubscriptionStatus()[_0x26f431(0x22e)](()=>{const _0x51ca45=_0x26f431;fetchVendors(),lucide[_0x51ca45(0x186)](),hidePageLoader();})['catch'](_0xe13c1b=>{const _0x103ea0=_0x26f431;console['error'](_0x103ea0(0x1fd),_0xe13c1b),showNotification(_0x103ea0(0x20f),_0x103ea0(0x1fa)),hidePageLoader();});}),window[_0x311da6(0x187)]=redirectToSubscription,window[_0x311da6(0x1dc)]=redirectToSubscription;
    </script>
</body>
</html>
