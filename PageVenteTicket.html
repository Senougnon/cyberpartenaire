<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* Styles CSS - Copied from previous version - No changes here */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()"><i class="fas fa-times"></i></span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i class="fas fa-share-alt"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i class="fas fa-file-pdf"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i class="fas fa-history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i class="fas fa-print"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i class="fas fa-file-pdf"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0xddc5fa=_0x2a34;(function(_0x172ab8,_0x2ea109){const _0x33a1d1=_0x2a34,_0x93b9c6=_0x172ab8();while(!![]){try{const _0xa5dd44=-parseInt(_0x33a1d1(0x1fd))/0x1+parseInt(_0x33a1d1(0x151))/0x2+-parseInt(_0x33a1d1(0x138))/0x3+-parseInt(_0x33a1d1(0x1cb))/0x4*(parseInt(_0x33a1d1(0x136))/0x5)+-parseInt(_0x33a1d1(0x1ee))/0x6+-parseInt(_0x33a1d1(0x129))/0x7*(parseInt(_0x33a1d1(0x205))/0x8)+parseInt(_0x33a1d1(0x127))/0x9;if(_0xa5dd44===_0x2ea109)break;else _0x93b9c6['push'](_0x93b9c6['shift']());}catch(_0x2bb86e){_0x93b9c6['push'](_0x93b9c6['shift']());}}}(_0x4ce4,0x9f102));import{getActiveDatabase}from'./firebase-config-manager.js';import{ref,get,set,push,remove,onChildAdded,update}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';let db,adminRef,currentUserIdAdmin,currentVendorId;async function initializeDatabase(){const _0x3d5b7e=_0x2a34;db=await getActiveDatabase(),console[_0x3d5b7e(0x18a)](_0x3d5b7e(0x1b6));}let ticketToSell=null,localTickets={},currentReservedTicket=null,vendors={},availableUsernames=[];window['jsPDF']=window[_0xddc5fa(0x191)]['jsPDF'];async function fetchVendors(){const _0x3810ea=_0xddc5fa;try{const _0x4f0a03=getAdminIdFromUrl();if(!_0x4f0a03){console['error'](_0x3810ea(0x16d));return;}currentUserIdAdmin=_0x4f0a03;const _0x4d3633=ref(db,_0x3810ea(0x161)+_0x4f0a03+_0x3810ea(0x19e)),_0x4f34ca=await get(_0x4d3633);_0x4f34ca[_0x3810ea(0x155)]()?(vendors=_0x4f34ca[_0x3810ea(0x17f)](),availableUsernames=Object[_0x3810ea(0x13b)](vendors)):console[_0x3810ea(0x18a)]('Aucun\x20vendeur\x20trouvé.');}catch(_0x25452e){console['error'](_0x3810ea(0x1b3),_0x25452e);}}const usernameInput=document[_0xddc5fa(0x1ac)](_0xddc5fa(0x194)),passwordInput=document['getElementById'](_0xddc5fa(0x1f1)),suggestionsList=document[_0xddc5fa(0x1ac)](_0xddc5fa(0x1f4));usernameInput[_0xddc5fa(0x18b)]('input',()=>{const _0x4a1799=_0xddc5fa,_0x488c18=usernameInput[_0x4a1799(0x128)]['toLowerCase'](),_0x146a6f=availableUsernames[_0x4a1799(0x1ef)](_0x5c227c=>_0x5c227c[_0x4a1799(0x13d)]()[_0x4a1799(0x16b)](_0x488c18));suggestionsList[_0x4a1799(0x1e4)]='';if(_0x488c18[_0x4a1799(0x14f)]===0x0||_0x146a6f[_0x4a1799(0x14f)]===0x0){suggestionsList['style']['display']=_0x4a1799(0x15b);return;}_0x146a6f[_0x4a1799(0x1f7)](_0x3d97ca=>{const _0x12329d=_0x4a1799,_0x45cbd8=document['createElement']('li');_0x45cbd8['textContent']=_0x3d97ca,_0x45cbd8[_0x12329d(0x18b)](_0x12329d(0x130),()=>{const _0x3baee1=_0x12329d;usernameInput[_0x3baee1(0x128)]=_0x3d97ca,suggestionsList[_0x3baee1(0x1e4)]='',suggestionsList['style'][_0x3baee1(0x143)]=_0x3baee1(0x15b);}),suggestionsList['appendChild'](_0x45cbd8);}),suggestionsList[_0x4a1799(0x160)][_0x4a1799(0x143)]=_0x4a1799(0x125);}),document['addEventListener'](_0xddc5fa(0x130),_0x20285b=>{const _0x19da6c=_0xddc5fa;!usernameInput[_0x19da6c(0x134)](_0x20285b[_0x19da6c(0x1d3)])&&!suggestionsList[_0x19da6c(0x134)](_0x20285b[_0x19da6c(0x1d3)])&&(suggestionsList[_0x19da6c(0x160)][_0x19da6c(0x143)]='none');});const rememberMeCheckbox=document[_0xddc5fa(0x1ac)](_0xddc5fa(0x182)),storedUsername=localStorage[_0xddc5fa(0x1ec)](_0xddc5fa(0x15f)),storedPassword=localStorage[_0xddc5fa(0x1ec)]('vendorPassword'),storedTimestamp=localStorage[_0xddc5fa(0x1ec)](_0xddc5fa(0x154)),now=Date[_0xddc5fa(0x1bf)](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput['value']=storedUsername,passwordInput['value']=storedPassword,rememberMeCheckbox[_0xddc5fa(0x1c9)]=!![]);const loginForm=document['getElementById'](_0xddc5fa(0x193)),loginError=document[_0xddc5fa(0x1ac)](_0xddc5fa(0x1be)),ratesSection=document[_0xddc5fa(0x172)]('.rates-section'),historySection=document[_0xddc5fa(0x1ac)]('historySection'),loginSection=document['getElementById'](_0xddc5fa(0x18d)),messagesSection=document['getElementById']('messagesSection');function _0x2a34(_0x208135,_0x5156e1){const _0x4ce440=_0x4ce4();return _0x2a34=function(_0x2a34f4,_0x2c9204){_0x2a34f4=_0x2a34f4-0x125;let _0x189ea3=_0x4ce440[_0x2a34f4];return _0x189ea3;},_0x2a34(_0x208135,_0x5156e1);}loginForm[_0xddc5fa(0x18b)](_0xddc5fa(0x1e1),async _0x4b99a4=>{const _0x43c98c=_0xddc5fa;_0x4b99a4[_0x43c98c(0x16f)](),showPageLoader();const _0x44079a=usernameInput[_0x43c98c(0x128)],_0x2e03e6=passwordInput['value'],_0x2cad57=getAdminIdFromUrl();if(!_0x2cad57){hidePageLoader(),loginError[_0x43c98c(0x160)][_0x43c98c(0x143)]='block',loginError[_0x43c98c(0x196)]=_0x43c98c(0x1bb);return;}if(vendors[_0x44079a]&&vendors[_0x44079a][_0x43c98c(0x1f1)]===_0x2e03e6){loginError[_0x43c98c(0x160)]['display']=_0x43c98c(0x15b),ratesSection['style'][_0x43c98c(0x143)]=_0x43c98c(0x125),historySection[_0x43c98c(0x160)][_0x43c98c(0x143)]='none',loginSection[_0x43c98c(0x160)]['display']=_0x43c98c(0x15b),messagesSection[_0x43c98c(0x160)][_0x43c98c(0x143)]='block',currentVendorId=_0x44079a;rememberMeCheckbox[_0x43c98c(0x1c9)]?(localStorage[_0x43c98c(0x19b)]('vendorUsername',_0x44079a),localStorage[_0x43c98c(0x19b)]('vendorPassword',_0x2e03e6),localStorage['setItem'](_0x43c98c(0x154),Date[_0x43c98c(0x1bf)]())):(localStorage[_0x43c98c(0x201)]('vendorUsername'),localStorage[_0x43c98c(0x201)](_0x43c98c(0x1e8)),localStorage[_0x43c98c(0x201)]('vendorUsernameTimestamp'));try{await syncTickets(),await loadHistory(),listenForNewMessages(),hidePageLoader();}catch(_0x509cb4){console['error'](_0x43c98c(0x187),_0x509cb4),showNotification(_0x43c98c(0x204),'Une\x20erreur\x20est\x20survenue\x20lors\x20du\x20chargement\x20des\x20données.\x20Veuillez\x20réessayer\x20ou\x20contacter\x20l\x27assistance.'),hidePageLoader();}}else loginError[_0x43c98c(0x160)][_0x43c98c(0x143)]=_0x43c98c(0x125),loginError[_0x43c98c(0x196)]=_0x43c98c(0x17d),hidePageLoader();});async function syncTickets(){const _0x1807e2=_0xddc5fa,_0x359756=getAdminIdFromUrl();if(!_0x359756){console[_0x1807e2(0x126)](_0x1807e2(0x203));return;}try{const _0x485f6c=document[_0x1807e2(0x172)]('.loading-message'),_0x183a77=document['querySelector'](_0x1807e2(0x14e));_0x485f6c[_0x1807e2(0x160)]['display']=_0x1807e2(0x125),_0x183a77[_0x1807e2(0x160)][_0x1807e2(0x143)]=_0x1807e2(0x15b);const _0x1d0475=ref(db,_0x1807e2(0x161)+_0x359756+'/TicketsTotal'),_0x44809d=await get(_0x1d0475);_0x44809d[_0x1807e2(0x155)]()?(localTickets=_0x44809d[_0x1807e2(0x17f)](),createTicketTable(),_0x485f6c[_0x1807e2(0x160)][_0x1807e2(0x143)]=_0x1807e2(0x15b),_0x183a77['style'][_0x1807e2(0x143)]='table'):_0x485f6c[_0x1807e2(0x196)]=_0x1807e2(0x1b1);}catch(_0x56a650){console['error'](_0x1807e2(0x1c2),_0x56a650),loadingMessage[_0x1807e2(0x196)]=_0x1807e2(0x12b);}}async function createTicketTable(){const _0x46d6d3=_0xddc5fa,_0x31822d=document[_0x46d6d3(0x172)](_0x46d6d3(0x14e));_0x31822d[_0x46d6d3(0x1e4)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';for(const [_0x4e32e8,_0x594754]of Object['entries'](localTickets)){const _0x56016b=_0x594754['utilisateur']?_0x594754[_0x46d6d3(0x141)]['length']:0x0;if(_0x56016b>0x0){const _0x1bb9ea=_0x594754[_0x46d6d3(0x14b)][0x0],_0x39bc35=_0x31822d[_0x46d6d3(0x12d)]();_0x39bc35['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x4e32e8+_0x46d6d3(0x15a)+_0x1bb9ea+_0x46d6d3(0x15a)+_0x56016b+_0x46d6d3(0x167)+_0x4e32e8+_0x46d6d3(0x1dc);}}document['querySelector'](_0x46d6d3(0x1c4))['style']['display']='none',_0x31822d[_0x46d6d3(0x160)][_0x46d6d3(0x143)]=_0x46d6d3(0x1ca);}window[_0xddc5fa(0x1e7)]=async function(_0x127dc1){const _0x180f8e=_0xddc5fa;showLoader();const _0xdbc06c=getAdminIdFromUrl();if(!_0xdbc06c){console[_0x180f8e(0x126)](_0x180f8e(0x137)),hideLoader();return;}try{const _0x227961=ref(db,'users-data/'+_0xdbc06c+_0x180f8e(0x1da)+_0x127dc1),_0x3d784d=await get(_0x227961);if(_0x3d784d[_0x180f8e(0x155)]()){const _0x2927e7=_0x3d784d['val']();if(!_0x2927e7[_0x180f8e(0x141)]||_0x2927e7[_0x180f8e(0x141)]['length']===0x0){hideLoader(),showNotification(_0x180f8e(0x1a1),_0x180f8e(0x1c3));return;}const _0x3f1919=_0x2927e7[_0x180f8e(0x141)][0x0],_0xc985c1=_0x2927e7[_0x180f8e(0x1e5)][0x0],_0x7ce1be=_0x2927e7[_0x180f8e(0x14b)][0x0];ticketToSell={'category':_0x127dc1,'user':_0x3f1919,'password':_0xc985c1,'price':_0x7ce1be,'updatedData':{'utilisateur':_0x2927e7[_0x180f8e(0x141)][_0x180f8e(0x1de)](0x1),'motDePasse':_0x2927e7[_0x180f8e(0x1e5)][_0x180f8e(0x1de)](0x1),'prix':_0x2927e7[_0x180f8e(0x14b)][_0x180f8e(0x1de)](0x1)}},await set(_0x227961,ticketToSell[_0x180f8e(0x1bc)]),await syncTickets(),showConfirmation(ticketToSell),hideLoader();}else hideLoader(),showNotification(_0x180f8e(0x1a1),'Catégorie\x20de\x20ticket\x20introuvable.');}catch(_0x587a44){console['error']('Erreur\x20lors\x20de\x20l\x27initialisation\x20de\x20la\x20vente:',_0x587a44),hideLoader(),showNotification(_0x180f8e(0x1a1),'Impossible\x20d\x27initialiser\x20la\x20vente\x20du\x20ticket.');}};function showConfirmation(_0x27c022){const _0x194781=_0xddc5fa,_0x2d4ac5=document[_0x194781(0x1ac)]('notification'),_0x5b22c9=document[_0x194781(0x1ac)]('notification-message'),_0x465e20=document[_0x194781(0x1ac)](_0x194781(0x15c)),_0xb56010=document[_0x194781(0x1ac)](_0x194781(0x1b0));document[_0x194781(0x1ac)](_0x194781(0x152))[_0x194781(0x196)]=_0x194781(0x166),_0x5b22c9['innerHTML']=_0x194781(0x183)+_0x27c022[_0x194781(0x177)]+_0x194781(0x131)+_0x27c022[_0x194781(0x1c5)]+_0x194781(0x142),_0xb56010[_0x194781(0x160)][_0x194781(0x143)]=_0x194781(0x1e9),_0x465e20[_0x194781(0x160)][_0x194781(0x143)]=_0x194781(0x15b),_0x2d4ac5[_0x194781(0x160)][_0x194781(0x143)]=_0x194781(0x125);}window[_0xddc5fa(0x12e)]=async function(){const _0x497aa5=_0xddc5fa;showLoader();if(!ticketToSell){showNotification(_0x497aa5(0x1a1),_0x497aa5(0x1d1)),hideLoader();return;}const _0x5acc73=getAdminIdFromUrl();if(!_0x5acc73){console[_0x497aa5(0x126)](_0x497aa5(0x19c)),hideLoader();return;}try{const _0x5b2312=ref(db,_0x497aa5(0x161)+_0x5acc73+_0x497aa5(0x145));await push(_0x5b2312,{'category':ticketToSell['category'],'user':ticketToSell[_0x497aa5(0x1d5)],'password':ticketToSell['password'],'price':ticketToSell[_0x497aa5(0x1c5)],'soldAt':Date[_0x497aa5(0x1bf)](),'vendorId':currentVendorId});const _0x2b6305=ref(db,_0x497aa5(0x161)+_0x5acc73+_0x497aa5(0x1fa)+currentVendorId);await push(_0x2b6305,{'category':ticketToSell[_0x497aa5(0x177)],'user':ticketToSell[_0x497aa5(0x1d5)],'password':ticketToSell[_0x497aa5(0x1f1)],'price':ticketToSell[_0x497aa5(0x1c5)],'soldAt':Date[_0x497aa5(0x1bf)]()}),showTicketDetails(ticketToSell),hideLoader();}catch(_0x56ef09){console[_0x497aa5(0x126)](_0x497aa5(0x162),_0x56ef09),showNotification(_0x497aa5(0x1a1),_0x497aa5(0x17a)),hideLoader();}ticketToSell=null;},window['cancelSale']=async function(){const _0x1bbbad=_0xddc5fa;if(ticketToSell){const _0x4159a1=getAdminIdFromUrl();if(!_0x4159a1){console['error'](_0x1bbbad(0x178));return;}const _0x5bdb20=ref(db,_0x1bbbad(0x161)+_0x4159a1+_0x1bbbad(0x1da)+ticketToSell[_0x1bbbad(0x177)]);try{const _0x1e84f3=await get(_0x5bdb20),_0x271635=_0x1e84f3['val']()||{'utilisateur':[],'motDePasse':[],'prix':[]},_0x19e646={'utilisateur':[ticketToSell['user'],..._0x271635[_0x1bbbad(0x141)]],'motDePasse':[ticketToSell['password'],..._0x271635[_0x1bbbad(0x1e5)]],'prix':[ticketToSell[_0x1bbbad(0x1c5)],..._0x271635[_0x1bbbad(0x14b)]]};await set(_0x5bdb20,_0x19e646),await syncTickets();}catch(_0x1ba464){console[_0x1bbbad(0x126)]('Erreur\x20lors\x20de\x20l\x27annulation\x20de\x20la\x20vente',_0x1ba464),showNotification(_0x1bbbad(0x1a1),'Impossible\x20d\x27annuler\x20la\x20vente');}ticketToSell=null;}hideNotification();};function showTicketDetails(_0x4ec37e){const _0x3e87bb=_0xddc5fa,_0x7e664f=document[_0x3e87bb(0x1ac)]('notification'),_0x2f2f2b=document[_0x3e87bb(0x1ac)](_0x3e87bb(0x144)),_0x3d61dd=document[_0x3e87bb(0x1ac)](_0x3e87bb(0x15c)),_0x2d4750=document['getElementById'](_0x3e87bb(0x1b0));document[_0x3e87bb(0x1ac)](_0x3e87bb(0x152))[_0x3e87bb(0x196)]=_0x3e87bb(0x148),_0x2f2f2b[_0x3e87bb(0x1e4)]=_0x3e87bb(0x157)+_0x4ec37e[_0x3e87bb(0x177)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x4ec37e[_0x3e87bb(0x1d5)]+_0x3e87bb(0x1c8)+_0x4ec37e[_0x3e87bb(0x1f1)]+_0x3e87bb(0x131)+_0x4ec37e[_0x3e87bb(0x1c5)]+_0x3e87bb(0x142),_0x2d4750[_0x3e87bb(0x160)][_0x3e87bb(0x143)]='none',_0x3d61dd[_0x3e87bb(0x160)][_0x3e87bb(0x143)]=_0x3e87bb(0x1e9),_0x7e664f['style'][_0x3e87bb(0x143)]=_0x3e87bb(0x125);}function showSaleConfirmation(_0x34bf36){const _0x109a6c=_0xddc5fa,_0x38433f=document[_0x109a6c(0x1ac)](_0x109a6c(0x18f)),_0x35e7b8=document[_0x109a6c(0x1ac)]('notification-message'),_0x1c0a19=document[_0x109a6c(0x1ac)](_0x109a6c(0x202));_0x35e7b8[_0x109a6c(0x1e4)]=_0x109a6c(0x157)+_0x34bf36[_0x109a6c(0x177)]+_0x109a6c(0x1d4)+_0x34bf36[_0x109a6c(0x1d5)]+_0x109a6c(0x1c8)+_0x34bf36[_0x109a6c(0x1f1)]+_0x109a6c(0x131)+_0x34bf36[_0x109a6c(0x1c5)]+_0x109a6c(0x142),_0x1c0a19[_0x109a6c(0x1e4)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x38433f[_0x109a6c(0x160)]['display']=_0x109a6c(0x125);}function showNotification(_0x512247,_0x515623){const _0x3fa344=_0xddc5fa,_0x34bab2=document[_0x3fa344(0x1ac)](_0x3fa344(0x18f)),_0x46e925=document[_0x3fa344(0x1ac)](_0x3fa344(0x152)),_0x2c96b0=document[_0x3fa344(0x1ac)](_0x3fa344(0x144)),_0x3a166c=document['getElementById'](_0x3fa344(0x202)),_0x5a334a=document[_0x3fa344(0x1ac)](_0x3fa344(0x15c));_0x46e925[_0x3fa344(0x196)]=_0x512247,_0x2c96b0[_0x3fa344(0x1e4)]=_0x515623,_0x512247==='Succès'||_0x512247===_0x3fa344(0x1a1)?(_0x3a166c[_0x3fa344(0x160)][_0x3fa344(0x143)]=_0x3fa344(0x15b),_0x5a334a[_0x3fa344(0x160)][_0x3fa344(0x143)]=_0x3fa344(0x15b)):(_0x3a166c[_0x3fa344(0x160)]['display']=_0x3fa344(0x1e9),_0x5a334a[_0x3fa344(0x160)][_0x3fa344(0x143)]='none'),_0x34bab2['style'][_0x3fa344(0x143)]=_0x3fa344(0x125);}window['hideNotification']=function(){const _0x395042=_0xddc5fa;document[_0x395042(0x1ac)](_0x395042(0x18f))[_0x395042(0x160)][_0x395042(0x143)]=_0x395042(0x15b),ticketToSell&&window[_0x395042(0x1f6)]();};async function loadHistory(){const _0x760c0f=_0xddc5fa;showLoader();const _0x2d63ab=getAdminIdFromUrl();if(!_0x2d63ab){console[_0x760c0f(0x126)](_0x760c0f(0x179)),hideLoader();return;}try{const _0x53edc9=ref(db,_0x760c0f(0x161)+_0x2d63ab+_0x760c0f(0x1fa)+currentVendorId),_0x2b67e7=await get(_0x53edc9);let _0x21b219=[];_0x2b67e7[_0x760c0f(0x155)]()&&(_0x21b219=Object['entries'](_0x2b67e7[_0x760c0f(0x17f)]())[_0x760c0f(0x17e)](([_0xaff7ce,_0x24edec])=>({'id':_0xaff7ce,..._0x24edec}))),filterHistory(_0x21b219),hideLoader();}catch(_0x3b6c60){console[_0x760c0f(0x126)](_0x760c0f(0x192),_0x3b6c60),showNotification(_0x760c0f(0x1a1),_0x760c0f(0x1c7)),hideLoader();}}function filterHistory(_0x5dff13){const _0x309a3b=_0xddc5fa,_0x40434a=document[_0x309a3b(0x1ac)](_0x309a3b(0x1a3))[_0x309a3b(0x128)],_0x48bccb=new Date(),_0xa3049a={'today':new Date(_0x48bccb[_0x309a3b(0x1f3)](0x0,0x0,0x0,0x0)),'week':new Date(_0x48bccb[_0x309a3b(0x174)](_0x48bccb[_0x309a3b(0x140)]()-_0x48bccb[_0x309a3b(0x1b7)]())),'month':new Date(_0x48bccb['setDate'](0x1)),'all':new Date(0x0)};let _0x49bf6a=_0x5dff13;_0x40434a!=='all'&&(_0x49bf6a=_0x5dff13['filter'](_0x5e1f11=>new Date(_0x5e1f11['soldAt'])>=_0xa3049a[_0x40434a])),updateStats(_0x49bf6a),updateHistoryTable(_0x49bf6a);}window['filterHistoryByDateRange']=function(){const _0x15f626=_0xddc5fa,_0x2cbbac=new Date(document[_0x15f626(0x1ac)]('startDate')['value']),_0x5b1d4a=new Date(document[_0x15f626(0x1ac)]('endDate')['value']);_0x5b1d4a[_0x15f626(0x1f3)](0x17,0x3b,0x3b);const _0x47614d=getAdminIdFromUrl();if(!_0x47614d){console[_0x15f626(0x126)](_0x15f626(0x18e));return;}if(isNaN(_0x2cbbac[_0x15f626(0x1d7)]())||isNaN(_0x5b1d4a['getTime']())){showNotification(_0x15f626(0x1a1),_0x15f626(0x1af));return;}const _0x346dbb=ref(db,'users-data/'+_0x47614d+_0x15f626(0x1fa)+currentVendorId);get(_0x346dbb)[_0x15f626(0x12a)](_0x54884d=>{const _0x14ad33=_0x15f626;let _0x218c2b=[];_0x54884d['exists']()&&(_0x218c2b=Object['entries'](_0x54884d[_0x14ad33(0x17f)]())['map'](([_0x3e26e6,_0x414ac9])=>({'id':_0x3e26e6,..._0x414ac9})));const _0x371006=_0x218c2b[_0x14ad33(0x1ef)](_0x356e57=>{const _0x296db7=_0x14ad33,_0x58b1ce=new Date(_0x356e57[_0x296db7(0x1db)]);return _0x58b1ce>=_0x2cbbac&&_0x58b1ce<=_0x5b1d4a;});updateStats(_0x371006),updateHistoryTable(_0x371006);});};function updateStats(_0x3bd1ca){const _0x1fda51=_0xddc5fa,_0x47f25f=_0x3bd1ca['length'],_0x3b5c15=_0x3bd1ca[_0x1fda51(0x197)]((_0x35513e,_0x5c71e4)=>_0x35513e+parseFloat(_0x5c71e4[_0x1fda51(0x1c5)]),0x0),_0x4c6385=_0x3bd1ca[_0x1fda51(0x197)]((_0x2b06f7,_0x2f3ebc)=>{const _0x47bac8=_0x1fda51;return _0x2b06f7[_0x2f3ebc[_0x47bac8(0x177)]]=(_0x2b06f7[_0x2f3ebc['category']]||0x0)+0x1,_0x2b06f7;},{}),_0x338601=Object[_0x1fda51(0x164)](_0x4c6385)[_0x1fda51(0x1a7)]((_0x3e054a,_0x24ac90)=>_0x24ac90[0x1]-_0x3e054a[0x1])[0x0]?.[0x0]||'-',_0x568877=_0x3bd1ca[_0x1fda51(0x14f)]>0x0?Math[_0x1fda51(0x1a4)](0x1,Math[_0x1fda51(0x16a)]((Date[_0x1fda51(0x1bf)]()-Math[_0x1fda51(0x1e3)](..._0x3bd1ca[_0x1fda51(0x17e)](_0x3e2ec4=>_0x3e2ec4[_0x1fda51(0x1db)])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x122b4e=(_0x47f25f/_0x568877)[_0x1fda51(0x1e6)](0x1);document[_0x1fda51(0x1ac)]('totalTickets')[_0x1fda51(0x196)]=_0x47f25f,document[_0x1fda51(0x1ac)](_0x1fda51(0x1cf))[_0x1fda51(0x196)]=_0x3b5c15[_0x1fda51(0x188)]()+_0x1fda51(0x1a0),document[_0x1fda51(0x1ac)](_0x1fda51(0x132))[_0x1fda51(0x196)]=_0x338601,document[_0x1fda51(0x1ac)](_0x1fda51(0x176))['textContent']=_0x122b4e;}function updateHistoryTable(_0x161418){const _0x126319=_0xddc5fa,_0xa7fa6d=document[_0x126319(0x1ac)]('historyTableBody');_0xa7fa6d[_0x126319(0x1e4)]=_0x161418[_0x126319(0x1a7)]((_0x3db863,_0x5e58a4)=>_0x5e58a4[_0x126319(0x1db)]-_0x3db863[_0x126319(0x1db)])[_0x126319(0x17e)](_0x70f102=>_0x126319(0x1f9)+_0x70f102['id']+_0x126319(0x133)+new Date(_0x70f102[_0x126319(0x1db)])['toLocaleString']()+_0x126319(0x15a)+_0x70f102[_0x126319(0x177)]+_0x126319(0x15a)+_0x70f102['user']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x70f102[_0x126319(0x1c5)]+_0x126319(0x1d2))['join']('');}window[_0xddc5fa(0x19a)]=async function(_0x3c1ca5){const _0x42a2e0=_0xddc5fa;showLoader();try{const _0x40e015=getAdminIdFromUrl();if(!_0x40e015){console['error']('Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20show\x20ticket\x20details\x20from\x20history.'),hideLoader();return;}const _0x2a8db8=ref(db,_0x42a2e0(0x161)+_0x40e015+_0x42a2e0(0x1fa)+currentVendorId+'/'+_0x3c1ca5),_0x1b9b3d=await get(_0x2a8db8);if(_0x1b9b3d['exists']()){const _0x56ba1c=_0x1b9b3d[_0x42a2e0(0x17f)]();window[_0x42a2e0(0x181)](),showTicketDetails(_0x56ba1c),hideLoader();}else showNotification('Erreur',_0x42a2e0(0x149)),hideLoader();}catch(_0xc08906){console['error'](_0x42a2e0(0x158),_0xc08906),showNotification(_0x42a2e0(0x1a1),_0x42a2e0(0x163)),hideLoader();}},window[_0xddc5fa(0x19d)]=function(){const _0x3b9217=_0xddc5fa,_0x2e4e21=document[_0x3b9217(0x1ac)](_0x3b9217(0x14d)),_0x1b7277=_0x2e4e21[_0x3b9217(0x160)][_0x3b9217(0x143)]===_0x3b9217(0x125);_0x2e4e21['style']['display']=_0x1b7277?'none':'block',!_0x1b7277&&loadHistory();},window[_0xddc5fa(0x181)]=function(){const _0x98bfdc=_0xddc5fa;document[_0x98bfdc(0x1ac)](_0x98bfdc(0x14d))[_0x98bfdc(0x160)]['display']=_0x98bfdc(0x15b);},window['filterHistory']=function(){loadHistory();};function listenForNewMessages(){const _0x57b746=_0xddc5fa,_0x55a470=getAdminIdFromUrl();if(!_0x55a470){console[_0x57b746(0x126)]('Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20listen\x20for\x20messages.');return;}const _0x1842d2=ref(db,_0x57b746(0x161)+_0x55a470+_0x57b746(0x12c)+currentVendorId+_0x57b746(0x1b8));onChildAdded(_0x1842d2,_0x1a8aa5=>{const _0x32d9eb=_0x57b746,_0x4cab84=_0x1a8aa5[_0x32d9eb(0x17f)]();displayNewMessage(_0x4cab84);});}function displayNewMessage(_0x14a1e2){const _0x454725=_0xddc5fa,_0x2df120=document['getElementById'](_0x454725(0x1b5)),_0x3df98f=document[_0x454725(0x1a5)]('div');_0x3df98f[_0x454725(0x190)][_0x454725(0x1eb)](_0x454725(0x199)),_0x3df98f[_0x454725(0x1e4)]=_0x454725(0x135)+_0x14a1e2[_0x454725(0x206)]+_0x454725(0x1fb)+new Date(_0x14a1e2['timestamp'])['toLocaleString']()+_0x454725(0x1a8),_0x2df120[_0x454725(0x159)](_0x3df98f),_0x2df120[_0x454725(0x15d)]=_0x2df120['scrollHeight'];}window[_0xddc5fa(0x1d0)]=function(){const _0x157e86=_0xddc5fa,_0x3f7a57=document[_0x157e86(0x1ac)](_0x157e86(0x144))[_0x157e86(0x1e0)];navigator['share']?navigator['share']({'title':'Détails\x20du\x20Ticket','text':_0x3f7a57})[_0x157e86(0x12a)](()=>console[_0x157e86(0x18a)](_0x157e86(0x1a6)))[_0x157e86(0x1ea)](_0x55440b=>console['error'](_0x157e86(0x168),_0x55440b)):alert('Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.');},window[_0xddc5fa(0x14c)]=function(){const _0x27c27f=_0xddc5fa,_0x1b58c5=document[_0x27c27f(0x1ac)](_0x27c27f(0x144))['innerText'];navigator[_0x27c27f(0x1f5)][_0x27c27f(0x13a)](_0x1b58c5)[_0x27c27f(0x12a)](()=>{const _0x57089e=_0x27c27f;showNotification(_0x57089e(0x1ae),'Ticket\x20copié\x20dans\x20le\x20presse-papiers!');})[_0x27c27f(0x1ea)](_0x10a925=>{const _0x4f6746=_0x27c27f;console['error'](_0x4f6746(0x147),_0x10a925),showNotification(_0x4f6746(0x1a1),_0x4f6746(0x195));});},window[_0xddc5fa(0x1f2)]=async function(){const _0x3b5d02=_0xddc5fa;showLoader();const _0x23d356=document[_0x3b5d02(0x1ac)]('notification-message'),_0x53f51d=new jsPDF(),_0x2b4da1=await html2canvas(_0x23d356),_0x2b1f5a=_0x2b4da1[_0x3b5d02(0x1d6)]('image/png');_0x53f51d['addImage'](_0x2b1f5a,_0x3b5d02(0x207),0xa,0xa,0xbe,0x0),_0x53f51d[_0x3b5d02(0x1bd)](_0x3b5d02(0x1c1)),hideLoader();},window[_0xddc5fa(0x16e)]=function(){const _0x402026=_0xddc5fa;window[_0x402026(0x13e)]();},window[_0xddc5fa(0x1b4)]=function(){const _0x3f7aae=_0xddc5fa,{jsPDF:_0x1af6d5}=window['jspdf'],_0x5b1bea=new _0x1af6d5(),_0x32cbcf=document[_0x3f7aae(0x1ac)](_0x3f7aae(0x150)),_0x467455={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x3f7aae(0x1ff),'halign':_0x3f7aae(0x169)},_0x258fb4={'halign':_0x3f7aae(0x1dd)},_0x186a4a={'theme':_0x3f7aae(0x180),'headStyles':_0x467455,'bodyStyles':_0x258fb4,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x2249e0){const _0x4aedbe=_0x3f7aae;_0x5b1bea[_0x4aedbe(0x156)](_0x4aedbe(0x1f0),0xe,0xf);const _0x27f090=_0x4aedbe(0x1cc)+_0x5b1bea[_0x4aedbe(0x1ab)][_0x4aedbe(0x1d8)]();_0x5b1bea[_0x4aedbe(0x13f)](0xa);const _0x8445ee=_0x5b1bea[_0x4aedbe(0x1ab)]['pageSize'],_0x4b53fb=_0x8445ee[_0x4aedbe(0x1f8)]?_0x8445ee[_0x4aedbe(0x1f8)]:_0x8445ee[_0x4aedbe(0x19f)]();_0x5b1bea[_0x4aedbe(0x156)](_0x27f090,_0x2249e0[_0x4aedbe(0x1a9)][_0x4aedbe(0x15e)][_0x4aedbe(0x1dd)],_0x4b53fb-0xa),_0x5b1bea[_0x4aedbe(0x156)](new Date()[_0x4aedbe(0x188)](),_0x8445ee[_0x4aedbe(0x1b9)]-_0x2249e0[_0x4aedbe(0x1a9)][_0x4aedbe(0x15e)][_0x4aedbe(0x170)]-0x28,_0x4b53fb-0xa);}};_0x5b1bea[_0x3f7aae(0x175)]({'html':_0x3f7aae(0x1aa),..._0x186a4a}),_0x5b1bea['save'](_0x3f7aae(0x186));},window['exportToExcelHistory']=function(){const _0x32b4a2=_0xddc5fa,_0x4d42ba=XLSX[_0x32b4a2(0x171)]['table_to_book'](document[_0x32b4a2(0x1ac)](_0x32b4a2(0x150)),{'sheet':_0x32b4a2(0x1d9)}),_0x31c976=XLSX[_0x32b4a2(0x189)](_0x4d42ba,{'bookType':_0x32b4a2(0x139),'type':_0x32b4a2(0x17c)});function _0x4bbc7d(_0x362587){const _0x29ee2d=_0x32b4a2,_0x58b6fc=new ArrayBuffer(_0x362587['length']),_0x25517a=new Uint8Array(_0x58b6fc);for(let _0x48cb02=0x0;_0x48cb02<_0x362587[_0x29ee2d(0x14f)];_0x48cb02++)_0x25517a[_0x48cb02]=_0x362587['charCodeAt'](_0x48cb02)&0xff;return _0x58b6fc;}saveAs(new Blob([_0x4bbc7d(_0x31c976)],{'type':_0x32b4a2(0x13c)}),_0x32b4a2(0x16c));};function showLoader(){const _0x20010a=_0xddc5fa;document['getElementById'](_0x20010a(0x1ad))[_0x20010a(0x160)]['display']=_0x20010a(0x125);}function _0x4ce4(){const _0x395127=['value','1673tIfnht','then','Erreur\x20de\x20synchronisation\x20des\x20tickets.','/Vendors/','insertRow','proceedWithSale','filterHistoryByDateRange','click','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','topCategory','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','contains','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','10wDYMGK','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20init\x20ticket\x20sale.','3816606dvllRF','xlsx','writeText','keys','application/octet-stream','toLowerCase','print','setFontSize','getDate','utilisateur','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','display','notification-message','/TicketsVendus','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','Erreur\x20lors\x20de\x20la\x20copie:','Ticket\x20vendu\x20avec\x20succès','Ticket\x20introuvable\x20dans\x20l\x27historique','status','prix','copyTicket','historySection','.rates-section\x20table','length','historyTableBody','180964dlQogK','notification-title','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','vendorUsernameTimestamp','exists','text','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','appendChild','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','none','ticket-actions','scrollTop','margin','vendorUsername','style','users-data/','Erreur\x20lors\x20de\x20la\x20vente:','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','entries','/admin/subscription','Confirmation\x20de\x20vente','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27','Erreur\x20lors\x20du\x20partage:','center','ceil','startsWith','historique_ventes.xlsx','Admin\x20ID\x20is\x20missing\x20from\x20URL.','printHistory','preventDefault','right','utils','querySelector','get','setDate','autoTable','avgDaily','category','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20cancel\x20sale.','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20load\x20history.','Impossible\x20de\x20finaliser\x20la\x20vente','endDate','binary','Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.','map','val','grid','closeHistory','rememberMe','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','index.html','DOMContentLoaded','historique_ventes.pdf','Error\x20during\x20initialization\x20after\x20login:','toLocaleString','write','log','addEventListener','hideNotification','loginSection','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20filter\x20history\x20by\x20date\x20range.','notification','classList','jspdf','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','loginForm','username','Impossible\x20de\x20copier\x20le\x20ticket','textContent','reduce','pageLoaderWrapper','message','showTicketDetailsFromHistory','setItem','Admin\x20ID\x20missing\x20from\x20URL.\x20Cannot\x20proceed\x20with\x20sale.','toggleHistory','/Vendors','getHeight','\x20FCFA','Erreur','location','periodFilter','max','createElement','Partage\x20réussi','sort','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','settings','#historyTableBody','internal','getElementById','loaderWrapper','Succès','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.','confirmation-buttons','Aucun\x20ticket\x20disponible.','dispatchEvent','Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:','exportToPDFHistory','messagesContainer','Database\x20initialized\x20in\x20PageVenteTicket.html','getDay','/messages','width','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Subscription\x20check\x20failed.','Admin\x20user\x20ID\x20is\x20missing.','updatedData','save','loginError','now','adminId','ticket.pdf','Erreur\x20de\x20synchronisation:','Plus\x20de\x20tickets\x20disponibles\x20pour\x20cette\x20catégorie.','.loading-message','price','Abonnement\x20expiré','Impossible\x20de\x20charger\x20l\x27historique','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','checked','table','76372FeUepd','Page\x20','active','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','totalRevenue','shareTicket','Aucun\x20ticket\x20à\x20vendre','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fas\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','target','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','user','toDataURL','getTime','getNumberOfPages','Ventes','/TicketsTotal/','soldAt','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','left','slice','search','innerText','submit','hideSubscriptionRequiredModal','min','innerHTML','motDePasse','toFixed','initTicketSale','vendorPassword','flex','catch','add','getItem','expired','1843776dKWNfz','filter','Historique\x20des\x20ventes','password','exportToPDF','setHours','autocompleteSuggestions','clipboard','cancelSale','forEach','height','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','/VendorsHistory/','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','filterHistory','295110cRhJgq','Pas\x20d\x27abonnement\x20actif','bold','href','removeItem','notification-buttons','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20sync\x20tickets.','Erreur\x20d\x27initialisation','34728bOyfrI','content','PNG','block','error','31601997oVhtwJ'];_0x4ce4=function(){return _0x395127;};return _0x4ce4();}function hideLoader(){const _0x26ee59=_0xddc5fa;document['getElementById'](_0x26ee59(0x1ad))[_0x26ee59(0x160)][_0x26ee59(0x143)]=_0x26ee59(0x15b);}function showPageLoader(){const _0xdeb92d=_0xddc5fa;document['getElementById'](_0xdeb92d(0x198))[_0xdeb92d(0x160)][_0xdeb92d(0x143)]=_0xdeb92d(0x1e9);}function hidePageLoader(){const _0x582de6=_0xddc5fa;document[_0x582de6(0x1ac)](_0x582de6(0x198))[_0x582de6(0x160)][_0x582de6(0x143)]=_0x582de6(0x15b);}function showSubscriptionRequiredModal(){const _0x47abd6=_0xddc5fa;subscriptionRequiredModal['style'][_0x47abd6(0x143)]=_0x47abd6(0x1e9);}function hideSubscriptionRequiredModal(){const _0x32cfd9=_0xddc5fa;subscriptionRequiredModal['style'][_0x32cfd9(0x143)]=_0x32cfd9(0x15b);}function redirectToSubscription(){const _0x1ed1ea=_0xddc5fa;window[_0x1ed1ea(0x1a2)][_0x1ed1ea(0x200)]=_0x1ed1ea(0x184);}function getAdminIdFromUrl(){const _0x5c385e=_0xddc5fa,_0x5ac988=new URLSearchParams(window[_0x5c385e(0x1a2)][_0x5c385e(0x1df)]);return _0x5ac988[_0x5c385e(0x173)](_0x5c385e(0x1c0));}async function checkSubscriptionStatus(){const _0x2780a6=_0xddc5fa,_0x229386=document[_0x2780a6(0x1ac)]('pageLoaderMessage');_0x229386['textContent']='Vérification\x20de\x20l\x27abonnement...';const _0x282311=getAdminIdFromUrl();if(!_0x282311)return hidePageLoader(),showSubscriptionRequiredModal(),console[_0x2780a6(0x126)](_0x2780a6(0x1ba)),![];try{adminRef=ref(db,_0x2780a6(0x161)+_0x282311+_0x2780a6(0x165));const _0x501fc9=await get(adminRef),_0x27a5a0=_0x501fc9['val'](),_0x12c894=new Date();if(_0x27a5a0&&_0x27a5a0[_0x2780a6(0x14a)]===_0x2780a6(0x1cd)){const _0x2b3008=new Date(_0x27a5a0[_0x2780a6(0x17b)]);return _0x2b3008<_0x12c894?(_0x229386[_0x2780a6(0x196)]=_0x2780a6(0x1c6),hidePageLoader(),showSubscriptionRequiredModal(),await update(adminRef,{'status':_0x2780a6(0x1ed)}),![]):(_0x229386[_0x2780a6(0x196)]='Abonnement\x20actif',hidePageLoader(),!![]);}else return _0x229386[_0x2780a6(0x196)]=_0x2780a6(0x1fe),hidePageLoader(),showSubscriptionRequiredModal(),![];}catch(_0x528f9c){return hidePageLoader(),console[_0x2780a6(0x126)](_0x2780a6(0x146),_0x528f9c),_0x229386[_0x2780a6(0x196)]=_0x2780a6(0x1ce),showNotification(_0x2780a6(0x1a1),_0x2780a6(0x153)),![];}}document[_0xddc5fa(0x18b)](_0xddc5fa(0x185),async()=>{const _0x5a62d4=_0xddc5fa;showPageLoader(),await initializeDatabase();const _0x5a860c=getAdminIdFromUrl(),_0x4e48bc=new URLSearchParams(window[_0x5a62d4(0x1a2)][_0x5a62d4(0x1df)])['get']('partnerId');if(!_0x5a860c){hidePageLoader(),loginSection[_0x5a62d4(0x160)][_0x5a62d4(0x143)]=_0x5a62d4(0x125);return;}currentUserIdAdmin=_0x5a860c,_0x4e48bc&&(currentVendorId=_0x4e48bc),await fetchVendors(),rememberMeCheckbox[_0x5a62d4(0x1c9)]?usernameInput['value']&&passwordInput['value']?await loginForm[_0x5a62d4(0x1b2)](new Event(_0x5a62d4(0x1e1))):hidePageLoader():hidePageLoader(),document['getElementById'](_0x5a62d4(0x193))[_0x5a62d4(0x18b)](_0x5a62d4(0x1e1),login),ratesSection['style']['display']===_0x5a62d4(0x125)&&(await syncTickets(),loadHistory(),listenForNewMessages());}),window['redirectToSubscription']=redirectToSubscription,window[_0xddc5fa(0x1e2)]=redirectToSubscription,window[_0xddc5fa(0x18c)]=hideNotification,window['proceedWithSale']=proceedWithSale,window['confirmSale']=confirmSale,window['cancelSale']=cancelSale,window['toggleHistory']=toggleHistory,window['closeHistory']=closeHistory,window[_0xddc5fa(0x1fc)]=filterHistory,window[_0xddc5fa(0x12f)]=filterHistoryByDateRange,window[_0xddc5fa(0x1d0)]=shareTicket,window['copyTicket']=copyTicket,window[_0xddc5fa(0x1f2)]=exportToPDF,window['exportToPDFHistory']=exportToPDFHistory,window['exportToExcelHistory']=exportToExcelHistory,window[_0xddc5fa(0x1e7)]=initTicketSale,window[_0xddc5fa(0x19a)]=showTicketDetailsFromHistory,window[_0xddc5fa(0x1fc)]=filterHistory;
</script>
</body>
</html>