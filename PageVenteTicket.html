<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* Styles CSS - Copied from previous version - No changes here */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()"><i class="fas fa-times"></i></span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i class="fas fa-share-alt"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i class="fas fa-file-pdf"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i class="fas fa-history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i class="fas fa-print"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i class="fas fa-file-pdf"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x2dac8a=_0xc0de;(function(_0xd4b551,_0x2ab13e){const _0x39d8d2=_0xc0de,_0x50a312=_0xd4b551();while(!![]){try{const _0x3bd837=parseInt(_0x39d8d2(0xf9))/0x1+-parseInt(_0x39d8d2(0x19a))/0x2*(-parseInt(_0x39d8d2(0x13d))/0x3)+-parseInt(_0x39d8d2(0x137))/0x4*(parseInt(_0x39d8d2(0x104))/0x5)+parseInt(_0x39d8d2(0x102))/0x6*(-parseInt(_0x39d8d2(0x1ad))/0x7)+-parseInt(_0x39d8d2(0x1b2))/0x8+parseInt(_0x39d8d2(0x1a8))/0x9+parseInt(_0x39d8d2(0x11d))/0xa;if(_0x3bd837===_0x2ab13e)break;else _0x50a312['push'](_0x50a312['shift']());}catch(_0x84dba6){_0x50a312['push'](_0x50a312['shift']());}}}(_0x2500,0xefa78));import{getActiveDatabase}from'./firebase-config-manager.js';import{ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';let db,adminRef,currentUserIdAdmin,currentVendorId;async function initializeDatabase(){const _0x34942f=_0xc0de;db=await getActiveDatabase(),console['log'](_0x34942f(0x133));}let ticketToSell=null,localTickets={},currentReservedTicket=null,vendors={},availableUsernames=[];window[_0x2dac8a(0x195)]=window['jspdf'][_0x2dac8a(0x195)];async function fetchVendors(){const _0x260af2=_0x2dac8a;try{const _0x4e3936=getAdminIdFromUrl();if(!_0x4e3936){console[_0x260af2(0x141)](_0x260af2(0xf6));return;}currentUserIdAdmin=_0x4e3936;const _0x2a222a=ref(db,'users-data/'+_0x4e3936+'/Vendors'),_0x204974=await get(_0x2a222a);_0x204974[_0x260af2(0x188)]()?(vendors=_0x204974['val'](),availableUsernames=Object[_0x260af2(0x151)](vendors)):console[_0x260af2(0x111)](_0x260af2(0x1a7));}catch(_0xde3468){console['error']('Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:',_0xde3468);}}const usernameInput=document[_0x2dac8a(0x14c)](_0x2dac8a(0x1b0)),passwordInput=document[_0x2dac8a(0x14c)]('password'),suggestionsList=document[_0x2dac8a(0x14c)](_0x2dac8a(0x13c));usernameInput[_0x2dac8a(0xf7)](_0x2dac8a(0x142),()=>{const _0x23e684=_0x2dac8a,_0x18a297=usernameInput['value']['toLowerCase'](),_0x3805a5=availableUsernames[_0x23e684(0x14d)](_0x1f69cf=>_0x1f69cf[_0x23e684(0x19b)]()[_0x23e684(0x109)](_0x18a297));suggestionsList[_0x23e684(0x143)]='';if(_0x18a297['length']===0x0||_0x3805a5[_0x23e684(0x184)]===0x0){suggestionsList[_0x23e684(0x1b8)]['display']=_0x23e684(0x18e);return;}_0x3805a5[_0x23e684(0x19d)](_0x1e4118=>{const _0x559baf=_0x23e684,_0x1d2486=document[_0x559baf(0xfa)]('li');_0x1d2486[_0x559baf(0x17c)]=_0x1e4118,_0x1d2486['addEventListener'](_0x559baf(0x122),()=>{const _0x223403=_0x559baf;usernameInput['value']=_0x1e4118,suggestionsList[_0x223403(0x143)]='',suggestionsList[_0x223403(0x1b8)][_0x223403(0x193)]=_0x223403(0x18e);}),suggestionsList[_0x559baf(0x12f)](_0x1d2486);}),suggestionsList[_0x23e684(0x1b8)][_0x23e684(0x193)]='block';}),document[_0x2dac8a(0xf7)]('click',_0x4b44a5=>{const _0x92f79c=_0x2dac8a;!usernameInput[_0x92f79c(0x135)](_0x4b44a5[_0x92f79c(0x1b9)])&&!suggestionsList['contains'](_0x4b44a5[_0x92f79c(0x1b9)])&&(suggestionsList[_0x92f79c(0x1b8)]['display']=_0x92f79c(0x18e));});const rememberMeCheckbox=document[_0x2dac8a(0x14c)](_0x2dac8a(0x13e)),storedUsername=localStorage['getItem']('vendorUsername'),storedPassword=localStorage['getItem']('vendorPassword'),storedTimestamp=localStorage['getItem'](_0x2dac8a(0x198)),now=Date['now'](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0x2dac8a(0x177)]=storedUsername,passwordInput[_0x2dac8a(0x177)]=storedPassword,rememberMeCheckbox[_0x2dac8a(0xe0)]=!![]);const loginForm=document[_0x2dac8a(0x14c)](_0x2dac8a(0x1ae)),loginError=document[_0x2dac8a(0x14c)](_0x2dac8a(0xde)),ratesSection=document[_0x2dac8a(0x191)](_0x2dac8a(0x16c)),historySection=document[_0x2dac8a(0x14c)](_0x2dac8a(0x12c)),loginSection=document[_0x2dac8a(0x14c)](_0x2dac8a(0x15c)),messagesSection=document[_0x2dac8a(0x14c)]('messagesSection');loginForm[_0x2dac8a(0xf7)](_0x2dac8a(0x170),async _0x43d315=>{const _0x1e5e0f=_0x2dac8a;_0x43d315[_0x1e5e0f(0xe3)](),showPageLoader();const _0xe351e=usernameInput[_0x1e5e0f(0x177)],_0x3d9172=passwordInput['value'],_0x396f39=getAdminIdFromUrl();if(!_0x396f39){hidePageLoader(),loginError[_0x1e5e0f(0x1b8)]['display']=_0x1e5e0f(0x131),loginError[_0x1e5e0f(0x17c)]=_0x1e5e0f(0x165);return;}if(vendors[_0xe351e]&&vendors[_0xe351e][_0x1e5e0f(0x121)]===_0x3d9172){loginError[_0x1e5e0f(0x1b8)][_0x1e5e0f(0x193)]='none',ratesSection[_0x1e5e0f(0x1b8)][_0x1e5e0f(0x193)]='block',historySection[_0x1e5e0f(0x1b8)][_0x1e5e0f(0x193)]=_0x1e5e0f(0x18e),loginSection[_0x1e5e0f(0x1b8)]['display']='none',messagesSection[_0x1e5e0f(0x1b8)]['display']=_0x1e5e0f(0x131),currentVendorId=_0xe351e;rememberMeCheckbox['checked']?(localStorage[_0x1e5e0f(0x113)]('vendorUsername',_0xe351e),localStorage[_0x1e5e0f(0x113)](_0x1e5e0f(0x105),_0x3d9172),localStorage[_0x1e5e0f(0x113)](_0x1e5e0f(0x198),Date[_0x1e5e0f(0x169)]())):(localStorage[_0x1e5e0f(0xdc)]('vendorUsername'),localStorage['removeItem'](_0x1e5e0f(0x105)),localStorage[_0x1e5e0f(0xdc)](_0x1e5e0f(0x198)));try{await syncTickets(),await loadHistory(),listenForNewMessages(),hidePageLoader();}catch(_0x389098){console[_0x1e5e0f(0x141)](_0x1e5e0f(0x1b6),_0x389098),showNotification(_0x1e5e0f(0x16d),_0x1e5e0f(0x12a)),hidePageLoader();}}else loginError[_0x1e5e0f(0x1b8)][_0x1e5e0f(0x193)]=_0x1e5e0f(0x131),loginError[_0x1e5e0f(0x17c)]='Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.',hidePageLoader();});async function syncTickets(){const _0x2c0687=_0x2dac8a,_0x3ba62e=getAdminIdFromUrl();if(!_0x3ba62e){console[_0x2c0687(0x141)](_0x2c0687(0xe7));return;}try{const _0x58ad72=document['querySelector'](_0x2c0687(0x128)),_0x5c104b=document[_0x2c0687(0x191)]('.rates-section\x20table');_0x58ad72[_0x2c0687(0x1b8)][_0x2c0687(0x193)]=_0x2c0687(0x131),_0x5c104b[_0x2c0687(0x1b8)]['display']=_0x2c0687(0x18e);const _0x2cecee=ref(db,'users-data/'+_0x3ba62e+_0x2c0687(0xfd)),_0x837980=await get(_0x2cecee);_0x837980[_0x2c0687(0x188)]()?(localTickets=_0x837980[_0x2c0687(0x183)](),createTicketTable(),_0x58ad72[_0x2c0687(0x1b8)][_0x2c0687(0x193)]=_0x2c0687(0x18e),_0x5c104b[_0x2c0687(0x1b8)][_0x2c0687(0x193)]=_0x2c0687(0x16e)):_0x58ad72['textContent']='Aucun\x20ticket\x20disponible.';}catch(_0x55fc8e){console[_0x2c0687(0x141)]('Erreur\x20de\x20synchronisation:',_0x55fc8e),loadingMessage[_0x2c0687(0x17c)]='Erreur\x20de\x20synchronisation\x20des\x20tickets.';}}async function createTicketTable(){const _0x2f2e6f=_0x2dac8a,_0x4c7c61=document[_0x2f2e6f(0x191)]('.rates-section\x20table');_0x4c7c61[_0x2f2e6f(0x143)]=_0x2f2e6f(0x179);for(const [_0x44568a,_0x512b3f]of Object[_0x2f2e6f(0x1ac)](localTickets)){const _0x43fa06=_0x512b3f['utilisateur']?_0x512b3f[_0x2f2e6f(0x174)][_0x2f2e6f(0x184)]:0x0;if(_0x43fa06>0x0){const _0x22eafb=_0x512b3f['prix'][0x0],_0x468015=_0x4c7c61[_0x2f2e6f(0xf2)]();_0x468015[_0x2f2e6f(0x143)]=_0x2f2e6f(0x19e)+_0x44568a+_0x2f2e6f(0x10c)+_0x22eafb+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x43fa06+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27'+_0x44568a+_0x2f2e6f(0x136);}}document['querySelector'](_0x2f2e6f(0x128))['style'][_0x2f2e6f(0x193)]=_0x2f2e6f(0x18e),_0x4c7c61['style']['display']=_0x2f2e6f(0x16e);}window[_0x2dac8a(0xf4)]=async function(_0x52c8ef){const _0x212ac0=_0x2dac8a;showLoader();try{const _0x975534=getAdminIdFromUrl();if(!_0x975534){console[_0x212ac0(0x141)](_0x212ac0(0x15a));return;}const _0x471b4a=ref(db,_0x212ac0(0xe6)+_0x975534+_0x212ac0(0x1ba)+_0x52c8ef),_0x41a823=await get(_0x471b4a);if(_0x41a823[_0x212ac0(0x188)]()){const _0x231305=_0x41a823[_0x212ac0(0x183)]();if(!_0x231305[_0x212ac0(0x174)]||_0x231305['utilisateur'][_0x212ac0(0x184)]===0x0)throw new Error(_0x212ac0(0xf1));ticketToSell={'category':_0x52c8ef,'user':_0x231305[_0x212ac0(0x174)][0x0],'password':_0x231305['motDePasse'][0x0],'price':_0x231305['prix'][0x0],'updatedData':{..._0x231305,'utilisateur':_0x231305['utilisateur']['slice'](0x1),'motDePasse':_0x231305[_0x212ac0(0x163)][_0x212ac0(0x13f)](0x1),'prix':_0x231305[_0x212ac0(0x1ab)][_0x212ac0(0x13f)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x1e51df){console[_0x212ac0(0x141)](_0x212ac0(0x138),_0x1e51df),showNotification(_0x212ac0(0x13a),'Impossible\x20de\x20récupérer\x20le\x20ticket'),hideLoader();}};function showConfirmation(_0x374271){const _0x39c6b2=_0x2dac8a,_0x111dce=document['getElementById']('notification'),_0xa0ff0a=document[_0x39c6b2(0x14c)](_0x39c6b2(0x1aa)),_0x25f93d=document['getElementById'](_0x39c6b2(0xeb)),_0x5c4361=document[_0x39c6b2(0x14c)](_0x39c6b2(0x185));document[_0x39c6b2(0x14c)](_0x39c6b2(0x10e))[_0x39c6b2(0x17c)]=_0x39c6b2(0x100),_0xa0ff0a[_0x39c6b2(0x143)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20'+_0x374271[_0x39c6b2(0x1a3)]+_0x39c6b2(0xfe)+_0x374271[_0x39c6b2(0x129)]+_0x39c6b2(0x166),_0x5c4361[_0x39c6b2(0x1b8)][_0x39c6b2(0x193)]='flex',_0x25f93d[_0x39c6b2(0x1b8)][_0x39c6b2(0x193)]=_0x39c6b2(0x18e),_0x111dce['style'][_0x39c6b2(0x193)]=_0x39c6b2(0x131);}function _0xc0de(_0x5db5df,_0x475b80){const _0x2500e1=_0x2500();return _0xc0de=function(_0xc0dedc,_0x127615){_0xc0dedc=_0xc0dedc-0xdb;let _0x17e738=_0x2500e1[_0xc0dedc];return _0x17e738;},_0xc0de(_0x5db5df,_0x475b80);}window[_0x2dac8a(0xfb)]=async function(){const _0x45d485=_0x2dac8a;showLoader();if(!ticketToSell){showNotification('Erreur',_0x45d485(0x194)),hideLoader();return;}const _0x20e660=getAdminIdFromUrl();if(!_0x20e660){console[_0x45d485(0x141)](_0x45d485(0x160)),hideLoader();return;}try{const _0xf2dd2a=ref(db,'users-data/'+_0x20e660+_0x45d485(0x1ba)+ticketToSell[_0x45d485(0x1a3)]);await set(_0xf2dd2a,ticketToSell[_0x45d485(0xe4)]);const _0x3fb9a8=ref(db,_0x45d485(0xe6)+_0x20e660+_0x45d485(0x115));await push(_0x3fb9a8,{'category':ticketToSell[_0x45d485(0x1a3)],'user':ticketToSell[_0x45d485(0x15f)],'password':ticketToSell['password'],'price':ticketToSell['price'],'soldAt':Date[_0x45d485(0x169)](),'vendorId':currentVendorId});const _0x4b02de=ref(db,_0x45d485(0xe6)+_0x20e660+_0x45d485(0x1a6)+currentVendorId);await push(_0x4b02de,{'category':ticketToSell[_0x45d485(0x1a3)],'user':ticketToSell[_0x45d485(0x15f)],'password':ticketToSell[_0x45d485(0x121)],'price':ticketToSell[_0x45d485(0x129)],'soldAt':Date['now']()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x346928){console[_0x45d485(0x141)](_0x45d485(0x18b),_0x346928),showNotification(_0x45d485(0x13a),_0x45d485(0x116)),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x2001b2){const _0x24afaa=_0x2dac8a,_0x5bf82e=document[_0x24afaa(0x14c)](_0x24afaa(0x14a)),_0x54c71c=document[_0x24afaa(0x14c)](_0x24afaa(0x1aa)),_0xf4fc25=document['getElementById'](_0x24afaa(0xeb)),_0x17f455=document[_0x24afaa(0x14c)](_0x24afaa(0x185));document[_0x24afaa(0x14c)](_0x24afaa(0x10e))['textContent']=_0x24afaa(0xe2),_0x54c71c[_0x24afaa(0x143)]=_0x24afaa(0x159)+_0x2001b2[_0x24afaa(0x1a3)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x2001b2[_0x24afaa(0x15f)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20'+_0x2001b2[_0x24afaa(0x121)]+_0x24afaa(0xfe)+_0x2001b2[_0x24afaa(0x129)]+_0x24afaa(0x166),_0x17f455[_0x24afaa(0x1b8)][_0x24afaa(0x193)]=_0x24afaa(0x18e),_0xf4fc25[_0x24afaa(0x1b8)]['display']=_0x24afaa(0x152),_0x5bf82e['style']['display']=_0x24afaa(0x131);}function showSaleConfirmation(_0x43e725){const _0x249ab5=_0x2dac8a,_0x124c5e=document[_0x249ab5(0x14c)](_0x249ab5(0x14a)),_0x312bc7=document[_0x249ab5(0x14c)](_0x249ab5(0x1aa)),_0x11d2a0=document[_0x249ab5(0x14c)]('notification-buttons');_0x312bc7['innerHTML']=_0x249ab5(0x159)+_0x43e725[_0x249ab5(0x1a3)]+_0x249ab5(0xef)+_0x43e725['user']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20'+_0x43e725['password']+_0x249ab5(0xfe)+_0x43e725['price']+_0x249ab5(0x166),_0x11d2a0[_0x249ab5(0x143)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x124c5e[_0x249ab5(0x1b8)][_0x249ab5(0x193)]='block';}window[_0x2dac8a(0x108)]=async function(){const _0x117f67=_0x2dac8a;showLoader();if(!currentReservedTicket){showNotification(_0x117f67(0x13a),'Aucun\x20ticket\x20en\x20cours\x20de\x20vente'),hideLoader();return;}try{const _0x57e35e=getAdminIdFromUrl();if(!_0x57e35e){console[_0x117f67(0x141)](_0x117f67(0xe1)),hideLoader();return;}const _0x1a0c08=ref(db,_0x117f67(0xe6)+_0x57e35e+'/TicketsVendus');await push(_0x1a0c08,{...currentReservedTicket,'soldAt':Date[_0x117f67(0x169)](),'vendorId':currentVendorId});const _0x3dada5=ref(db,'users-data/'+_0x57e35e+_0x117f67(0x1a6)+currentVendorId);await push(_0x3dada5,{...currentReservedTicket,'soldAt':Date[_0x117f67(0x169)]()}),showNotification('Succès',_0x117f67(0x1a0)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x3591b1){console[_0x117f67(0x141)](_0x117f67(0x101),_0x3591b1),showNotification(_0x117f67(0x13a),'Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente'),hideLoader();}},window[_0x2dac8a(0xea)]=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0x25530d,_0x3cd83e){const _0x33dae5=_0x2dac8a,_0x401d60=document[_0x33dae5(0x14c)](_0x33dae5(0x14a)),_0x28e789=document['getElementById'](_0x33dae5(0x10e)),_0x48d71a=document[_0x33dae5(0x14c)](_0x33dae5(0x1aa)),_0x11a059=document[_0x33dae5(0x14c)](_0x33dae5(0x114)),_0x4bbd1f=document['getElementById'](_0x33dae5(0xeb));_0x28e789['textContent']=_0x25530d,_0x48d71a[_0x33dae5(0x143)]=_0x3cd83e,_0x25530d===_0x33dae5(0x156)||_0x25530d===_0x33dae5(0x13a)?(_0x11a059[_0x33dae5(0x1b8)][_0x33dae5(0x193)]=_0x33dae5(0x18e),_0x4bbd1f[_0x33dae5(0x1b8)][_0x33dae5(0x193)]=_0x33dae5(0x18e)):(_0x11a059[_0x33dae5(0x1b8)][_0x33dae5(0x193)]=_0x33dae5(0x152),_0x4bbd1f[_0x33dae5(0x1b8)][_0x33dae5(0x193)]=_0x33dae5(0x18e)),_0x401d60[_0x33dae5(0x1b8)][_0x33dae5(0x193)]='block';}window[_0x2dac8a(0x124)]=function(){const _0x31d023=_0x2dac8a;document[_0x31d023(0x14c)]('notification')['style'][_0x31d023(0x193)]=_0x31d023(0x18e);};async function loadHistory(){const _0x51e1be=_0x2dac8a;showLoader();const _0x4bd374=getAdminIdFromUrl();if(!_0x4bd374){console['error'](_0x51e1be(0x1a4)),hideLoader();return;}try{const _0x8c2c36=ref(db,_0x51e1be(0xe6)+_0x4bd374+'/VendorsHistory/'+currentVendorId),_0x52b314=await get(_0x8c2c36);let _0x40511a=[];_0x52b314['exists']()&&(_0x40511a=Object['entries'](_0x52b314['val']())[_0x51e1be(0x10a)](([_0x1cc2ed,_0x1c8c1a])=>({'id':_0x1cc2ed,..._0x1c8c1a}))),filterHistory(_0x40511a),hideLoader();}catch(_0x5a686b){console[_0x51e1be(0x141)](_0x51e1be(0x1b4),_0x5a686b),showNotification(_0x51e1be(0x13a),_0x51e1be(0x12e)),hideLoader();}}function filterHistory(_0x60d408){const _0x2faa2d=_0x2dac8a,_0x402e64=document['getElementById'](_0x2faa2d(0x147))['value'],_0x3bc90f=new Date(),_0x3d326a={'today':new Date(_0x3bc90f[_0x2faa2d(0x167)](0x0,0x0,0x0,0x0)),'week':new Date(_0x3bc90f['setDate'](_0x3bc90f[_0x2faa2d(0x18c)]()-_0x3bc90f[_0x2faa2d(0x1af)]())),'month':new Date(_0x3bc90f[_0x2faa2d(0x16b)](0x1)),'all':new Date(0x0)};let _0xa095d9=_0x60d408;_0x402e64!==_0x2faa2d(0x164)&&(_0xa095d9=_0x60d408[_0x2faa2d(0x14d)](_0x5aa1a0=>new Date(_0x5aa1a0[_0x2faa2d(0xf5)])>=_0x3d326a[_0x402e64])),updateStats(_0xa095d9),updateHistoryTable(_0xa095d9);}window['filterHistoryByDateRange']=function(){const _0x1fbc30=_0x2dac8a,_0x7520a4=new Date(document[_0x1fbc30(0x14c)]('startDate')[_0x1fbc30(0x177)]),_0x7b1826=new Date(document[_0x1fbc30(0x14c)](_0x1fbc30(0xee))['value']);_0x7b1826[_0x1fbc30(0x167)](0x17,0x3b,0x3b);const _0x2865d2=getAdminIdFromUrl();if(!_0x2865d2){console[_0x1fbc30(0x141)](_0x1fbc30(0x158));return;}if(isNaN(_0x7520a4['getTime']())||isNaN(_0x7b1826['getTime']())){showNotification(_0x1fbc30(0x13a),_0x1fbc30(0xdb));return;}const _0x1061cd=ref(db,_0x1fbc30(0xe6)+_0x2865d2+_0x1fbc30(0x1a6)+currentVendorId);get(_0x1061cd)[_0x1fbc30(0x140)](_0xbab63c=>{const _0x223a15=_0x1fbc30;let _0x391e3c=[];_0xbab63c[_0x223a15(0x188)]()&&(_0x391e3c=Object[_0x223a15(0x1ac)](_0xbab63c[_0x223a15(0x183)]())['map'](([_0xfacb51,_0x456b74])=>({'id':_0xfacb51,..._0x456b74})));const _0x1a646f=_0x391e3c[_0x223a15(0x14d)](_0x4ecc13=>{const _0xfc23e7=new Date(_0x4ecc13['soldAt']);return _0xfc23e7>=_0x7520a4&&_0xfc23e7<=_0x7b1826;});updateStats(_0x1a646f),updateHistoryTable(_0x1a646f);});};function updateStats(_0x24fa45){const _0x560839=_0x2dac8a,_0x14b7a9=_0x24fa45[_0x560839(0x184)],_0x5854b8=_0x24fa45[_0x560839(0x181)]((_0x5493b0,_0x3372f6)=>_0x5493b0+parseFloat(_0x3372f6[_0x560839(0x129)]),0x0),_0xaa96e8=_0x24fa45[_0x560839(0x181)]((_0x2b89ff,_0x4ea485)=>{const _0x211ba5=_0x560839;return _0x2b89ff[_0x4ea485[_0x211ba5(0x1a3)]]=(_0x2b89ff[_0x4ea485[_0x211ba5(0x1a3)]]||0x0)+0x1,_0x2b89ff;},{}),_0x413036=Object[_0x560839(0x1ac)](_0xaa96e8)[_0x560839(0xf3)]((_0x1f524f,_0x1a8042)=>_0x1a8042[0x1]-_0x1f524f[0x1])[0x0]?.[0x0]||'-',_0x33a2b4=_0x24fa45['length']>0x0?Math['max'](0x1,Math[_0x560839(0x153)]((Date[_0x560839(0x169)]()-Math['min'](..._0x24fa45['map'](_0x29000c=>_0x29000c['soldAt'])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x80538a=(_0x14b7a9/_0x33a2b4)[_0x560839(0x11f)](0x1);document['getElementById']('totalTickets')[_0x560839(0x17c)]=_0x14b7a9,document[_0x560839(0x14c)]('totalRevenue')[_0x560839(0x17c)]=_0x5854b8[_0x560839(0xdd)]()+_0x560839(0x117),document[_0x560839(0x14c)](_0x560839(0x139))[_0x560839(0x17c)]=_0x413036,document[_0x560839(0x14c)]('avgDaily')[_0x560839(0x17c)]=_0x80538a;}function updateHistoryTable(_0x9f4dc9){const _0x16ee29=_0x2dac8a,_0x49b42f=document[_0x16ee29(0x14c)](_0x16ee29(0x123));_0x49b42f[_0x16ee29(0x143)]=_0x9f4dc9[_0x16ee29(0xf3)]((_0x3a1095,_0x386cf7)=>_0x386cf7[_0x16ee29(0xf5)]-_0x3a1095['soldAt'])[_0x16ee29(0x10a)](_0x2e57a4=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27'+_0x2e57a4['id']+_0x16ee29(0x148)+new Date(_0x2e57a4['soldAt'])[_0x16ee29(0xdd)]()+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x2e57a4[_0x16ee29(0x1a3)]+_0x16ee29(0x10c)+_0x2e57a4['user']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x2e57a4[_0x16ee29(0x129)]+_0x16ee29(0x16a))[_0x16ee29(0xe8)]('');}window[_0x2dac8a(0x19f)]=async function(_0xe193a){const _0x4f3de1=_0x2dac8a;showLoader();try{const _0x4c3b92=getAdminIdFromUrl();if(!_0x4c3b92){console[_0x4f3de1(0x141)](_0x4f3de1(0x11a)),hideLoader();return;}const _0x24d7a3=ref(db,_0x4f3de1(0xe6)+_0x4c3b92+_0x4f3de1(0x1a6)+currentVendorId+'/'+_0xe193a),_0x4f39b=await get(_0x24d7a3);if(_0x4f39b[_0x4f3de1(0x188)]()){const _0x522f10=_0x4f39b['val']();window[_0x4f3de1(0x145)](),showTicketDetails(_0x522f10),hideLoader();}else showNotification(_0x4f3de1(0x13a),_0x4f3de1(0x126)),hideLoader();}catch(_0x549026){console[_0x4f3de1(0x141)](_0x4f3de1(0x190),_0x549026),showNotification(_0x4f3de1(0x13a),_0x4f3de1(0x192)),hideLoader();}},window[_0x2dac8a(0x106)]=function(){const _0x3eb71b=_0x2dac8a,_0x55df88=document['getElementById'](_0x3eb71b(0x12c)),_0x5b2596=_0x55df88[_0x3eb71b(0x1b8)]['display']==='block';_0x55df88[_0x3eb71b(0x1b8)][_0x3eb71b(0x193)]=_0x5b2596?_0x3eb71b(0x18e):_0x3eb71b(0x131),!_0x5b2596&&loadHistory();},window['closeHistory']=function(){const _0x4ede4a=_0x2dac8a;document['getElementById']('historySection')[_0x4ede4a(0x1b8)][_0x4ede4a(0x193)]=_0x4ede4a(0x18e);},window[_0x2dac8a(0x15d)]=function(){loadHistory();};function _0x2500(){const _0x1fc05c=['904781LnmQLa','createElement','proceedWithSale','writeText','/TicketsTotal','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','catch','Confirmation\x20de\x20vente','Erreur\x20de\x20confirmation:','532344JJhGYJ','active','907290JBmMSS','vendorPassword','toggleHistory','classList','confirmSale','startsWith','map','/messages','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','partnerId','notification-title','/admin/subscription','internal','log','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','setItem','notification-buttons','/TicketsVendus','Impossible\x20de\x20finaliser\x20la\x20vente','\x20FCFA','application/octet-stream','location','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20show\x20ticket\x20details\x20from\x20history.','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','Page\x20','3684110fdsKKC','print','toFixed','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','password','click','historyTableBody','hideNotification','innerText','Ticket\x20introuvable\x20dans\x20l\x27historique','jspdf','.loading-message','price','Une\x20erreur\x20est\x20survenue\x20lors\x20du\x20chargement\x20des\x20données.\x20Veuillez\x20réessayer\x20ou\x20contacter\x20l\x27assistance.','exportToExcelHistory','historySection','Détails\x20du\x20Ticket','Impossible\x20de\x20charger\x20l\x27historique','appendChild','Erreur\x20lors\x20de\x20la\x20copie:','block','left','Database\x20initialized\x20in\x20PageVenteTicket.html','href','contains','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','4rvjDKB','Erreur:','topCategory','Erreur','status','autocompleteSuggestions','447ZePBrM','rememberMe','slice','then','error','input','innerHTML','index.html','closeHistory','historique_ventes.pdf','periodFilter','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','filterHistoryByDateRange','notification','redirectToSubscription','getElementById','filter','Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.','hideSubscriptionRequiredModal','autoTable','keys','flex','ceil','printHistory','shareTicket','Succès','xlsx','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20filter\x20history\x20by\x20date\x20range.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20init\x20ticket\x20sale.','ticket.pdf','loginSection','filterHistory','search','user','Admin\x20ID\x20missing\x20from\x20URL.\x20Cannot\x20proceed\x20with\x20sale.','#historyTableBody','image/png','motDePasse','all','Admin\x20user\x20ID\x20is\x20missing.','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','setHours','getHeight','now','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fas\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','setDate','.rates-section','Erreur\x20d\x27initialisation','table','margin','submit','binary','height','setFontSize','utilisateur','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','settings','value','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20listen\x20for\x20messages.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','save','toDataURL','textContent','grid','add','pageSize','Ventes','reduce','write','val','length','confirmation-buttons','content','width','exists','loaderWrapper','adminId','Erreur\x20lors\x20de\x20la\x20vente:','getDate','scrollHeight','none','exportToPDF','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','querySelector','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','display','Aucun\x20ticket\x20à\x20vendre','jsPDF','center','expired','vendorUsernameTimestamp','Abonnement\x20expiré','10018KNSJQz','toLowerCase','DOMContentLoaded','forEach','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','showTicketDetailsFromHistory','Ticket\x20vendu\x20avec\x20succès!','right','Historique\x20des\x20ventes','category','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20load\x20history.','div','/VendorsHistory/','Aucun\x20vendeur\x20trouvé.','11533356nDQAgR','exportToPDFHistory','notification-message','prix','entries','133xFylsP','loginForm','getDay','username','message','3617432pmUQMH','copyTicket','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','clipboard','Error\x20during\x20initialization\x20after\x20login:','/Vendors/','style','target','/TicketsTotal/','PNG','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.','removeItem','toLocaleString','loginError','timestamp','checked','Admin\x20ID\x20missing\x20from\x20URL.\x20Cannot\x20confirm\x20sale.','Ticket\x20vendu\x20avec\x20succès','preventDefault','updatedData','share','users-data/','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20sync\x20tickets.','join','pageLoaderWrapper','cancelSale','ticket-actions','getNumberOfPages','historique_ventes.xlsx','endDate','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','Plus\x20de\x20tickets\x20disponibles','insertRow','sort','initTicketSale','soldAt','Admin\x20ID\x20is\x20missing\x20from\x20URL.','addEventListener','charCodeAt'];_0x2500=function(){return _0x1fc05c;};return _0x2500();}function listenForNewMessages(){const _0x51c073=_0x2dac8a,_0x217d16=getAdminIdFromUrl();if(!_0x217d16){console[_0x51c073(0x141)](_0x51c073(0x178));return;}const _0x27b530=ref(db,_0x51c073(0xe6)+_0x217d16+_0x51c073(0x1b7)+currentVendorId+_0x51c073(0x10b));onChildAdded(_0x27b530,_0x109dc0=>{const _0x5755e2=_0x51c073,_0x39ec10=_0x109dc0[_0x5755e2(0x183)]();displayNewMessage(_0x39ec10);});}function displayNewMessage(_0x404c47){const _0x74ee21=_0x2dac8a,_0x4d7b48=document[_0x74ee21(0x14c)]('messagesContainer'),_0x35933b=document[_0x74ee21(0xfa)](_0x74ee21(0x1a5));_0x35933b[_0x74ee21(0x107)][_0x74ee21(0x17e)](_0x74ee21(0x1b1)),_0x35933b[_0x74ee21(0x143)]=_0x74ee21(0x112)+_0x404c47[_0x74ee21(0x186)]+_0x74ee21(0x11b)+new Date(_0x404c47[_0x74ee21(0xdf)])[_0x74ee21(0xdd)]()+_0x74ee21(0x175),_0x4d7b48[_0x74ee21(0x12f)](_0x35933b),_0x4d7b48['scrollTop']=_0x4d7b48[_0x74ee21(0x18d)];}window[_0x2dac8a(0x155)]=function(){const _0x505832=_0x2dac8a,_0x2e2fc3=document[_0x505832(0x14c)](_0x505832(0x1aa))[_0x505832(0x125)];navigator[_0x505832(0xe5)]?navigator[_0x505832(0xe5)]({'title':_0x505832(0x12d),'text':_0x2e2fc3})[_0x505832(0x140)](()=>console[_0x505832(0x111)]('Partage\x20réussi'))['catch'](_0xdc0bc1=>console[_0x505832(0x141)]('Erreur\x20lors\x20du\x20partage:',_0xdc0bc1)):alert(_0x505832(0x14e));},window[_0x2dac8a(0x1b3)]=function(){const _0x5ef2fd=_0x2dac8a,_0x2ed44b=document[_0x5ef2fd(0x14c)](_0x5ef2fd(0x1aa))[_0x5ef2fd(0x125)];navigator[_0x5ef2fd(0x1b5)][_0x5ef2fd(0xfc)](_0x2ed44b)[_0x5ef2fd(0x140)](()=>{const _0x390c45=_0x5ef2fd;showNotification(_0x390c45(0x156),_0x390c45(0xf0));})[_0x5ef2fd(0xff)](_0x3c2a14=>{const _0x34f454=_0x5ef2fd;console[_0x34f454(0x141)](_0x34f454(0x130),_0x3c2a14),showNotification(_0x34f454(0x13a),'Impossible\x20de\x20copier\x20le\x20ticket');});},window['exportToPDF']=async function(){const _0x624e2e=_0x2dac8a;showLoader();const _0x4c46ad=document[_0x624e2e(0x14c)]('notification-message'),_0x39a888=new jsPDF(),_0x278fdc=await html2canvas(_0x4c46ad),_0x5abc6f=_0x278fdc[_0x624e2e(0x17b)](_0x624e2e(0x162));_0x39a888['addImage'](_0x5abc6f,_0x624e2e(0x1bb),0xa,0xa,0xbe,0x0),_0x39a888[_0x624e2e(0x17a)](_0x624e2e(0x15b)),hideLoader();},window[_0x2dac8a(0x154)]=function(){const _0x5776ec=_0x2dac8a;window[_0x5776ec(0x11e)]();},window[_0x2dac8a(0x1a9)]=function(){const _0x2efd14=_0x2dac8a,{jsPDF:_0x326270}=window[_0x2efd14(0x127)],_0x57b6b3=new _0x326270(),_0x2280e9=document['getElementById'](_0x2efd14(0x123)),_0x2dabf8={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':'bold','halign':_0x2efd14(0x196)},_0x5af537={'halign':'left'},_0x264a93={'theme':_0x2efd14(0x17d),'headStyles':_0x2dabf8,'bodyStyles':_0x5af537,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0xbbe8f1){const _0x189734=_0x2efd14;_0x57b6b3['text'](_0x189734(0x1a2),0xe,0xf);const _0x7a0a25=_0x189734(0x11c)+_0x57b6b3[_0x189734(0x110)][_0x189734(0xec)]();_0x57b6b3[_0x189734(0x173)](0xa);const _0x566023=_0x57b6b3[_0x189734(0x110)][_0x189734(0x17f)],_0x40a069=_0x566023[_0x189734(0x172)]?_0x566023[_0x189734(0x172)]:_0x566023[_0x189734(0x168)]();_0x57b6b3['text'](_0x7a0a25,_0xbbe8f1['settings']['margin'][_0x189734(0x132)],_0x40a069-0xa),_0x57b6b3['text'](new Date()[_0x189734(0xdd)](),_0x566023[_0x189734(0x187)]-_0xbbe8f1[_0x189734(0x176)][_0x189734(0x16f)][_0x189734(0x1a1)]-0x28,_0x40a069-0xa);}};_0x57b6b3[_0x2efd14(0x150)]({'html':_0x2efd14(0x161),..._0x264a93}),_0x57b6b3['save'](_0x2efd14(0x146));},window['exportToExcelHistory']=function(){const _0x28f062=_0x2dac8a,_0x4768ae=XLSX['utils']['table_to_book'](document[_0x28f062(0x14c)](_0x28f062(0x123)),{'sheet':_0x28f062(0x180)}),_0x14d801=XLSX[_0x28f062(0x182)](_0x4768ae,{'bookType':_0x28f062(0x157),'type':_0x28f062(0x171)});function _0x148d15(_0x534607){const _0xb2ac21=_0x28f062,_0x19898d=new ArrayBuffer(_0x534607[_0xb2ac21(0x184)]),_0x7f64e0=new Uint8Array(_0x19898d);for(let _0x1e116c=0x0;_0x1e116c<_0x534607[_0xb2ac21(0x184)];_0x1e116c++)_0x7f64e0[_0x1e116c]=_0x534607[_0xb2ac21(0xf8)](_0x1e116c)&0xff;return _0x19898d;}saveAs(new Blob([_0x148d15(_0x14d801)],{'type':_0x28f062(0x118)}),_0x28f062(0xed));};function showLoader(){const _0x257463=_0x2dac8a;document[_0x257463(0x14c)](_0x257463(0x189))[_0x257463(0x1b8)][_0x257463(0x193)]=_0x257463(0x131);}function hideLoader(){const _0x333faf=_0x2dac8a;document['getElementById'](_0x333faf(0x189))[_0x333faf(0x1b8)][_0x333faf(0x193)]=_0x333faf(0x18e);}function showPageLoader(){const _0x37aa5f=_0x2dac8a;document['getElementById'](_0x37aa5f(0xe9))[_0x37aa5f(0x1b8)][_0x37aa5f(0x193)]=_0x37aa5f(0x152);}function hidePageLoader(){const _0x31d029=_0x2dac8a;document[_0x31d029(0x14c)](_0x31d029(0xe9))[_0x31d029(0x1b8)][_0x31d029(0x193)]=_0x31d029(0x18e);}function showSubscriptionRequiredModal(){const _0x29b0df=_0x2dac8a;subscriptionRequiredModal[_0x29b0df(0x1b8)][_0x29b0df(0x193)]=_0x29b0df(0x152);}function hideSubscriptionRequiredModal(){const _0x3329eb=_0x2dac8a;subscriptionRequiredModal[_0x3329eb(0x1b8)][_0x3329eb(0x193)]=_0x3329eb(0x18e);}function redirectToSubscription(){const _0xa0939=_0x2dac8a;window['location'][_0xa0939(0x134)]=_0xa0939(0x144);}function getAdminIdFromUrl(){const _0x2bc0df=_0x2dac8a,_0x10a589=new URLSearchParams(window[_0x2bc0df(0x119)][_0x2bc0df(0x15e)]);return _0x10a589['get'](_0x2bc0df(0x18a));}async function checkSubscriptionStatus(){const _0x4661ad=_0x2dac8a,_0x761b17=document[_0x4661ad(0x14c)]('pageLoaderMessage');_0x761b17[_0x4661ad(0x17c)]='Vérification\x20de\x20l\x27abonnement...';const _0x524068=getAdminIdFromUrl();if(!_0x524068)return hidePageLoader(),showSubscriptionRequiredModal(),console['error']('Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Subscription\x20check\x20failed.'),![];try{adminRef=ref(db,_0x4661ad(0xe6)+_0x524068+_0x4661ad(0x10f));const _0x40d5e5=await get(adminRef),_0x4c29ae=_0x40d5e5['val'](),_0x39d979=new Date();if(_0x4c29ae&&_0x4c29ae[_0x4661ad(0x13b)]===_0x4661ad(0x103)){const _0x527115=new Date(_0x4c29ae['endDate']);return _0x527115<_0x39d979?(_0x761b17[_0x4661ad(0x17c)]=_0x4661ad(0x199),hidePageLoader(),showSubscriptionRequiredModal(),await update(adminRef,{'status':_0x4661ad(0x197)}),![]):(_0x761b17['textContent']='Abonnement\x20actif',hidePageLoader(),!![]);}else return _0x761b17[_0x4661ad(0x17c)]='Pas\x20d\x27abonnement\x20actif',hidePageLoader(),showSubscriptionRequiredModal(),![];}catch(_0xee3783){return hidePageLoader(),console[_0x4661ad(0x141)](_0x4661ad(0x120),_0xee3783),_0x761b17[_0x4661ad(0x17c)]='Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement',showNotification(_0x4661ad(0x13a),'Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.'),![];}}document[_0x2dac8a(0xf7)](_0x2dac8a(0x19c),async()=>{const _0x4d80eb=_0x2dac8a;showPageLoader(),await initializeDatabase();const _0x7726ab=getAdminIdFromUrl(),_0x534f6f=new URLSearchParams(window[_0x4d80eb(0x119)][_0x4d80eb(0x15e)])['get'](_0x4d80eb(0x10d));if(!_0x7726ab){hidePageLoader(),loginSection[_0x4d80eb(0x1b8)][_0x4d80eb(0x193)]=_0x4d80eb(0x131);return;}currentUserIdAdmin=_0x7726ab,_0x534f6f&&(currentVendorId=_0x534f6f),await fetchVendors(),rememberMeCheckbox[_0x4d80eb(0xe0)]?usernameInput[_0x4d80eb(0x177)]&&passwordInput[_0x4d80eb(0x177)]?await loginForm['dispatchEvent'](new Event(_0x4d80eb(0x170))):hidePageLoader():hidePageLoader(),document[_0x4d80eb(0x14c)](_0x4d80eb(0x1ae))['addEventListener']('submit',login),ratesSection[_0x4d80eb(0x1b8)][_0x4d80eb(0x193)]===_0x4d80eb(0x131)&&(await syncTickets(),loadHistory(),listenForNewMessages());}),window[_0x2dac8a(0x14b)]=redirectToSubscription,window[_0x2dac8a(0x14f)]=redirectToSubscription,window[_0x2dac8a(0x124)]=hideNotification,window[_0x2dac8a(0xfb)]=proceedWithSale,window[_0x2dac8a(0x108)]=confirmSale,window[_0x2dac8a(0xea)]=cancelSale,window[_0x2dac8a(0x106)]=toggleHistory,window[_0x2dac8a(0x145)]=closeHistory,window['filterHistory']=filterHistory,window[_0x2dac8a(0x149)]=filterHistoryByDateRange,window['shareTicket']=shareTicket,window['copyTicket']=copyTicket,window[_0x2dac8a(0x18f)]=exportToPDF,window[_0x2dac8a(0x1a9)]=exportToPDFHistory,window[_0x2dac8a(0x12b)]=exportToExcelHistory,window[_0x2dac8a(0xf4)]=initTicketSale,window[_0x2dac8a(0x19f)]=showTicketDetailsFromHistory,window[_0x2dac8a(0x15d)]=filterHistory;

</script>
</body>
</html>