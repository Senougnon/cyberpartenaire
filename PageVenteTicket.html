<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* Styles CSS - Copied from previous version - No changes here */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()"><i class="fas fa-times"></i></span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i class="fas fa-share-alt"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i class="fas fa-file-pdf"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i class="fas fa-history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i class="fas fa-print"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i class="fas fa-file-pdf"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x26248e=_0x4266;(function(_0x4c3778,_0x5b5af8){const _0x231574=_0x4266,_0x41ee4b=_0x4c3778();while(!![]){try{const _0x5a3eaf=parseInt(_0x231574(0x211))/0x1*(-parseInt(_0x231574(0x25e))/0x2)+-parseInt(_0x231574(0x1d8))/0x3+parseInt(_0x231574(0x241))/0x4+parseInt(_0x231574(0x1e5))/0x5+-parseInt(_0x231574(0x1e9))/0x6+-parseInt(_0x231574(0x18f))/0x7+parseInt(_0x231574(0x1c2))/0x8;if(_0x5a3eaf===_0x5b5af8)break;else _0x41ee4b['push'](_0x41ee4b['shift']());}catch(_0x8b8d93){_0x41ee4b['push'](_0x41ee4b['shift']());}}}(_0x1bf3,0xa395f));import{getActiveDatabase}from'./firebase-config-manager.js';import{ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';let db,adminRef,currentUserIdAdmin,currentVendorId;function _0x4266(_0x35c1b8,_0x5de609){const _0x1bf3bb=_0x1bf3();return _0x4266=function(_0x4266b9,_0x7ab066){_0x4266b9=_0x4266b9-0x183;let _0x2e85ff=_0x1bf3bb[_0x4266b9];return _0x2e85ff;},_0x4266(_0x35c1b8,_0x5de609);}async function initializeDatabase(){const _0x56ee16=_0x4266;db=await getActiveDatabase(),console['log'](_0x56ee16(0x188));}let ticketToSell=null,localTickets={},currentReservedTicket=null,vendors={},availableUsernames=[];window['jsPDF']=window[_0x26248e(0x184)][_0x26248e(0x25d)];async function fetchVendors(){const _0x40447c=_0x26248e;try{const _0x2658ef=getAdminIdFromUrl();if(!_0x2658ef){console[_0x40447c(0x234)](_0x40447c(0x25b));return;}currentUserIdAdmin=_0x2658ef;const _0x4a1879=ref(db,'users-data/'+_0x2658ef+_0x40447c(0x223)),_0xe4fef9=await get(_0x4a1879);_0xe4fef9[_0x40447c(0x1f1)]()?(vendors=_0xe4fef9['val'](),availableUsernames=Object[_0x40447c(0x1c6)](vendors)):console[_0x40447c(0x21b)]('Aucun\x20vendeur\x20trouvé.');}catch(_0xc82d12){console[_0x40447c(0x234)](_0x40447c(0x1b4),_0xc82d12);}}const usernameInput=document[_0x26248e(0x1d5)](_0x26248e(0x1ab)),passwordInput=document[_0x26248e(0x1d5)](_0x26248e(0x1af)),suggestionsList=document['getElementById'](_0x26248e(0x207));function _0x1bf3(){const _0x22af3a=['catch','vendorUsernameTimestamp','Ticket\x20vendu\x20avec\x20succès','filterHistoryByDateRange','Plus\x20de\x20tickets\x20disponibles','Erreur\x20lors\x20de\x20la\x20copie:','historySection','username','right','add','Erreur','password','soldAt','updatedData','sort','periodFilter','Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:','utilisateur','write','loginError','pageLoaderMessage','getNumberOfPages','Aucun\x20ticket\x20à\x20vendre','notification-title','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','getTime','contains','setHours','users-data/','pageSize','8382048GNmDqx','endDate','Erreur\x20de\x20synchronisation\x20des\x20tickets.','input','keys','category','removeItem','charCodeAt','height','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Ventes','Historique\x20des\x20ventes','confirmSale','dispatchEvent','partnerId','Pas\x20d\x27abonnement\x20actif','Aucun\x20ticket\x20en\x20cours\x20de\x20vente','shareTicket','toLocaleString','getElementById','all','share','95676uFAmXD','forEach','user','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20load\x20history.','showTicketDetailsFromHistory','proceedWithSale','left','Abonnement\x20actif','Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','createElement','checked','Aucun\x20ticket\x20disponible.','1903230jgThge','Ticket\x20vendu\x20avec\x20succès!','Succès','initTicketSale','2763126AiJMpd','toLowerCase','closeHistory','Erreur\x20de\x20confirmation:','click','settings','notification-message','getDay','exists','Abonnement\x20expiré','scrollHeight','Impossible\x20de\x20copier\x20le\x20ticket','message','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','get','hideNotification','block','classList','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Partage\x20réussi','/messages','margin','Admin\x20ID\x20missing\x20from\x20URL.\x20Cannot\x20confirm\x20sale.','historique_ventes.xlsx','location','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20listen\x20for\x20messages.','timestamp','/VendorsHistory/','exportToExcelHistory','autocompleteSuggestions','/TicketsVendus','totalTickets','Admin\x20ID\x20missing\x20from\x20URL.\x20Cannot\x20proceed\x20with\x20sale.','filterHistory','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Subscription\x20check\x20failed.','Impossible\x20de\x20charger\x20l\x27historique','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','price','adminId','1311793aXSvcQ','rememberMe','Page\x20','Erreur:','exportToPDF','setFontSize','avgDaily','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','target','table_to_book','log','table','now','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','confirmation-buttons','notification','loginForm','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','/Vendors','Impossible\x20de\x20finaliser\x20la\x20vente','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fas\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','PNG','style','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20sync\x20tickets.','getHeight','href','flex','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.rates-section\x20table','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','ceil','bold','Impossible\x20de\x20récupérer\x20le\x20ticket','innerText','min','error','internal','val','max','search','cancelSale','slice','save','redirectToSubscription','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20filter\x20history\x20by\x20date\x20range.','vendorPassword','querySelector','loaderWrapper','4887000QRSDjb','motDePasse','/Vendors/','toggleHistory','getItem','length','DOMContentLoaded','copyTicket','then','center','setDate','appendChild','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','notification-buttons','Ticket\x20introuvable\x20dans\x20l\x27historique','pageLoaderWrapper','ticket-actions','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','value','image/png','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','topCategory','toFixed','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20show\x20ticket\x20details\x20from\x20history.','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','Vérification\x20de\x20l\x27abonnement...','Admin\x20ID\x20is\x20missing\x20from\x20URL.','historyTableBody','jsPDF','2RDBETJ','Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente','addImage','exportToPDFHistory','map','width','submit','.rates-section','autoTable','none','jspdf','#historyTableBody','expired','innerHTML','Database\x20initialized\x20in\x20PageVenteTicket.html','preventDefault','Admin\x20ID\x20is\x20missing\x20from\x20URL.\x20Cannot\x20init\x20ticket\x20sale.','setItem','reduce','startDate','addEventListener','1231293glsRCW','.loading-message','textContent','active','div','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.','Erreur\x20lors\x20du\x20partage:','filter','historique_ventes.pdf','display','entries','join','index.html','toDataURL','text','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','Admin\x20user\x20ID\x20is\x20missing.','Confirmation\x20de\x20vente','prix','insertRow','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'];_0x1bf3=function(){return _0x22af3a;};return _0x1bf3();}usernameInput[_0x26248e(0x18e)](_0x26248e(0x1c5),()=>{const _0x31bfdb=_0x26248e,_0x284164=usernameInput[_0x31bfdb(0x253)][_0x31bfdb(0x1ea)](),_0x2e50a7=availableUsernames[_0x31bfdb(0x196)](_0x2bcb3f=>_0x2bcb3f['toLowerCase']()['startsWith'](_0x284164));suggestionsList[_0x31bfdb(0x187)]='';if(_0x284164[_0x31bfdb(0x246)]===0x0||_0x2e50a7[_0x31bfdb(0x246)]===0x0){suggestionsList[_0x31bfdb(0x227)][_0x31bfdb(0x198)]='none';return;}_0x2e50a7[_0x31bfdb(0x1d9)](_0x1df02c=>{const _0x1941dc=_0x31bfdb,_0x173113=document[_0x1941dc(0x1e2)]('li');_0x173113[_0x1941dc(0x191)]=_0x1df02c,_0x173113['addEventListener'](_0x1941dc(0x1ed),()=>{const _0x426a03=_0x1941dc;usernameInput[_0x426a03(0x253)]=_0x1df02c,suggestionsList['innerHTML']='',suggestionsList[_0x426a03(0x227)]['display']=_0x426a03(0x183);}),suggestionsList[_0x1941dc(0x24c)](_0x173113);}),suggestionsList[_0x31bfdb(0x227)]['display']=_0x31bfdb(0x1fa);}),document['addEventListener']('click',_0xa9e93e=>{const _0x53e2f8=_0x26248e;!usernameInput[_0x53e2f8(0x1be)](_0xa9e93e[_0x53e2f8(0x219)])&&!suggestionsList['contains'](_0xa9e93e[_0x53e2f8(0x219)])&&(suggestionsList['style'][_0x53e2f8(0x198)]=_0x53e2f8(0x183));});const rememberMeCheckbox=document[_0x26248e(0x1d5)](_0x26248e(0x212)),storedUsername=localStorage[_0x26248e(0x245)]('vendorUsername'),storedPassword=localStorage[_0x26248e(0x245)](_0x26248e(0x23e)),storedTimestamp=localStorage[_0x26248e(0x245)](_0x26248e(0x1a5)),now=Date['now'](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0x26248e(0x253)]=storedUsername,passwordInput[_0x26248e(0x253)]=storedPassword,rememberMeCheckbox['checked']=!![]);const loginForm=document[_0x26248e(0x1d5)](_0x26248e(0x221)),loginError=document[_0x26248e(0x1d5)](_0x26248e(0x1b7)),ratesSection=document[_0x26248e(0x23f)](_0x26248e(0x265)),historySection=document['getElementById'](_0x26248e(0x1aa)),loginSection=document[_0x26248e(0x1d5)]('loginSection'),messagesSection=document[_0x26248e(0x1d5)]('messagesSection');loginForm['addEventListener']('submit',async _0x2f3d39=>{const _0x5c28ef=_0x26248e;_0x2f3d39[_0x5c28ef(0x189)](),showLoader();const _0x1792b2=usernameInput[_0x5c28ef(0x253)],_0x231068=passwordInput[_0x5c28ef(0x253)],_0x428e74=getAdminIdFromUrl();if(!_0x428e74){hideLoader(),loginError[_0x5c28ef(0x227)][_0x5c28ef(0x198)]=_0x5c28ef(0x1fa),loginError[_0x5c28ef(0x191)]=_0x5c28ef(0x19f);return;}vendors[_0x1792b2]&&vendors[_0x1792b2]['password']===_0x231068?(loginError[_0x5c28ef(0x227)]['display']=_0x5c28ef(0x183),ratesSection[_0x5c28ef(0x227)]['display']=_0x5c28ef(0x1fa),historySection['style'][_0x5c28ef(0x198)]='none',loginSection['style']['display']='none',messagesSection['style'][_0x5c28ef(0x198)]=_0x5c28ef(0x1fa),currentVendorId=_0x1792b2,rememberMeCheckbox[_0x5c28ef(0x1e3)]?(localStorage[_0x5c28ef(0x18b)]('vendorUsername',_0x1792b2),localStorage[_0x5c28ef(0x18b)](_0x5c28ef(0x23e),_0x231068),localStorage[_0x5c28ef(0x18b)](_0x5c28ef(0x1a5),Date[_0x5c28ef(0x21d)]())):(localStorage[_0x5c28ef(0x1c8)]('vendorUsername'),localStorage[_0x5c28ef(0x1c8)](_0x5c28ef(0x23e)),localStorage[_0x5c28ef(0x1c8)](_0x5c28ef(0x1a5))),await syncTickets(),loadHistory(),listenForNewMessages(),hideLoader()):(loginError[_0x5c28ef(0x227)][_0x5c28ef(0x198)]=_0x5c28ef(0x1fa),loginError['textContent']=_0x5c28ef(0x1e0),hideLoader());});async function syncTickets(){const _0x42e577=_0x26248e,_0x4e79de=getAdminIdFromUrl();if(!_0x4e79de){console[_0x42e577(0x234)](_0x42e577(0x228));return;}try{const _0x343f41=document[_0x42e577(0x23f)](_0x42e577(0x190)),_0x30c816=document[_0x42e577(0x23f)]('.rates-section\x20table');_0x343f41[_0x42e577(0x227)][_0x42e577(0x198)]=_0x42e577(0x1fa),_0x30c816[_0x42e577(0x227)][_0x42e577(0x198)]='none';const _0x21a988=ref(db,_0x42e577(0x1c0)+_0x4e79de+'/TicketsTotal'),_0x180dac=await get(_0x21a988);_0x180dac[_0x42e577(0x1f1)]()?(localTickets=_0x180dac[_0x42e577(0x236)](),createTicketTable(),_0x343f41[_0x42e577(0x227)][_0x42e577(0x198)]=_0x42e577(0x183),_0x30c816[_0x42e577(0x227)][_0x42e577(0x198)]='table'):_0x343f41[_0x42e577(0x191)]=_0x42e577(0x1e4);}catch(_0x129881){console['error']('Erreur\x20de\x20synchronisation:',_0x129881),loadingMessage['textContent']=_0x42e577(0x1c4);}}async function createTicketTable(){const _0x48aae6=_0x26248e,_0xe6eb6e=document['querySelector'](_0x48aae6(0x22d));_0xe6eb6e[_0x48aae6(0x187)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';for(const [_0x21de66,_0x191fb7]of Object[_0x48aae6(0x199)](localTickets)){const _0x22d395=_0x191fb7[_0x48aae6(0x1b5)]?_0x191fb7[_0x48aae6(0x1b5)][_0x48aae6(0x246)]:0x0;if(_0x22d395>0x0){const _0x17e679=_0x191fb7['prix'][0x0],_0x131c53=_0xe6eb6e[_0x48aae6(0x1a2)]();_0x131c53[_0x48aae6(0x187)]=_0x48aae6(0x1cb)+_0x21de66+_0x48aae6(0x1fc)+_0x17e679+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x22d395+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27'+_0x21de66+_0x48aae6(0x1a3);}}document['querySelector'](_0x48aae6(0x190))[_0x48aae6(0x227)]['display']=_0x48aae6(0x183),_0xe6eb6e[_0x48aae6(0x227)][_0x48aae6(0x198)]=_0x48aae6(0x21c);}window['initTicketSale']=async function(_0x978cda){const _0x476fa7=_0x26248e;showLoader();try{const _0x5053a0=getAdminIdFromUrl();if(!_0x5053a0){console[_0x476fa7(0x234)](_0x476fa7(0x18a));return;}const _0x36529f=ref(db,_0x476fa7(0x1c0)+_0x5053a0+'/TicketsTotal/'+_0x978cda),_0x1e1dfa=await get(_0x36529f);if(_0x1e1dfa[_0x476fa7(0x1f1)]()){const _0x5da496=_0x1e1dfa[_0x476fa7(0x236)]();if(!_0x5da496['utilisateur']||_0x5da496['utilisateur']['length']===0x0)throw new Error(_0x476fa7(0x1a8));ticketToSell={'category':_0x978cda,'user':_0x5da496[_0x476fa7(0x1b5)][0x0],'password':_0x5da496[_0x476fa7(0x242)][0x0],'price':_0x5da496[_0x476fa7(0x1a1)][0x0],'updatedData':{..._0x5da496,'utilisateur':_0x5da496['utilisateur'][_0x476fa7(0x23a)](0x1),'motDePasse':_0x5da496[_0x476fa7(0x242)]['slice'](0x1),'prix':_0x5da496['prix'][_0x476fa7(0x23a)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x34da21){console[_0x476fa7(0x234)](_0x476fa7(0x214),_0x34da21),showNotification(_0x476fa7(0x1ae),_0x476fa7(0x231)),hideLoader();}};function showConfirmation(_0x47e084){const _0x5b4c0e=_0x26248e,_0x1255e6=document[_0x5b4c0e(0x1d5)]('notification'),_0x54de0a=document[_0x5b4c0e(0x1d5)](_0x5b4c0e(0x1ef)),_0x426de9=document['getElementById'](_0x5b4c0e(0x251)),_0x30d18f=document['getElementById'](_0x5b4c0e(0x21f));document['getElementById'](_0x5b4c0e(0x1bb))[_0x5b4c0e(0x191)]=_0x5b4c0e(0x1a0),_0x54de0a[_0x5b4c0e(0x187)]=_0x5b4c0e(0x22e)+_0x47e084[_0x5b4c0e(0x1c7)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x47e084[_0x5b4c0e(0x20f)]+_0x5b4c0e(0x22c),_0x30d18f['style'][_0x5b4c0e(0x198)]=_0x5b4c0e(0x22b),_0x426de9[_0x5b4c0e(0x227)]['display']=_0x5b4c0e(0x183),_0x1255e6[_0x5b4c0e(0x227)][_0x5b4c0e(0x198)]='block';}window[_0x26248e(0x1dd)]=async function(){const _0x1cf44b=_0x26248e;showLoader();if(!ticketToSell){showNotification('Erreur',_0x1cf44b(0x1ba)),hideLoader();return;}const _0xc63c20=getAdminIdFromUrl();if(!_0xc63c20){console[_0x1cf44b(0x234)](_0x1cf44b(0x20a)),hideLoader();return;}try{const _0x224c6e=ref(db,_0x1cf44b(0x1c0)+_0xc63c20+'/TicketsTotal/'+ticketToSell[_0x1cf44b(0x1c7)]);await set(_0x224c6e,ticketToSell[_0x1cf44b(0x1b1)]);const _0x125049=ref(db,'users-data/'+_0xc63c20+_0x1cf44b(0x208));await push(_0x125049,{'category':ticketToSell[_0x1cf44b(0x1c7)],'user':ticketToSell[_0x1cf44b(0x1da)],'password':ticketToSell['password'],'price':ticketToSell[_0x1cf44b(0x20f)],'soldAt':Date[_0x1cf44b(0x21d)](),'vendorId':currentVendorId});const _0x3faf56=ref(db,_0x1cf44b(0x1c0)+_0xc63c20+_0x1cf44b(0x205)+currentVendorId);await push(_0x3faf56,{'category':ticketToSell[_0x1cf44b(0x1c7)],'user':ticketToSell[_0x1cf44b(0x1da)],'password':ticketToSell['password'],'price':ticketToSell[_0x1cf44b(0x20f)],'soldAt':Date[_0x1cf44b(0x21d)]()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x2c6ad8){console[_0x1cf44b(0x234)]('Erreur\x20lors\x20de\x20la\x20vente:',_0x2c6ad8),showNotification('Erreur',_0x1cf44b(0x224)),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x5f3dcd){const _0x2d0dc4=_0x26248e,_0x2b0e28=document[_0x2d0dc4(0x1d5)](_0x2d0dc4(0x220)),_0x15889a=document[_0x2d0dc4(0x1d5)](_0x2d0dc4(0x1ef)),_0x51871d=document['getElementById'](_0x2d0dc4(0x251)),_0x3ced1c=document[_0x2d0dc4(0x1d5)](_0x2d0dc4(0x21f));document[_0x2d0dc4(0x1d5)](_0x2d0dc4(0x1bb))[_0x2d0dc4(0x191)]=_0x2d0dc4(0x1a6),_0x15889a[_0x2d0dc4(0x187)]=_0x2d0dc4(0x1e1)+_0x5f3dcd['category']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x5f3dcd[_0x2d0dc4(0x1da)]+_0x2d0dc4(0x255)+_0x5f3dcd[_0x2d0dc4(0x1af)]+_0x2d0dc4(0x252)+_0x5f3dcd[_0x2d0dc4(0x20f)]+_0x2d0dc4(0x22c),_0x3ced1c['style'][_0x2d0dc4(0x198)]=_0x2d0dc4(0x183),_0x51871d[_0x2d0dc4(0x227)][_0x2d0dc4(0x198)]='flex',_0x2b0e28['style'][_0x2d0dc4(0x198)]='block';}function showSaleConfirmation(_0x5d5e8e){const _0x3e468e=_0x26248e,_0xefabf5=document[_0x3e468e(0x1d5)](_0x3e468e(0x220)),_0x515fb0=document[_0x3e468e(0x1d5)](_0x3e468e(0x1ef)),_0x5073a9=document[_0x3e468e(0x1d5)](_0x3e468e(0x24e));_0x515fb0[_0x3e468e(0x187)]=_0x3e468e(0x1e1)+_0x5d5e8e[_0x3e468e(0x1c7)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x5d5e8e[_0x3e468e(0x1da)]+_0x3e468e(0x255)+_0x5d5e8e[_0x3e468e(0x1af)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x5d5e8e[_0x3e468e(0x20f)]+_0x3e468e(0x22c),_0x5073a9[_0x3e468e(0x187)]=_0x3e468e(0x1f6),_0xefabf5[_0x3e468e(0x227)]['display']='block';}window[_0x26248e(0x1ce)]=async function(){const _0x2514ca=_0x26248e;showLoader();if(!currentReservedTicket){showNotification(_0x2514ca(0x1ae),_0x2514ca(0x1d2)),hideLoader();return;}try{const _0x246390=getAdminIdFromUrl();if(!_0x246390){console['error'](_0x2514ca(0x200)),hideLoader();return;}const _0xb88b96=ref(db,_0x2514ca(0x1c0)+_0x246390+_0x2514ca(0x208));await push(_0xb88b96,{...currentReservedTicket,'soldAt':Date[_0x2514ca(0x21d)](),'vendorId':currentVendorId});const _0x1ec691=ref(db,_0x2514ca(0x1c0)+_0x246390+_0x2514ca(0x205)+currentVendorId);await push(_0x1ec691,{...currentReservedTicket,'soldAt':Date[_0x2514ca(0x21d)]()}),showNotification('Succès',_0x2514ca(0x1e6)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x160eff){console[_0x2514ca(0x234)](_0x2514ca(0x1ec),_0x160eff),showNotification(_0x2514ca(0x1ae),_0x2514ca(0x25f)),hideLoader();}},window[_0x26248e(0x239)]=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0x79a7f9,_0x13c020){const _0x593e2b=_0x26248e,_0x1d877e=document[_0x593e2b(0x1d5)](_0x593e2b(0x220)),_0x141e26=document['getElementById'](_0x593e2b(0x1bb)),_0x3462c7=document[_0x593e2b(0x1d5)](_0x593e2b(0x1ef)),_0x28df31=document['getElementById']('notification-buttons'),_0x37ad80=document[_0x593e2b(0x1d5)](_0x593e2b(0x251));_0x141e26['textContent']=_0x79a7f9,_0x3462c7['innerHTML']=_0x13c020,_0x79a7f9===_0x593e2b(0x1e7)||_0x79a7f9==='Erreur'?(_0x28df31[_0x593e2b(0x227)][_0x593e2b(0x198)]=_0x593e2b(0x183),_0x37ad80['style'][_0x593e2b(0x198)]=_0x593e2b(0x183)):(_0x28df31['style']['display']=_0x593e2b(0x22b),_0x37ad80['style'][_0x593e2b(0x198)]=_0x593e2b(0x183)),_0x1d877e['style'][_0x593e2b(0x198)]='block';}window[_0x26248e(0x1f9)]=function(){const _0x45f2d5=_0x26248e;document[_0x45f2d5(0x1d5)](_0x45f2d5(0x220))[_0x45f2d5(0x227)][_0x45f2d5(0x198)]=_0x45f2d5(0x183);};async function loadHistory(){const _0x4c56cd=_0x26248e;showLoader();const _0x4b6e4a=getAdminIdFromUrl();if(!_0x4b6e4a){console[_0x4c56cd(0x234)](_0x4c56cd(0x1db)),hideLoader();return;}try{const _0x1f6897=ref(db,_0x4c56cd(0x1c0)+_0x4b6e4a+_0x4c56cd(0x205)+currentVendorId),_0x3a070e=await get(_0x1f6897);let _0x1233be=[];_0x3a070e[_0x4c56cd(0x1f1)]()&&(_0x1233be=Object[_0x4c56cd(0x199)](_0x3a070e[_0x4c56cd(0x236)]())[_0x4c56cd(0x262)](([_0x5a12e8,_0x52136b])=>({'id':_0x5a12e8,..._0x52136b}))),filterHistory(_0x1233be),hideLoader();}catch(_0x15bf14){console[_0x4c56cd(0x234)]('Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:',_0x15bf14),showNotification('Erreur',_0x4c56cd(0x20d)),hideLoader();}}function filterHistory(_0x5d7ab6){const _0x5838ef=_0x26248e,_0xf1f47f=document[_0x5838ef(0x1d5)](_0x5838ef(0x1b3))[_0x5838ef(0x253)],_0x566385=new Date(),_0x3c4b01={'today':new Date(_0x566385['setHours'](0x0,0x0,0x0,0x0)),'week':new Date(_0x566385[_0x5838ef(0x24b)](_0x566385['getDate']()-_0x566385[_0x5838ef(0x1f0)]())),'month':new Date(_0x566385[_0x5838ef(0x24b)](0x1)),'all':new Date(0x0)};let _0x2dc507=_0x5d7ab6;_0xf1f47f!==_0x5838ef(0x1d6)&&(_0x2dc507=_0x5d7ab6[_0x5838ef(0x196)](_0x384a56=>new Date(_0x384a56[_0x5838ef(0x1b0)])>=_0x3c4b01[_0xf1f47f])),updateStats(_0x2dc507),updateHistoryTable(_0x2dc507);}window[_0x26248e(0x1a7)]=function(){const _0x1c28a6=_0x26248e,_0x34bd0b=new Date(document[_0x1c28a6(0x1d5)](_0x1c28a6(0x18d))[_0x1c28a6(0x253)]),_0x3104e2=new Date(document[_0x1c28a6(0x1d5)](_0x1c28a6(0x1c3))[_0x1c28a6(0x253)]);_0x3104e2[_0x1c28a6(0x1bf)](0x17,0x3b,0x3b);const _0x1613ac=getAdminIdFromUrl();if(!_0x1613ac){console['error'](_0x1c28a6(0x23d));return;}if(isNaN(_0x34bd0b[_0x1c28a6(0x1bd)]())||isNaN(_0x3104e2['getTime']())){showNotification(_0x1c28a6(0x1ae),_0x1c28a6(0x194));return;}const _0xa6263c=ref(db,_0x1c28a6(0x1c0)+_0x1613ac+'/VendorsHistory/'+currentVendorId);get(_0xa6263c)['then'](_0x1a3655=>{const _0x1b2118=_0x1c28a6;let _0x4245a3=[];_0x1a3655[_0x1b2118(0x1f1)]()&&(_0x4245a3=Object[_0x1b2118(0x199)](_0x1a3655[_0x1b2118(0x236)]())[_0x1b2118(0x262)](([_0x530aba,_0x233b3a])=>({'id':_0x530aba,..._0x233b3a})));const _0x3df8db=_0x4245a3[_0x1b2118(0x196)](_0xe4ab9b=>{const _0x5289cf=_0x1b2118,_0x4e2684=new Date(_0xe4ab9b[_0x5289cf(0x1b0)]);return _0x4e2684>=_0x34bd0b&&_0x4e2684<=_0x3104e2;});updateStats(_0x3df8db),updateHistoryTable(_0x3df8db);});};function updateStats(_0x3f11ff){const _0x47d6c4=_0x26248e,_0x1db27a=_0x3f11ff['length'],_0x3f946e=_0x3f11ff[_0x47d6c4(0x18c)]((_0x28c3ab,_0x258f98)=>_0x28c3ab+parseFloat(_0x258f98['price']),0x0),_0x1008de=_0x3f11ff['reduce']((_0x41b45b,_0x12da17)=>{const _0x1939e2=_0x47d6c4;return _0x41b45b[_0x12da17[_0x1939e2(0x1c7)]]=(_0x41b45b[_0x12da17[_0x1939e2(0x1c7)]]||0x0)+0x1,_0x41b45b;},{}),_0x16d199=Object[_0x47d6c4(0x199)](_0x1008de)[_0x47d6c4(0x1b2)]((_0x14b3a7,_0x4a7abf)=>_0x4a7abf[0x1]-_0x14b3a7[0x1])[0x0]?.[0x0]||'-',_0x321d11=_0x3f11ff[_0x47d6c4(0x246)]>0x0?Math[_0x47d6c4(0x237)](0x1,Math[_0x47d6c4(0x22f)]((Date[_0x47d6c4(0x21d)]()-Math[_0x47d6c4(0x233)](..._0x3f11ff['map'](_0xf72a4d=>_0xf72a4d[_0x47d6c4(0x1b0)])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x387559=(_0x1db27a/_0x321d11)[_0x47d6c4(0x257)](0x1);document[_0x47d6c4(0x1d5)](_0x47d6c4(0x209))[_0x47d6c4(0x191)]=_0x1db27a,document[_0x47d6c4(0x1d5)]('totalRevenue')['textContent']=_0x3f946e['toLocaleString']()+'\x20FCFA',document['getElementById'](_0x47d6c4(0x256))['textContent']=_0x16d199,document[_0x47d6c4(0x1d5)](_0x47d6c4(0x217))[_0x47d6c4(0x191)]=_0x387559;}function updateHistoryTable(_0xf5f4f1){const _0x134713=_0x26248e,_0x55bc0c=document[_0x134713(0x1d5)]('historyTableBody');_0x55bc0c[_0x134713(0x187)]=_0xf5f4f1[_0x134713(0x1b2)]((_0x11884e,_0x4383e2)=>_0x4383e2['soldAt']-_0x11884e[_0x134713(0x1b0)])['map'](_0x46c35a=>_0x134713(0x218)+_0x46c35a['id']+_0x134713(0x24d)+new Date(_0x46c35a['soldAt'])['toLocaleString']()+_0x134713(0x1fc)+_0x46c35a['category']+_0x134713(0x1fc)+_0x46c35a[_0x134713(0x1da)]+_0x134713(0x1fc)+_0x46c35a[_0x134713(0x20f)]+_0x134713(0x225))[_0x134713(0x19a)]('');}window[_0x26248e(0x1dc)]=async function(_0x867285){const _0x3e659e=_0x26248e;showLoader();try{const _0x5859fb=getAdminIdFromUrl();if(!_0x5859fb){console['error'](_0x3e659e(0x258)),hideLoader();return;}const _0x838c7e=ref(db,_0x3e659e(0x1c0)+_0x5859fb+'/VendorsHistory/'+currentVendorId+'/'+_0x867285),_0x38668a=await get(_0x838c7e);if(_0x38668a[_0x3e659e(0x1f1)]()){const _0x5baacc=_0x38668a[_0x3e659e(0x236)]();window[_0x3e659e(0x1eb)](),showTicketDetails(_0x5baacc),hideLoader();}else showNotification(_0x3e659e(0x1ae),_0x3e659e(0x24f)),hideLoader();}catch(_0x3512c0){console[_0x3e659e(0x234)](_0x3e659e(0x20e),_0x3512c0),showNotification(_0x3e659e(0x1ae),_0x3e659e(0x1bc)),hideLoader();}},window[_0x26248e(0x244)]=function(){const _0x52f117=_0x26248e,_0x1651f7=document['getElementById'](_0x52f117(0x1aa)),_0x450ece=_0x1651f7[_0x52f117(0x227)][_0x52f117(0x198)]===_0x52f117(0x1fa);_0x1651f7[_0x52f117(0x227)][_0x52f117(0x198)]=_0x450ece?_0x52f117(0x183):_0x52f117(0x1fa),!_0x450ece&&loadHistory();},window[_0x26248e(0x1eb)]=function(){const _0x5c9103=_0x26248e;document[_0x5c9103(0x1d5)]('historySection')[_0x5c9103(0x227)][_0x5c9103(0x198)]=_0x5c9103(0x183);},window[_0x26248e(0x20b)]=function(){loadHistory();};function listenForNewMessages(){const _0x2c9a3e=_0x26248e,_0x599ba5=getAdminIdFromUrl();if(!_0x599ba5){console[_0x2c9a3e(0x234)](_0x2c9a3e(0x203));return;}const _0x5b262c=ref(db,_0x2c9a3e(0x1c0)+_0x599ba5+_0x2c9a3e(0x243)+currentVendorId+_0x2c9a3e(0x1fe));onChildAdded(_0x5b262c,_0x2a963d=>{const _0x20ba71=_0x2c9a3e,_0x5f1a1a=_0x2a963d[_0x20ba71(0x236)]();displayNewMessage(_0x5f1a1a);});}function displayNewMessage(_0x1776b2){const _0x186d6f=_0x26248e,_0xde2932=document['getElementById']('messagesContainer'),_0x226070=document[_0x186d6f(0x1e2)](_0x186d6f(0x193));_0x226070[_0x186d6f(0x1fb)][_0x186d6f(0x1ad)](_0x186d6f(0x1f5)),_0x226070['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x1776b2['content']+_0x186d6f(0x222)+new Date(_0x1776b2[_0x186d6f(0x204)])[_0x186d6f(0x1d4)]()+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xde2932[_0x186d6f(0x24c)](_0x226070),_0xde2932['scrollTop']=_0xde2932[_0x186d6f(0x1f3)];}window[_0x26248e(0x1d3)]=function(){const _0x1a78d8=_0x26248e,_0x51fa70=document['getElementById'](_0x1a78d8(0x1ef))[_0x1a78d8(0x232)];navigator[_0x1a78d8(0x1d7)]?navigator[_0x1a78d8(0x1d7)]({'title':'Détails\x20du\x20Ticket','text':_0x51fa70})[_0x1a78d8(0x249)](()=>console[_0x1a78d8(0x21b)](_0x1a78d8(0x1fd)))['catch'](_0x4fde18=>console['error'](_0x1a78d8(0x195),_0x4fde18)):alert('Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.');},window[_0x26248e(0x248)]=function(){const _0x592bf7=_0x26248e,_0x2e24e1=document[_0x592bf7(0x1d5)](_0x592bf7(0x1ef))[_0x592bf7(0x232)];navigator['clipboard']['writeText'](_0x2e24e1)[_0x592bf7(0x249)](()=>{const _0xb43968=_0x592bf7;showNotification('Succès',_0xb43968(0x19e));})[_0x592bf7(0x1a4)](_0x9a7fec=>{const _0x5a4056=_0x592bf7;console[_0x5a4056(0x234)](_0x5a4056(0x1a9),_0x9a7fec),showNotification(_0x5a4056(0x1ae),_0x5a4056(0x1f4));});},window[_0x26248e(0x215)]=async function(){const _0x460eae=_0x26248e;showLoader();const _0x56042d=document['getElementById']('notification-message'),_0x317dfe=new jsPDF(),_0x527f22=await html2canvas(_0x56042d),_0x46a49b=_0x527f22[_0x460eae(0x19c)](_0x460eae(0x254));_0x317dfe[_0x460eae(0x260)](_0x46a49b,_0x460eae(0x226),0xa,0xa,0xbe,0x0),_0x317dfe[_0x460eae(0x23b)]('ticket.pdf'),hideLoader();},window['printHistory']=function(){window['print']();},window[_0x26248e(0x261)]=function(){const _0x1c7781=_0x26248e,{jsPDF:_0x4c9607}=window[_0x1c7781(0x184)],_0x26cdc4=new _0x4c9607(),_0x199f4b=document[_0x1c7781(0x1d5)](_0x1c7781(0x25c)),_0x2b39c7={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x1c7781(0x230),'halign':_0x1c7781(0x24a)},_0x3750c8={'halign':_0x1c7781(0x1de)},_0x3b96cc={'theme':'grid','headStyles':_0x2b39c7,'bodyStyles':_0x3750c8,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x8939e2){const _0xa935c=_0x1c7781;_0x26cdc4[_0xa935c(0x19d)](_0xa935c(0x1cd),0xe,0xf);const _0x26fbb6=_0xa935c(0x213)+_0x26cdc4[_0xa935c(0x235)][_0xa935c(0x1b9)]();_0x26cdc4[_0xa935c(0x216)](0xa);const _0x2638cf=_0x26cdc4[_0xa935c(0x235)][_0xa935c(0x1c1)],_0x4ebd58=_0x2638cf['height']?_0x2638cf[_0xa935c(0x1ca)]:_0x2638cf[_0xa935c(0x229)]();_0x26cdc4[_0xa935c(0x19d)](_0x26fbb6,_0x8939e2['settings'][_0xa935c(0x1ff)]['left'],_0x4ebd58-0xa),_0x26cdc4[_0xa935c(0x19d)](new Date()[_0xa935c(0x1d4)](),_0x2638cf[_0xa935c(0x263)]-_0x8939e2[_0xa935c(0x1ee)][_0xa935c(0x1ff)][_0xa935c(0x1ac)]-0x28,_0x4ebd58-0xa);}};_0x26cdc4[_0x1c7781(0x266)]({'html':_0x1c7781(0x185),..._0x3b96cc}),_0x26cdc4['save'](_0x1c7781(0x197));},window[_0x26248e(0x206)]=function(){const _0x490a91=_0x26248e,_0x3e1a6f=XLSX['utils'][_0x490a91(0x21a)](document[_0x490a91(0x1d5)](_0x490a91(0x25c)),{'sheet':_0x490a91(0x1cc)}),_0x53db1c=XLSX[_0x490a91(0x1b6)](_0x3e1a6f,{'bookType':'xlsx','type':'binary'});function _0x32fd4b(_0x829911){const _0x26bb34=_0x490a91,_0x2159c5=new ArrayBuffer(_0x829911[_0x26bb34(0x246)]),_0x318586=new Uint8Array(_0x2159c5);for(let _0x372c86=0x0;_0x372c86<_0x829911[_0x26bb34(0x246)];_0x372c86++)_0x318586[_0x372c86]=_0x829911[_0x26bb34(0x1c9)](_0x372c86)&0xff;return _0x2159c5;}saveAs(new Blob([_0x32fd4b(_0x53db1c)],{'type':'application/octet-stream'}),_0x490a91(0x201));};function showLoader(){const _0x1d3585=_0x26248e;document['getElementById'](_0x1d3585(0x240))[_0x1d3585(0x227)][_0x1d3585(0x198)]=_0x1d3585(0x1fa);}function hideLoader(){const _0x421b85=_0x26248e;document['getElementById'](_0x421b85(0x240))[_0x421b85(0x227)][_0x421b85(0x198)]=_0x421b85(0x183);}function showPageLoader(){const _0x172d89=_0x26248e;document['getElementById']('pageLoaderWrapper')['style'][_0x172d89(0x198)]='flex';}function hidePageLoader(){const _0x3df3cb=_0x26248e;document['getElementById'](_0x3df3cb(0x250))[_0x3df3cb(0x227)][_0x3df3cb(0x198)]=_0x3df3cb(0x183);}function showSubscriptionRequiredModal(){const _0x3f0b68=_0x26248e;subscriptionRequiredModal[_0x3f0b68(0x227)]['display']=_0x3f0b68(0x22b);}function hideSubscriptionRequiredModal(){const _0x1bbec6=_0x26248e;subscriptionRequiredModal[_0x1bbec6(0x227)][_0x1bbec6(0x198)]='none';}function redirectToSubscription(){const _0x4087b7=_0x26248e;window[_0x4087b7(0x202)][_0x4087b7(0x22a)]=_0x4087b7(0x19b);}function getAdminIdFromUrl(){const _0x171f54=_0x26248e,_0x19a84d=new URLSearchParams(window[_0x171f54(0x202)]['search']);return _0x19a84d[_0x171f54(0x1f8)](_0x171f54(0x210));}async function checkSubscriptionStatus(){const _0x189c69=_0x26248e,_0x370343=document[_0x189c69(0x1d5)](_0x189c69(0x1b8));_0x370343[_0x189c69(0x191)]=_0x189c69(0x25a);const _0x40b0b2=getAdminIdFromUrl();if(!_0x40b0b2)return hidePageLoader(),showSubscriptionRequiredModal(),console['error'](_0x189c69(0x20c)),![];try{adminRef=ref(db,_0x189c69(0x1c0)+_0x40b0b2+'/admin/subscription');const _0x269d3e=await get(adminRef),_0x41496d=_0x269d3e[_0x189c69(0x236)](),_0x38a937=new Date();if(_0x41496d&&_0x41496d['status']===_0x189c69(0x192)){const _0x16e679=new Date(_0x41496d[_0x189c69(0x1c3)]);return _0x16e679<_0x38a937?(_0x370343[_0x189c69(0x191)]=_0x189c69(0x1f2),hidePageLoader(),showSubscriptionRequiredModal(),await update(adminRef,{'status':_0x189c69(0x186)}),![]):(_0x370343[_0x189c69(0x191)]=_0x189c69(0x1df),hidePageLoader(),!![]);}else return _0x370343[_0x189c69(0x191)]=_0x189c69(0x1d1),hidePageLoader(),showSubscriptionRequiredModal(),![];}catch(_0x10e636){return hidePageLoader(),console[_0x189c69(0x234)](_0x189c69(0x259),_0x10e636),_0x370343[_0x189c69(0x191)]=_0x189c69(0x1f7),showNotification(_0x189c69(0x1ae),_0x189c69(0x21e)),![];}}document[_0x26248e(0x18e)](_0x26248e(0x247),async()=>{const _0x35b9c9=_0x26248e;showPageLoader(),await initializeDatabase();const _0x3f94f9=getAdminIdFromUrl(),_0x4f60d9=new URLSearchParams(window[_0x35b9c9(0x202)][_0x35b9c9(0x238)])[_0x35b9c9(0x1f8)](_0x35b9c9(0x1d0));if(!_0x3f94f9){hidePageLoader(),loginSection[_0x35b9c9(0x227)]['display']=_0x35b9c9(0x1fa);return;}currentUserIdAdmin=_0x3f94f9,_0x4f60d9&&(currentVendorId=_0x4f60d9),await fetchVendors(),rememberMeCheckbox['checked']?usernameInput[_0x35b9c9(0x253)]&&passwordInput['value']?await loginForm[_0x35b9c9(0x1cf)](new Event(_0x35b9c9(0x264))):hidePageLoader():hidePageLoader(),document['getElementById'](_0x35b9c9(0x221))[_0x35b9c9(0x18e)](_0x35b9c9(0x264),login),ratesSection[_0x35b9c9(0x227)][_0x35b9c9(0x198)]===_0x35b9c9(0x1fa)&&(await syncTickets(),loadHistory(),listenForNewMessages());}),window[_0x26248e(0x23c)]=redirectToSubscription,window['hideSubscriptionRequiredModal']=redirectToSubscription,window[_0x26248e(0x1f9)]=hideNotification,window['proceedWithSale']=proceedWithSale,window[_0x26248e(0x1ce)]=confirmSale,window[_0x26248e(0x239)]=cancelSale,window[_0x26248e(0x244)]=toggleHistory,window['closeHistory']=closeHistory,window['filterHistory']=filterHistory,window[_0x26248e(0x1a7)]=filterHistoryByDateRange,window[_0x26248e(0x1d3)]=shareTicket,window[_0x26248e(0x248)]=copyTicket,window[_0x26248e(0x215)]=exportToPDF,window['exportToPDFHistory']=exportToPDFHistory,window[_0x26248e(0x206)]=exportToExcelHistory,window[_0x26248e(0x1e8)]=initTicketSale,window['showTicketDetailsFromHistory']=showTicketDetailsFromHistory,window[_0x26248e(0x20b)]=filterHistory;

</script>
</body>
</html>