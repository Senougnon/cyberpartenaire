<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i data-lucide="share-2"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i data-lucide="file-text"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i data-lucide="history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i data-lucide="printer"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i data-lucide="file-down"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x41aa64=_0x50b4;(function(_0x4eda8e,_0x3ebece){const _0x1d8627=_0x50b4,_0x49bbc8=_0x4eda8e();while(!![]){try{const _0x436219=parseInt(_0x1d8627(0x18c))/0x1+-parseInt(_0x1d8627(0x184))/0x2+-parseInt(_0x1d8627(0x17e))/0x3+parseInt(_0x1d8627(0x1f0))/0x4*(parseInt(_0x1d8627(0x194))/0x5)+-parseInt(_0x1d8627(0x161))/0x6+-parseInt(_0x1d8627(0x22e))/0x7+parseInt(_0x1d8627(0x1d1))/0x8;if(_0x436219===_0x3ebece)break;else _0x49bbc8['push'](_0x49bbc8['shift']());}catch(_0x3ba514){_0x49bbc8['push'](_0x49bbc8['shift']());}}}(_0x4bd0,0x6119a));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';function _0x4bd0(){const _0x22cefe=['#historyTableBody','1:345974541860:web:a296190bcea2ce496bd2b1','admin/subscription','prix','pageLoaderWrapper','1016208ILFcfK','setHours','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','hideSubscriptionRequiredModal','index.html','then','520652vvZShX','textContent','Aucun\x20ticket\x20à\x20vendre','Erreur\x20lors\x20de\x20l\x27initialisation\x20:','Succès','height','jspdf','scrollTop','606963LhLuHx','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','addEventListener','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27','autocompleteSuggestions','toFixed','max','margin','5BILRQy','usernameTimestamp','log','ticket-actions','getHeight','display','Ticket\x20vendu\x20avec\x20succès','none','querySelector','left','notification-buttons','innerHTML','loginSection','active','shareTicket','messagesContainer','save','endDate','Abonnement\x20actif','entries','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','price','hideNotification','keys','addImage','exportToPDFHistory','motDePasse','removeItem','application/octet-stream','min','Plus\x20de\x20tickets\x20disponibles','historique_ventes.pdf','href','style','update','toLowerCase','exists','setItem','historySection','table','Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.','error','loaderWrapper','contains','e-fdr-wifi-zone.firebasestorage.app','checked','username','getDate','flex','345974541860','historyTableBody','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','user','proceedWithSale','getNumberOfPages','\x20FCFA','confirmation-buttons','TicketsTotal/','submit','filter','VendorsHistory/','8173856lGUhvK','Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:','print','startDate','category','DOMContentLoaded','ticket.pdf','all','innerText','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','password','Erreur\x20de\x20confirmation:','ceil','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','closeHistory','Impossible\x20de\x20charger\x20l\x27historique','getTime','setFontSize','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','utilisateur','Erreur\x20lors\x20de\x20la\x20copie:','getItem','writeText','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','historique_ventes.xlsx','content','confirmSale','totalTickets','setDate','235924GqspHM','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','reduce','value','charCodeAt','Partage\x20réussi','notification-title','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','soldAt','periodFilter','now','PNG','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','join','Ticket\x20vendu\x20avec\x20succès!','TicketsVendus','center','input','Détails\x20du\x20Ticket','settings','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','G-ZP7NDJ1TCW','scrollHeight','timestamp','printHistory','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Vendors/','Aucun\x20vendeur\x20trouvé.','updatedData','share','utils','val','redirectToSubscription','Impossible\x20de\x20récupérer\x20le\x20ticket','.rates-section\x20table','sort','target','clipboard','getElementById','internal','avgDaily','appendChild','jsPDF','status','click','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','notification-message','Erreur','catch','Erreur\x20lors\x20de\x20la\x20vente:','rememberMe','notification','pageSize','copyTicket','add','topCategory','width','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','Aucun\x20ticket\x20disponible.','div','bold','pageLoaderMessage','4778326hlldZP','length','image/png','Ticket\x20introuvable\x20dans\x20l\x27historique','TicketsTotal','slice','preventDefault','49644ZBOorg','totalRevenue','grid','Historique\x20des\x20ventes','map','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','text','createElement','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Erreur\x20lors\x20du\x20partage:','loginForm','filterHistory','table_to_book','.rates-section','toggleHistory','block','Vérification\x20de\x20l\x27abonnement...','message','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','getDay','e-fdr-wifi-zone','toLocaleString','createIcons','xlsx'];_0x4bd0=function(){return _0x22cefe;};return _0x4bd0();}import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':'AIzaSyA427nwGB3DfsySqvBCnkpRUdDAcYyhn2Q','authDomain':'e-fdr-wifi-zone.firebaseapp.com','databaseURL':'https://e-fdr-wifi-zone-default-rtdb.firebaseio.com','projectId':_0x41aa64(0x175),'storageBucket':_0x41aa64(0x1c0),'messagingSenderId':_0x41aa64(0x1c5),'appId':_0x41aa64(0x17a),'measurementId':_0x41aa64(0x205)},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x41aa64(0x17b));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window['jsPDF']=window[_0x41aa64(0x18a)][_0x41aa64(0x21a)];async function fetchVendors(){const _0x290acb=_0x41aa64;try{const _0x1c1079=ref(db,'Vendors'),_0x805329=await get(_0x1c1079);_0x805329[_0x290acb(0x1b8)]()?(vendors=_0x805329[_0x290acb(0x20f)](),availableUsernames=Object[_0x290acb(0x1ab)](vendors)):console[_0x290acb(0x196)](_0x290acb(0x20b));}catch(_0x2a84ac){console[_0x290acb(0x1bd)](_0x290acb(0x1d2),_0x2a84ac);}}const usernameInput=document['getElementById'](_0x41aa64(0x1c2)),passwordInput=document[_0x41aa64(0x216)](_0x41aa64(0x1db)),suggestionsList=document['getElementById'](_0x41aa64(0x190));usernameInput[_0x41aa64(0x18e)](_0x41aa64(0x201),()=>{const _0x245eca=_0x41aa64,_0x44c8a1=usernameInput[_0x245eca(0x1f3)][_0x245eca(0x1b7)](),_0xcf682b=availableUsernames['filter'](_0x1e77d5=>_0x1e77d5[_0x245eca(0x1b7)]()['startsWith'](_0x44c8a1));suggestionsList[_0x245eca(0x19f)]='';if(_0x44c8a1[_0x245eca(0x22f)]===0x0||_0xcf682b[_0x245eca(0x22f)]===0x0){suggestionsList[_0x245eca(0x1b5)][_0x245eca(0x199)]='none';return;}_0xcf682b['forEach'](_0x33a44d=>{const _0x3e3d8a=_0x245eca,_0x379d3a=document['createElement']('li');_0x379d3a['textContent']=_0x33a44d,_0x379d3a[_0x3e3d8a(0x18e)](_0x3e3d8a(0x21c),()=>{const _0xc11512=_0x3e3d8a;usernameInput[_0xc11512(0x1f3)]=_0x33a44d,suggestionsList[_0xc11512(0x19f)]='',suggestionsList['style'][_0xc11512(0x199)]='none';}),suggestionsList[_0x3e3d8a(0x219)](_0x379d3a);}),suggestionsList[_0x245eca(0x1b5)][_0x245eca(0x199)]=_0x245eca(0x170);}),document['addEventListener']('click',_0x4b674d=>{const _0x433601=_0x41aa64;!usernameInput[_0x433601(0x1bf)](_0x4b674d[_0x433601(0x214)])&&!suggestionsList['contains'](_0x4b674d[_0x433601(0x214)])&&(suggestionsList[_0x433601(0x1b5)][_0x433601(0x199)]='none');});const rememberMeCheckbox=document[_0x41aa64(0x216)](_0x41aa64(0x222)),storedUsername=localStorage['getItem'](_0x41aa64(0x1c2)),storedPassword=localStorage[_0x41aa64(0x1e8)]('password'),storedTimestamp=localStorage[_0x41aa64(0x1e8)](_0x41aa64(0x195)),now=Date[_0x41aa64(0x1fa)](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0x41aa64(0x1f3)]=storedUsername,passwordInput[_0x41aa64(0x1f3)]=storedPassword,rememberMeCheckbox[_0x41aa64(0x1c1)]=!![]);const loginForm=document['getElementById'](_0x41aa64(0x16b)),loginError=document[_0x41aa64(0x216)]('loginError'),ratesSection=document[_0x41aa64(0x19c)](_0x41aa64(0x16e)),historySection=document[_0x41aa64(0x216)](_0x41aa64(0x1ba)),loginSection=document[_0x41aa64(0x216)](_0x41aa64(0x1a0)),messagesSection=document[_0x41aa64(0x216)]('messagesSection');loginForm['addEventListener'](_0x41aa64(0x1ce),async _0x8ef305=>{const _0xe5eb87=_0x41aa64;_0x8ef305[_0xe5eb87(0x234)](),showLoader();const _0x4be835=usernameInput[_0xe5eb87(0x1f3)],_0x3cb01d=passwordInput[_0xe5eb87(0x1f3)];vendors[_0x4be835]&&vendors[_0x4be835][_0xe5eb87(0x1db)]===_0x3cb01d?(loginError[_0xe5eb87(0x1b5)][_0xe5eb87(0x199)]=_0xe5eb87(0x19b),ratesSection[_0xe5eb87(0x1b5)][_0xe5eb87(0x199)]='block',historySection[_0xe5eb87(0x1b5)][_0xe5eb87(0x199)]=_0xe5eb87(0x19b),loginSection[_0xe5eb87(0x1b5)]['display']=_0xe5eb87(0x19b),messagesSection[_0xe5eb87(0x1b5)][_0xe5eb87(0x199)]=_0xe5eb87(0x170),currentVendorId=_0x4be835,rememberMeCheckbox[_0xe5eb87(0x1c1)]?(localStorage[_0xe5eb87(0x1b9)](_0xe5eb87(0x1c2),_0x4be835),localStorage[_0xe5eb87(0x1b9)](_0xe5eb87(0x1db),_0x3cb01d),localStorage['setItem']('usernameTimestamp',Date['now']())):(localStorage['removeItem'](_0xe5eb87(0x1c2)),localStorage['removeItem'](_0xe5eb87(0x1db)),localStorage[_0xe5eb87(0x1af)](_0xe5eb87(0x195))),await syncTickets(),loadHistory(),listenForNewMessages(),lucide['createIcons'](),hideLoader()):(loginError[_0xe5eb87(0x1b5)][_0xe5eb87(0x199)]=_0xe5eb87(0x170),loginError[_0xe5eb87(0x185)]=_0xe5eb87(0x1bc),hideLoader());});async function syncTickets(){const _0x4b7754=_0x41aa64;try{const _0x2ed50a=document[_0x4b7754(0x19c)]('.loading-message'),_0x91579c=document['querySelector'](_0x4b7754(0x212));_0x2ed50a['style'][_0x4b7754(0x199)]=_0x4b7754(0x170),_0x91579c[_0x4b7754(0x1b5)][_0x4b7754(0x199)]=_0x4b7754(0x19b);const _0x30a669=ref(db,_0x4b7754(0x232)),_0x438e58=await get(_0x30a669);_0x438e58[_0x4b7754(0x1b8)]()?(localTickets=_0x438e58[_0x4b7754(0x20f)](),createTicketTable(),_0x2ed50a['style']['display']=_0x4b7754(0x19b),_0x91579c['style'][_0x4b7754(0x199)]=_0x4b7754(0x1bb)):_0x2ed50a[_0x4b7754(0x185)]=_0x4b7754(0x22a);}catch(_0x57b081){console[_0x4b7754(0x1bd)]('Erreur\x20de\x20synchronisation:',_0x57b081),loadingMessage[_0x4b7754(0x185)]='Erreur\x20de\x20synchronisation\x20des\x20tickets.';}}async function createTicketTable(){const _0x3fb536=_0x41aa64,_0x441a02=document['querySelector'](_0x3fb536(0x212));_0x441a02[_0x3fb536(0x19f)]=_0x3fb536(0x204);for(const [_0x4bc819,_0xe5a3ae]of Object[_0x3fb536(0x1a7)](localTickets)){const _0x4f6821=_0xe5a3ae[_0x3fb536(0x1e6)]?_0xe5a3ae[_0x3fb536(0x1e6)][_0x3fb536(0x22f)]:0x0;if(_0x4f6821>0x0){const _0x473cce=_0xe5a3ae[_0x3fb536(0x17c)][0x0],_0x2dd447=_0x441a02['insertRow']();_0x2dd447['innerHTML']=_0x3fb536(0x209)+_0x4bc819+_0x3fb536(0x1c7)+_0x473cce+_0x3fb536(0x1c7)+_0x4f6821+_0x3fb536(0x18f)+_0x4bc819+_0x3fb536(0x1a8);}}document['querySelector']('.loading-message')[_0x3fb536(0x1b5)][_0x3fb536(0x199)]=_0x3fb536(0x19b),_0x441a02[_0x3fb536(0x1b5)]['display']=_0x3fb536(0x1bb);}window['initTicketSale']=async function(_0x59bf6b){const _0xcf564d=_0x41aa64;showLoader();try{const _0x4be4d6=ref(db,_0xcf564d(0x1cd)+_0x59bf6b),_0x3d6592=await get(_0x4be4d6);if(_0x3d6592[_0xcf564d(0x1b8)]()){const _0x45f7c7=_0x3d6592['val']();if(!_0x45f7c7[_0xcf564d(0x1e6)]||_0x45f7c7[_0xcf564d(0x1e6)][_0xcf564d(0x22f)]===0x0)throw new Error(_0xcf564d(0x1b2));ticketToSell={'category':_0x59bf6b,'user':_0x45f7c7[_0xcf564d(0x1e6)][0x0],'password':_0x45f7c7[_0xcf564d(0x1ae)][0x0],'price':_0x45f7c7['prix'][0x0],'updatedData':{..._0x45f7c7,'utilisateur':_0x45f7c7[_0xcf564d(0x1e6)][_0xcf564d(0x233)](0x1),'motDePasse':_0x45f7c7[_0xcf564d(0x1ae)][_0xcf564d(0x233)](0x1),'prix':_0x45f7c7[_0xcf564d(0x17c)][_0xcf564d(0x233)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x3a7812){console['error']('Erreur:',_0x3a7812),showNotification(_0xcf564d(0x21f),_0xcf564d(0x211)),hideLoader();}};function showConfirmation(_0x23463c){const _0x548346=_0x41aa64,_0x167a2d=document['getElementById'](_0x548346(0x223)),_0x56b073=document[_0x548346(0x216)](_0x548346(0x21e)),_0xe1a49d=document['getElementById'](_0x548346(0x197)),_0x12856d=document[_0x548346(0x216)]('confirmation-buttons');document[_0x548346(0x216)](_0x548346(0x1f6))[_0x548346(0x185)]='Confirmation\x20de\x20vente',_0x56b073[_0x548346(0x19f)]=_0x548346(0x173)+_0x23463c['category']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x23463c['price']+_0x548346(0x1e4),_0x12856d[_0x548346(0x1b5)][_0x548346(0x199)]=_0x548346(0x1c4),_0xe1a49d[_0x548346(0x1b5)][_0x548346(0x199)]='none',_0x167a2d[_0x548346(0x1b5)][_0x548346(0x199)]='block';}window[_0x41aa64(0x1c9)]=async function(){const _0x14d4c1=_0x41aa64;showLoader();if(!ticketToSell){showNotification(_0x14d4c1(0x21f),_0x14d4c1(0x186)),hideLoader();return;}try{const _0x51a654=ref(db,_0x14d4c1(0x1cd)+ticketToSell[_0x14d4c1(0x1d5)]);await set(_0x51a654,ticketToSell[_0x14d4c1(0x20c)]);const _0x1209df=ref(db,_0x14d4c1(0x1ff));await push(_0x1209df,{'category':ticketToSell[_0x14d4c1(0x1d5)],'user':ticketToSell[_0x14d4c1(0x1c8)],'password':ticketToSell[_0x14d4c1(0x1db)],'price':ticketToSell[_0x14d4c1(0x1a9)],'soldAt':Date['now'](),'vendorId':currentVendorId});const _0x2a8e76=ref(db,'VendorsHistory/'+currentVendorId);await push(_0x2a8e76,{'category':ticketToSell[_0x14d4c1(0x1d5)],'user':ticketToSell[_0x14d4c1(0x1c8)],'password':ticketToSell[_0x14d4c1(0x1db)],'price':ticketToSell['price'],'soldAt':Date[_0x14d4c1(0x1fa)]()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x2c41c7){console[_0x14d4c1(0x1bd)](_0x14d4c1(0x221),_0x2c41c7),showNotification(_0x14d4c1(0x21f),'Impossible\x20de\x20finaliser\x20la\x20vente'),hideLoader();}ticketToSell=null;};function showTicketDetails(_0xe39cc4){const _0x3babc5=_0x41aa64,_0x1880d2=document[_0x3babc5(0x216)](_0x3babc5(0x223)),_0x23bcfb=document['getElementById'](_0x3babc5(0x21e)),_0xcecf70=document[_0x3babc5(0x216)]('ticket-actions'),_0x4ddd21=document['getElementById'](_0x3babc5(0x1cc));document[_0x3babc5(0x216)](_0x3babc5(0x1f6))['textContent']=_0x3babc5(0x19a),_0x23bcfb[_0x3babc5(0x19f)]=_0x3babc5(0x1e5)+_0xe39cc4[_0x3babc5(0x1d5)]+_0x3babc5(0x229)+_0xe39cc4[_0x3babc5(0x1c8)]+_0x3babc5(0x18d)+_0xe39cc4[_0x3babc5(0x1db)]+_0x3babc5(0x1f7)+_0xe39cc4[_0x3babc5(0x1a9)]+_0x3babc5(0x1e4),_0x4ddd21[_0x3babc5(0x1b5)][_0x3babc5(0x199)]=_0x3babc5(0x19b),_0xcecf70[_0x3babc5(0x1b5)]['display']='flex',_0x1880d2[_0x3babc5(0x1b5)]['display']=_0x3babc5(0x170),lucide['createIcons']();}function showSaleConfirmation(_0x3c7da7){const _0x290e6a=_0x41aa64,_0xb5e64=document[_0x290e6a(0x216)]('notification'),_0x4c7ca2=document['getElementById'](_0x290e6a(0x21e)),_0x5e61e3=document['getElementById'](_0x290e6a(0x19e));_0x4c7ca2[_0x290e6a(0x19f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20'+_0x3c7da7[_0x290e6a(0x1d5)]+_0x290e6a(0x229)+_0x3c7da7[_0x290e6a(0x1c8)]+_0x290e6a(0x18d)+_0x3c7da7[_0x290e6a(0x1db)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x3c7da7[_0x290e6a(0x1a9)]+_0x290e6a(0x1e4),_0x5e61e3[_0x290e6a(0x19f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xb5e64[_0x290e6a(0x1b5)][_0x290e6a(0x199)]=_0x290e6a(0x170),lucide[_0x290e6a(0x177)]();}window[_0x41aa64(0x1ed)]=async function(){const _0x384b4d=_0x41aa64;showLoader();if(!currentReservedTicket){showNotification('Erreur','Aucun\x20ticket\x20en\x20cours\x20de\x20vente'),hideLoader();return;}try{const _0x12a7ed=ref(db,_0x384b4d(0x1ff));await push(_0x12a7ed,{...currentReservedTicket,'soldAt':Date[_0x384b4d(0x1fa)](),'vendorId':currentVendorId});const _0x57f12e=ref(db,_0x384b4d(0x1d0)+currentVendorId);await push(_0x57f12e,{...currentReservedTicket,'soldAt':Date[_0x384b4d(0x1fa)]()}),showNotification(_0x384b4d(0x188),_0x384b4d(0x1fe)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0xf7ab50){console['error'](_0x384b4d(0x1dc),_0xf7ab50),showNotification(_0x384b4d(0x21f),'Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente'),hideLoader();}},window['cancelSale']=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0xe940f5,_0x40a59a){const _0x3d10e1=_0x41aa64,_0x5c8e6f=document[_0x3d10e1(0x216)](_0x3d10e1(0x223)),_0x18aefe=document['getElementById']('notification-title'),_0x560c18=document[_0x3d10e1(0x216)](_0x3d10e1(0x21e)),_0x512740=document[_0x3d10e1(0x216)](_0x3d10e1(0x19e)),_0x1a5537=document[_0x3d10e1(0x216)](_0x3d10e1(0x197));_0x18aefe['textContent']=_0xe940f5,_0x560c18['innerHTML']=_0x40a59a,_0xe940f5==='Succès'||_0xe940f5===_0x3d10e1(0x21f)?(_0x512740['style'][_0x3d10e1(0x199)]=_0x3d10e1(0x19b),_0x1a5537['style']['display']='none'):(_0x512740['style'][_0x3d10e1(0x199)]=_0x3d10e1(0x1c4),_0x1a5537['style'][_0x3d10e1(0x199)]=_0x3d10e1(0x19b)),_0x5c8e6f[_0x3d10e1(0x1b5)]['display']=_0x3d10e1(0x170);}window[_0x41aa64(0x1aa)]=function(){const _0x45df97=_0x41aa64;document[_0x45df97(0x216)]('notification')[_0x45df97(0x1b5)][_0x45df97(0x199)]=_0x45df97(0x19b);};async function loadHistory(){const _0x2a64e9=_0x41aa64;showLoader();try{const _0x525255=ref(db,'VendorsHistory/'+currentVendorId),_0x868532=await get(_0x525255);let _0x4749fa=[];_0x868532[_0x2a64e9(0x1b8)]()&&(_0x4749fa=Object[_0x2a64e9(0x1a7)](_0x868532[_0x2a64e9(0x20f)]())[_0x2a64e9(0x165)](([_0x3948c4,_0x3bef89])=>({'id':_0x3948c4,..._0x3bef89}))),filterHistory(_0x4749fa),hideLoader();}catch(_0xada0f8){console[_0x2a64e9(0x1bd)]('Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:',_0xada0f8),showNotification('Erreur',_0x2a64e9(0x1e0)),hideLoader();}}function _0x50b4(_0x376abd,_0x42dc88){const _0x4bd02d=_0x4bd0();return _0x50b4=function(_0x50b4bb,_0x131205){_0x50b4bb=_0x50b4bb-0x161;let _0x2a0b54=_0x4bd02d[_0x50b4bb];return _0x2a0b54;},_0x50b4(_0x376abd,_0x42dc88);}function filterHistory(_0x51cdea){const _0x1aa481=_0x41aa64,_0x42190b=document['getElementById'](_0x1aa481(0x1f9))[_0x1aa481(0x1f3)],_0x5f4977=new Date(),_0xbcb47f={'today':new Date(_0x5f4977['setHours'](0x0,0x0,0x0,0x0)),'week':new Date(_0x5f4977['setDate'](_0x5f4977[_0x1aa481(0x1c3)]()-_0x5f4977[_0x1aa481(0x174)]())),'month':new Date(_0x5f4977[_0x1aa481(0x1ef)](0x1)),'all':new Date(0x0)};let _0x5cc6fc=_0x51cdea;_0x42190b!==_0x1aa481(0x1d8)&&(_0x5cc6fc=_0x51cdea['filter'](_0x4a6d11=>new Date(_0x4a6d11[_0x1aa481(0x1f8)])>=_0xbcb47f[_0x42190b])),updateStats(_0x5cc6fc),updateHistoryTable(_0x5cc6fc);}window['filterHistoryByDateRange']=function(){const _0x9d235b=_0x41aa64,_0x897c1a=new Date(document[_0x9d235b(0x216)](_0x9d235b(0x1d4))[_0x9d235b(0x1f3)]),_0x5a4617=new Date(document['getElementById']('endDate')['value']);_0x5a4617[_0x9d235b(0x17f)](0x17,0x3b,0x3b);if(isNaN(_0x897c1a['getTime']())||isNaN(_0x5a4617[_0x9d235b(0x1e1)]())){showNotification(_0x9d235b(0x21f),'Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.');return;}const _0x4b7518=ref(db,'VendorsHistory/'+currentVendorId);get(_0x4b7518)[_0x9d235b(0x183)](_0x52abcf=>{const _0x58295b=_0x9d235b;let _0x95c2b7=[];_0x52abcf[_0x58295b(0x1b8)]()&&(_0x95c2b7=Object[_0x58295b(0x1a7)](_0x52abcf['val']())[_0x58295b(0x165)](([_0x149b10,_0x11a027])=>({'id':_0x149b10,..._0x11a027})));const _0x466cbd=_0x95c2b7[_0x58295b(0x1cf)](_0x2d2c67=>{const _0x1d5ce2=new Date(_0x2d2c67['soldAt']);return _0x1d5ce2>=_0x897c1a&&_0x1d5ce2<=_0x5a4617;});updateStats(_0x466cbd),updateHistoryTable(_0x466cbd);});};function updateStats(_0x47234f){const _0x267689=_0x41aa64,_0x38e691=_0x47234f[_0x267689(0x22f)],_0x57f38e=_0x47234f[_0x267689(0x1f2)]((_0x127920,_0x3b9d25)=>_0x127920+parseFloat(_0x3b9d25[_0x267689(0x1a9)]),0x0),_0x6cf459=_0x47234f[_0x267689(0x1f2)]((_0x39e34d,_0x3414e9)=>{const _0x17c6a0=_0x267689;return _0x39e34d[_0x3414e9[_0x17c6a0(0x1d5)]]=(_0x39e34d[_0x3414e9['category']]||0x0)+0x1,_0x39e34d;},{}),_0x9eebf2=Object[_0x267689(0x1a7)](_0x6cf459)['sort']((_0x2ea435,_0x516c24)=>_0x516c24[0x1]-_0x2ea435[0x1])[0x0]?.[0x0]||'-',_0x314da6=_0x47234f[_0x267689(0x22f)]>0x0?Math[_0x267689(0x192)](0x1,Math[_0x267689(0x1dd)]((Date[_0x267689(0x1fa)]()-Math[_0x267689(0x1b1)](..._0x47234f[_0x267689(0x165)](_0x3bcde5=>_0x3bcde5['soldAt'])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x9e7d12=(_0x38e691/_0x314da6)[_0x267689(0x191)](0x1);document['getElementById'](_0x267689(0x1ee))[_0x267689(0x185)]=_0x38e691,document[_0x267689(0x216)](_0x267689(0x162))[_0x267689(0x185)]=_0x57f38e[_0x267689(0x176)]()+_0x267689(0x1cb),document[_0x267689(0x216)](_0x267689(0x227))[_0x267689(0x185)]=_0x9eebf2,document['getElementById'](_0x267689(0x218))[_0x267689(0x185)]=_0x9e7d12;}function updateHistoryTable(_0x30f62b){const _0x201bb1=_0x41aa64,_0x3b6725=document[_0x201bb1(0x216)](_0x201bb1(0x1c6));_0x3b6725[_0x201bb1(0x19f)]=_0x30f62b[_0x201bb1(0x213)]((_0x2169ce,_0x3b7ae9)=>_0x3b7ae9[_0x201bb1(0x1f8)]-_0x2169ce[_0x201bb1(0x1f8)])['map'](_0x163577=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27'+_0x163577['id']+_0x201bb1(0x1ea)+new Date(_0x163577[_0x201bb1(0x1f8)])['toLocaleString']()+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x163577['category']+_0x201bb1(0x1c7)+_0x163577['user']+_0x201bb1(0x1c7)+_0x163577[_0x201bb1(0x1a9)]+_0x201bb1(0x169))[_0x201bb1(0x1fd)]('');}window['showTicketDetailsFromHistory']=async function(_0xbd62cb){const _0x537aa3=_0x41aa64;showLoader();try{const _0x4965a8=ref(db,_0x537aa3(0x1d0)+currentVendorId+'/'+_0xbd62cb),_0x3b1c88=await get(_0x4965a8);if(_0x3b1c88['exists']()){const _0x1ac30e=_0x3b1c88[_0x537aa3(0x20f)]();window[_0x537aa3(0x1df)](),showTicketDetails(_0x1ac30e),hideLoader();}else showNotification('Erreur',_0x537aa3(0x231)),hideLoader();}catch(_0xc60aa1){console[_0x537aa3(0x1bd)](_0x537aa3(0x166),_0xc60aa1),showNotification(_0x537aa3(0x21f),'Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket'),hideLoader();}},window[_0x41aa64(0x16f)]=function(){const _0x51337c=_0x41aa64,_0x1910d8=document[_0x51337c(0x216)]('historySection'),_0x529243=_0x1910d8['style'][_0x51337c(0x199)]===_0x51337c(0x170);_0x1910d8[_0x51337c(0x1b5)]['display']=_0x529243?_0x51337c(0x19b):'block',!_0x529243&&loadHistory();},window[_0x41aa64(0x1df)]=function(){const _0x4ffa6b=_0x41aa64;document['getElementById']('historySection')[_0x4ffa6b(0x1b5)][_0x4ffa6b(0x199)]=_0x4ffa6b(0x19b);},window[_0x41aa64(0x16c)]=function(){loadHistory();};function listenForNewMessages(){const _0x1ecac0=_0x41aa64,_0x2e8296=ref(db,_0x1ecac0(0x20a)+currentVendorId+'/messages');onChildAdded(_0x2e8296,_0x3867e8=>{const _0x3af911=_0x1ecac0,_0x252ea1=_0x3867e8[_0x3af911(0x20f)]();displayNewMessage(_0x252ea1);});}function displayNewMessage(_0x4c26b5){const _0x3867e3=_0x41aa64,_0x9fc84=document[_0x3867e3(0x216)](_0x3867e3(0x1a3)),_0x48e56f=document[_0x3867e3(0x168)](_0x3867e3(0x22b));_0x48e56f['classList'][_0x3867e3(0x226)](_0x3867e3(0x172)),_0x48e56f[_0x3867e3(0x19f)]=_0x3867e3(0x21d)+_0x4c26b5[_0x3867e3(0x1ec)]+_0x3867e3(0x1da)+new Date(_0x4c26b5[_0x3867e3(0x207)])['toLocaleString']()+_0x3867e3(0x1f1),_0x9fc84[_0x3867e3(0x219)](_0x48e56f),_0x9fc84[_0x3867e3(0x18b)]=_0x9fc84[_0x3867e3(0x206)];}window[_0x41aa64(0x1a2)]=function(){const _0x223e4c=_0x41aa64,_0x94150f=document['getElementById'](_0x223e4c(0x21e))[_0x223e4c(0x1d9)];navigator[_0x223e4c(0x20d)]?navigator[_0x223e4c(0x20d)]({'title':_0x223e4c(0x202),'text':_0x94150f})['then'](()=>console[_0x223e4c(0x196)](_0x223e4c(0x1f5)))[_0x223e4c(0x220)](_0x375f38=>console[_0x223e4c(0x1bd)](_0x223e4c(0x16a),_0x375f38)):alert('Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.');},window[_0x41aa64(0x225)]=function(){const _0x38fa80=_0x41aa64,_0x24b923=document[_0x38fa80(0x216)](_0x38fa80(0x21e))[_0x38fa80(0x1d9)];navigator[_0x38fa80(0x215)][_0x38fa80(0x1e9)](_0x24b923)[_0x38fa80(0x183)](()=>{const _0x8b5c26=_0x38fa80;showNotification(_0x8b5c26(0x188),_0x8b5c26(0x1fc));})[_0x38fa80(0x220)](_0x5ec8e5=>{const _0xb5dce2=_0x38fa80;console[_0xb5dce2(0x1bd)](_0xb5dce2(0x1e7),_0x5ec8e5),showNotification(_0xb5dce2(0x21f),'Impossible\x20de\x20copier\x20le\x20ticket');});},window['exportToPDF']=async function(){const _0x1082b1=_0x41aa64;showLoader();const _0x994573=document[_0x1082b1(0x216)]('notification-message'),_0xe5e1d8=new jsPDF(),_0x426033=await html2canvas(_0x994573),_0xaaa06f=_0x426033['toDataURL'](_0x1082b1(0x230));_0xe5e1d8[_0x1082b1(0x1ac)](_0xaaa06f,_0x1082b1(0x1fb),0xa,0xa,0xbe,0x0),_0xe5e1d8[_0x1082b1(0x1a4)](_0x1082b1(0x1d7)),hideLoader();},window[_0x41aa64(0x208)]=function(){const _0xa15924=_0x41aa64;window[_0xa15924(0x1d3)]();},window[_0x41aa64(0x1ad)]=function(){const _0x5b5af0=_0x41aa64,{jsPDF:_0x22f6ac}=window['jspdf'],_0x298af4=new _0x22f6ac(),_0x428bc6=document[_0x5b5af0(0x216)](_0x5b5af0(0x1c6)),_0x133488={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x5b5af0(0x22c),'halign':_0x5b5af0(0x200)},_0x2ff01d={'halign':_0x5b5af0(0x19d)},_0x5aeb89={'theme':_0x5b5af0(0x163),'headStyles':_0x133488,'bodyStyles':_0x2ff01d,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x519e1b){const _0x4f743c=_0x5b5af0;_0x298af4[_0x4f743c(0x167)](_0x4f743c(0x164),0xe,0xf);const _0xcddabb='Page\x20'+_0x298af4[_0x4f743c(0x217)][_0x4f743c(0x1ca)]();_0x298af4[_0x4f743c(0x1e2)](0xa);const _0x3f1566=_0x298af4[_0x4f743c(0x217)][_0x4f743c(0x224)],_0x11ca42=_0x3f1566[_0x4f743c(0x189)]?_0x3f1566['height']:_0x3f1566[_0x4f743c(0x198)]();_0x298af4['text'](_0xcddabb,_0x519e1b[_0x4f743c(0x203)][_0x4f743c(0x193)][_0x4f743c(0x19d)],_0x11ca42-0xa),_0x298af4['text'](new Date()['toLocaleString'](),_0x3f1566[_0x4f743c(0x228)]-_0x519e1b[_0x4f743c(0x203)][_0x4f743c(0x193)]['right']-0x28,_0x11ca42-0xa);}};_0x298af4['autoTable']({'html':_0x5b5af0(0x179),..._0x5aeb89}),_0x298af4['save'](_0x5b5af0(0x1b3));},window['exportToExcelHistory']=function(){const _0x4881d5=_0x41aa64,_0x58bc3b=XLSX[_0x4881d5(0x20e)][_0x4881d5(0x16d)](document['getElementById'](_0x4881d5(0x1c6)),{'sheet':'Ventes'}),_0x1b58d2=XLSX['write'](_0x58bc3b,{'bookType':_0x4881d5(0x178),'type':'binary'});function _0x39e716(_0x5d02be){const _0x1116f0=_0x4881d5,_0x3a415d=new ArrayBuffer(_0x5d02be[_0x1116f0(0x22f)]),_0xdcdb31=new Uint8Array(_0x3a415d);for(let _0x5be11c=0x0;_0x5be11c<_0x5d02be[_0x1116f0(0x22f)];_0x5be11c++)_0xdcdb31[_0x5be11c]=_0x5d02be[_0x1116f0(0x1f4)](_0x5be11c)&0xff;return _0x3a415d;}saveAs(new Blob([_0x39e716(_0x1b58d2)],{'type':_0x4881d5(0x1b0)}),_0x4881d5(0x1eb));};function showLoader(){const _0x1f4e12=_0x41aa64;document['getElementById']('loaderWrapper')[_0x1f4e12(0x1b5)][_0x1f4e12(0x199)]=_0x1f4e12(0x170);}function hideLoader(){const _0x4ea3b1=_0x41aa64;document[_0x4ea3b1(0x216)](_0x4ea3b1(0x1be))[_0x4ea3b1(0x1b5)][_0x4ea3b1(0x199)]=_0x4ea3b1(0x19b);}function showPageLoader(){const _0x2209cd=_0x41aa64;document[_0x2209cd(0x216)](_0x2209cd(0x17d))[_0x2209cd(0x1b5)][_0x2209cd(0x199)]=_0x2209cd(0x1c4);}function hidePageLoader(){const _0x137c36=_0x41aa64;document[_0x137c36(0x216)](_0x137c36(0x17d))[_0x137c36(0x1b5)][_0x137c36(0x199)]=_0x137c36(0x19b);}function showSubscriptionRequiredModal(){const _0x3728a8=_0x41aa64;subscriptionRequiredModal[_0x3728a8(0x1b5)][_0x3728a8(0x199)]=_0x3728a8(0x1c4);}function hideSubscriptionRequiredModal(){const _0x4c0e39=_0x41aa64;subscriptionRequiredModal[_0x4c0e39(0x1b5)][_0x4c0e39(0x199)]=_0x4c0e39(0x19b);}function redirectToSubscription(){const _0x5b0b9b=_0x41aa64;window['location'][_0x5b0b9b(0x1b4)]=_0x5b0b9b(0x182);}async function checkSubscriptionStatus(){const _0x35d75c=_0x41aa64,_0x59bead=document[_0x35d75c(0x216)](_0x35d75c(0x22d));_0x59bead[_0x35d75c(0x185)]=_0x35d75c(0x171);try{const _0x2cf358=await get(adminRef),_0x29cbec=_0x2cf358['val'](),_0x55a552=new Date();if(_0x29cbec&&_0x29cbec[_0x35d75c(0x21b)]===_0x35d75c(0x1a1)){const _0x279510=new Date(_0x29cbec[_0x35d75c(0x1a5)]);_0x279510<_0x55a552?(_0x59bead[_0x35d75c(0x185)]='Abonnement\x20expiré',showSubscriptionRequiredModal(),await adminRef[_0x35d75c(0x1b6)]({'status':'expired'})):_0x59bead[_0x35d75c(0x185)]=_0x35d75c(0x1a6);}else _0x59bead[_0x35d75c(0x185)]='Pas\x20d\x27abonnement\x20actif',showSubscriptionRequiredModal();}catch(_0x38e0c0){console[_0x35d75c(0x1bd)]('Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:',_0x38e0c0),_0x59bead['textContent']=_0x35d75c(0x1de),showNotification(_0x35d75c(0x21f),_0x35d75c(0x1e3));}}document[_0x41aa64(0x18e)](_0x41aa64(0x1d6),()=>{checkSubscriptionStatus()['then'](()=>{fetchVendors(),lucide['createIcons'](),hidePageLoader();})['catch'](_0x21c02f=>{const _0x5d7133=_0x50b4;console[_0x5d7133(0x1bd)](_0x5d7133(0x187),_0x21c02f),showNotification('Erreur',_0x5d7133(0x180)),hidePageLoader();});}),window[_0x41aa64(0x210)]=redirectToSubscription,window[_0x41aa64(0x181)]=redirectToSubscription;
    </script>
</body>
</html>
