<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i data-lucide="share-2"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i data-lucide="file-text"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i data-lucide="history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i data-lucide="printer"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i data-lucide="file-down"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0xe73751=_0x26fd;(function(_0x191b34,_0x33f2e9){const _0x27b306=_0x26fd,_0x4d476c=_0x191b34();while(!![]){try{const _0x41c57f=parseInt(_0x27b306(0x1f9))/0x1*(parseInt(_0x27b306(0x1ea))/0x2)+parseInt(_0x27b306(0x1a0))/0x3*(parseInt(_0x27b306(0x254))/0x4)+-parseInt(_0x27b306(0x208))/0x5*(-parseInt(_0x27b306(0x206))/0x6)+parseInt(_0x27b306(0x1b9))/0x7*(parseInt(_0x27b306(0x194))/0x8)+-parseInt(_0x27b306(0x201))/0x9*(parseInt(_0x27b306(0x211))/0xa)+-parseInt(_0x27b306(0x240))/0xb*(-parseInt(_0x27b306(0x1e7))/0xc)+-parseInt(_0x27b306(0x18a))/0xd*(parseInt(_0x27b306(0x1ae))/0xe);if(_0x41c57f===_0x33f2e9)break;else _0x4d476c['push'](_0x4d476c['shift']());}catch(_0x462a29){_0x4d476c['push'](_0x4d476c['shift']());}}}(_0x1705,0xeddb3));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';function _0x1705(){const _0x573ec8=['Impossible\x20de\x20charger\x20l\x27historique','Ticket\x20introuvable\x20dans\x20l\x27historique','2WdepDe','avgDaily','updatedData','table','reduce','Erreur\x20de\x20synchronisation\x20des\x20tickets.','515975925887','getElementById','Abonnement\x20actif','autoTable','left','ticket.pdf','display','Aucun\x20ticket\x20en\x20cours\x20de\x20vente','forEach','550397pnHrqe','jsPDF','Abonnement\x20expiré','submit','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','rememberMe','historyTableBody','135CBJUfk','loginError','notification-message','.loading-message','length','412536uvaGjP','margin','35DLeiJb','trs100','then','getDay','Impossible\x20de\x20récupérer\x20le\x20ticket','utilisateur','exists','Impossible\x20de\x20finaliser\x20la\x20vente','insertRow','452740OkwUDq','Aucun\x20ticket\x20à\x20vendre','cancelSale','Vendors/','internal','preventDefault','\x20FCFA','binary','toLocaleString','totalTickets','username','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:','confirmation-buttons','DOMContentLoaded','all','startsWith','Vendors','soldAt','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','admin/subscription','width','hideNotification','password','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','image/png','toDataURL','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','contains','write','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','style','usernameTimestamp','writeText','Erreur','setItem','Erreur:','Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:','confirmSale','.rates-section\x20table','startDate','endDate','height','right','content','Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente','getHeight','37367KJUWfi','totalRevenue','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','Confirmation\x20de\x20vente','target','historique_ventes.xlsx','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','pageLoaderMessage','Vérification\x20de\x20l\x27abonnement...','trs100.firebaseapp.com','copyTicket','user','entries','redirectToSubscription','TicketsVendus','error','ceil','loginSection','historySection','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','4wwFVDT','motDePasse','setDate','AIzaSyAAqwJ7Ta4SHKzLOptCNmCUFzmD9dRV1bw','Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.','input','notification-title','min','active','pageLoaderWrapper','filter','checked','G-VMB231DY1L','Ticket\x20vendu\x20avec\x20succès','loginForm','toLowerCase','innerHTML','utils','xlsx','VendorsHistory/','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27','Erreur\x20de\x20confirmation:','#historyTableBody','block','price','4938193rmUvzB','now','innerText','Plus\x20de\x20tickets\x20disponibles','bold','/messages','exportToPDF','Ticket\x20vendu\x20avec\x20succès!','location','notification-buttons','3342904nHjIJj','https://trs100-default-rtdb.firebaseio.com','initTicketSale','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','TicketsTotal/','Aucun\x20ticket\x20disponible.','.rates-section','appendChild','keys','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','clipboard','2683083IRFKME','querySelector','loaderWrapper','grid','click','add','share','classList','messagesSection','href','save','slice','category','charCodeAt','56qaZZOm','sort','toggleHistory','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','getItem','removeItem','flex','trs100.firebasestorage.app','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','proceedWithSale','Détails\x20du\x20Ticket','14yUJTyY','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','center','value','closeHistory','log','topCategory','text','filterHistory','createIcons','getDate','addEventListener','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.','printHistory','Succès','map','Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.','application/octet-stream','filterHistoryByDateRange','Partage\x20réussi','prix','join','settings','val','none','Ventes','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','ticket-actions','getTime','notification','Pas\x20d\x27abonnement\x20actif','textContent','createElement','PNG','Page\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','Aucun\x20vendeur\x20trouvé.','catch','setHours','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','addImage','scrollTop','periodFilter','1:515975925887:web:d4f867778ec322d8f52f4a','jspdf','Erreur\x20lors\x20de\x20l\x27initialisation\x20:','1452bKgmnA'];_0x1705=function(){return _0x573ec8;};return _0x1705();}import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':_0xe73751(0x257),'authDomain':_0xe73751(0x249),'databaseURL':_0xe73751(0x195),'projectId':_0xe73751(0x209),'storageBucket':_0xe73751(0x1b5),'messagingSenderId':_0xe73751(0x1f0),'appId':_0xe73751(0x1e4),'measurementId':_0xe73751(0x17d)},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0xe73751(0x224));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window[_0xe73751(0x1fa)]=window[_0xe73751(0x1e5)][_0xe73751(0x1fa)];async function fetchVendors(){const _0x13b8b7=_0xe73751;try{const _0x255cfe=ref(db,_0x13b8b7(0x221)),_0x4dadcd=await get(_0x255cfe);_0x4dadcd[_0x13b8b7(0x20e)]()?(vendors=_0x4dadcd[_0x13b8b7(0x1d0)](),availableUsernames=Object[_0x13b8b7(0x19c)](vendors)):console[_0x13b8b7(0x1be)](_0x13b8b7(0x1dd));}catch(_0x377062){console[_0x13b8b7(0x24f)](_0x13b8b7(0x236),_0x377062);}}const usernameInput=document[_0xe73751(0x1f1)](_0xe73751(0x21b)),passwordInput=document[_0xe73751(0x1f1)](_0xe73751(0x227)),suggestionsList=document[_0xe73751(0x1f1)]('autocompleteSuggestions');usernameInput[_0xe73751(0x1c4)](_0xe73751(0x259),()=>{const _0x1e8828=_0xe73751,_0x54a496=usernameInput['value']['toLowerCase'](),_0x158015=availableUsernames['filter'](_0x55de2d=>_0x55de2d[_0x1e8828(0x180)]()[_0x1e8828(0x220)](_0x54a496));suggestionsList[_0x1e8828(0x181)]='';if(_0x54a496[_0x1e8828(0x205)]===0x0||_0x158015[_0x1e8828(0x205)]===0x0){suggestionsList[_0x1e8828(0x230)][_0x1e8828(0x1f6)]=_0x1e8828(0x1d1);return;}_0x158015[_0x1e8828(0x1f8)](_0x2b753a=>{const _0x2e469c=_0x1e8828,_0x1ec049=document[_0x2e469c(0x1d9)]('li');_0x1ec049[_0x2e469c(0x1d8)]=_0x2b753a,_0x1ec049['addEventListener'](_0x2e469c(0x1a4),()=>{const _0x32f7cf=_0x2e469c;usernameInput[_0x32f7cf(0x1bc)]=_0x2b753a,suggestionsList[_0x32f7cf(0x181)]='',suggestionsList[_0x32f7cf(0x230)][_0x32f7cf(0x1f6)]=_0x32f7cf(0x1d1);}),suggestionsList[_0x2e469c(0x19b)](_0x1ec049);}),suggestionsList[_0x1e8828(0x230)][_0x1e8828(0x1f6)]='block';}),document[_0xe73751(0x1c4)](_0xe73751(0x1a4),_0x2eaecc=>{const _0xc5527c=_0xe73751;!usernameInput['contains'](_0x2eaecc[_0xc5527c(0x244)])&&!suggestionsList[_0xc5527c(0x22d)](_0x2eaecc[_0xc5527c(0x244)])&&(suggestionsList['style'][_0xc5527c(0x1f6)]=_0xc5527c(0x1d1));});const rememberMeCheckbox=document[_0xe73751(0x1f1)](_0xe73751(0x1ff)),storedUsername=localStorage[_0xe73751(0x1b2)](_0xe73751(0x21b)),storedPassword=localStorage[_0xe73751(0x1b2)](_0xe73751(0x227)),storedTimestamp=localStorage['getItem']('usernameTimestamp'),now=Date['now'](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0xe73751(0x1bc)]=storedUsername,passwordInput[_0xe73751(0x1bc)]=storedPassword,rememberMeCheckbox['checked']=!![]);const loginForm=document[_0xe73751(0x1f1)](_0xe73751(0x17f)),loginError=document[_0xe73751(0x1f1)](_0xe73751(0x202)),ratesSection=document[_0xe73751(0x1a1)](_0xe73751(0x19a)),historySection=document[_0xe73751(0x1f1)](_0xe73751(0x252)),loginSection=document[_0xe73751(0x1f1)](_0xe73751(0x251)),messagesSection=document[_0xe73751(0x1f1)](_0xe73751(0x1a8));loginForm[_0xe73751(0x1c4)](_0xe73751(0x1fc),async _0x18263c=>{const _0x44e256=_0xe73751;_0x18263c[_0x44e256(0x216)](),showLoader();const _0x392e5a=usernameInput[_0x44e256(0x1bc)],_0x553e41=passwordInput[_0x44e256(0x1bc)];vendors[_0x392e5a]&&vendors[_0x392e5a][_0x44e256(0x227)]===_0x553e41?(loginError[_0x44e256(0x230)][_0x44e256(0x1f6)]='none',ratesSection['style'][_0x44e256(0x1f6)]=_0x44e256(0x188),historySection[_0x44e256(0x230)]['display']=_0x44e256(0x1d1),loginSection[_0x44e256(0x230)][_0x44e256(0x1f6)]=_0x44e256(0x1d1),messagesSection[_0x44e256(0x230)][_0x44e256(0x1f6)]=_0x44e256(0x188),currentVendorId=_0x392e5a,rememberMeCheckbox[_0x44e256(0x17c)]?(localStorage['setItem'](_0x44e256(0x21b),_0x392e5a),localStorage['setItem'](_0x44e256(0x227),_0x553e41),localStorage[_0x44e256(0x234)](_0x44e256(0x231),Date[_0x44e256(0x18b)]())):(localStorage[_0x44e256(0x1b3)](_0x44e256(0x21b)),localStorage[_0x44e256(0x1b3)]('password'),localStorage[_0x44e256(0x1b3)](_0x44e256(0x231))),await syncTickets(),loadHistory(),listenForNewMessages(),lucide[_0x44e256(0x1c2)](),hideLoader()):(loginError[_0x44e256(0x230)][_0x44e256(0x1f6)]=_0x44e256(0x188),loginError[_0x44e256(0x1d8)]=_0x44e256(0x1c9),hideLoader());});async function syncTickets(){const _0x18369e=_0xe73751;try{const _0x236e81=document[_0x18369e(0x1a1)]('.loading-message'),_0x11dab3=document['querySelector']('.rates-section\x20table');_0x236e81[_0x18369e(0x230)][_0x18369e(0x1f6)]=_0x18369e(0x188),_0x11dab3['style'][_0x18369e(0x1f6)]='none';const _0x7fe82c=ref(db,'TicketsTotal'),_0x17eb42=await get(_0x7fe82c);_0x17eb42[_0x18369e(0x20e)]()?(localTickets=_0x17eb42[_0x18369e(0x1d0)](),createTicketTable(),_0x236e81[_0x18369e(0x230)][_0x18369e(0x1f6)]=_0x18369e(0x1d1),_0x11dab3[_0x18369e(0x230)][_0x18369e(0x1f6)]=_0x18369e(0x1ed)):_0x236e81[_0x18369e(0x1d8)]=_0x18369e(0x199);}catch(_0x46e3db){console[_0x18369e(0x24f)]('Erreur\x20de\x20synchronisation:',_0x46e3db),loadingMessage['textContent']=_0x18369e(0x1ef);}}async function createTicketTable(){const _0x4181e8=_0xe73751,_0x39988b=document[_0x4181e8(0x1a1)](_0x4181e8(0x238));_0x39988b[_0x4181e8(0x181)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';for(const [_0x438acd,_0xddb36a]of Object['entries'](localTickets)){const _0x2207e0=_0xddb36a[_0x4181e8(0x20d)]?_0xddb36a[_0x4181e8(0x20d)][_0x4181e8(0x205)]:0x0;if(_0x2207e0>0x0){const _0x10e498=_0xddb36a[_0x4181e8(0x1cd)][0x0],_0x12ec87=_0x39988b[_0x4181e8(0x210)]();_0x12ec87[_0x4181e8(0x181)]=_0x4181e8(0x19e)+_0x438acd+_0x4181e8(0x1e0)+_0x10e498+_0x4181e8(0x1e0)+_0x2207e0+_0x4181e8(0x185)+_0x438acd+'\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}}document[_0x4181e8(0x1a1)](_0x4181e8(0x204))['style'][_0x4181e8(0x1f6)]=_0x4181e8(0x1d1),_0x39988b[_0x4181e8(0x230)][_0x4181e8(0x1f6)]=_0x4181e8(0x1ed);}window[_0xe73751(0x196)]=async function(_0x23e5e9){const _0x7633b5=_0xe73751;showLoader();try{const _0x48c375=ref(db,_0x7633b5(0x198)+_0x23e5e9),_0x5d8b12=await get(_0x48c375);if(_0x5d8b12['exists']()){const _0x1b4325=_0x5d8b12[_0x7633b5(0x1d0)]();if(!_0x1b4325[_0x7633b5(0x20d)]||_0x1b4325[_0x7633b5(0x20d)][_0x7633b5(0x205)]===0x0)throw new Error(_0x7633b5(0x18d));ticketToSell={'category':_0x23e5e9,'user':_0x1b4325[_0x7633b5(0x20d)][0x0],'password':_0x1b4325[_0x7633b5(0x255)][0x0],'price':_0x1b4325['prix'][0x0],'updatedData':{..._0x1b4325,'utilisateur':_0x1b4325[_0x7633b5(0x20d)][_0x7633b5(0x1ab)](0x1),'motDePasse':_0x1b4325['motDePasse']['slice'](0x1),'prix':_0x1b4325[_0x7633b5(0x1cd)][_0x7633b5(0x1ab)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x22334e){console['error'](_0x7633b5(0x235),_0x22334e),showNotification(_0x7633b5(0x233),_0x7633b5(0x20c)),hideLoader();}};function _0x26fd(_0x51cdd7,_0x433831){const _0x170557=_0x1705();return _0x26fd=function(_0x26fd4b,_0x4c0312){_0x26fd4b=_0x26fd4b-0x17c;let _0x354fba=_0x170557[_0x26fd4b];return _0x354fba;},_0x26fd(_0x51cdd7,_0x433831);}function showConfirmation(_0x2883f4){const _0x5a5253=_0xe73751,_0x1e45b4=document[_0x5a5253(0x1f1)](_0x5a5253(0x1d6)),_0x505b58=document[_0x5a5253(0x1f1)]('notification-message'),_0x4b0e91=document[_0x5a5253(0x1f1)]('ticket-actions'),_0xae9abe=document[_0x5a5253(0x1f1)](_0x5a5253(0x21d));document['getElementById'](_0x5a5253(0x25a))[_0x5a5253(0x1d8)]=_0x5a5253(0x243),_0x505b58[_0x5a5253(0x181)]=_0x5a5253(0x1fd)+_0x2883f4['category']+_0x5a5253(0x1d3)+_0x2883f4[_0x5a5253(0x189)]+_0x5a5253(0x1b6),_0xae9abe[_0x5a5253(0x230)][_0x5a5253(0x1f6)]=_0x5a5253(0x1b4),_0x4b0e91[_0x5a5253(0x230)][_0x5a5253(0x1f6)]=_0x5a5253(0x1d1),_0x1e45b4[_0x5a5253(0x230)][_0x5a5253(0x1f6)]='block';}window[_0xe73751(0x1b7)]=async function(){const _0x40ee98=_0xe73751;showLoader();if(!ticketToSell){showNotification(_0x40ee98(0x233),_0x40ee98(0x212)),hideLoader();return;}try{const _0x174c6b=ref(db,_0x40ee98(0x198)+ticketToSell[_0x40ee98(0x1ac)]);await set(_0x174c6b,ticketToSell[_0x40ee98(0x1ec)]);const _0x5650f8=ref(db,_0x40ee98(0x24e));await push(_0x5650f8,{'category':ticketToSell['category'],'user':ticketToSell[_0x40ee98(0x24b)],'password':ticketToSell['password'],'price':ticketToSell[_0x40ee98(0x189)],'soldAt':Date[_0x40ee98(0x18b)](),'vendorId':currentVendorId});const _0x15bc6f=ref(db,_0x40ee98(0x184)+currentVendorId);await push(_0x15bc6f,{'category':ticketToSell[_0x40ee98(0x1ac)],'user':ticketToSell[_0x40ee98(0x24b)],'password':ticketToSell[_0x40ee98(0x227)],'price':ticketToSell[_0x40ee98(0x189)],'soldAt':Date[_0x40ee98(0x18b)]()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x1b9db4){console[_0x40ee98(0x24f)]('Erreur\x20lors\x20de\x20la\x20vente:',_0x1b9db4),showNotification(_0x40ee98(0x233),_0x40ee98(0x20f)),hideLoader();}ticketToSell=null;};function showTicketDetails(_0xb7c89){const _0x4d7295=_0xe73751,_0x30abfb=document[_0x4d7295(0x1f1)](_0x4d7295(0x1d6)),_0x52b32f=document[_0x4d7295(0x1f1)](_0x4d7295(0x203)),_0x478743=document[_0x4d7295(0x1f1)](_0x4d7295(0x1d4)),_0x38c97d=document[_0x4d7295(0x1f1)](_0x4d7295(0x21d));document['getElementById'](_0x4d7295(0x25a))[_0x4d7295(0x1d8)]=_0x4d7295(0x17e),_0x52b32f[_0x4d7295(0x181)]=_0x4d7295(0x1dc)+_0xb7c89[_0x4d7295(0x1ac)]+_0x4d7295(0x253)+_0xb7c89['user']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20'+_0xb7c89[_0x4d7295(0x227)]+_0x4d7295(0x1d3)+_0xb7c89[_0x4d7295(0x189)]+'\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x38c97d[_0x4d7295(0x230)]['display']=_0x4d7295(0x1d1),_0x478743['style'][_0x4d7295(0x1f6)]='flex',_0x30abfb[_0x4d7295(0x230)]['display']=_0x4d7295(0x188),lucide[_0x4d7295(0x1c2)]();}function showSaleConfirmation(_0x3668b1){const _0x2bcff2=_0xe73751,_0x5ecea7=document[_0x2bcff2(0x1f1)]('notification'),_0x13527e=document['getElementById'](_0x2bcff2(0x203)),_0x1d64f7=document[_0x2bcff2(0x1f1)](_0x2bcff2(0x193));_0x13527e['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20'+_0x3668b1[_0x2bcff2(0x1ac)]+_0x2bcff2(0x253)+_0x3668b1[_0x2bcff2(0x24b)]+_0x2bcff2(0x246)+_0x3668b1[_0x2bcff2(0x227)]+_0x2bcff2(0x1d3)+_0x3668b1[_0x2bcff2(0x189)]+'\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x1d64f7['innerHTML']=_0x2bcff2(0x228),_0x5ecea7[_0x2bcff2(0x230)][_0x2bcff2(0x1f6)]=_0x2bcff2(0x188),lucide[_0x2bcff2(0x1c2)]();}window[_0xe73751(0x237)]=async function(){const _0x56c001=_0xe73751;showLoader();if(!currentReservedTicket){showNotification('Erreur',_0x56c001(0x1f7)),hideLoader();return;}try{const _0x1899f1=ref(db,'TicketsVendus');await push(_0x1899f1,{...currentReservedTicket,'soldAt':Date[_0x56c001(0x18b)](),'vendorId':currentVendorId});const _0x437a09=ref(db,_0x56c001(0x184)+currentVendorId);await push(_0x437a09,{...currentReservedTicket,'soldAt':Date[_0x56c001(0x18b)]()}),showNotification(_0x56c001(0x1c7),_0x56c001(0x191)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x3f166a){console['error'](_0x56c001(0x186),_0x3f166a),showNotification(_0x56c001(0x233),_0x56c001(0x23e)),hideLoader();}},window[_0xe73751(0x213)]=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0xbf9fa,_0x5cb87e){const _0x22a639=_0xe73751,_0x232207=document[_0x22a639(0x1f1)](_0x22a639(0x1d6)),_0x23ae18=document[_0x22a639(0x1f1)](_0x22a639(0x25a)),_0x4593fc=document['getElementById'](_0x22a639(0x203)),_0x493b1a=document[_0x22a639(0x1f1)](_0x22a639(0x193)),_0xc3cab6=document[_0x22a639(0x1f1)](_0x22a639(0x1d4));_0x23ae18[_0x22a639(0x1d8)]=_0xbf9fa,_0x4593fc[_0x22a639(0x181)]=_0x5cb87e,_0xbf9fa===_0x22a639(0x1c7)||_0xbf9fa==='Erreur'?(_0x493b1a['style'][_0x22a639(0x1f6)]='none',_0xc3cab6['style'][_0x22a639(0x1f6)]=_0x22a639(0x1d1)):(_0x493b1a['style'][_0x22a639(0x1f6)]=_0x22a639(0x1b4),_0xc3cab6[_0x22a639(0x230)][_0x22a639(0x1f6)]=_0x22a639(0x1d1)),_0x232207['style']['display']=_0x22a639(0x188);}window[_0xe73751(0x226)]=function(){const _0x2c2b39=_0xe73751;document[_0x2c2b39(0x1f1)]('notification')[_0x2c2b39(0x230)]['display']=_0x2c2b39(0x1d1);};async function loadHistory(){const _0x72a416=_0xe73751;showLoader();try{const _0x409411=ref(db,_0x72a416(0x184)+currentVendorId),_0x30e1eb=await get(_0x409411);let _0x4af6f5=[];_0x30e1eb['exists']()&&(_0x4af6f5=Object[_0x72a416(0x24c)](_0x30e1eb[_0x72a416(0x1d0)]())[_0x72a416(0x1c8)](([_0x28c325,_0x48808c])=>({'id':_0x28c325,..._0x48808c}))),filterHistory(_0x4af6f5),hideLoader();}catch(_0x39598e){console[_0x72a416(0x24f)]('Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:',_0x39598e),showNotification(_0x72a416(0x233),_0x72a416(0x1e8)),hideLoader();}}function filterHistory(_0x5534a3){const _0x123998=_0xe73751,_0x3523bc=document[_0x123998(0x1f1)](_0x123998(0x1e3))[_0x123998(0x1bc)],_0x2b876e=new Date(),_0x1f2f3f={'today':new Date(_0x2b876e[_0x123998(0x1df)](0x0,0x0,0x0,0x0)),'week':new Date(_0x2b876e[_0x123998(0x256)](_0x2b876e[_0x123998(0x1c3)]()-_0x2b876e[_0x123998(0x20b)]())),'month':new Date(_0x2b876e['setDate'](0x1)),'all':new Date(0x0)};let _0x4c98c3=_0x5534a3;_0x3523bc!==_0x123998(0x21f)&&(_0x4c98c3=_0x5534a3[_0x123998(0x25e)](_0x30f4ee=>new Date(_0x30f4ee[_0x123998(0x222)])>=_0x1f2f3f[_0x3523bc])),updateStats(_0x4c98c3),updateHistoryTable(_0x4c98c3);}window[_0xe73751(0x1cb)]=function(){const _0x71bb1a=_0xe73751,_0x44480c=new Date(document[_0x71bb1a(0x1f1)](_0x71bb1a(0x239))['value']),_0x3e011b=new Date(document[_0x71bb1a(0x1f1)](_0x71bb1a(0x23a))[_0x71bb1a(0x1bc)]);_0x3e011b[_0x71bb1a(0x1df)](0x17,0x3b,0x3b);if(isNaN(_0x44480c[_0x71bb1a(0x1d5)]())||isNaN(_0x3e011b[_0x71bb1a(0x1d5)]())){showNotification(_0x71bb1a(0x233),_0x71bb1a(0x1c5));return;}const _0x5d79a1=ref(db,_0x71bb1a(0x184)+currentVendorId);get(_0x5d79a1)[_0x71bb1a(0x20a)](_0x5311b9=>{const _0x10b618=_0x71bb1a;let _0x196a9e=[];_0x5311b9[_0x10b618(0x20e)]()&&(_0x196a9e=Object[_0x10b618(0x24c)](_0x5311b9[_0x10b618(0x1d0)]())[_0x10b618(0x1c8)](([_0xe4514f,_0x2f278b])=>({'id':_0xe4514f,..._0x2f278b})));const _0x4436c9=_0x196a9e[_0x10b618(0x25e)](_0xca52e3=>{const _0xcdae9f=_0x10b618,_0x59fedb=new Date(_0xca52e3[_0xcdae9f(0x222)]);return _0x59fedb>=_0x44480c&&_0x59fedb<=_0x3e011b;});updateStats(_0x4436c9),updateHistoryTable(_0x4436c9);});};function updateStats(_0x1b59a2){const _0x10687e=_0xe73751,_0x30593f=_0x1b59a2[_0x10687e(0x205)],_0x257d4a=_0x1b59a2['reduce']((_0x25d35a,_0x26a8e8)=>_0x25d35a+parseFloat(_0x26a8e8[_0x10687e(0x189)]),0x0),_0x274865=_0x1b59a2[_0x10687e(0x1ee)]((_0x206e92,_0xa9b9d8)=>{const _0x11fb0f=_0x10687e;return _0x206e92[_0xa9b9d8[_0x11fb0f(0x1ac)]]=(_0x206e92[_0xa9b9d8[_0x11fb0f(0x1ac)]]||0x0)+0x1,_0x206e92;},{}),_0x873bd4=Object[_0x10687e(0x24c)](_0x274865)[_0x10687e(0x1af)]((_0x110127,_0x38ef07)=>_0x38ef07[0x1]-_0x110127[0x1])[0x0]?.[0x0]||'-',_0x361503=_0x1b59a2[_0x10687e(0x205)]>0x0?Math['max'](0x1,Math[_0x10687e(0x250)]((Date[_0x10687e(0x18b)]()-Math[_0x10687e(0x25b)](..._0x1b59a2[_0x10687e(0x1c8)](_0x576faa=>_0x576faa[_0x10687e(0x222)])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x575f9f=(_0x30593f/_0x361503)['toFixed'](0x1);document[_0x10687e(0x1f1)](_0x10687e(0x21a))['textContent']=_0x30593f,document[_0x10687e(0x1f1)](_0x10687e(0x241))['textContent']=_0x257d4a[_0x10687e(0x219)]()+_0x10687e(0x217),document[_0x10687e(0x1f1)](_0x10687e(0x1bf))[_0x10687e(0x1d8)]=_0x873bd4,document['getElementById'](_0x10687e(0x1eb))[_0x10687e(0x1d8)]=_0x575f9f;}function updateHistoryTable(_0x3b6f83){const _0x5516d5=_0xe73751,_0x16afdb=document[_0x5516d5(0x1f1)]('historyTableBody');_0x16afdb[_0x5516d5(0x181)]=_0x3b6f83[_0x5516d5(0x1af)]((_0x49b22c,_0x37e31a)=>_0x37e31a[_0x5516d5(0x222)]-_0x49b22c[_0x5516d5(0x222)])[_0x5516d5(0x1c8)](_0x1c64a4=>_0x5516d5(0x22c)+_0x1c64a4['id']+_0x5516d5(0x223)+new Date(_0x1c64a4['soldAt'])[_0x5516d5(0x219)]()+_0x5516d5(0x1e0)+_0x1c64a4[_0x5516d5(0x1ac)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x1c64a4[_0x5516d5(0x24b)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x1c64a4[_0x5516d5(0x189)]+_0x5516d5(0x1fe))[_0x5516d5(0x1ce)]('');}window['showTicketDetailsFromHistory']=async function(_0x127e6d){const _0x10bb38=_0xe73751;showLoader();try{const _0x36a75b=ref(db,_0x10bb38(0x184)+currentVendorId+'/'+_0x127e6d),_0x3c7433=await get(_0x36a75b);if(_0x3c7433['exists']()){const _0x104637=_0x3c7433[_0x10bb38(0x1d0)]();window[_0x10bb38(0x1bd)](),showTicketDetails(_0x104637),hideLoader();}else showNotification(_0x10bb38(0x233),_0x10bb38(0x1e9)),hideLoader();}catch(_0x11057f){console[_0x10bb38(0x24f)](_0x10bb38(0x197),_0x11057f),showNotification(_0x10bb38(0x233),_0x10bb38(0x1b1)),hideLoader();}},window[_0xe73751(0x1b0)]=function(){const _0x16a3b1=_0xe73751,_0x72faf8=document['getElementById'](_0x16a3b1(0x252)),_0x1e51ad=_0x72faf8[_0x16a3b1(0x230)]['display']===_0x16a3b1(0x188);_0x72faf8[_0x16a3b1(0x230)]['display']=_0x1e51ad?_0x16a3b1(0x1d1):_0x16a3b1(0x188),!_0x1e51ad&&loadHistory();},window['closeHistory']=function(){const _0x40a27c=_0xe73751;document['getElementById'](_0x40a27c(0x252))[_0x40a27c(0x230)][_0x40a27c(0x1f6)]=_0x40a27c(0x1d1);},window[_0xe73751(0x1c1)]=function(){loadHistory();};function listenForNewMessages(){const _0xa02474=_0xe73751,_0x1f9947=ref(db,_0xa02474(0x214)+currentVendorId+_0xa02474(0x18f));onChildAdded(_0x1f9947,_0x592475=>{const _0x3198fa=_0xa02474,_0x345971=_0x592475[_0x3198fa(0x1d0)]();displayNewMessage(_0x345971);});}function displayNewMessage(_0x240a6d){const _0x5d256f=_0xe73751,_0x8d7e4=document[_0x5d256f(0x1f1)]('messagesContainer'),_0x57942e=document[_0x5d256f(0x1d9)]('div');_0x57942e[_0x5d256f(0x1a7)][_0x5d256f(0x1a5)]('message'),_0x57942e[_0x5d256f(0x181)]=_0x5d256f(0x242)+_0x240a6d[_0x5d256f(0x23d)]+_0x5d256f(0x22b)+new Date(_0x240a6d['timestamp'])[_0x5d256f(0x219)]()+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x8d7e4['appendChild'](_0x57942e),_0x8d7e4[_0x5d256f(0x1e2)]=_0x8d7e4['scrollHeight'];}window['shareTicket']=function(){const _0x30966b=_0xe73751,_0x1cb0f8=document[_0x30966b(0x1f1)](_0x30966b(0x203))[_0x30966b(0x18c)];navigator[_0x30966b(0x1a6)]?navigator[_0x30966b(0x1a6)]({'title':_0x30966b(0x1b8),'text':_0x1cb0f8})[_0x30966b(0x20a)](()=>console[_0x30966b(0x1be)](_0x30966b(0x1cc)))[_0x30966b(0x1de)](_0x1f1d0a=>console[_0x30966b(0x24f)]('Erreur\x20lors\x20du\x20partage:',_0x1f1d0a)):alert(_0x30966b(0x258));},window[_0xe73751(0x24a)]=function(){const _0x4534b8=_0xe73751,_0x26f184=document[_0x4534b8(0x1f1)](_0x4534b8(0x203))[_0x4534b8(0x18c)];navigator[_0x4534b8(0x19f)][_0x4534b8(0x232)](_0x26f184)['then'](()=>{const _0x3c9fe2=_0x4534b8;showNotification(_0x3c9fe2(0x1c7),_0x3c9fe2(0x22f));})['catch'](_0x2c96ff=>{const _0x4b565e=_0x4534b8;console[_0x4b565e(0x24f)]('Erreur\x20lors\x20de\x20la\x20copie:',_0x2c96ff),showNotification('Erreur','Impossible\x20de\x20copier\x20le\x20ticket');});},window[_0xe73751(0x190)]=async function(){const _0x30035c=_0xe73751;showLoader();const _0x31ec1a=document[_0x30035c(0x1f1)](_0x30035c(0x203)),_0x1795da=new jsPDF(),_0x5f4145=await html2canvas(_0x31ec1a),_0xdf035=_0x5f4145[_0x30035c(0x22a)](_0x30035c(0x229));_0x1795da[_0x30035c(0x1e1)](_0xdf035,_0x30035c(0x1da),0xa,0xa,0xbe,0x0),_0x1795da[_0x30035c(0x1aa)](_0x30035c(0x1f5)),hideLoader();},window[_0xe73751(0x1c6)]=function(){window['print']();},window['exportToPDFHistory']=function(){const _0x39b0be=_0xe73751,{jsPDF:_0x50fb6f}=window[_0x39b0be(0x1e5)],_0x32da7e=new _0x50fb6f(),_0x5bb299=document[_0x39b0be(0x1f1)](_0x39b0be(0x200)),_0x3b5523={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x39b0be(0x18e),'halign':_0x39b0be(0x1bb)},_0x52d877={'halign':_0x39b0be(0x1f4)},_0x4cc933={'theme':_0x39b0be(0x1a3),'headStyles':_0x3b5523,'bodyStyles':_0x52d877,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x561382){const _0x300c57=_0x39b0be;_0x32da7e['text']('Historique\x20des\x20ventes',0xe,0xf);const _0x95d77a=_0x300c57(0x1db)+_0x32da7e[_0x300c57(0x215)]['getNumberOfPages']();_0x32da7e['setFontSize'](0xa);const _0x41d72a=_0x32da7e[_0x300c57(0x215)]['pageSize'],_0x3d5c75=_0x41d72a[_0x300c57(0x23b)]?_0x41d72a[_0x300c57(0x23b)]:_0x41d72a[_0x300c57(0x23f)]();_0x32da7e[_0x300c57(0x1c0)](_0x95d77a,_0x561382[_0x300c57(0x1cf)][_0x300c57(0x207)]['left'],_0x3d5c75-0xa),_0x32da7e[_0x300c57(0x1c0)](new Date()[_0x300c57(0x219)](),_0x41d72a[_0x300c57(0x225)]-_0x561382[_0x300c57(0x1cf)]['margin'][_0x300c57(0x23c)]-0x28,_0x3d5c75-0xa);}};_0x32da7e[_0x39b0be(0x1f3)]({'html':_0x39b0be(0x187),..._0x4cc933}),_0x32da7e[_0x39b0be(0x1aa)]('historique_ventes.pdf');},window['exportToExcelHistory']=function(){const _0x2607be=_0xe73751,_0x148aeb=XLSX[_0x2607be(0x182)]['table_to_book'](document[_0x2607be(0x1f1)](_0x2607be(0x200)),{'sheet':_0x2607be(0x1d2)}),_0x1afe2b=XLSX[_0x2607be(0x22e)](_0x148aeb,{'bookType':_0x2607be(0x183),'type':_0x2607be(0x218)});function _0x2a31c7(_0x254af3){const _0x2ce417=_0x2607be,_0x4dd6f9=new ArrayBuffer(_0x254af3[_0x2ce417(0x205)]),_0x23c985=new Uint8Array(_0x4dd6f9);for(let _0x415aca=0x0;_0x415aca<_0x254af3[_0x2ce417(0x205)];_0x415aca++)_0x23c985[_0x415aca]=_0x254af3[_0x2ce417(0x1ad)](_0x415aca)&0xff;return _0x4dd6f9;}saveAs(new Blob([_0x2a31c7(_0x1afe2b)],{'type':_0x2607be(0x1ca)}),_0x2607be(0x245));};function showLoader(){const _0x5cf190=_0xe73751;document[_0x5cf190(0x1f1)](_0x5cf190(0x1a2))[_0x5cf190(0x230)][_0x5cf190(0x1f6)]='block';}function hideLoader(){const _0x539040=_0xe73751;document['getElementById'](_0x539040(0x1a2))[_0x539040(0x230)][_0x539040(0x1f6)]=_0x539040(0x1d1);}function showPageLoader(){const _0x5d4d4a=_0xe73751;document[_0x5d4d4a(0x1f1)]('pageLoaderWrapper')[_0x5d4d4a(0x230)]['display']=_0x5d4d4a(0x1b4);}function hidePageLoader(){const _0x147e2d=_0xe73751;document['getElementById'](_0x147e2d(0x25d))[_0x147e2d(0x230)]['display']=_0x147e2d(0x1d1);}function showSubscriptionRequiredModal(){const _0x1cba2d=_0xe73751;subscriptionRequiredModal[_0x1cba2d(0x230)][_0x1cba2d(0x1f6)]=_0x1cba2d(0x1b4);}function hideSubscriptionRequiredModal(){const _0x41a575=_0xe73751;subscriptionRequiredModal['style']['display']=_0x41a575(0x1d1);}function redirectToSubscription(){const _0x171e83=_0xe73751;window[_0x171e83(0x192)][_0x171e83(0x1a9)]='index.html';}async function checkSubscriptionStatus(){const _0x371db7=_0xe73751,_0xbf0452=document[_0x371db7(0x1f1)](_0x371db7(0x247));_0xbf0452['textContent']=_0x371db7(0x248);try{const _0xce24b5=await get(adminRef),_0x5e716a=_0xce24b5[_0x371db7(0x1d0)](),_0x2a2035=new Date();if(_0x5e716a&&_0x5e716a['status']===_0x371db7(0x25c)){const _0x40116e=new Date(_0x5e716a[_0x371db7(0x23a)]);_0x40116e<_0x2a2035?(_0xbf0452[_0x371db7(0x1d8)]=_0x371db7(0x1fb),showSubscriptionRequiredModal(),await adminRef['update']({'status':'expired'})):_0xbf0452[_0x371db7(0x1d8)]=_0x371db7(0x1f2);}else _0xbf0452[_0x371db7(0x1d8)]=_0x371db7(0x1d7),showSubscriptionRequiredModal();}catch(_0x5026e8){console[_0x371db7(0x24f)](_0x371db7(0x21c),_0x5026e8),_0xbf0452['textContent']='Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement',showNotification(_0x371db7(0x233),_0x371db7(0x19d));}}document[_0xe73751(0x1c4)](_0xe73751(0x21e),()=>{const _0x4c02ce=_0xe73751;checkSubscriptionStatus()[_0x4c02ce(0x20a)](()=>{const _0x30c6dd=_0x4c02ce;fetchVendors(),lucide[_0x30c6dd(0x1c2)](),hidePageLoader();})[_0x4c02ce(0x1de)](_0xc44eeb=>{const _0x10dc55=_0x4c02ce;console[_0x10dc55(0x24f)](_0x10dc55(0x1e6),_0xc44eeb),showNotification('Erreur',_0x10dc55(0x1ba)),hidePageLoader();});}),window[_0xe73751(0x24d)]=redirectToSubscription,window['hideSubscriptionRequiredModal']=redirectToSubscription;
    </script>
</body>
</html>
