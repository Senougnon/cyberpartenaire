<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Ticket</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i data-lucide="share-2"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i data-lucide="file-text"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i data-lucide="history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i data-lucide="printer"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i data-lucide="file-down"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x4d64bf=_0x1a11;(function(_0x56a64c,_0x5b7567){const _0x5ffa00=_0x1a11,_0x20e431=_0x56a64c();while(!![]){try{const _0x5639f5=-parseInt(_0x5ffa00(0x12e))/0x1*(parseInt(_0x5ffa00(0x14e))/0x2)+-parseInt(_0x5ffa00(0xfa))/0x3+parseInt(_0x5ffa00(0x1b7))/0x4*(parseInt(_0x5ffa00(0x10f))/0x5)+-parseInt(_0x5ffa00(0x166))/0x6*(parseInt(_0x5ffa00(0x1bf))/0x7)+-parseInt(_0x5ffa00(0x11b))/0x8*(-parseInt(_0x5ffa00(0x103))/0x9)+parseInt(_0x5ffa00(0x12f))/0xa+parseInt(_0x5ffa00(0x16a))/0xb;if(_0x5639f5===_0x5b7567)break;else _0x20e431['push'](_0x20e431['shift']());}catch(_0x340cfc){_0x20e431['push'](_0x20e431['shift']());}}}(_0x2258,0xf418c));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':_0x4d64bf(0x195),'authDomain':_0x4d64bf(0x1b6),'databaseURL':_0x4d64bf(0x1bd),'projectId':'wifi-zone-tanto','storageBucket':_0x4d64bf(0x1b3),'messagingSenderId':_0x4d64bf(0x161),'appId':'1:244600435822:web:574f154301e4d852d1627f','measurementId':'G-V9RB51B16P'},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x4d64bf(0x11e));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window[_0x4d64bf(0x1ac)]=window[_0x4d64bf(0xf9)][_0x4d64bf(0x1ac)];async function fetchVendors(){const _0x473e5a=_0x4d64bf;try{const _0xc9b575=ref(db,_0x473e5a(0x102)),_0x3e4838=await get(_0xc9b575);_0x3e4838[_0x473e5a(0x15a)]()?(vendors=_0x3e4838[_0x473e5a(0x17d)](),availableUsernames=Object[_0x473e5a(0x164)](vendors)):console['log'](_0x473e5a(0x18c));}catch(_0x3371c8){console[_0x473e5a(0x13a)]('Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:',_0x3371c8);}}const usernameInput=document[_0x4d64bf(0x10e)]('username'),passwordInput=document[_0x4d64bf(0x10e)](_0x4d64bf(0x1c7)),suggestionsList=document['getElementById'](_0x4d64bf(0x160));usernameInput[_0x4d64bf(0x153)](_0x4d64bf(0x1c5),()=>{const _0x4f04c5=_0x4d64bf,_0x2903b8=usernameInput[_0x4f04c5(0x10b)][_0x4f04c5(0x147)](),_0x38ec60=availableUsernames[_0x4f04c5(0x199)](_0x4375e2=>_0x4375e2[_0x4f04c5(0x147)]()[_0x4f04c5(0xf3)](_0x2903b8));suggestionsList['innerHTML']='';if(_0x2903b8[_0x4f04c5(0x14c)]===0x0||_0x38ec60['length']===0x0){suggestionsList[_0x4f04c5(0x177)][_0x4f04c5(0x136)]=_0x4f04c5(0x172);return;}_0x38ec60['forEach'](_0x4fd8cb=>{const _0x13a2d9=_0x4f04c5,_0x2b1a26=document[_0x13a2d9(0x189)]('li');_0x2b1a26[_0x13a2d9(0x1bb)]=_0x4fd8cb,_0x2b1a26['addEventListener'](_0x13a2d9(0x16e),()=>{const _0x4f1fc5=_0x13a2d9;usernameInput[_0x4f1fc5(0x10b)]=_0x4fd8cb,suggestionsList[_0x4f1fc5(0x196)]='',suggestionsList['style']['display']=_0x4f1fc5(0x172);}),suggestionsList[_0x13a2d9(0x142)](_0x2b1a26);}),suggestionsList[_0x4f04c5(0x177)][_0x4f04c5(0x136)]=_0x4f04c5(0x191);}),document[_0x4d64bf(0x153)](_0x4d64bf(0x16e),_0x4e8948=>{const _0x1c16b0=_0x4d64bf;!usernameInput[_0x1c16b0(0x194)](_0x4e8948['target'])&&!suggestionsList[_0x1c16b0(0x194)](_0x4e8948[_0x1c16b0(0x13c)])&&(suggestionsList[_0x1c16b0(0x177)]['display']=_0x1c16b0(0x172));});const rememberMeCheckbox=document[_0x4d64bf(0x10e)](_0x4d64bf(0x15b)),storedUsername=localStorage['getItem'](_0x4d64bf(0x1cc)),storedPassword=localStorage['getItem'](_0x4d64bf(0x1c7)),storedTimestamp=localStorage[_0x4d64bf(0x19d)]('usernameTimestamp'),now=Date[_0x4d64bf(0x1b4)](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput[_0x4d64bf(0x10b)]=storedUsername,passwordInput['value']=storedPassword,rememberMeCheckbox['checked']=!![]);const loginForm=document['getElementById'](_0x4d64bf(0x1ca)),loginError=document[_0x4d64bf(0x10e)](_0x4d64bf(0xf0)),ratesSection=document['querySelector'](_0x4d64bf(0x1b0)),historySection=document[_0x4d64bf(0x10e)](_0x4d64bf(0x1af)),loginSection=document['getElementById'](_0x4d64bf(0x154)),messagesSection=document[_0x4d64bf(0x10e)](_0x4d64bf(0x173));loginForm['addEventListener']('submit',async _0x5740ea=>{const _0x5441d9=_0x4d64bf;_0x5740ea['preventDefault'](),showLoader();const _0x4fdfd0=usernameInput[_0x5441d9(0x10b)],_0x2d7536=passwordInput['value'];vendors[_0x4fdfd0]&&vendors[_0x4fdfd0][_0x5441d9(0x1c7)]===_0x2d7536?(loginError[_0x5441d9(0x177)][_0x5441d9(0x136)]='none',ratesSection['style'][_0x5441d9(0x136)]=_0x5441d9(0x191),historySection[_0x5441d9(0x177)]['display']=_0x5441d9(0x172),loginSection[_0x5441d9(0x177)][_0x5441d9(0x136)]=_0x5441d9(0x172),messagesSection[_0x5441d9(0x177)][_0x5441d9(0x136)]='block',currentVendorId=_0x4fdfd0,rememberMeCheckbox[_0x5441d9(0x10a)]?(localStorage[_0x5441d9(0x130)](_0x5441d9(0x1cc),_0x4fdfd0),localStorage['setItem'](_0x5441d9(0x1c7),_0x2d7536),localStorage[_0x5441d9(0x130)](_0x5441d9(0x1c3),Date[_0x5441d9(0x1b4)]())):(localStorage['removeItem']('username'),localStorage[_0x5441d9(0xf4)]('password'),localStorage[_0x5441d9(0xf4)](_0x5441d9(0x1c3))),await syncTickets(),loadHistory(),listenForNewMessages(),lucide['createIcons'](),hideLoader()):(loginError[_0x5441d9(0x177)][_0x5441d9(0x136)]=_0x5441d9(0x191),loginError[_0x5441d9(0x1bb)]='Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.',hideLoader());});async function syncTickets(){const _0x4482cf=_0x4d64bf;try{const _0x2b59ba=document[_0x4482cf(0x11c)](_0x4482cf(0x16b)),_0x76ea3f=document[_0x4482cf(0x11c)](_0x4482cf(0x110));_0x2b59ba['style'][_0x4482cf(0x136)]=_0x4482cf(0x191),_0x76ea3f['style'][_0x4482cf(0x136)]=_0x4482cf(0x172);const _0x7d5665=ref(db,_0x4482cf(0x1a7)),_0x546ef1=await get(_0x7d5665);_0x546ef1[_0x4482cf(0x15a)]()?(localTickets=_0x546ef1[_0x4482cf(0x17d)](),createTicketTable(),_0x2b59ba[_0x4482cf(0x177)][_0x4482cf(0x136)]=_0x4482cf(0x172),_0x76ea3f['style']['display']=_0x4482cf(0x197)):_0x2b59ba[_0x4482cf(0x1bb)]=_0x4482cf(0x184);}catch(_0x303130){console[_0x4482cf(0x13a)]('Erreur\x20de\x20synchronisation:',_0x303130),loadingMessage['textContent']=_0x4482cf(0x1be);}}async function createTicketTable(){const _0x4b2c1f=_0x4d64bf,_0x1a0f83=document[_0x4b2c1f(0x11c)]('.rates-section\x20table');_0x1a0f83[_0x4b2c1f(0x196)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';for(const [_0x50b576,_0x559786]of Object[_0x4b2c1f(0x15d)](localTickets)){const _0x187d3d=_0x559786['utilisateur']?_0x559786[_0x4b2c1f(0x180)][_0x4b2c1f(0x14c)]:0x0;if(_0x187d3d>0x0){const _0x36a781=_0x559786['prix'][0x0],_0x5daf71=_0x1a0f83['insertRow']();_0x5daf71['innerHTML']=_0x4b2c1f(0x159)+_0x50b576+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x36a781+_0x4b2c1f(0x13d)+_0x187d3d+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27'+_0x50b576+_0x4b2c1f(0x115);}}document[_0x4b2c1f(0x11c)](_0x4b2c1f(0x16b))['style'][_0x4b2c1f(0x136)]=_0x4b2c1f(0x172),_0x1a0f83[_0x4b2c1f(0x177)][_0x4b2c1f(0x136)]=_0x4b2c1f(0x197);}function _0x2258(){const _0x32382d=['textContent','print','https://wifi-zone-tanto-default-rtdb.firebaseio.com','Erreur\x20de\x20synchronisation\x20des\x20tickets.','7nMOYdv','totalRevenue','Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.','save','usernameTimestamp','utils','input','TicketsTotal/','password','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','getDate','loginForm','getDay','username','charCodeAt','loginError','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','startsWith','removeItem','ceil','notification-title','avgDaily','VendorsHistory/','jspdf','4059543VKlDxr','\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Erreur:','/messages','periodFilter','redirectToSubscription','confirmation-buttons','text','Vendors','27fqVcCm','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','all','catch','add','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','then','checked','value','settings','join','getElementById','5iiFzuK','.rates-section\x20table','Ticket\x20vendu\x20avec\x20succès!','endDate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','historique_ventes.pdf','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','DOMContentLoaded','price','user','confirmSale','4375288syqmtm','querySelector','sort','admin/subscription','updatedData','topCategory','Plus\x20de\x20tickets\x20disponibles','notification-message','Ventes','Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente','getTime','filterHistoryByDateRange','Impossible\x20de\x20copier\x20le\x20ticket','Vérification\x20de\x20l\x27abonnement...','Erreur\x20de\x20confirmation:','Erreur\x20lors\x20de\x20la\x20copie:','prix','clipboard','hideSubscriptionRequiredModal','8VPlQxs','5761850lEyndz','setItem','autoTable','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','classList','max','proceedWithSale','display','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','grid','toFixed','error','internal','target','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Détails\x20du\x20Ticket','\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','totalTickets','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','appendChild','content','image/png','xlsx','Impossible\x20de\x20finaliser\x20la\x20vente','toLowerCase','table_to_book','update','getNumberOfPages','setDate','length','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','485198AkRrpg','href','Ticket\x20introuvable\x20dans\x20l\x27historique','notification','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','addEventListener','loginSection','Erreur','binary','toLocaleString','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','exists','rememberMe','toggleHistory','entries','status','Abonnement\x20actif','autocompleteSuggestions','244600435822','slice','div','keys','map','11051406uLkmjq','scrollTop','height','Vendors/','28664053LjhXGc','.loading-message','category','ticket.pdf','click','historyTableBody','Aucun\x20ticket\x20à\x20vendre','Confirmation\x20de\x20vente','none','messagesSection','Erreur\x20lors\x20de\x20la\x20vente:','shareTicket','Aucun\x20ticket\x20en\x20cours\x20de\x20vente','style','filterHistory','TicketsVendus','Succès','pageLoaderWrapper','addImage','val','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','flex','utilisateur','\x20FCFA','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>','soldAt','Aucun\x20ticket\x20disponible.','initTicketSale','#historyTableBody','writeText','application/octet-stream','createElement','Ticket\x20vendu\x20avec\x20succès','margin','Aucun\x20vendeur\x20trouvé.','write','Erreur\x20lors\x20du\x20partage:','closeHistory','timestamp','block','pageLoaderMessage','pageSize','contains','AIzaSyDg4IhUtLPJZTJE9ZIvbfB6Td9hNVmLTT0','innerHTML','table','exportToExcelHistory','filter','printHistory','expired','ticket-actions','getItem','Erreur\x20lors\x20de\x20l\x27initialisation\x20:','width','notification-buttons','startDate','right','log','loaderWrapper','showTicketDetailsFromHistory','setHours','TicketsTotal','cancelSale','toDataURL','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Historique\x20des\x20ventes','jsPDF','createIcons','messagesContainer','historySection','.rates-section','reduce','Partage\x20réussi','wifi-zone-tanto.firebasestorage.app','now','left','wifi-zone-tanto.firebaseapp.com','5251812xzHqFZ','Impossible\x20de\x20récupérer\x20le\x20ticket','share','motDePasse'];_0x2258=function(){return _0x32382d;};return _0x2258();}window[_0x4d64bf(0x185)]=async function(_0x454015){const _0x3c0386=_0x4d64bf;showLoader();try{const _0xf4408f=ref(db,_0x3c0386(0x1c6)+_0x454015),_0x35b277=await get(_0xf4408f);if(_0x35b277['exists']()){const _0x4eb647=_0x35b277[_0x3c0386(0x17d)]();if(!_0x4eb647['utilisateur']||_0x4eb647[_0x3c0386(0x180)]['length']===0x0)throw new Error(_0x3c0386(0x121));ticketToSell={'category':_0x454015,'user':_0x4eb647[_0x3c0386(0x180)][0x0],'password':_0x4eb647['motDePasse'][0x0],'price':_0x4eb647[_0x3c0386(0x12b)][0x0],'updatedData':{..._0x4eb647,'utilisateur':_0x4eb647[_0x3c0386(0x180)][_0x3c0386(0x162)](0x1),'motDePasse':_0x4eb647[_0x3c0386(0x1ba)][_0x3c0386(0x162)](0x1),'prix':_0x4eb647[_0x3c0386(0x12b)][_0x3c0386(0x162)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x203bf0){console[_0x3c0386(0x13a)](_0x3c0386(0xfc),_0x203bf0),showNotification('Erreur',_0x3c0386(0x1b8)),hideLoader();}};function showConfirmation(_0x23b84d){const _0x30f87b=_0x4d64bf,_0x4abffd=document[_0x30f87b(0x10e)](_0x30f87b(0x151)),_0x5173db=document[_0x30f87b(0x10e)](_0x30f87b(0x122)),_0x3227ee=document['getElementById'](_0x30f87b(0x19c)),_0x480b5f=document[_0x30f87b(0x10e)](_0x30f87b(0x100));document[_0x30f87b(0x10e)](_0x30f87b(0xf6))['textContent']=_0x30f87b(0x171),_0x5173db['innerHTML']=_0x30f87b(0x132)+_0x23b84d[_0x30f87b(0x16c)]+_0x30f87b(0x158)+_0x23b84d[_0x30f87b(0x118)]+_0x30f87b(0x152),_0x480b5f[_0x30f87b(0x177)]['display']='flex',_0x3227ee[_0x30f87b(0x177)][_0x30f87b(0x136)]=_0x30f87b(0x172),_0x4abffd[_0x30f87b(0x177)][_0x30f87b(0x136)]=_0x30f87b(0x191);}window[_0x4d64bf(0x135)]=async function(){const _0x1f59dd=_0x4d64bf;showLoader();if(!ticketToSell){showNotification('Erreur',_0x1f59dd(0x170)),hideLoader();return;}try{const _0xc5d677=ref(db,_0x1f59dd(0x1c6)+ticketToSell[_0x1f59dd(0x16c)]);await set(_0xc5d677,ticketToSell[_0x1f59dd(0x11f)]);const _0xe2dd32=ref(db,_0x1f59dd(0x179));await push(_0xe2dd32,{'category':ticketToSell[_0x1f59dd(0x16c)],'user':ticketToSell[_0x1f59dd(0x119)],'password':ticketToSell['password'],'price':ticketToSell[_0x1f59dd(0x118)],'soldAt':Date[_0x1f59dd(0x1b4)](),'vendorId':currentVendorId});const _0x49008f=ref(db,_0x1f59dd(0xf8)+currentVendorId);await push(_0x49008f,{'category':ticketToSell['category'],'user':ticketToSell[_0x1f59dd(0x119)],'password':ticketToSell['password'],'price':ticketToSell[_0x1f59dd(0x118)],'soldAt':Date[_0x1f59dd(0x1b4)]()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x5e9394){console[_0x1f59dd(0x13a)](_0x1f59dd(0x174),_0x5e9394),showNotification(_0x1f59dd(0x155),_0x1f59dd(0x146)),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x70b9ac){const _0x2ab5cd=_0x4d64bf,_0x4ff673=document[_0x2ab5cd(0x10e)]('notification'),_0x191a14=document[_0x2ab5cd(0x10e)](_0x2ab5cd(0x122)),_0x142f5b=document[_0x2ab5cd(0x10e)](_0x2ab5cd(0x19c)),_0x1c4a04=document[_0x2ab5cd(0x10e)](_0x2ab5cd(0x100));document[_0x2ab5cd(0x10e)]('notification-title')[_0x2ab5cd(0x1bb)]=_0x2ab5cd(0x18a),_0x191a14[_0x2ab5cd(0x196)]=_0x2ab5cd(0x113)+_0x70b9ac[_0x2ab5cd(0x16c)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x70b9ac['user']+_0x2ab5cd(0xf2)+_0x70b9ac['password']+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x70b9ac[_0x2ab5cd(0x118)]+_0x2ab5cd(0x152),_0x1c4a04[_0x2ab5cd(0x177)]['display']=_0x2ab5cd(0x172),_0x142f5b['style'][_0x2ab5cd(0x136)]='flex',_0x4ff673[_0x2ab5cd(0x177)]['display']='block',lucide[_0x2ab5cd(0x1ad)]();}function showSaleConfirmation(_0x2665d4){const _0x37468d=_0x4d64bf,_0xa1fc20=document[_0x37468d(0x10e)](_0x37468d(0x151)),_0x57c5ea=document[_0x37468d(0x10e)](_0x37468d(0x122)),_0x2e9b90=document[_0x37468d(0x10e)](_0x37468d(0x1a0));_0x57c5ea[_0x37468d(0x196)]=_0x37468d(0x113)+_0x2665d4[_0x37468d(0x16c)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x2665d4[_0x37468d(0x119)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20'+_0x2665d4[_0x37468d(0x1c7)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20'+_0x2665d4['price']+_0x37468d(0x152),_0x2e9b90[_0x37468d(0x196)]=_0x37468d(0x1aa),_0xa1fc20['style'][_0x37468d(0x136)]=_0x37468d(0x191),lucide[_0x37468d(0x1ad)]();}window[_0x4d64bf(0x11a)]=async function(){const _0x2dfd0d=_0x4d64bf;showLoader();if(!currentReservedTicket){showNotification(_0x2dfd0d(0x155),_0x2dfd0d(0x176)),hideLoader();return;}try{const _0x22f640=ref(db,_0x2dfd0d(0x179));await push(_0x22f640,{...currentReservedTicket,'soldAt':Date['now'](),'vendorId':currentVendorId});const _0x32d5e0=ref(db,_0x2dfd0d(0xf8)+currentVendorId);await push(_0x32d5e0,{...currentReservedTicket,'soldAt':Date['now']()}),showNotification('Succès',_0x2dfd0d(0x111)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x2df57e){console[_0x2dfd0d(0x13a)](_0x2dfd0d(0x129),_0x2df57e),showNotification(_0x2dfd0d(0x155),_0x2dfd0d(0x124)),hideLoader();}},window[_0x4d64bf(0x1a8)]=function(){currentReservedTicket=null,hideNotification();};function showNotification(_0x2a9cbe,_0x425a4f){const _0x16c804=_0x4d64bf,_0x233b07=document['getElementById'](_0x16c804(0x151)),_0x39a688=document[_0x16c804(0x10e)]('notification-title'),_0x1245dc=document[_0x16c804(0x10e)](_0x16c804(0x122)),_0x5d15de=document[_0x16c804(0x10e)]('notification-buttons'),_0x2fcea1=document[_0x16c804(0x10e)]('ticket-actions');_0x39a688[_0x16c804(0x1bb)]=_0x2a9cbe,_0x1245dc['innerHTML']=_0x425a4f,_0x2a9cbe===_0x16c804(0x17a)||_0x2a9cbe===_0x16c804(0x155)?(_0x5d15de[_0x16c804(0x177)][_0x16c804(0x136)]=_0x16c804(0x172),_0x2fcea1[_0x16c804(0x177)]['display']=_0x16c804(0x172)):(_0x5d15de['style'][_0x16c804(0x136)]=_0x16c804(0x17f),_0x2fcea1[_0x16c804(0x177)][_0x16c804(0x136)]=_0x16c804(0x172)),_0x233b07['style'][_0x16c804(0x136)]=_0x16c804(0x191);}window['hideNotification']=function(){const _0x29dc36=_0x4d64bf;document[_0x29dc36(0x10e)](_0x29dc36(0x151))[_0x29dc36(0x177)][_0x29dc36(0x136)]=_0x29dc36(0x172);};async function loadHistory(){const _0x5ee65f=_0x4d64bf;showLoader();try{const _0xa8fd30=ref(db,_0x5ee65f(0xf8)+currentVendorId),_0x2d84ab=await get(_0xa8fd30);let _0x4c1d80=[];_0x2d84ab[_0x5ee65f(0x15a)]()&&(_0x4c1d80=Object[_0x5ee65f(0x15d)](_0x2d84ab['val']())['map'](([_0x3a9fd7,_0x2b01e8])=>({'id':_0x3a9fd7,..._0x2b01e8}))),filterHistory(_0x4c1d80),hideLoader();}catch(_0x10d985){console['error'](_0x5ee65f(0x14d),_0x10d985),showNotification('Erreur','Impossible\x20de\x20charger\x20l\x27historique'),hideLoader();}}function filterHistory(_0x401e38){const _0x387db4=_0x4d64bf,_0x538523=document[_0x387db4(0x10e)](_0x387db4(0xfe))['value'],_0x13720f=new Date(),_0x1ea665={'today':new Date(_0x13720f[_0x387db4(0x1a6)](0x0,0x0,0x0,0x0)),'week':new Date(_0x13720f[_0x387db4(0x14b)](_0x13720f[_0x387db4(0x1c9)]()-_0x13720f[_0x387db4(0x1cb)]())),'month':new Date(_0x13720f[_0x387db4(0x14b)](0x1)),'all':new Date(0x0)};let _0x119136=_0x401e38;_0x538523!==_0x387db4(0x105)&&(_0x119136=_0x401e38[_0x387db4(0x199)](_0x447146=>new Date(_0x447146[_0x387db4(0x183)])>=_0x1ea665[_0x538523])),updateStats(_0x119136),updateHistoryTable(_0x119136);}window[_0x4d64bf(0x126)]=function(){const _0x2baa77=_0x4d64bf,_0x2225cf=new Date(document[_0x2baa77(0x10e)](_0x2baa77(0x1a1))['value']),_0xd5763a=new Date(document['getElementById'](_0x2baa77(0x112))[_0x2baa77(0x10b)]);_0xd5763a[_0x2baa77(0x1a6)](0x17,0x3b,0x3b);if(isNaN(_0x2225cf[_0x2baa77(0x125)]())||isNaN(_0xd5763a[_0x2baa77(0x125)]())){showNotification(_0x2baa77(0x155),'Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.');return;}const _0x6b4f2=ref(db,_0x2baa77(0xf8)+currentVendorId);get(_0x6b4f2)[_0x2baa77(0x109)](_0x204c7f=>{const _0xdc2072=_0x2baa77;let _0x2029d2=[];_0x204c7f[_0xdc2072(0x15a)]()&&(_0x2029d2=Object['entries'](_0x204c7f[_0xdc2072(0x17d)]())[_0xdc2072(0x165)](([_0x3ef051,_0x9eaaa3])=>({'id':_0x3ef051,..._0x9eaaa3})));const _0x59c556=_0x2029d2['filter'](_0x96c389=>{const _0x1fb983=_0xdc2072,_0x3dd049=new Date(_0x96c389[_0x1fb983(0x183)]);return _0x3dd049>=_0x2225cf&&_0x3dd049<=_0xd5763a;});updateStats(_0x59c556),updateHistoryTable(_0x59c556);});};function updateStats(_0x40bccb){const _0x575a1e=_0x4d64bf,_0x12b593=_0x40bccb[_0x575a1e(0x14c)],_0x2a7778=_0x40bccb[_0x575a1e(0x1b1)]((_0x5e4645,_0x532e93)=>_0x5e4645+parseFloat(_0x532e93['price']),0x0),_0x5d37cd=_0x40bccb[_0x575a1e(0x1b1)]((_0x4bf9a9,_0x245416)=>{const _0x3694be=_0x575a1e;return _0x4bf9a9[_0x245416[_0x3694be(0x16c)]]=(_0x4bf9a9[_0x245416[_0x3694be(0x16c)]]||0x0)+0x1,_0x4bf9a9;},{}),_0x14c94b=Object[_0x575a1e(0x15d)](_0x5d37cd)[_0x575a1e(0x11d)]((_0x21ef02,_0x219691)=>_0x219691[0x1]-_0x21ef02[0x1])[0x0]?.[0x0]||'-',_0x5bb818=_0x40bccb[_0x575a1e(0x14c)]>0x0?Math[_0x575a1e(0x134)](0x1,Math[_0x575a1e(0xf5)]((Date['now']()-Math['min'](..._0x40bccb['map'](_0x34d027=>_0x34d027['soldAt'])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x3c829c=(_0x12b593/_0x5bb818)[_0x575a1e(0x139)](0x1);document['getElementById'](_0x575a1e(0x140))[_0x575a1e(0x1bb)]=_0x12b593,document[_0x575a1e(0x10e)](_0x575a1e(0x1c0))[_0x575a1e(0x1bb)]=_0x2a7778[_0x575a1e(0x157)]()+_0x575a1e(0x181),document[_0x575a1e(0x10e)](_0x575a1e(0x120))[_0x575a1e(0x1bb)]=_0x14c94b,document['getElementById'](_0x575a1e(0xf7))[_0x575a1e(0x1bb)]=_0x3c829c;}function updateHistoryTable(_0x1a3524){const _0x14c58f=_0x4d64bf,_0x50bf6c=document[_0x14c58f(0x10e)](_0x14c58f(0x16f));_0x50bf6c['innerHTML']=_0x1a3524['sort']((_0x3a6753,_0x5c07f1)=>_0x5c07f1['soldAt']-_0x3a6753[_0x14c58f(0x183)])[_0x14c58f(0x165)](_0x334a54=>_0x14c58f(0xf1)+_0x334a54['id']+_0x14c58f(0xfb)+new Date(_0x334a54['soldAt'])[_0x14c58f(0x157)]()+_0x14c58f(0x13d)+_0x334a54[_0x14c58f(0x16c)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x334a54[_0x14c58f(0x119)]+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x334a54[_0x14c58f(0x118)]+_0x14c58f(0x13f))[_0x14c58f(0x10d)]('');}window[_0x4d64bf(0x1a5)]=async function(_0x52f7f8){const _0x354903=_0x4d64bf;showLoader();try{const _0x2ee259=ref(db,_0x354903(0xf8)+currentVendorId+'/'+_0x52f7f8),_0x2f178d=await get(_0x2ee259);if(_0x2f178d[_0x354903(0x15a)]()){const _0x5ee3a3=_0x2f178d[_0x354903(0x17d)]();window[_0x354903(0x18f)](),showTicketDetails(_0x5ee3a3),hideLoader();}else showNotification(_0x354903(0x155),_0x354903(0x150)),hideLoader();}catch(_0x5da8bd){console[_0x354903(0x13a)](_0x354903(0x1c8),_0x5da8bd),showNotification(_0x354903(0x155),_0x354903(0x137)),hideLoader();}},window[_0x4d64bf(0x15c)]=function(){const _0x1ac4d3=_0x4d64bf,_0x56fc74=document[_0x1ac4d3(0x10e)](_0x1ac4d3(0x1af)),_0x46c71f=_0x56fc74[_0x1ac4d3(0x177)][_0x1ac4d3(0x136)]===_0x1ac4d3(0x191);_0x56fc74[_0x1ac4d3(0x177)]['display']=_0x46c71f?_0x1ac4d3(0x172):_0x1ac4d3(0x191),!_0x46c71f&&loadHistory();},window[_0x4d64bf(0x18f)]=function(){const _0x1a3b0a=_0x4d64bf;document[_0x1a3b0a(0x10e)](_0x1a3b0a(0x1af))[_0x1a3b0a(0x177)][_0x1a3b0a(0x136)]=_0x1a3b0a(0x172);},window[_0x4d64bf(0x178)]=function(){loadHistory();};function listenForNewMessages(){const _0x1c9b64=_0x4d64bf,_0x357841=ref(db,_0x1c9b64(0x169)+currentVendorId+_0x1c9b64(0xfd));onChildAdded(_0x357841,_0x147260=>{const _0x3484c9=_0x1c9b64,_0x1d29fc=_0x147260[_0x3484c9(0x17d)]();displayNewMessage(_0x1d29fc);});}function displayNewMessage(_0x7acddf){const _0x173faf=_0x4d64bf,_0x448324=document[_0x173faf(0x10e)](_0x173faf(0x1ae)),_0x2f6bbb=document[_0x173faf(0x189)](_0x173faf(0x163));_0x2f6bbb[_0x173faf(0x133)][_0x173faf(0x107)]('message'),_0x2f6bbb['innerHTML']=_0x173faf(0x182)+_0x7acddf[_0x173faf(0x143)]+_0x173faf(0x116)+new Date(_0x7acddf[_0x173faf(0x190)])[_0x173faf(0x157)]()+_0x173faf(0x104),_0x448324[_0x173faf(0x142)](_0x2f6bbb),_0x448324[_0x173faf(0x167)]=_0x448324['scrollHeight'];}window[_0x4d64bf(0x175)]=function(){const _0x29ade5=_0x4d64bf,_0xeb1db=document[_0x29ade5(0x10e)](_0x29ade5(0x122))['innerText'];navigator[_0x29ade5(0x1b9)]?navigator[_0x29ade5(0x1b9)]({'title':_0x29ade5(0x13e),'text':_0xeb1db})[_0x29ade5(0x109)](()=>console[_0x29ade5(0x1a3)](_0x29ade5(0x1b2)))['catch'](_0x441658=>console[_0x29ade5(0x13a)](_0x29ade5(0x18e),_0x441658)):alert(_0x29ade5(0x1c1));},window['copyTicket']=function(){const _0x1a8f5d=_0x4d64bf,_0x1447df=document[_0x1a8f5d(0x10e)](_0x1a8f5d(0x122))['innerText'];navigator[_0x1a8f5d(0x12c)][_0x1a8f5d(0x187)](_0x1447df)[_0x1a8f5d(0x109)](()=>{const _0x33a73f=_0x1a8f5d;showNotification(_0x33a73f(0x17a),_0x33a73f(0x141));})[_0x1a8f5d(0x106)](_0x542192=>{const _0x3893e0=_0x1a8f5d;console['error'](_0x3893e0(0x12a),_0x542192),showNotification(_0x3893e0(0x155),_0x3893e0(0x127));});},window['exportToPDF']=async function(){const _0xa61e32=_0x4d64bf;showLoader();const _0x452a57=document[_0xa61e32(0x10e)](_0xa61e32(0x122)),_0x1519f5=new jsPDF(),_0x4501e2=await html2canvas(_0x452a57),_0x321dcd=_0x4501e2[_0xa61e32(0x1a9)](_0xa61e32(0x144));_0x1519f5[_0xa61e32(0x17c)](_0x321dcd,'PNG',0xa,0xa,0xbe,0x0),_0x1519f5[_0xa61e32(0x1c2)](_0xa61e32(0x16d)),hideLoader();},window[_0x4d64bf(0x19a)]=function(){const _0x3191d5=_0x4d64bf;window[_0x3191d5(0x1bc)]();},window['exportToPDFHistory']=function(){const _0x54ca64=_0x4d64bf,{jsPDF:_0x21b314}=window[_0x54ca64(0xf9)],_0x134676=new _0x21b314(),_0x1ff420=document[_0x54ca64(0x10e)](_0x54ca64(0x16f)),_0x27facd={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':'bold','halign':'center'},_0x306799={'halign':_0x54ca64(0x1b5)},_0x4ac797={'theme':_0x54ca64(0x138),'headStyles':_0x27facd,'bodyStyles':_0x306799,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x3e71a6){const _0x44807f=_0x54ca64;_0x134676[_0x44807f(0x101)](_0x44807f(0x1ab),0xe,0xf);const _0x60ce97='Page\x20'+_0x134676[_0x44807f(0x13b)][_0x44807f(0x14a)]();_0x134676['setFontSize'](0xa);const _0x38c39a=_0x134676['internal'][_0x44807f(0x193)],_0x35e8a0=_0x38c39a[_0x44807f(0x168)]?_0x38c39a[_0x44807f(0x168)]:_0x38c39a['getHeight']();_0x134676[_0x44807f(0x101)](_0x60ce97,_0x3e71a6[_0x44807f(0x10c)][_0x44807f(0x18b)][_0x44807f(0x1b5)],_0x35e8a0-0xa),_0x134676[_0x44807f(0x101)](new Date()[_0x44807f(0x157)](),_0x38c39a[_0x44807f(0x19f)]-_0x3e71a6[_0x44807f(0x10c)][_0x44807f(0x18b)][_0x44807f(0x1a2)]-0x28,_0x35e8a0-0xa);}};_0x134676[_0x54ca64(0x131)]({'html':_0x54ca64(0x186),..._0x4ac797}),_0x134676[_0x54ca64(0x1c2)](_0x54ca64(0x114));},window[_0x4d64bf(0x198)]=function(){const _0x1fce2c=_0x4d64bf,_0x440f6e=XLSX[_0x1fce2c(0x1c4)][_0x1fce2c(0x148)](document[_0x1fce2c(0x10e)](_0x1fce2c(0x16f)),{'sheet':_0x1fce2c(0x123)}),_0x30398e=XLSX[_0x1fce2c(0x18d)](_0x440f6e,{'bookType':_0x1fce2c(0x145),'type':_0x1fce2c(0x156)});function _0x6236d6(_0x282b97){const _0x511f1a=_0x1fce2c,_0x5f5a95=new ArrayBuffer(_0x282b97[_0x511f1a(0x14c)]),_0x11c750=new Uint8Array(_0x5f5a95);for(let _0x311c0c=0x0;_0x311c0c<_0x282b97[_0x511f1a(0x14c)];_0x311c0c++)_0x11c750[_0x311c0c]=_0x282b97[_0x511f1a(0xef)](_0x311c0c)&0xff;return _0x5f5a95;}saveAs(new Blob([_0x6236d6(_0x30398e)],{'type':_0x1fce2c(0x188)}),'historique_ventes.xlsx');};function _0x1a11(_0x24e8bd,_0x1ae922){const _0x225820=_0x2258();return _0x1a11=function(_0x1a11bf,_0x4d71c7){_0x1a11bf=_0x1a11bf-0xef;let _0x4111c7=_0x225820[_0x1a11bf];return _0x4111c7;},_0x1a11(_0x24e8bd,_0x1ae922);}function showLoader(){const _0x4002bf=_0x4d64bf;document['getElementById'](_0x4002bf(0x1a4))[_0x4002bf(0x177)][_0x4002bf(0x136)]=_0x4002bf(0x191);}function hideLoader(){const _0x52036f=_0x4d64bf;document[_0x52036f(0x10e)](_0x52036f(0x1a4))[_0x52036f(0x177)][_0x52036f(0x136)]=_0x52036f(0x172);}function showPageLoader(){const _0x19133f=_0x4d64bf;document[_0x19133f(0x10e)](_0x19133f(0x17b))[_0x19133f(0x177)][_0x19133f(0x136)]=_0x19133f(0x17f);}function hidePageLoader(){const _0x3afe72=_0x4d64bf;document[_0x3afe72(0x10e)]('pageLoaderWrapper')[_0x3afe72(0x177)][_0x3afe72(0x136)]='none';}function showSubscriptionRequiredModal(){const _0x323ba5=_0x4d64bf;subscriptionRequiredModal[_0x323ba5(0x177)][_0x323ba5(0x136)]=_0x323ba5(0x17f);}function hideSubscriptionRequiredModal(){const _0x19826a=_0x4d64bf;subscriptionRequiredModal[_0x19826a(0x177)][_0x19826a(0x136)]=_0x19826a(0x172);}function redirectToSubscription(){const _0x565948=_0x4d64bf;window['location'][_0x565948(0x14f)]='index.html';}async function checkSubscriptionStatus(){const _0x3125db=_0x4d64bf,_0xe7e14f=document['getElementById'](_0x3125db(0x192));_0xe7e14f['textContent']=_0x3125db(0x128);try{const _0x1014b3=await get(adminRef),_0x40d929=_0x1014b3[_0x3125db(0x17d)](),_0x418779=new Date();if(_0x40d929&&_0x40d929[_0x3125db(0x15e)]==='active'){const _0xa09253=new Date(_0x40d929[_0x3125db(0x112)]);_0xa09253<_0x418779?(_0xe7e14f[_0x3125db(0x1bb)]='Abonnement\x20expiré',showSubscriptionRequiredModal(),await adminRef[_0x3125db(0x149)]({'status':_0x3125db(0x19b)})):_0xe7e14f[_0x3125db(0x1bb)]=_0x3125db(0x15f);}else _0xe7e14f[_0x3125db(0x1bb)]='Pas\x20d\x27abonnement\x20actif',showSubscriptionRequiredModal();}catch(_0x27f2ad){console[_0x3125db(0x13a)]('Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:',_0x27f2ad),_0xe7e14f[_0x3125db(0x1bb)]=_0x3125db(0x17e),showNotification(_0x3125db(0x155),'Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.');}}document[_0x4d64bf(0x153)](_0x4d64bf(0x117),()=>{const _0xb4821c=_0x4d64bf;checkSubscriptionStatus()[_0xb4821c(0x109)](()=>{const _0x142f59=_0xb4821c;fetchVendors(),lucide[_0x142f59(0x1ad)](),hidePageLoader();})['catch'](_0x1414bd=>{const _0x3d31e4=_0xb4821c;console[_0x3d31e4(0x13a)](_0x3d31e4(0x19e),_0x1414bd),showNotification(_0x3d31e4(0x155),_0x3d31e4(0x108)),hidePageLoader();});}),window[_0x4d64bf(0xff)]=redirectToSubscription,window[_0x4d64bf(0x12d)]=redirectToSubscription;
    </script>
</body>
</html>
