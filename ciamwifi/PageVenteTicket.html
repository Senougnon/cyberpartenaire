<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vente Tickets Cyber Campus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications ici) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg,  #424242, #073018, #553a01);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #fff;
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        section:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: white;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        td{
            transition: background-color 0.3s ease;
        }
        tr:hover td{
            background-color: rgba(255, 255, 255, 0.1);
        }

        button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            touch-action: manipulation;
        }

        button:active {
            transform: scale(0.95);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            color: #1a2a6c;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .notification h3 {
            margin-bottom: 16px;
            color: #1a2a6c;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ticket-details {
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .ticket-details p {
            margin: 8px 0;
            word-break: break-word;
        }

        .action-icons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .action-icon {
            cursor: pointer;
            padding: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .action-icon:active {
            transform: scale(0.9);
        }

        .icon-share { color: #4CAF50; }
        .icon-copy { color: #2196F3; }
        .icon-pdf { color: #f44336; }

        .buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-sell {
            background-color: #4CAF50;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .close-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            cursor: pointer;
            font-size: 24px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            z-index: 1001;
            text-align: center;
            max-width: 200px;
            left: 50% !important;
            transform: translateX(-50%);
            bottom: 24px;
        }
        .history-section {
            display: none;
            background: rgba(26, 42, 108, 0.95); /* Fond plus opaque avec une teinte bleue foncée */
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .history-section:hover{
            transform: translate(-50%, -50%) translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration du style de l'en-tête de l'historique pour plus de lisibilité */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: inherit;
            padding: 10px 0;
            z-index: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Amélioration de la lisibilité des cartes de statistiques */
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover{
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card h4 {
            color: #fdbb2d;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toggle-history {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #fdbb2d;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .toggle-history i{
            transition: transform 0.3s ease;
        }
        .toggle-history:hover{
            transform: scale(1.1);
        }
        .toggle-history:hover i{
            transform: rotate(180deg);
        }

        .toggle-history:active {
            transform: scale(0.95);
        }
        .export-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .export-buttons button {
            margin: 0 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: center;
        }

        .date-filter input[type="date"] {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter button{
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        .date-filter select {
            padding: 8px;
            border-radius: 4px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        footer {
            margin-top: auto;
            text-align: center;
            padding: 16px;
            background-color: rgba(0, 0, 0, 0.5);
            font-size: 0.9rem;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 12px;
            }

            section {
                padding: 12px;
                margin: 12px 0;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 6px;
            }

            td:last-child {
                text-align: right;
            }

            button {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .notification {
                padding: 20px 16px;
                width: 95%;
            }

            .action-icons {
                gap: 16px;
            }

            .action-icon {
                width: 40px;
                height: 40px;
                padding: 10px;
            }

            .buttons button {
                flex: 1;
                min-width: 0;
            }

            .close-icon {
                top: 8px;
                right: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .history-table {
                font-size: 0.8rem;
            }

            .date-filter {
                flex-direction: column;
            }
        }

        @media (max-width: 320px) {
            .buttons {
                flex-direction: column;
            }

            .action-icons {
                gap: 12px;
            }

            .action-icon {
                width: 36px;
                height: 36px;
            }
        }

        .login-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .login-section input[type="text"],
        .login-section input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .login-section button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            width: 100%;
            margin-top: 10px;
        }

        .login-section button:active {
            transform: scale(0.95);
        }

        .error-message {
            margin-top: 10px;
            text-align: center;
        }
        .messages-section {
            margin: 16px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-height: 300px; /* Hauteur maximale pour la section des messages */
            overflow-y: auto; /* Permettre le défilement vertical si le contenu dépasse la hauteur maximale */
        }

        .messages-section h2 {
            color: #fdbb2d;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .message {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: #ccc;
            margin-top: 5px;
        }

        /* Styles pour l'autocomplétion */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            border: 1px solid #ccc;
            list-style: none;
            padding: 0;
            margin: 0;
            z-index: 100;
            background-color: white;
            width: 100%; /* Assurez-vous que la liste a la même largeur que le champ de saisie */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ombre pour un effet visuel */
        }

        .autocomplete-suggestions li {
            padding: 5px;
            cursor: pointer;
            color: #000;
        }

        .autocomplete-suggestions li:hover {
            background-color: #fdbb2d;
            color: #1a2a6c;
        }
        .loader-wrapper {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .page-loader-wrapper {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .page-loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        .loader-message {
            color: white;
            margin-top: 16px;
            font-size: 1rem;
            text-align: center;
            max-width: 80%;
        }
        .subscription-required {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }

    </style>
</head>

<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <section class="login-section" id="loginSection">
        <h2>Connexion Partenaire</h2>
        <form id="loginForm">
            <div class="autocomplete-container">
                <input type="text" id="username" placeholder="Nom d'utilisateur" required>
                <ul class="autocomplete-suggestions" id="autocompleteSuggestions" style="display: none;"></ul>
            </div>
            <input type="password" id="password" placeholder="Mot de passe" required>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe" style="color: white; margin-left: 5px;">Se souvenir de moi (24h)</label>
            </div>
            <button type="submit">Se connecter</button>
        </form>
        <div class="error-message" id="loginError" style="display: none; color: red;"></div>
    </section>

    <div class="container">
        <section class="rates-section" style="display: none;">
            <h2>Vente de tickets WiFi</h2>
            <div class="loading-message">Chargement des tickets...</div>
            <table style="display: none;"></table>
        </section>
    </div>

    <div class="notification" id="notification">
        <span class="close-icon" onclick="hideNotification()">×</span>
        <h3 id="notification-title">Confirmation de vente</h3>
        <div class="ticket-details" id="notification-message"></div>
        <div class="buttons" id="confirmation-buttons">
            <button class="btn-sell" onclick="window.proceedWithSale()">Confirmer</button>
            <button class="btn-cancel" onclick="hideNotification()">Annuler</button>
        </div>
        <div class="action-icons" id="ticket-actions" style="display: none;">
            <div class="action-icon icon-share" onclick="shareTicket()" title="Partager">
                <i data-lucide="share-2"></i>
            </div>
            <div class="action-icon icon-pdf" onclick="exportToPDF()" title="Exporter en PDF">
                <i data-lucide="file-text"></i>
            </div>
        </div>
    </div>

    <div class="toggle-history" onclick="toggleHistory()">
        <i data-lucide="history"></i>
    </div>

    <div class="history-section" id="historySection" style="display: none;">
        <div class="history-header">
            <h2>Historique des ventes</h2>
            <button onclick="closeHistory()">
                <i data-lucide="x"></i>
            </button>
        </div>

        <div class="date-filter">
            <select id="periodFilter" onchange="filterHistory()">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Tout l'historique</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="filterHistoryByDateRange()">Filtrer par date</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h4>Tickets vendus</h4>
                <div id="totalTickets" class="value">0</div>
            </div>
            <div class="stat-card">
                <h4>Chiffre d'affaires</h4>
                <div id="totalRevenue" class="value">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h4>Ticket le plus vendu</h4>
                <div id="topCategory" class="value">-</div>
            </div>
            <div class="stat-card">
                <h4>Moyenne par jour</h4>
                <div id="avgDaily" class="value">0</div>
            </div>
        </div>
        <div class="export-buttons">
            <button onclick="printHistory()"><i data-lucide="printer"></i> Imprimer</button>
            <button onclick="exportToPDFHistory()"><i data-lucide="file-down"></i> Exporter en PDF</button>
        </div>

        <div class="history-table">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <section class="messages-section" id="messagesSection" style="display: none;">
        <h2>Messages Reçus</h2>
        <div id="messagesContainer">
            <!-- Les messages seront ajoutés ici -->
        </div>
    </section>

    <div id="tooltip" class="tooltip"></div>

    <footer>
        <div class="anitext">PROPULSE PAR EVISIONS</div>
    </footer>

    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>

    <script type="module">
const _0x7dcf3=_0x1f6a;(function(_0x41e134,_0x60f0b1){const _0xbb681a=_0x1f6a,_0x558d9e=_0x41e134();while(!![]){try{const _0x213c14=parseInt(_0xbb681a(0x2b4))/0x1*(parseInt(_0xbb681a(0x1ee))/0x2)+parseInt(_0xbb681a(0x22f))/0x3*(-parseInt(_0xbb681a(0x2a4))/0x4)+-parseInt(_0xbb681a(0x250))/0x5*(-parseInt(_0xbb681a(0x23d))/0x6)+parseInt(_0xbb681a(0x233))/0x7+-parseInt(_0xbb681a(0x260))/0x8*(parseInt(_0xbb681a(0x215))/0x9)+parseInt(_0xbb681a(0x263))/0xa+-parseInt(_0xbb681a(0x24c))/0xb;if(_0x213c14===_0x60f0b1)break;else _0x558d9e['push'](_0x558d9e['shift']());}catch(_0x1b7649){_0x558d9e['push'](_0x558d9e['shift']());}}}(_0x358b,0x295ad));import{initializeApp}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import{getDatabase,ref,get,set,push,remove,onChildAdded}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';const firebaseConfig={'apiKey':_0x7dcf3(0x26e),'authDomain':_0x7dcf3(0x2b2),'databaseURL':'https://ciamwifi-default-rtdb.firebaseio.com','projectId':_0x7dcf3(0x1ed),'storageBucket':_0x7dcf3(0x278),'messagingSenderId':_0x7dcf3(0x24b),'appId':_0x7dcf3(0x242),'measurementId':_0x7dcf3(0x235)},app=initializeApp(firebaseConfig),db=getDatabase(app),adminRef=ref(db,_0x7dcf3(0x25e));let ticketToSell=null,localTickets={},currentReservedTicket=null,currentVendorId='',vendors={},availableUsernames=[];window['jsPDF']=window[_0x7dcf3(0x23e)]['jsPDF'];async function fetchVendors(){const _0xb67263=_0x7dcf3;try{const _0xf4df31=ref(db,_0xb67263(0x22a)),_0x25f122=await get(_0xf4df31);_0x25f122[_0xb67263(0x285)]()?(vendors=_0x25f122[_0xb67263(0x29c)](),availableUsernames=Object[_0xb67263(0x26a)](vendors)):console[_0xb67263(0x209)](_0xb67263(0x283));}catch(_0x3e5dec){console[_0xb67263(0x280)]('Erreur\x20lors\x20de\x20la\x20récupération\x20des\x20vendeurs:',_0x3e5dec);}}const usernameInput=document['getElementById'](_0x7dcf3(0x26b)),passwordInput=document[_0x7dcf3(0x236)](_0x7dcf3(0x282)),suggestionsList=document[_0x7dcf3(0x236)](_0x7dcf3(0x1e2));usernameInput[_0x7dcf3(0x21c)](_0x7dcf3(0x1ef),()=>{const _0x595fcd=_0x7dcf3,_0x5d304f=usernameInput['value']['toLowerCase'](),_0x4d6726=availableUsernames[_0x595fcd(0x211)](_0x2f7c53=>_0x2f7c53[_0x595fcd(0x237)]()[_0x595fcd(0x20f)](_0x5d304f));suggestionsList['innerHTML']='';if(_0x5d304f[_0x595fcd(0x261)]===0x0||_0x4d6726['length']===0x0){suggestionsList['style'][_0x595fcd(0x267)]=_0x595fcd(0x279);return;}_0x4d6726[_0x595fcd(0x1f8)](_0x3434d8=>{const _0xea2849=_0x595fcd,_0x441c93=document[_0xea2849(0x234)]('li');_0x441c93[_0xea2849(0x293)]=_0x3434d8,_0x441c93[_0xea2849(0x21c)](_0xea2849(0x239),()=>{const _0x354d05=_0xea2849;usernameInput['value']=_0x3434d8,suggestionsList['innerHTML']='',suggestionsList[_0x354d05(0x271)][_0x354d05(0x267)]=_0x354d05(0x279);}),suggestionsList[_0xea2849(0x2af)](_0x441c93);}),suggestionsList[_0x595fcd(0x271)][_0x595fcd(0x267)]='block';}),document[_0x7dcf3(0x21c)](_0x7dcf3(0x239),_0x47eed3=>{const _0x2b56b1=_0x7dcf3;!usernameInput['contains'](_0x47eed3['target'])&&!suggestionsList[_0x2b56b1(0x248)](_0x47eed3['target'])&&(suggestionsList[_0x2b56b1(0x271)][_0x2b56b1(0x267)]='none');});const rememberMeCheckbox=document['getElementById'](_0x7dcf3(0x229)),storedUsername=localStorage[_0x7dcf3(0x249)](_0x7dcf3(0x26b)),storedPassword=localStorage[_0x7dcf3(0x249)]('password'),storedTimestamp=localStorage[_0x7dcf3(0x249)](_0x7dcf3(0x281)),now=Date[_0x7dcf3(0x1f6)](),twentyFourHours=0x18*0x3c*0x3c*0x3e8;storedUsername&&storedPassword&&storedTimestamp&&now-storedTimestamp<twentyFourHours&&(usernameInput['value']=storedUsername,passwordInput[_0x7dcf3(0x223)]=storedPassword,rememberMeCheckbox['checked']=!![]);const loginForm=document[_0x7dcf3(0x236)](_0x7dcf3(0x297)),loginError=document['getElementById']('loginError'),ratesSection=document['querySelector'](_0x7dcf3(0x228)),historySection=document[_0x7dcf3(0x236)](_0x7dcf3(0x268)),loginSection=document[_0x7dcf3(0x236)]('loginSection'),messagesSection=document[_0x7dcf3(0x236)]('messagesSection');loginForm['addEventListener'](_0x7dcf3(0x296),async _0x24ff2c=>{const _0x4d18e1=_0x7dcf3;_0x24ff2c[_0x4d18e1(0x2ac)](),showLoader();const _0x489501=usernameInput['value'],_0x153982=passwordInput[_0x4d18e1(0x223)];vendors[_0x489501]&&vendors[_0x489501]['password']===_0x153982?(loginError[_0x4d18e1(0x271)][_0x4d18e1(0x267)]=_0x4d18e1(0x279),ratesSection['style'][_0x4d18e1(0x267)]=_0x4d18e1(0x287),historySection[_0x4d18e1(0x271)][_0x4d18e1(0x267)]=_0x4d18e1(0x279),loginSection[_0x4d18e1(0x271)][_0x4d18e1(0x267)]=_0x4d18e1(0x279),messagesSection['style'][_0x4d18e1(0x267)]='block',currentVendorId=_0x489501,rememberMeCheckbox['checked']?(localStorage[_0x4d18e1(0x1f0)](_0x4d18e1(0x26b),_0x489501),localStorage[_0x4d18e1(0x1f0)](_0x4d18e1(0x282),_0x153982),localStorage[_0x4d18e1(0x1f0)](_0x4d18e1(0x281),Date[_0x4d18e1(0x1f6)]())):(localStorage[_0x4d18e1(0x2a5)](_0x4d18e1(0x26b)),localStorage[_0x4d18e1(0x2a5)](_0x4d18e1(0x282)),localStorage[_0x4d18e1(0x2a5)]('usernameTimestamp')),await syncTickets(),loadHistory(),listenForNewMessages(),lucide[_0x4d18e1(0x21f)](),hideLoader()):(loginError[_0x4d18e1(0x271)][_0x4d18e1(0x267)]='block',loginError[_0x4d18e1(0x293)]=_0x4d18e1(0x25d),hideLoader());});async function syncTickets(){const _0x286494=_0x7dcf3;try{const _0x191798=document[_0x286494(0x27d)](_0x286494(0x245)),_0x478be8=document[_0x286494(0x27d)](_0x286494(0x251));_0x191798[_0x286494(0x271)][_0x286494(0x267)]=_0x286494(0x287),_0x478be8[_0x286494(0x271)][_0x286494(0x267)]=_0x286494(0x279);const _0x3e3b06=ref(db,'TicketsTotal'),_0x177c81=await get(_0x3e3b06);_0x177c81[_0x286494(0x285)]()?(localTickets=_0x177c81[_0x286494(0x29c)](),createTicketTable(),_0x191798[_0x286494(0x271)][_0x286494(0x267)]=_0x286494(0x279),_0x478be8[_0x286494(0x271)]['display']='table'):_0x191798[_0x286494(0x293)]=_0x286494(0x20a);}catch(_0x4a4ed6){console[_0x286494(0x280)](_0x286494(0x25f),_0x4a4ed6),loadingMessage[_0x286494(0x293)]=_0x286494(0x24f);}}async function createTicketTable(){const _0x1b4f8b=_0x7dcf3,_0x47a652=document[_0x1b4f8b(0x27d)](_0x1b4f8b(0x251));_0x47a652[_0x1b4f8b(0x23b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Catégorie</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Prix\x20(FCFA)</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Restants</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Action</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';for(const [_0x3d11ef,_0xc548ed]of Object[_0x1b4f8b(0x216)](localTickets)){const _0x23366c=_0xc548ed[_0x1b4f8b(0x219)]?_0xc548ed[_0x1b4f8b(0x219)][_0x1b4f8b(0x261)]:0x0;if(_0x23366c>0x0){const _0x3584b0=_0xc548ed[_0x1b4f8b(0x25a)][0x0],_0x17fd18=_0x47a652[_0x1b4f8b(0x28e)]();_0x17fd18[_0x1b4f8b(0x23b)]=_0x1b4f8b(0x274)+_0x3d11ef+_0x1b4f8b(0x20d)+_0x3584b0+_0x1b4f8b(0x20d)+_0x23366c+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22window.initTicketSale(\x27'+_0x3d11ef+_0x1b4f8b(0x29d);}}document['querySelector'](_0x1b4f8b(0x245))[_0x1b4f8b(0x271)]['display']=_0x1b4f8b(0x279),_0x47a652[_0x1b4f8b(0x271)][_0x1b4f8b(0x267)]=_0x1b4f8b(0x246);}window[_0x7dcf3(0x20b)]=async function(_0x2c713c){const _0x5a4fbe=_0x7dcf3;showLoader();try{const _0x5195c8=ref(db,_0x5a4fbe(0x2b3)+_0x2c713c),_0x35c0db=await get(_0x5195c8);if(_0x35c0db[_0x5a4fbe(0x285)]()){const _0x2ef8ed=_0x35c0db['val']();if(!_0x2ef8ed[_0x5a4fbe(0x219)]||_0x2ef8ed[_0x5a4fbe(0x219)]['length']===0x0)throw new Error(_0x5a4fbe(0x28b));ticketToSell={'category':_0x2c713c,'user':_0x2ef8ed[_0x5a4fbe(0x219)][0x0],'password':_0x2ef8ed['motDePasse'][0x0],'price':_0x2ef8ed[_0x5a4fbe(0x25a)][0x0],'updatedData':{..._0x2ef8ed,'utilisateur':_0x2ef8ed[_0x5a4fbe(0x219)][_0x5a4fbe(0x24d)](0x1),'motDePasse':_0x2ef8ed['motDePasse']['slice'](0x1),'prix':_0x2ef8ed[_0x5a4fbe(0x25a)][_0x5a4fbe(0x24d)](0x1)}},showConfirmation(ticketToSell),hideLoader();}}catch(_0x4189d5){console[_0x5a4fbe(0x280)](_0x5a4fbe(0x24a),_0x4189d5),showNotification('Erreur',_0x5a4fbe(0x23c)),hideLoader();}};function showConfirmation(_0x36de24){const _0x2cb0da=_0x7dcf3,_0x3d7043=document[_0x2cb0da(0x236)](_0x2cb0da(0x2a6)),_0x744d08=document[_0x2cb0da(0x236)]('notification-message'),_0x43055b=document['getElementById'](_0x2cb0da(0x1ec)),_0x6da62d=document[_0x2cb0da(0x236)](_0x2cb0da(0x2ae));document[_0x2cb0da(0x236)]('notification-title')[_0x2cb0da(0x293)]=_0x2cb0da(0x225),_0x744d08[_0x2cb0da(0x23b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Voulez-vous\x20vendre\x20ce\x20ticket\x20?</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20'+_0x36de24['category']+_0x2cb0da(0x224)+_0x36de24[_0x2cb0da(0x207)]+_0x2cb0da(0x295),_0x6da62d[_0x2cb0da(0x271)]['display']=_0x2cb0da(0x1e9),_0x43055b[_0x2cb0da(0x271)][_0x2cb0da(0x267)]=_0x2cb0da(0x279),_0x3d7043[_0x2cb0da(0x271)][_0x2cb0da(0x267)]=_0x2cb0da(0x287);}window[_0x7dcf3(0x298)]=async function(){const _0x4d6c78=_0x7dcf3;showLoader();if(!ticketToSell){showNotification('Erreur',_0x4d6c78(0x259)),hideLoader();return;}try{const _0x26cb22=ref(db,_0x4d6c78(0x2b3)+ticketToSell[_0x4d6c78(0x1e5)]);await set(_0x26cb22,ticketToSell['updatedData']);const _0x49ad94=ref(db,'TicketsVendus');await push(_0x49ad94,{'category':ticketToSell[_0x4d6c78(0x1e5)],'user':ticketToSell[_0x4d6c78(0x23f)],'password':ticketToSell[_0x4d6c78(0x282)],'price':ticketToSell[_0x4d6c78(0x207)],'soldAt':Date[_0x4d6c78(0x1f6)](),'vendorId':currentVendorId});const _0x3d9711=ref(db,'VendorsHistory/'+currentVendorId);await push(_0x3d9711,{'category':ticketToSell[_0x4d6c78(0x1e5)],'user':ticketToSell['user'],'password':ticketToSell['password'],'price':ticketToSell['price'],'soldAt':Date[_0x4d6c78(0x1f6)]()}),showTicketDetails(ticketToSell),await syncTickets(),hideLoader();}catch(_0x3b090b){console[_0x4d6c78(0x280)](_0x4d6c78(0x258),_0x3b090b),showNotification(_0x4d6c78(0x2b5),_0x4d6c78(0x2a8)),hideLoader();}ticketToSell=null;};function showTicketDetails(_0x41b131){const _0x128676=_0x7dcf3,_0x5b6a16=document[_0x128676(0x236)](_0x128676(0x2a6)),_0x4c0eef=document['getElementById'](_0x128676(0x1ff)),_0x36aca8=document[_0x128676(0x236)](_0x128676(0x1ec)),_0x4358d8=document[_0x128676(0x236)](_0x128676(0x2ae));document[_0x128676(0x236)](_0x128676(0x1ea))[_0x128676(0x293)]=_0x128676(0x244),_0x4c0eef[_0x128676(0x23b)]=_0x128676(0x213)+_0x41b131[_0x128676(0x1e5)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20'+_0x41b131[_0x128676(0x23f)]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20'+_0x41b131[_0x128676(0x282)]+_0x128676(0x224)+_0x41b131['price']+'\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x4358d8[_0x128676(0x271)][_0x128676(0x267)]=_0x128676(0x279),_0x36aca8[_0x128676(0x271)][_0x128676(0x267)]='flex',_0x5b6a16[_0x128676(0x271)]['display']=_0x128676(0x287),lucide[_0x128676(0x21f)]();}function showSaleConfirmation(_0x1e2b64){const _0x2e8091=_0x7dcf3,_0x2ac816=document[_0x2e8091(0x236)](_0x2e8091(0x2a6)),_0x134b36=document[_0x2e8091(0x236)](_0x2e8091(0x1ff)),_0x4cc6b2=document[_0x2e8091(0x236)]('notification-buttons');_0x134b36[_0x2e8091(0x23b)]=_0x2e8091(0x213)+_0x1e2b64[_0x2e8091(0x1e5)]+_0x2e8091(0x276)+_0x1e2b64[_0x2e8091(0x23f)]+_0x2e8091(0x265)+_0x1e2b64['password']+_0x2e8091(0x224)+_0x1e2b64['price']+'\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x4cc6b2[_0x2e8091(0x23b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-sell\x22\x20onclick=\x22window.confirmSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Confirmer\x20la\x20vente\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn-cancel\x22\x20onclick=\x22window.cancelSale()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Annuler\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x2ac816[_0x2e8091(0x271)][_0x2e8091(0x267)]='block',lucide[_0x2e8091(0x21f)]();}window[_0x7dcf3(0x294)]=async function(){const _0x4b03ca=_0x7dcf3;showLoader();if(!currentReservedTicket){showNotification(_0x4b03ca(0x2b5),_0x4b03ca(0x2ad)),hideLoader();return;}try{const _0x41d454=ref(db,_0x4b03ca(0x2b1));await push(_0x41d454,{...currentReservedTicket,'soldAt':Date[_0x4b03ca(0x1f6)](),'vendorId':currentVendorId});const _0x5390a6=ref(db,_0x4b03ca(0x26d)+currentVendorId);await push(_0x5390a6,{...currentReservedTicket,'soldAt':Date[_0x4b03ca(0x1f6)]()}),showNotification(_0x4b03ca(0x1f3),_0x4b03ca(0x286)),currentReservedTicket=null,hideNotification(),await syncTickets(),hideLoader();}catch(_0x4afb8f){console['error']('Erreur\x20de\x20confirmation:',_0x4afb8f),showNotification('Erreur',_0x4b03ca(0x1f4)),hideLoader();}},window[_0x7dcf3(0x1fd)]=function(){currentReservedTicket=null,hideNotification();};function _0x1f6a(_0x388a9f,_0x11ed66){const _0x358bb9=_0x358b();return _0x1f6a=function(_0x1f6af5,_0x312076){_0x1f6af5=_0x1f6af5-0x1e1;let _0x89059e=_0x358bb9[_0x1f6af5];return _0x89059e;},_0x1f6a(_0x388a9f,_0x11ed66);}function showNotification(_0x263cfc,_0x21bbc0){const _0x369944=_0x7dcf3,_0x147d88=document[_0x369944(0x236)](_0x369944(0x2a6)),_0x320fdd=document[_0x369944(0x236)](_0x369944(0x1ea)),_0x3459a0=document[_0x369944(0x236)]('notification-message'),_0x1f809f=document[_0x369944(0x236)](_0x369944(0x241)),_0x121c1a=document[_0x369944(0x236)](_0x369944(0x1ec));_0x320fdd[_0x369944(0x293)]=_0x263cfc,_0x3459a0[_0x369944(0x23b)]=_0x21bbc0,_0x263cfc===_0x369944(0x1f3)||_0x263cfc===_0x369944(0x2b5)?(_0x1f809f[_0x369944(0x271)][_0x369944(0x267)]=_0x369944(0x279),_0x121c1a[_0x369944(0x271)][_0x369944(0x267)]=_0x369944(0x279)):(_0x1f809f[_0x369944(0x271)]['display']='flex',_0x121c1a[_0x369944(0x271)]['display']=_0x369944(0x279)),_0x147d88[_0x369944(0x271)][_0x369944(0x267)]=_0x369944(0x287);}window['hideNotification']=function(){const _0x4cbfc6=_0x7dcf3;document[_0x4cbfc6(0x236)]('notification')['style'][_0x4cbfc6(0x267)]='none';};async function loadHistory(){const _0x5cb93a=_0x7dcf3;showLoader();try{const _0x8bcb9b=ref(db,_0x5cb93a(0x26d)+currentVendorId),_0x42a8c0=await get(_0x8bcb9b);let _0x4c6b0f=[];_0x42a8c0[_0x5cb93a(0x285)]()&&(_0x4c6b0f=Object[_0x5cb93a(0x216)](_0x42a8c0[_0x5cb93a(0x29c)]())[_0x5cb93a(0x27b)](([_0x14654b,_0x2d41ae])=>({'id':_0x14654b,..._0x2d41ae}))),filterHistory(_0x4c6b0f),hideLoader();}catch(_0xc5db1e){console[_0x5cb93a(0x280)](_0x5cb93a(0x1fc),_0xc5db1e),showNotification(_0x5cb93a(0x2b5),_0x5cb93a(0x29f)),hideLoader();}}function filterHistory(_0x5ecfd5){const _0x2dfe88=_0x7dcf3,_0x1ea255=document[_0x2dfe88(0x236)]('periodFilter')['value'],_0x5ed348=new Date(),_0x568e6a={'today':new Date(_0x5ed348[_0x2dfe88(0x2a0)](0x0,0x0,0x0,0x0)),'week':new Date(_0x5ed348[_0x2dfe88(0x24e)](_0x5ed348[_0x2dfe88(0x21d)]()-_0x5ed348[_0x2dfe88(0x22d)]())),'month':new Date(_0x5ed348[_0x2dfe88(0x24e)](0x1)),'all':new Date(0x0)};let _0x46b7f3=_0x5ecfd5;_0x1ea255!==_0x2dfe88(0x2a1)&&(_0x46b7f3=_0x5ecfd5[_0x2dfe88(0x211)](_0x4ee882=>new Date(_0x4ee882['soldAt'])>=_0x568e6a[_0x1ea255])),updateStats(_0x46b7f3),updateHistoryTable(_0x46b7f3);}window[_0x7dcf3(0x203)]=function(){const _0x4a4ebc=_0x7dcf3,_0x286dd9=new Date(document['getElementById']('startDate')['value']),_0x1dffc4=new Date(document[_0x4a4ebc(0x236)](_0x4a4ebc(0x264))[_0x4a4ebc(0x223)]);_0x1dffc4['setHours'](0x17,0x3b,0x3b);if(isNaN(_0x286dd9[_0x4a4ebc(0x2b0)]())||isNaN(_0x1dffc4[_0x4a4ebc(0x2b0)]())){showNotification(_0x4a4ebc(0x2b5),_0x4a4ebc(0x272));return;}const _0x49aaab=ref(db,_0x4a4ebc(0x26d)+currentVendorId);get(_0x49aaab)[_0x4a4ebc(0x269)](_0x588d3d=>{const _0x21d615=_0x4a4ebc;let _0x1cdaba=[];_0x588d3d['exists']()&&(_0x1cdaba=Object[_0x21d615(0x216)](_0x588d3d[_0x21d615(0x29c)]())[_0x21d615(0x27b)](([_0x37ba2d,_0x512df3])=>({'id':_0x37ba2d,..._0x512df3})));const _0x5a61a4=_0x1cdaba['filter'](_0x4e85d8=>{const _0x505449=_0x21d615,_0x28941=new Date(_0x4e85d8[_0x505449(0x27e)]);return _0x28941>=_0x286dd9&&_0x28941<=_0x1dffc4;});updateStats(_0x5a61a4),updateHistoryTable(_0x5a61a4);});};function _0x358b(){const _0x786858=['historique_ventes.pdf','forEach','pageLoaderWrapper','Historique\x20des\x20ventes','historique_ventes.xlsx','Erreur\x20lors\x20du\x20chargement\x20de\x20l\x27historique:','cancelSale','clipboard','notification-message','Pas\x20d\x27abonnement\x20actif','reduce','div','filterHistoryByDateRange','redirectToSubscription','exportToPDFHistory','join','price','Partage\x20réussi','log','Aucun\x20ticket\x20disponible.','initTicketSale','toLocaleString','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','location','startsWith','Impossible\x20de\x20récupérer\x20les\x20détails\x20du\x20ticket','filter','ticket.pdf','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Catégorie:</strong>\x20','save','18ZPHqVm','entries','avgDaily','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22timestamp\x22>','utilisateur','Ticket\x20introuvable\x20dans\x20l\x27historique','min','addEventListener','getDate','text','createIcons','status','margin','right','value','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Prix:</strong>\x20','Confirmation\x20de\x20vente','classList','Erreur\x20lors\x20de\x20la\x20copie:','.rates-section','rememberMe','Vendors','content','width','getDay','expired','9jkFiSs','charCodeAt','shareTicket','center','1010842Xdkycl','createElement','G-50HPXBBBB8','getElementById','toLowerCase','bold','click','table_to_book','innerHTML','Impossible\x20de\x20récupérer\x20le\x20ticket','966WGFTbo','jspdf','user','exportToPDF','notification-buttons','1:796986987288:web:58d59305a053487de0c46d','DOMContentLoaded','Ticket\x20vendu\x20avec\x20succès','.loading-message','table','left','contains','getItem','Erreur:','796986987288','2228182OMakbv','slice','setDate','Erreur\x20de\x20synchronisation\x20des\x20tickets.','10275JgSSwM','.rates-section\x20table','Le\x20partage\x20n\x27est\x20pas\x20supporté\x20sur\x20votre\x20navigateur.\x20Veuillez\x20copier\x20manuellement\x20les\x20détails\x20du\x20ticket.','print','sort','Page\x20','internal','getHeight','Erreur\x20lors\x20de\x20la\x20vente:','Aucun\x20ticket\x20à\x20vendre','prix','image/png','toggleHistory','Nom\x20d\x27utilisateur\x20ou\x20mot\x20de\x20passe\x20incorrect.','admin/subscription','Erreur\x20de\x20synchronisation:','366176zxhjhV','length','href','823300CMbKuT','endDate','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Mot\x20de\x20passe:</strong>\x20','Erreur\x20lors\x20du\x20partage:','display','historySection','then','keys','username','write','VendorsHistory/','AIzaSyCgeFWhfZZee9KTWJW2Hx_w_94Me1FB_tU','printHistory','toDataURL','style','Veuillez\x20sélectionner\x20une\x20date\x20de\x20début\x20et\x20une\x20date\x20de\x20fin.','PNG','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','grid','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p><strong>Nom\x20d\x27utilisateur:</strong>\x20','height','ciamwifi.firebasestorage.app','none','max','map','scrollTop','querySelector','soldAt','Ventes','error','usernameTimestamp','password','Aucun\x20vendeur\x20trouvé.','Détails\x20du\x20Ticket','exists','Ticket\x20vendu\x20avec\x20succès!','block','loaderWrapper','Ticket\x20copié\x20dans\x20le\x20presse-papiers!','message','Plus\x20de\x20tickets\x20disponibles','innerText','share','insertRow','exportToExcelHistory','xlsx','Erreur\x20lors\x20de\x20l\x27initialisation\x20:','Abonnement\x20actif','textContent','confirmSale','\x20FCFA</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','submit','loginForm','proceedWithSale','toFixed','/messages','closeHistory','val','\x27)\x22>Vendre</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','totalRevenue','Impossible\x20de\x20charger\x20l\x27historique','setHours','all','Vérification\x20de\x20l\x27abonnement...','pageSize','409928jwZAQz','removeItem','notification','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Impossible\x20de\x20finaliser\x20la\x20vente','historyTableBody','setFontSize','Vendors/','preventDefault','Aucun\x20ticket\x20en\x20cours\x20de\x20vente','confirmation-buttons','appendChild','getTime','TicketsVendus','ciamwifi.firebaseapp.com','TicketsTotal/','251yAyYni','Erreur','Erreur\x20lors\x20de\x20la\x20récupération\x20du\x20ticket:','autocompleteSuggestions','Une\x20erreur\x20est\x20survenue\x20lors\x20de\x20l\x27initialisation.','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','category','catch','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement','settings','flex','notification-title','autoTable','ticket-actions','ciamwifi','1700QdnHiB','input','setItem','ceil','writeText','Succès','Erreur\x20lors\x20de\x20la\x20confirmation\x20de\x20la\x20vente','pageLoaderMessage','now'];_0x358b=function(){return _0x786858;};return _0x358b();}function updateStats(_0x58fa9c){const _0x1f569f=_0x7dcf3,_0x14a9b8=_0x58fa9c[_0x1f569f(0x261)],_0x707c68=_0x58fa9c[_0x1f569f(0x201)]((_0x2542dd,_0x3834b5)=>_0x2542dd+parseFloat(_0x3834b5[_0x1f569f(0x207)]),0x0),_0xaafe81=_0x58fa9c['reduce']((_0x4b6575,_0x517aa2)=>{const _0x3fb04d=_0x1f569f;return _0x4b6575[_0x517aa2[_0x3fb04d(0x1e5)]]=(_0x4b6575[_0x517aa2[_0x3fb04d(0x1e5)]]||0x0)+0x1,_0x4b6575;},{}),_0x309521=Object['entries'](_0xaafe81)[_0x1f569f(0x254)]((_0x12c120,_0x43faac)=>_0x43faac[0x1]-_0x12c120[0x1])[0x0]?.[0x0]||'-',_0x5bb7c4=_0x58fa9c['length']>0x0?Math[_0x1f569f(0x27a)](0x1,Math[_0x1f569f(0x1f1)]((Date['now']()-Math[_0x1f569f(0x21b)](..._0x58fa9c[_0x1f569f(0x27b)](_0x52fc59=>_0x52fc59[_0x1f569f(0x27e)])))/(0x3e8*0x3c*0x3c*0x18))):0x1,_0x2e85d9=(_0x14a9b8/_0x5bb7c4)[_0x1f569f(0x299)](0x1);document[_0x1f569f(0x236)]('totalTickets')[_0x1f569f(0x293)]=_0x14a9b8,document[_0x1f569f(0x236)](_0x1f569f(0x29e))[_0x1f569f(0x293)]=_0x707c68[_0x1f569f(0x20c)]()+'\x20FCFA',document[_0x1f569f(0x236)]('topCategory')[_0x1f569f(0x293)]=_0x309521,document[_0x1f569f(0x236)](_0x1f569f(0x217))[_0x1f569f(0x293)]=_0x2e85d9;}function updateHistoryTable(_0x4b1dce){const _0x2f46a1=_0x7dcf3,_0x17359b=document[_0x2f46a1(0x236)](_0x2f46a1(0x2a9));_0x17359b[_0x2f46a1(0x23b)]=_0x4b1dce[_0x2f46a1(0x254)]((_0x1ab00c,_0x47e8dd)=>_0x47e8dd[_0x2f46a1(0x27e)]-_0x1ab00c[_0x2f46a1(0x27e)])['map'](_0x2e60e0=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20onclick=\x22window.showTicketDetailsFromHistory(\x27'+_0x2e60e0['id']+'\x27)\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+new Date(_0x2e60e0[_0x2f46a1(0x27e)])['toLocaleString']()+_0x2f46a1(0x20d)+_0x2e60e0[_0x2f46a1(0x1e5)]+_0x2f46a1(0x20d)+_0x2e60e0[_0x2f46a1(0x23f)]+_0x2f46a1(0x20d)+_0x2e60e0[_0x2f46a1(0x207)]+'\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><i\x20class=\x22fa-solid\x20fa-arrow-right\x22></i></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x2f46a1(0x206)]('');}window['showTicketDetailsFromHistory']=async function(_0xc7493d){const _0xe9c25c=_0x7dcf3;showLoader();try{const _0x1ccec9=ref(db,_0xe9c25c(0x26d)+currentVendorId+'/'+_0xc7493d),_0x150400=await get(_0x1ccec9);if(_0x150400[_0xe9c25c(0x285)]()){const _0x636948=_0x150400[_0xe9c25c(0x29c)]();window[_0xe9c25c(0x29b)](),showTicketDetails(_0x636948),hideLoader();}else showNotification(_0xe9c25c(0x2b5),_0xe9c25c(0x21a)),hideLoader();}catch(_0xcb2ae0){console['error'](_0xe9c25c(0x1e1),_0xcb2ae0),showNotification(_0xe9c25c(0x2b5),_0xe9c25c(0x210)),hideLoader();}},window[_0x7dcf3(0x25c)]=function(){const _0x2af05a=_0x7dcf3,_0x527a37=document[_0x2af05a(0x236)]('historySection'),_0x285ea3=_0x527a37[_0x2af05a(0x271)][_0x2af05a(0x267)]==='block';_0x527a37[_0x2af05a(0x271)][_0x2af05a(0x267)]=_0x285ea3?_0x2af05a(0x279):_0x2af05a(0x287),!_0x285ea3&&loadHistory();},window['closeHistory']=function(){const _0x436411=_0x7dcf3;document[_0x436411(0x236)](_0x436411(0x268))[_0x436411(0x271)]['display']=_0x436411(0x279);},window['filterHistory']=function(){loadHistory();};function listenForNewMessages(){const _0x3bc74e=_0x7dcf3,_0x365272=ref(db,_0x3bc74e(0x2ab)+currentVendorId+_0x3bc74e(0x29a));onChildAdded(_0x365272,_0x235a90=>{const _0xded1bf=_0x3bc74e,_0x12c854=_0x235a90[_0xded1bf(0x29c)]();displayNewMessage(_0x12c854);});}function displayNewMessage(_0x1f88dd){const _0x3c852d=_0x7dcf3,_0x1cc283=document[_0x3c852d(0x236)]('messagesContainer'),_0x1e2c37=document[_0x3c852d(0x234)](_0x3c852d(0x202));_0x1e2c37[_0x3c852d(0x226)]['add'](_0x3c852d(0x28a)),_0x1e2c37[_0x3c852d(0x23b)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>'+_0x1f88dd[_0x3c852d(0x22b)]+_0x3c852d(0x218)+new Date(_0x1f88dd['timestamp'])['toLocaleString']()+_0x3c852d(0x2a7),_0x1cc283[_0x3c852d(0x2af)](_0x1e2c37),_0x1cc283[_0x3c852d(0x27c)]=_0x1cc283['scrollHeight'];}window[_0x7dcf3(0x231)]=function(){const _0x362da5=_0x7dcf3,_0x424195=document[_0x362da5(0x236)](_0x362da5(0x1ff))[_0x362da5(0x28c)];navigator[_0x362da5(0x28d)]?navigator['share']({'title':_0x362da5(0x284),'text':_0x424195})[_0x362da5(0x269)](()=>console['log'](_0x362da5(0x208)))['catch'](_0x3b128f=>console[_0x362da5(0x280)](_0x362da5(0x266),_0x3b128f)):alert(_0x362da5(0x252));},window['copyTicket']=function(){const _0x4ab81f=_0x7dcf3,_0x253863=document[_0x4ab81f(0x236)](_0x4ab81f(0x1ff))[_0x4ab81f(0x28c)];navigator[_0x4ab81f(0x1fe)][_0x4ab81f(0x1f2)](_0x253863)['then'](()=>{const _0x34b67d=_0x4ab81f;showNotification(_0x34b67d(0x1f3),_0x34b67d(0x289));})[_0x4ab81f(0x1e6)](_0x150095=>{const _0x475f30=_0x4ab81f;console[_0x475f30(0x280)](_0x475f30(0x227),_0x150095),showNotification('Erreur','Impossible\x20de\x20copier\x20le\x20ticket');});},window[_0x7dcf3(0x240)]=async function(){const _0x2a66ef=_0x7dcf3;showLoader();const _0x4910a1=document[_0x2a66ef(0x236)](_0x2a66ef(0x1ff)),_0x4a1af7=new jsPDF(),_0x1fd237=await html2canvas(_0x4910a1),_0x1cb2e7=_0x1fd237[_0x2a66ef(0x270)](_0x2a66ef(0x25b));_0x4a1af7['addImage'](_0x1cb2e7,_0x2a66ef(0x273),0xa,0xa,0xbe,0x0),_0x4a1af7[_0x2a66ef(0x214)](_0x2a66ef(0x212)),hideLoader();},window[_0x7dcf3(0x26f)]=function(){const _0x1e01e3=_0x7dcf3;window[_0x1e01e3(0x253)]();},window[_0x7dcf3(0x205)]=function(){const _0x4591e2=_0x7dcf3,{jsPDF:_0x583922}=window[_0x4591e2(0x23e)],_0x5ba77d=new _0x583922(),_0x9d0a4c=document['getElementById']('historyTableBody'),_0x434591={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x4591e2(0x238),'halign':_0x4591e2(0x232)},_0x193715={'halign':_0x4591e2(0x247)},_0x7e773d={'theme':_0x4591e2(0x275),'headStyles':_0x434591,'bodyStyles':_0x193715,'margin':{'top':0x14},'startY':0x1e,'didDrawPage':function(_0x38ee13){const _0x17f2e8=_0x4591e2;_0x5ba77d[_0x17f2e8(0x21e)](_0x17f2e8(0x1fa),0xe,0xf);const _0x17f208=_0x17f2e8(0x255)+_0x5ba77d['internal']['getNumberOfPages']();_0x5ba77d[_0x17f2e8(0x2aa)](0xa);const _0x283fe9=_0x5ba77d[_0x17f2e8(0x256)][_0x17f2e8(0x2a3)],_0x26adda=_0x283fe9[_0x17f2e8(0x277)]?_0x283fe9[_0x17f2e8(0x277)]:_0x283fe9[_0x17f2e8(0x257)]();_0x5ba77d[_0x17f2e8(0x21e)](_0x17f208,_0x38ee13['settings'][_0x17f2e8(0x221)][_0x17f2e8(0x247)],_0x26adda-0xa),_0x5ba77d[_0x17f2e8(0x21e)](new Date()['toLocaleString'](),_0x283fe9[_0x17f2e8(0x22c)]-_0x38ee13[_0x17f2e8(0x1e8)][_0x17f2e8(0x221)][_0x17f2e8(0x222)]-0x28,_0x26adda-0xa);}};_0x5ba77d[_0x4591e2(0x1eb)]({'html':'#historyTableBody',..._0x7e773d}),_0x5ba77d[_0x4591e2(0x214)](_0x4591e2(0x1f7));},window[_0x7dcf3(0x28f)]=function(){const _0x286429=_0x7dcf3,_0x245a9=XLSX['utils'][_0x286429(0x23a)](document['getElementById'](_0x286429(0x2a9)),{'sheet':_0x286429(0x27f)}),_0x425e6d=XLSX[_0x286429(0x26c)](_0x245a9,{'bookType':_0x286429(0x290),'type':'binary'});function _0x1a8ab2(_0x157bb5){const _0xef78c4=_0x286429,_0x9b94da=new ArrayBuffer(_0x157bb5[_0xef78c4(0x261)]),_0x15af2c=new Uint8Array(_0x9b94da);for(let _0x17293a=0x0;_0x17293a<_0x157bb5[_0xef78c4(0x261)];_0x17293a++)_0x15af2c[_0x17293a]=_0x157bb5[_0xef78c4(0x230)](_0x17293a)&0xff;return _0x9b94da;}saveAs(new Blob([_0x1a8ab2(_0x425e6d)],{'type':'application/octet-stream'}),_0x286429(0x1fb));};function showLoader(){const _0x3ac80a=_0x7dcf3;document['getElementById'](_0x3ac80a(0x288))[_0x3ac80a(0x271)][_0x3ac80a(0x267)]=_0x3ac80a(0x287);}function hideLoader(){const _0x3347c3=_0x7dcf3;document[_0x3347c3(0x236)](_0x3347c3(0x288))[_0x3347c3(0x271)]['display']='none';}function showPageLoader(){const _0x4b5b1a=_0x7dcf3;document[_0x4b5b1a(0x236)]('pageLoaderWrapper')[_0x4b5b1a(0x271)][_0x4b5b1a(0x267)]=_0x4b5b1a(0x1e9);}function hidePageLoader(){const _0x1417b5=_0x7dcf3;document[_0x1417b5(0x236)](_0x1417b5(0x1f9))['style']['display']=_0x1417b5(0x279);}function showSubscriptionRequiredModal(){const _0x2db717=_0x7dcf3;subscriptionRequiredModal[_0x2db717(0x271)]['display']=_0x2db717(0x1e9);}function hideSubscriptionRequiredModal(){const _0x3a4d32=_0x7dcf3;subscriptionRequiredModal[_0x3a4d32(0x271)][_0x3a4d32(0x267)]=_0x3a4d32(0x279);}function redirectToSubscription(){const _0x586b87=_0x7dcf3;window[_0x586b87(0x20e)][_0x586b87(0x262)]='index.html';}async function checkSubscriptionStatus(){const _0x2eb30f=_0x7dcf3,_0x527ee5=document['getElementById'](_0x2eb30f(0x1f5));_0x527ee5[_0x2eb30f(0x293)]=_0x2eb30f(0x2a2);try{const _0x26a13b=await get(adminRef),_0x2a06a8=_0x26a13b[_0x2eb30f(0x29c)](),_0x1a0d15=new Date();if(_0x2a06a8&&_0x2a06a8[_0x2eb30f(0x220)]==='active'){const _0x56923f=new Date(_0x2a06a8['endDate']);_0x56923f<_0x1a0d15?(_0x527ee5[_0x2eb30f(0x293)]='Abonnement\x20expiré',showSubscriptionRequiredModal(),await adminRef['update']({'status':_0x2eb30f(0x22e)})):_0x527ee5[_0x2eb30f(0x293)]=_0x2eb30f(0x292);}else _0x527ee5[_0x2eb30f(0x293)]=_0x2eb30f(0x200),showSubscriptionRequiredModal();}catch(_0x49d1d2){console['error']('Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:',_0x49d1d2),_0x527ee5[_0x2eb30f(0x293)]=_0x2eb30f(0x1e7),showNotification(_0x2eb30f(0x2b5),_0x2eb30f(0x1e4));}}document[_0x7dcf3(0x21c)](_0x7dcf3(0x243),()=>{const _0x4c077c=_0x7dcf3;checkSubscriptionStatus()[_0x4c077c(0x269)](()=>{const _0x3430da=_0x4c077c;fetchVendors(),lucide[_0x3430da(0x21f)](),hidePageLoader();})[_0x4c077c(0x1e6)](_0x312087=>{const _0x29e4f8=_0x4c077c;console['error'](_0x29e4f8(0x291),_0x312087),showNotification('Erreur',_0x29e4f8(0x1e3)),hidePageLoader();});}),window[_0x7dcf3(0x204)]=redirectToSubscription,window['hideSubscriptionRequiredModal']=redirectToSubscription;
    </script>
</body>
</html>
