<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrateur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.20/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ... (Styles CSS - Pas de modifications majeures, juste quelques ajustements) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #424242, #073018, #553a01);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
        }

        .logout-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .logout-button:hover {
            background-color: #c0392b;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .stat-card h3 {
            color: #fdbb2d;
            margin-bottom: 10px;
        }

        .filters {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        select,
        input {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        select option {
            background: #1a2a6c;
            color: white;
        }

        .sales-table {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(0, 0, 0, 0.2);
            color: #fdbb2d;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
            color: white; /* Texte en blanc pour la lisibilité */
            background-color: #28a745; /* Vert */
        }
        .action-btn.copy-link-btn {
            background-color: #17a2b8; /* Bleu clair */
        }

        .delete-btn {
            background: #dc3545; /* Rouge (Bootstrap danger) */
        }

        .clear-btn {
            background: #007bff; /* Bleu (Bootstrap primary) */
        }
         .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Assurez-vous que le modal est au-dessus du reste */
        }


        .modal-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .partners-management {
            margin-bottom: 30px;
        }

        .partner-actions {
            margin-bottom: 20px;
        }

        .partner-form {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .partner-form input {
            margin-bottom: 10px;
            width: 100%; /* Assurez-vous que les inputs prennent toute la largeur */
            padding: 10px; /* Augmentez le padding pour une meilleure saisie */

        }
         .partner-form .input-group {
            margin-bottom: 15px; /* Plus d'espace entre les groupes d'input */
        }

        .partner-form label {
            display: block;
            margin-bottom: 5px;
            color: #f8f9fa; /* Couleur claire pour les labels */
        }

        .partners-table table {
            width: 100%;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }
        }
          /* Styles pour la section de lien partenaire */
        .partner-link-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: none; /* Caché par défaut */
        }

        .partner-link-section p {
            margin-bottom: 10px;
            word-break: break-all; /* Pour éviter que les longs liens ne débordent */
        }

        .partner-link-section button {
            margin-top: 10px;
        }

        .loader-wrapper, .page-loader-wrapper {
            /* Styles pour les loaders - Pas de modifications */
              display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .loader, .page-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #fdbb2d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            transform: translate(-50%, -50%);
        }
          @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .subscription-required {
            /* ... (styles pour subscription-required) ... */
             display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .subscription-required-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .subscription-required-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .subscription-required-content p {
            color: #666;
            margin-bottom: 30px;
        }

        .subscription-required-content button {
            background-color: #fdbb2d;
            color: #1a2a6c;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0 10px;
        }

        .subscription-required-content button:hover {
            background-color: #e6a727;
        }
          .export-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .export-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .export-btn:hover {
            background-color: #218838;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .export-btn i {
            margin-right: 6px;
        }

    </style>
</head>
<body>
    <div class="page-loader-wrapper" id="pageLoaderWrapper">
        <div class="page-loader"></div>
        <div class="loader-message" id="pageLoaderMessage">Initialisation...</div>
    </div>
    <div class="loader-wrapper" id="loaderWrapper">
        <div class="loader"></div>
    </div>
    <div class="container" id="contentContainer" style="display:none;">
        <div class="header">
            <h1>Dashboard Administrateur</h1>
             <button onclick="logout()" class="logout-button">
                <i class="fas fa-sign-out-alt"></i> Déconnexion
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total des ventes</h3>
                <div id="totalSales">0 FCFA</div>
            </div>
            <div class="stat-card">
                <h3>Nombre de tickets vendus</h3>
                <div id="totalTickets">0</div>
            </div>
            <div class="stat-card">
                <h3>Meilleur vendeur</h3>
                <div id="topVendor">-</div>
            </div>
        </div>

        <div class="filters">
            <select id="vendorFilter">
                <option value="all">Tous les vendeurs</option>
            </select>
            <select id="periodFilter">
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
                <option value="all">Toute la période</option>
            </select>
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button class="action-btn" onclick="applyFilters()">Filtrer</button>
        </div>

        <div class="sales-table">

            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Vendeur</th>
                        <th>Catégorie</th>
                        <th>Utilisateur</th>
                        <th>Prix</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="salesTable"></tbody>
            </table>
            <div class="export-buttons">
                <button class="action-btn delete-btn" onclick="printTable()"><i class="fas fa-print"></i> Imprimer</button>
                <button class="action-btn delete-btn" onclick="exportToPDF()"><i class="fas fa-file-download"></i> Exporter en PDF</button>
                <button class="action-btn delete-btn" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Exporter en Excel</button>
            </div>
        </div>

        <div class="partners-management">
            <h2>Gestion des partenaires</h2>
            <div class="partner-actions">
                <button class="action-btn" onclick="showAddPartnerForm()">Ajouter un partenaire</button>
            </div>

            <div class="partner-form" id="addPartnerForm" style="display: none;">
                <h3>Ajouter un partenaire</h3>
                <div class="input-group">
                    <label for="newPartnerName">Nom du partenaire :</label>
                    <input type="text" id="newPartnerName" placeholder="Nom du partenaire">
                </div>
                <div class="input-group">
                    <label for="newPartnerPassword">Mot de passe :</label>
                    <input type="password" id="newPartnerPassword" placeholder="Mot de passe">
                </div>
                <button class="action-btn" onclick="addPartner()">Enregistrer</button>
                <button class="action-btn clear-btn" onclick="hideAddPartnerForm()">Annuler</button>
            </div>

             <!-- Section pour afficher le lien du partenaire -->
            <div class="partner-link-section" id="partnerLinkSection">
                <h3>Lien du partenaire</h3>
                <p id="partnerLink"></p>
                <button class="action-btn copy-link-btn" onclick="copyPartnerLink()">Copier le lien</button>
            </div>

            <div class="partners-table">
                <table>
                    <thead>
                        <tr>
                            <th>Nom du partenaire</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="partnersTable"></tbody>
                </table>
            </div>
        </div>

        <div id="editPartnerModal" class="modal">
            <div class="modal-content">
                <h2>Modifier le partenaire</h2>
                 <div class="input-group">
                    <label for="editPartnerName">Nom du partenaire :</label>
                    <input type="text" id="editPartnerName" placeholder="Nom du partenaire">
                </div>
                <div class="input-group">
                    <label for="editPartnerPassword">Mot de passe :</label>
                    <input type="password" id="editPartnerPassword" placeholder="Mot de passe">
                </div>
                <input type="hidden" id="editPartnerId">
                <div class="modal-actions">
                    <button class="action-btn" onclick="closeEditModal()">Annuler</button>
                    <button class="action-btn" onclick="updatePartner()">Enregistrer</button>
                </div>
            </div>
        </div>

        <div id="messagePartnerModal" class="modal">
            <div class="modal-content">
                <h2>Envoyer un message</h2>
                <input type="hidden" id="messagePartnerId">
                 <div class="input-group">
                    <label for="messageContent">Message :</label>
                     <textarea id="messageContent" placeholder="Votre message"></textarea>
                </div>
                <div class="modal-actions">
                    <button class="action-btn" onclick="closeMessageModal()">Annuler</button>
                    <button class="action-btn" onclick="sendMessage()">Envoyer</button>
                </div>
            </div>
        </div>

    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2>Confirmation</h2>
            <p id="modalMessage"></p>
            <div class="modal-actions">
                <button class="action-btn" onclick="closeModal()">Annuler</button>
                <button class="action-btn delete-btn" id="confirmBtn">Confirmer</button>
            </div>
        </div>
    </div>
    <div id="subscriptionRequiredModal" class="subscription-required" style="display: none;">
        <div class="subscription-required-content">
            <h2>Abonnement Requis</h2>
            <p>Un abonnement actif est nécessaire pour accéder à cette fonctionnalité.</p>
            <button onclick="redirectToSubscription()">S'abonner</button>
            <button onclick="hideSubscriptionRequiredModal()">Fermer</button>
        </div>
    </div>
    <script type="module">
const _0x1fac09=_0x350e;(function(_0x206b1f,_0x59b952){const _0x155557=_0x350e,_0x2aba34=_0x206b1f();while(!![]){try{const _0xc791a=parseInt(_0x155557(0x12a))/0x1+-parseInt(_0x155557(0x122))/0x2*(-parseInt(_0x155557(0x1b1))/0x3)+parseInt(_0x155557(0x131))/0x4*(-parseInt(_0x155557(0x193))/0x5)+-parseInt(_0x155557(0x13e))/0x6+-parseInt(_0x155557(0x119))/0x7*(parseInt(_0x155557(0x1a7))/0x8)+parseInt(_0x155557(0x152))/0x9*(-parseInt(_0x155557(0x144))/0xa)+parseInt(_0x155557(0x147))/0xb;if(_0xc791a===_0x59b952)break;else _0x2aba34['push'](_0x2aba34['shift']());}catch(_0x1566ee){_0x2aba34['push'](_0x2aba34['shift']());}}}(_0x58d3,0x42ce2));import{getActiveDatabase}from'./firebase-config-manager.js';function _0x350e(_0x480a40,_0x2b6b8d){const _0x58d346=_0x58d3();return _0x350e=function(_0x350e75,_0x46ced8){_0x350e75=_0x350e75-0x115;let _0x57c4c2=_0x58d346[_0x350e75];return _0x57c4c2;},_0x350e(_0x480a40,_0x2b6b8d);}import{ref,get,remove,set,push,update}from'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';let db,adminRef;async function initializeDatabase(){const _0x2f36e7=_0x350e;db=await getActiveDatabase(),console[_0x2f36e7(0x136)](_0x2f36e7(0x15e));}async function checkLoginStatus(){const _0x45ed25=_0x350e;if(sessionStorage[_0x45ed25(0x13d)](_0x45ed25(0x139))!=='true')redirectToLogin();else{const _0x432e2e=sessionStorage[_0x45ed25(0x13d)](_0x45ed25(0x1a1));if(!_0x432e2e){console[_0x45ed25(0x177)]('currentUserId\x20is\x20null.\x20User\x20might\x20not\x20be\x20logged\x20in\x20properly.'),redirectToLogin();return;}adminRef=ref(db,_0x45ed25(0x128)+_0x432e2e+_0x45ed25(0x17f)),document[_0x45ed25(0x18b)]('contentContainer')[_0x45ed25(0x130)]['display']=_0x45ed25(0x16e);}}function redirectToLogin(){const _0x2a645c=_0x350e;window[_0x2a645c(0x16b)]['href']=_0x2a645c(0x1be);}window[_0x1fac09(0x15d)]=function(){const _0xeb15d0=_0x1fac09;sessionStorage[_0xeb15d0(0x125)](),redirectToLogin();};let allSales=[],vendors=new Set(),partners={};function generatePartnerLink(_0x100843,_0x200391){const _0x2d9773=_0x1fac09,_0x5ca602=window[_0x2d9773(0x16b)]['origin'];return _0x5ca602+_0x2d9773(0x134)+encodeURIComponent(_0x100843)+'&adminId='+encodeURIComponent(_0x200391);}async function loadPartners(){const _0x31fb09=_0x1fac09,_0x3fd2b2=sessionStorage[_0x31fb09(0x13d)](_0x31fb09(0x1a1));if(!_0x3fd2b2)return;try{const _0x219d2d=ref(db,'users-data/'+_0x3fd2b2+'/Vendors'),_0x685c6=await get(_0x219d2d);_0x685c6['exists']()&&(partners=_0x685c6[_0x31fb09(0x1ce)](),updatePartnersTable());}catch(_0x49957a){console[_0x31fb09(0x177)](_0x31fb09(0x184),_0x49957a);}}function updatePartnersTable(){const _0x4b243e=_0x1fac09,_0x29d558=document[_0x4b243e(0x18b)]('partnersTable');_0x29d558[_0x4b243e(0x12e)]='';for(const _0x2d0b79 in partners){const _0xcd474b=partners[_0x2d0b79],_0x1aa1f2=document[_0x4b243e(0x11a)]('tr');_0x1aa1f2['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+_0x2d0b79+_0x4b243e(0x127)+_0x2d0b79+_0x4b243e(0x1b2)+_0x2d0b79+_0x4b243e(0x159)+_0x2d0b79+_0x4b243e(0x164)+_0x2d0b79+'\x27)\x22>Lien</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x29d558['appendChild'](_0x1aa1f2);}}window[_0x1fac09(0x1b9)]=function(){const _0x57006e=_0x1fac09;document['getElementById'](_0x57006e(0x179))['style']['display']=_0x57006e(0x16e),document['getElementById']('partnerLinkSection')[_0x57006e(0x130)][_0x57006e(0x17a)]=_0x57006e(0x1b8);},window[_0x1fac09(0x1c4)]=function(){const _0x5ab292=_0x1fac09;document['getElementById']('newPartnerName')[_0x5ab292(0x155)]='',document['getElementById'](_0x5ab292(0x132))[_0x5ab292(0x155)]='',document[_0x5ab292(0x18b)](_0x5ab292(0x179))[_0x5ab292(0x130)][_0x5ab292(0x17a)]='none';},window['addPartner']=async function(){const _0x1b4df2=_0x1fac09,_0x3ff912=document['getElementById'](_0x1b4df2(0x1ac))['value'][_0x1b4df2(0x16f)](),_0x503e6a=document[_0x1b4df2(0x18b)]('newPartnerPassword')[_0x1b4df2(0x155)],_0x3736c7=sessionStorage[_0x1b4df2(0x13d)]('currentUserId');if(!_0x3736c7)return;if(!_0x3ff912||!_0x503e6a){alert('Veuillez\x20remplir\x20tous\x20les\x20champs.');return;}if(partners[_0x3ff912]){alert('Ce\x20nom\x20de\x20partenaire\x20est\x20déjà\x20utilisé.');return;}try{const _0x1761b7=ref(db,_0x1b4df2(0x128)+_0x3736c7+_0x1b4df2(0x1bd)+_0x3ff912);await set(_0x1761b7,{'password':_0x503e6a});const _0x421338=generatePartnerLink(_0x3ff912,_0x3736c7);document[_0x1b4df2(0x18b)]('partnerLink')[_0x1b4df2(0x137)]=_0x421338,document[_0x1b4df2(0x18b)](_0x1b4df2(0x18a))['style'][_0x1b4df2(0x17a)]=_0x1b4df2(0x16e),await loadPartners(),hideAddPartnerForm();}catch(_0x1101d4){console[_0x1b4df2(0x177)](_0x1b4df2(0x1b0),_0x1101d4),alert('Une\x20erreur\x20s\x27est\x20produite\x20lors\x20de\x20l\x27ajout\x20du\x20partenaire.');}},window[_0x1fac09(0x198)]=function(){const _0x4dd17f=_0x1fac09,_0x9fe73a=document[_0x4dd17f(0x18b)]('partnerLink')['textContent'];navigator['clipboard']['writeText'](_0x9fe73a)[_0x4dd17f(0x143)](()=>{const _0x50df81=_0x4dd17f;alert(_0x50df81(0x117));})['catch'](_0x10b4bd=>{const _0x5b744e=_0x4dd17f;console[_0x5b744e(0x177)](_0x5b744e(0x115),_0x10b4bd),alert(_0x5b744e(0x194));});},window[_0x1fac09(0x1af)]=function(_0x3d955c){const _0x8e2777=_0x1fac09,_0x39cd9d=document[_0x8e2777(0x18b)](_0x8e2777(0x199));document[_0x8e2777(0x18b)](_0x8e2777(0x161))['value']=_0x3d955c,document[_0x8e2777(0x18b)](_0x8e2777(0x18d))[_0x8e2777(0x155)]=_0x3d955c,document['getElementById'](_0x8e2777(0x11d))[_0x8e2777(0x155)]=partners[_0x3d955c][_0x8e2777(0x1c6)],_0x39cd9d[_0x8e2777(0x130)][_0x8e2777(0x17a)]='flex',document[_0x8e2777(0x18b)](_0x8e2777(0x18a))['style'][_0x8e2777(0x17a)]=_0x8e2777(0x1b8);},window[_0x1fac09(0x11f)]=function(){const _0x2e6912=_0x1fac09;document[_0x2e6912(0x18b)]('editPartnerModal')[_0x2e6912(0x130)][_0x2e6912(0x17a)]=_0x2e6912(0x1b8);},window[_0x1fac09(0x1bb)]=async function(){const _0x52b472=_0x1fac09,_0x38a5c5=document[_0x52b472(0x18b)](_0x52b472(0x161))['value'],_0x1f6899=document[_0x52b472(0x18b)](_0x52b472(0x18d))[_0x52b472(0x155)]['trim'](),_0x3d9e5f=document[_0x52b472(0x18b)](_0x52b472(0x11d))['value'],_0x47bab3=sessionStorage[_0x52b472(0x13d)](_0x52b472(0x1a1));if(!_0x47bab3)return;if(!_0x1f6899||!_0x3d9e5f){alert(_0x52b472(0x13f));return;}if(_0x1f6899!==_0x38a5c5&&partners[_0x1f6899]){alert(_0x52b472(0x17e));return;}try{const _0x10ff7b={};_0x10ff7b[_0x52b472(0x128)+_0x47bab3+_0x52b472(0x1bd)+_0x1f6899]={'password':_0x3d9e5f};if(_0x38a5c5!==_0x1f6899){_0x10ff7b[_0x52b472(0x128)+_0x47bab3+'/Vendors/'+_0x38a5c5]=null;const _0xc654cc=ref(db,_0x52b472(0x128)+_0x47bab3+_0x52b472(0x185)+_0x38a5c5),_0xe505f8=await get(_0xc654cc);_0xe505f8[_0x52b472(0x1a8)]()&&(_0x10ff7b[_0x52b472(0x128)+_0x47bab3+_0x52b472(0x185)+_0x1f6899]=_0xe505f8['val'](),_0x10ff7b['users-data/'+_0x47bab3+'/VendorsHistory/'+_0x38a5c5]=null);}await update(ref(db),_0x10ff7b),await loadPartners(),closeEditModal();}catch(_0x1a6bdc){console[_0x52b472(0x177)]('Erreur\x20lors\x20de\x20la\x20mise\x20à\x20jour\x20du\x20partenaire:',_0x1a6bdc),alert('Une\x20erreur\x20s\x27est\x20produite\x20lors\x20de\x20la\x20mise\x20à\x20jour\x20du\x20partenaire.');}},window[_0x1fac09(0x182)]=async function(_0x4a0b1f){const _0x2c4d41=_0x1fac09,_0x276347=sessionStorage['getItem'](_0x2c4d41(0x1a1));if(!_0x276347)return;if(confirm('Êtes-vous\x20sûr\x20de\x20vouloir\x20supprimer\x20le\x20partenaire\x20'+_0x4a0b1f+'\x20?\x20\x20Toutes\x20les\x20données\x20associées\x20seront\x20perdues.')){showLoader();try{const _0x1c1a5={};_0x1c1a5['users-data/'+_0x276347+_0x2c4d41(0x1bd)+_0x4a0b1f]=null,_0x1c1a5[_0x2c4d41(0x128)+_0x276347+_0x2c4d41(0x185)+_0x4a0b1f]=null,await update(ref(db),_0x1c1a5),hideLoader(),await loadPartners();}catch(_0x2553ec){hideLoader(),console['error'](_0x2c4d41(0x19b),_0x2553ec),alert(_0x2c4d41(0x165));}}},window['showMessagePartnerForm']=function(_0x263219){const _0x479a7d=_0x1fac09,_0x52bad=document[_0x479a7d(0x18b)](_0x479a7d(0x17b));document['getElementById'](_0x479a7d(0x146))[_0x479a7d(0x155)]=_0x263219,document[_0x479a7d(0x18b)]('messageContent')['value']='',_0x52bad['style'][_0x479a7d(0x17a)]=_0x479a7d(0x172),document['getElementById'](_0x479a7d(0x18a))['style'][_0x479a7d(0x17a)]=_0x479a7d(0x1b8);},window[_0x1fac09(0x181)]=function(){const _0x441b57=_0x1fac09;document[_0x441b57(0x18b)](_0x441b57(0x17b))[_0x441b57(0x130)][_0x441b57(0x17a)]=_0x441b57(0x1b8);},window['sendMessage']=async function(){const _0x152eec=_0x1fac09,_0x1f3c4c=document['getElementById'](_0x152eec(0x146))[_0x152eec(0x155)],_0x55c81d=document[_0x152eec(0x18b)](_0x152eec(0x149))['value'],_0x442fac=sessionStorage[_0x152eec(0x13d)]('currentUserId');if(!_0x442fac)return;if(_0x55c81d)try{const _0x3a1d57=ref(db,_0x152eec(0x128)+_0x442fac+_0x152eec(0x1bd)+_0x1f3c4c+'/messages');await push(_0x3a1d57,{'content':_0x55c81d,'timestamp':Date['now']()}),alert(_0x152eec(0x11e)),closeMessageModal();}catch(_0x5c72ab){console[_0x152eec(0x177)](_0x152eec(0x148),_0x5c72ab);}else alert('Veuillez\x20saisir\x20un\x20message.');},window['showPartnerLink']=function(_0x1d7b28){const _0x4f3665=_0x1fac09,_0x227a18=sessionStorage['getItem'](_0x4f3665(0x1a1));if(!_0x227a18){alert(_0x4f3665(0x18c));return;}const _0x2a9523=generatePartnerLink(_0x1d7b28,_0x227a18);document[_0x4f3665(0x18b)]('partnerLink')[_0x4f3665(0x137)]=_0x2a9523,document['getElementById'](_0x4f3665(0x18a))[_0x4f3665(0x130)]['display']=_0x4f3665(0x16e),document['getElementById'](_0x4f3665(0x179))[_0x4f3665(0x130)][_0x4f3665(0x17a)]='none',document[_0x4f3665(0x18b)]('editPartnerModal')[_0x4f3665(0x130)][_0x4f3665(0x17a)]=_0x4f3665(0x1b8),document[_0x4f3665(0x18b)](_0x4f3665(0x17b))[_0x4f3665(0x130)]['display']=_0x4f3665(0x1b8);};async function loadSalesData(){const _0x4d5665=_0x1fac09,_0x48c704=sessionStorage[_0x4d5665(0x13d)]('currentUserId');if(!_0x48c704)return;try{const _0x756f41=ref(db,_0x4d5665(0x128)+_0x48c704+_0x4d5665(0x1ba)),_0x570688=await get(_0x756f41);_0x570688['exists']()&&(vendors=new Set(Object[_0x4d5665(0x140)](_0x570688[_0x4d5665(0x1ce)]())),updateVendorFilter());const _0x3fc981=ref(db,'users-data/'+_0x48c704+'/VendorsHistory'),_0x2d4c15=await get(_0x3fc981);if(_0x2d4c15[_0x4d5665(0x1a8)]()){allSales=[];const _0x39d64b=_0x2d4c15[_0x4d5665(0x1ce)]();Object['entries'](_0x39d64b)[_0x4d5665(0x187)](([_0x258704,_0x20320c])=>{const _0x93b065=_0x4d5665;Object[_0x93b065(0x183)](_0x20320c)['forEach'](([_0x35240e,_0x5927b8])=>{allSales['push']({'id':_0x35240e,'vendor':_0x258704,..._0x5927b8});});}),applyFilters();}}catch(_0x5e2b6a){console[_0x4d5665(0x177)]('Erreur\x20lors\x20du\x20chargement\x20des\x20données:',_0x5e2b6a);}}function updateVendorFilter(){const _0x5c034a=_0x1fac09,_0x2ba0c9=document[_0x5c034a(0x18b)](_0x5c034a(0x12f));_0x2ba0c9[_0x5c034a(0x12e)]=_0x5c034a(0x167),vendors[_0x5c034a(0x187)](_0x451af5=>{const _0x2e93df=_0x5c034a;_0x2ba0c9[_0x2e93df(0x12e)]+=_0x2e93df(0x16c)+_0x451af5+'\x22>'+_0x451af5+_0x2e93df(0x1bc);});}async function loadSales(){const _0x15085d=_0x1fac09,_0x23edc5=sessionStorage[_0x15085d(0x13d)](_0x15085d(0x1a1));if(!_0x23edc5)return;try{const _0x3ae3b9=ref(db,_0x15085d(0x128)+_0x23edc5+_0x15085d(0x1ba)),_0x4c6818=await get(_0x3ae3b9);if(_0x4c6818['exists']()){allSales=[];const _0x55199e=_0x4c6818['val']();Object[_0x15085d(0x183)](_0x55199e)[_0x15085d(0x187)](([_0x2ea246,_0x438038])=>{const _0x59b7ba=_0x15085d;Object[_0x59b7ba(0x183)](_0x438038)[_0x59b7ba(0x187)](([_0xdd65f8,_0x477dfa])=>{const _0x1802b0=_0x59b7ba;allSales[_0x1802b0(0x178)]({'id':_0xdd65f8,'vendor':_0x2ea246,..._0x477dfa});});}),applyFilters();}}catch(_0x3ad733){console[_0x15085d(0x177)](_0x15085d(0x133),_0x3ad733);}}window[_0x1fac09(0x166)]=function(){const _0x5529a1=_0x1fac09,_0x12e5bb=document[_0x5529a1(0x18b)]('vendorFilter')[_0x5529a1(0x155)],_0x1ffc4d=document[_0x5529a1(0x18b)](_0x5529a1(0x1a3))[_0x5529a1(0x155)],_0xd3175c=new Date(document['getElementById']('startDate')[_0x5529a1(0x155)]),_0x3c22e9=new Date(document['getElementById'](_0x5529a1(0x1cf))[_0x5529a1(0x155)]);_0x3c22e9[_0x5529a1(0x150)](0x17,0x3b,0x3b);let _0x2cfb3b=allSales;_0x12e5bb!=='all'&&(_0x2cfb3b=_0x2cfb3b[_0x5529a1(0x12c)](_0x64fd86=>_0x64fd86['vendor']===_0x12e5bb));if(_0x1ffc4d!=='all'||!isNaN(_0xd3175c['getTime']())||!isNaN(_0x3c22e9[_0x5529a1(0x1cc)]())){const _0x302947=new Date(),_0x2d1fd5={'today':new Date(_0x302947[_0x5529a1(0x150)](0x0,0x0,0x0,0x0)),'week':new Date(_0x302947[_0x5529a1(0x1b4)](_0x302947['getDate']()-_0x302947[_0x5529a1(0x19d)]())),'month':new Date(_0x302947[_0x5529a1(0x1b4)](0x1))};_0x2cfb3b=_0x2cfb3b['filter'](_0x122839=>{const _0x59063c=_0x5529a1,_0x5df096=new Date(_0x122839[_0x59063c(0x197)]);if(_0x1ffc4d!==_0x59063c(0x142)&&_0x2d1fd5[_0x1ffc4d])return _0x5df096>=_0x2d1fd5[_0x1ffc4d];if(!isNaN(_0xd3175c[_0x59063c(0x1cc)]())&&!isNaN(_0x3c22e9[_0x59063c(0x1cc)]()))return _0x5df096>=_0xd3175c&&_0x5df096<=_0x3c22e9;return!![];});}updateTable(_0x2cfb3b),updateStats(_0x2cfb3b);};function updateTable(_0x2ddd4b){const _0xf94174=_0x1fac09,_0x23affa=document[_0xf94174(0x18b)](_0xf94174(0x19a));_0x23affa['innerHTML']=_0x2ddd4b[_0xf94174(0x162)]((_0x300daa,_0x2fc7e5)=>_0x2fc7e5[_0xf94174(0x197)]-_0x300daa['soldAt'])[_0xf94174(0x190)](_0x28b60b=>_0xf94174(0x1c9)+new Date(_0x28b60b[_0xf94174(0x197)])[_0xf94174(0x17c)]()+_0xf94174(0x145)+_0x28b60b[_0xf94174(0x19f)]+_0xf94174(0x145)+_0x28b60b[_0xf94174(0x120)]+_0xf94174(0x145)+_0x28b60b[_0xf94174(0x1b3)]+_0xf94174(0x145)+_0x28b60b[_0xf94174(0x14e)]+'\x20FCFA</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x20delete-btn\x22\x20onclick=\x22deleteSale(\x27'+_0x28b60b[_0xf94174(0x19f)]+_0xf94174(0x168)+_0x28b60b['id']+_0xf94174(0x14d))[_0xf94174(0x129)]('');}function updateStats(_0x3f1b40){const _0x361a34=_0x1fac09,_0x5450c9=_0x3f1b40[_0x361a34(0x171)]((_0x4ed6a8,_0x1f7a6d)=>_0x4ed6a8+parseFloat(_0x1f7a6d[_0x361a34(0x14e)]),0x0),_0x338d95=_0x3f1b40[_0x361a34(0x196)],_0x285aa6=_0x3f1b40[_0x361a34(0x171)]((_0x5872b2,_0x581a4a)=>{const _0xf1c1d9=_0x361a34;return _0x5872b2[_0x581a4a[_0xf1c1d9(0x19f)]]=(_0x5872b2[_0x581a4a[_0xf1c1d9(0x19f)]]||0x0)+parseFloat(_0x581a4a['price']),_0x5872b2;},{}),_0x2cb24d=Object[_0x361a34(0x183)](_0x285aa6)[_0x361a34(0x162)](([,_0x36c6d0],[,_0x569dc7])=>_0x569dc7-_0x36c6d0)[0x0]?.[0x0]||'-';document[_0x361a34(0x18b)](_0x361a34(0x15b))[_0x361a34(0x137)]=_0x5450c9[_0x361a34(0x17c)]()+_0x361a34(0x17d),document[_0x361a34(0x18b)](_0x361a34(0x160))['textContent']=_0x338d95,document['getElementById'](_0x361a34(0x189))['textContent']=_0x2cb24d;}window[_0x1fac09(0x118)]=function(_0x354952,_0x1711ce){const _0x49fe30=_0x1fac09,_0x1200ba=sessionStorage[_0x49fe30(0x13d)](_0x49fe30(0x1a1));if(!_0x1200ba)return;const _0x103a98=document['getElementById']('confirmModal');document['getElementById'](_0x49fe30(0x180))[_0x49fe30(0x137)]=_0x49fe30(0x192);const _0x454529=document['getElementById']('confirmBtn');_0x454529[_0x49fe30(0x153)]=async()=>{const _0x5b0cc1=_0x49fe30;try{await remove(ref(db,'users-data/'+_0x1200ba+_0x5b0cc1(0x185)+_0x354952+'/'+_0x1711ce)),await loadSales(),closeModal();}catch(_0x3d1103){console[_0x5b0cc1(0x177)](_0x5b0cc1(0x173),_0x3d1103);}},_0x103a98[_0x49fe30(0x130)][_0x49fe30(0x17a)]=_0x49fe30(0x172);},window[_0x1fac09(0x1ae)]=function(_0x256ec2){const _0x477721=_0x1fac09,_0x6426d4=sessionStorage['getItem']('currentUserId');if(!_0x6426d4)return;const _0x4514aa=document[_0x477721(0x18b)](_0x477721(0x16d));document[_0x477721(0x18b)]('modalMessage')[_0x477721(0x137)]='Êtes-vous\x20sûr\x20de\x20vouloir\x20effacer\x20tout\x20l\x27historique\x20de\x20'+_0x256ec2+'\x20?';const _0x163326=document[_0x477721(0x18b)](_0x477721(0x15f));_0x163326[_0x477721(0x153)]=async()=>{const _0x140244=_0x477721;try{await set(ref(db,_0x140244(0x128)+_0x6426d4+_0x140244(0x185)+_0x256ec2),null),await loadSales(),closeModal();}catch(_0x166d60){console[_0x140244(0x177)](_0x140244(0x1c7),_0x166d60);}},_0x4514aa[_0x477721(0x130)][_0x477721(0x17a)]='flex';},window[_0x1fac09(0x15a)]=function(){const _0x482710=_0x1fac09;document[_0x482710(0x18b)](_0x482710(0x16d))[_0x482710(0x130)][_0x482710(0x17a)]=_0x482710(0x1b8);};function showLoader(){const _0x1e6eb8=_0x1fac09;document[_0x1e6eb8(0x18b)](_0x1e6eb8(0x176))[_0x1e6eb8(0x130)][_0x1e6eb8(0x17a)]=_0x1e6eb8(0x16e);}function hideLoader(){const _0x232aed=_0x1fac09;document[_0x232aed(0x18b)](_0x232aed(0x176))[_0x232aed(0x130)][_0x232aed(0x17a)]='none';}function showPageLoader(){const _0x1cae75=_0x1fac09;document[_0x1cae75(0x18b)](_0x1cae75(0x1ab))['style'][_0x1cae75(0x17a)]=_0x1cae75(0x172);}function _0x58d3(){const _0x4d7d46=['closeModal','totalSales','getDate','logout','Database\x20initialized\x20in\x20AdminVentePartenaires.html','confirmBtn','totalTickets','editPartnerId','sort','Utilisateur','\x27)\x22>Message</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x20copy-link-btn\x22\x20onclick=\x22showPartnerLink(\x27','Une\x20erreur\x20s\x27est\x20produite\x20lors\x20de\x20la\x20suppression\x20du\x20partenaire.','applyFilters','<option\x20value=\x22all\x22>Tous\x20les\x20vendeurs</option>','\x27,\x20\x27','Filtres\x20:\x20','Abonnement\x20actif','location','<option\x20value=\x22','confirmModal','block','trim','height','reduce','flex','Erreur\x20lors\x20de\x20la\x20suppression:','settings','Vendeur','loaderWrapper','error','push','addPartnerForm','display','messagePartnerModal','toLocaleString','\x20FCFA','Ce\x20nom\x20de\x20partenaire\x20est\x20déjà\x20utilisé.','/admin/subscription','modalMessage','closeMessageModal','deletePartner','entries','Erreur\x20lors\x20du\x20chargement\x20des\x20partenaires:','/VendorsHistory/','xlsx','forEach','Ventes','topVendor','partnerLinkSection','getElementById','Administrateur\x20non\x20connecté.','editPartnerName','center','Pas\x20d\x27abonnement\x20actif','map','addEventListener','Êtes-vous\x20sûr\x20de\x20vouloir\x20supprimer\x20cette\x20vente\x20?','5XpbRsl','Impossible\x20de\x20copier\x20le\x20lien.\x20Veuillez\x20le\x20copier\x20manuellement.','Prix','length','soldAt','copyPartnerLink','editPartnerModal','salesTable','Erreur\x20lors\x20de\x20la\x20suppression\x20du\x20partenaire:','ventes.xlsx','getDay','hideSubscriptionRequiredModal','vendor','charCodeAt','currentUserId','active','periodFilter','Catégorie','internal','width','312tdmeIb','exists','json_to_sheet','book_append_sheet','pageLoaderWrapper','newPartnerName','right','clearVendorHistory','showEditPartnerForm','Erreur\x20lors\x20de\x20l\x27ajout\x20du\x20partenaire:','6axKxrT','\x27)\x22>Modifier</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x20delete-btn\x22\x20onclick=\x22deletePartner(\x27','user','setDate','href','bold','startDate','none','showAddPartnerForm','/VendorsHistory','updatePartner','</option>','/Vendors/','loginAccueil.html','pageLoaderMessage','grid','Vérification\x20de\x20l\x27abonnement...','left','expired','hideAddPartnerForm','index.html','password','Erreur\x20lors\x20de\x20l\x27effacement:','Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','Période:\x20','Page\x20','getTime','text','val','endDate','Erreur\x20lors\x20de\x20la\x20copie\x20du\x20lien:','setFontSize','Lien\x20copié\x20dans\x20le\x20presse-papiers!','deleteSale','18683vfLDti','createElement','Date','Liste\x20des\x20ventes','editPartnerPassword','Message\x20envoyé\x20!','closeEditModal','category','Vendeur:\x20','438326lhBuTT','ventes.pdf','getHeight','clear','currentUserId\x20is\x20null.\x20Subscription\x20check\x20failed.','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x22\x20onclick=\x22showEditPartnerForm(\x27','users-data/','join','466146LvtWXO','printTable','filter','pageSize','innerHTML','vendorFilter','style','1356972jcWoxp','newPartnerPassword','Erreur\x20lors\x20du\x20chargement\x20des\x20ventes:','/PageVenteTicket.html?partnerId=','binary','log','textContent','sheet_add_aoa','isLoggedIn','status','margin','Fin:\x20','getItem','78126oyISWc','Veuillez\x20remplir\x20tous\x20les\x20champs.','keys','exportToPDF','all','then','349630yufigP','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>','messagePartnerId','3652hUXLQm','Erreur\x20lors\x20de\x20l\x27envoi\x20du\x20message:','messageContent','Début:\x20','print','redirectToSubscription','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Supprimer\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','price','DOMContentLoaded','setHours','Abonnement\x20expiré','45DzyagM','onclick','write','value','toLocaleDateString','exportToExcel','utils','\x27)\x22>Supprimer</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22action-btn\x22\x20onclick=\x22showMessagePartnerForm(\x27'];_0x58d3=function(){return _0x4d7d46;};return _0x58d3();}function hidePageLoader(){const _0x403f15=_0x1fac09;document['getElementById'](_0x403f15(0x1ab))[_0x403f15(0x130)][_0x403f15(0x17a)]='none';}function showSubscriptionRequiredModal(){const _0xab4e6d=_0x1fac09;subscriptionRequiredModal['style']['display']=_0xab4e6d(0x172);}function hideSubscriptionRequiredModal(){const _0x9771ec=_0x1fac09;subscriptionRequiredModal['style'][_0x9771ec(0x17a)]=_0x9771ec(0x1b8);}function redirectToSubscription(){const _0x1e57fb=_0x1fac09;window[_0x1e57fb(0x16b)][_0x1e57fb(0x1b5)]=_0x1e57fb(0x1c5);}async function checkSubscriptionStatus(){const _0x35c82c=_0x1fac09,_0x12cd20=document[_0x35c82c(0x18b)](_0x35c82c(0x1bf));_0x12cd20[_0x35c82c(0x137)]=_0x35c82c(0x1c1);const _0x4aa02a=sessionStorage['getItem'](_0x35c82c(0x1a1));if(!_0x4aa02a)return hidePageLoader(),showSubscriptionRequiredModal(),console['error'](_0x35c82c(0x126)),![];try{adminRef=ref(db,_0x35c82c(0x128)+_0x4aa02a+_0x35c82c(0x17f));const _0x3b626b=await get(adminRef),_0x3eb1df=_0x3b626b[_0x35c82c(0x1ce)](),_0xf5ca7a=new Date();if(_0x3eb1df&&_0x3eb1df[_0x35c82c(0x13a)]===_0x35c82c(0x1a2)){const _0x4d0fa3=new Date(_0x3eb1df[_0x35c82c(0x1cf)]);return _0x4d0fa3<_0xf5ca7a?(_0x12cd20[_0x35c82c(0x137)]=_0x35c82c(0x151),hidePageLoader(),showSubscriptionRequiredModal(),await update(adminRef,{'status':_0x35c82c(0x1c3)}),![]):(_0x12cd20[_0x35c82c(0x137)]=_0x35c82c(0x16a),hidePageLoader(),!![]);}else return _0x12cd20[_0x35c82c(0x137)]=_0x35c82c(0x18f),hidePageLoader(),showSubscriptionRequiredModal(),![];}catch(_0x517660){return hidePageLoader(),console[_0x35c82c(0x177)]('Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement\x20:',_0x517660),_0x12cd20[_0x35c82c(0x137)]='Erreur\x20lors\x20de\x20la\x20vérification\x20de\x20l\x27abonnement',showNotification('Erreur',_0x35c82c(0x1c8)),![];}}window[_0x1fac09(0x12b)]=function(){const _0x499f64=_0x1fac09;window[_0x499f64(0x14b)]();},window[_0x1fac09(0x141)]=function(){const _0x3e3262=_0x1fac09,{jsPDF:_0x4a51fa}=window['jspdf'],_0xfb4989=new _0x4a51fa(),_0x5ef2dc=document[_0x3e3262(0x18b)](_0x3e3262(0x19a)),_0x4c9a33=document[_0x3e3262(0x18b)](_0x3e3262(0x12f))[_0x3e3262(0x155)],_0x4c0142=document['getElementById'](_0x3e3262(0x1a3))[_0x3e3262(0x155)],_0x258900=new Date(document[_0x3e3262(0x18b)](_0x3e3262(0x1b7))[_0x3e3262(0x155)]),_0x1bc012=new Date(document[_0x3e3262(0x18b)](_0x3e3262(0x1cf))[_0x3e3262(0x155)]);_0x1bc012[_0x3e3262(0x150)](0x17,0x3b,0x3b);let _0x426596=allSales;_0x4c9a33!==_0x3e3262(0x142)&&(_0x426596=_0x426596[_0x3e3262(0x12c)](_0x172767=>_0x172767[_0x3e3262(0x19f)]===_0x4c9a33));if(_0x4c0142!==_0x3e3262(0x142)||!isNaN(_0x258900[_0x3e3262(0x1cc)]())||!isNaN(_0x1bc012[_0x3e3262(0x1cc)]())){const _0x33dafb=new Date(),_0x43baf1={'today':new Date(_0x33dafb['setHours'](0x0,0x0,0x0,0x0)),'week':new Date(_0x33dafb[_0x3e3262(0x1b4)](_0x33dafb[_0x3e3262(0x15c)]()-_0x33dafb[_0x3e3262(0x19d)]())),'month':new Date(_0x33dafb[_0x3e3262(0x1b4)](0x1))};_0x426596=_0x426596['filter'](_0x53bece=>{const _0x742ef7=_0x3e3262,_0xa2dcfd=new Date(_0x53bece[_0x742ef7(0x197)]);if(_0x4c0142!==_0x742ef7(0x142)&&_0x43baf1[_0x4c0142])return _0xa2dcfd>=_0x43baf1[_0x4c0142];if(!isNaN(_0x258900[_0x742ef7(0x1cc)]())&&!isNaN(_0x1bc012[_0x742ef7(0x1cc)]()))return _0xa2dcfd>=_0x258900&&_0xa2dcfd<=_0x1bc012;return!![];});}const _0x217141=_0x426596['map'](_0x389446=>[new Date(_0x389446['soldAt'])[_0x3e3262(0x17c)](),_0x389446[_0x3e3262(0x19f)],_0x389446['category'],_0x389446['user'],_0x389446[_0x3e3262(0x14e)]+'\x20FCFA']),_0x157062={'fillColor':[0x2a,0x3a,0x6c],'textColor':[0xff,0xff,0xff],'fontStyle':_0x3e3262(0x1b6),'halign':_0x3e3262(0x18e)},_0x3813fc={'halign':'left'},_0x1472e3={'theme':_0x3e3262(0x1c0),'headStyles':_0x157062,'bodyStyles':_0x3813fc,'margin':{'top':0x1e},'startY':0x1e,'didDrawPage':function(_0x872c56){const _0x1dc75d=_0x3e3262;_0xfb4989['setFontSize'](0x12),_0xfb4989[_0x1dc75d(0x1cd)](_0x1dc75d(0x11c),0xe,0xf);let _0x34dadf=_0x1dc75d(0x169);if(_0x4c9a33!==_0x1dc75d(0x142))_0x34dadf+=_0x1dc75d(0x121)+_0x4c9a33+',\x20';if(_0x4c0142!=='all')_0x34dadf+=_0x1dc75d(0x1ca)+_0x4c0142+',\x20';if(!isNaN(_0x258900[_0x1dc75d(0x1cc)]()))_0x34dadf+=_0x1dc75d(0x14a)+_0x258900[_0x1dc75d(0x156)]()+',\x20';if(!isNaN(_0x1bc012[_0x1dc75d(0x1cc)]()))_0x34dadf+=_0x1dc75d(0x13c)+_0x1bc012[_0x1dc75d(0x156)]()+',\x20';_0xfb4989[_0x1dc75d(0x116)](0xa),_0xfb4989[_0x1dc75d(0x1cd)](_0x34dadf,0xe,0x16);const _0x1c5c6f=_0x1dc75d(0x1cb)+_0xfb4989[_0x1dc75d(0x1a5)]['getNumberOfPages'](),_0x4d31ff=_0xfb4989[_0x1dc75d(0x1a5)][_0x1dc75d(0x12d)],_0x396cd3=_0x4d31ff[_0x1dc75d(0x170)]?_0x4d31ff[_0x1dc75d(0x170)]:_0x4d31ff[_0x1dc75d(0x124)]();_0xfb4989[_0x1dc75d(0x1cd)](_0x1c5c6f,_0x872c56[_0x1dc75d(0x174)][_0x1dc75d(0x13b)][_0x1dc75d(0x1c2)],_0x396cd3-0xa),_0xfb4989[_0x1dc75d(0x1cd)](new Date()[_0x1dc75d(0x17c)](),_0x4d31ff[_0x1dc75d(0x1a6)]-_0x872c56[_0x1dc75d(0x174)]['margin'][_0x1dc75d(0x1ad)]-0x28,_0x396cd3-0xa);}};_0xfb4989['autoTable']({'head':[[_0x3e3262(0x11b),_0x3e3262(0x175),_0x3e3262(0x1a4),_0x3e3262(0x163),'Prix']],'body':_0x217141,..._0x1472e3}),_0xfb4989['save'](_0x3e3262(0x123));},window[_0x1fac09(0x157)]=function(){const _0x321bda=_0x1fac09,_0x175332=document['getElementById']('vendorFilter')[_0x321bda(0x155)],_0x257db2=document['getElementById'](_0x321bda(0x1a3))['value'],_0x39b0f0=new Date(document[_0x321bda(0x18b)]('startDate')[_0x321bda(0x155)]),_0x31b689=new Date(document[_0x321bda(0x18b)](_0x321bda(0x1cf))[_0x321bda(0x155)]);_0x31b689[_0x321bda(0x150)](0x17,0x3b,0x3b);let _0x3e6dce=allSales;_0x175332!==_0x321bda(0x142)&&(_0x3e6dce=_0x3e6dce[_0x321bda(0x12c)](_0x5d72b0=>_0x5d72b0['vendor']===_0x175332));if(_0x257db2!==_0x321bda(0x142)||!isNaN(_0x39b0f0[_0x321bda(0x1cc)]())||!isNaN(_0x31b689['getTime']())){const _0x30523f=new Date(),_0x3e9e6a={'today':new Date(_0x30523f['setHours'](0x0,0x0,0x0,0x0)),'week':new Date(_0x30523f['setDate'](_0x30523f['getDate']()-_0x30523f['getDay']())),'month':new Date(_0x30523f['setDate'](0x1))};_0x3e6dce=_0x3e6dce[_0x321bda(0x12c)](_0x3fcefe=>{const _0x374fc5=_0x321bda,_0x465aa9=new Date(_0x3fcefe[_0x374fc5(0x197)]);if(_0x257db2!==_0x374fc5(0x142)&&_0x3e9e6a[_0x257db2])return _0x465aa9>=_0x3e9e6a[_0x257db2];if(!isNaN(_0x39b0f0[_0x374fc5(0x1cc)]())&&!isNaN(_0x31b689[_0x374fc5(0x1cc)]()))return _0x465aa9>=_0x39b0f0&&_0x465aa9<=_0x31b689;return!![];});}const _0xdff22a=_0x3e6dce['map'](_0x4f8288=>({'Date':new Date(_0x4f8288[_0x321bda(0x197)])[_0x321bda(0x17c)](),'Vendeur':_0x4f8288[_0x321bda(0x19f)],'Catégorie':_0x4f8288['category'],'Utilisateur':_0x4f8288[_0x321bda(0x1b3)],'Prix':_0x4f8288[_0x321bda(0x14e)]})),_0x51735f=XLSX['utils'][_0x321bda(0x1a9)](_0xdff22a),_0x597b8a=XLSX[_0x321bda(0x158)]['book_new']();XLSX[_0x321bda(0x158)][_0x321bda(0x1aa)](_0x597b8a,_0x51735f,_0x321bda(0x188));const _0x10216f=['Date',_0x321bda(0x175),_0x321bda(0x1a4),_0x321bda(0x163),_0x321bda(0x195)];XLSX[_0x321bda(0x158)][_0x321bda(0x138)](_0x51735f,[_0x10216f],{'origin':'A1'});const _0x35778d=XLSX[_0x321bda(0x154)](_0x597b8a,{'bookType':_0x321bda(0x186),'type':_0x321bda(0x135)});function _0x5691bc(_0x4b7b85){const _0x3a8cc4=_0x321bda,_0x275c27=new ArrayBuffer(_0x4b7b85[_0x3a8cc4(0x196)]),_0x590203=new Uint8Array(_0x275c27);for(let _0x2268be=0x0;_0x2268be<_0x4b7b85[_0x3a8cc4(0x196)];_0x2268be++)_0x590203[_0x2268be]=_0x4b7b85[_0x3a8cc4(0x1a0)](_0x2268be)&0xff;return _0x275c27;}saveAs(new Blob([_0x5691bc(_0x35778d)],{'type':'application/octet-stream'}),_0x321bda(0x19c));},document[_0x1fac09(0x191)](_0x1fac09(0x14f),async()=>{const _0x1855ec=_0x1fac09;showPageLoader(),await initializeDatabase(),await checkLoginStatus();const _0xb56c45=await checkSubscriptionStatus();_0xb56c45?(await loadSalesData(),await loadPartners(),document[_0x1855ec(0x18b)](_0x1855ec(0x1a3))[_0x1855ec(0x155)]='today',applyFilters(),hidePageLoader()):hidePageLoader();}),window[_0x1fac09(0x14c)]=redirectToSubscription,window[_0x1fac09(0x19e)]=redirectToSubscription;
    </script>
</body>
</html>